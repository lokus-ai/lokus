#!/usr/bin/env node
var _p=Object.create;var ro=Object.defineProperty;var kp=Object.getOwnPropertyDescriptor;var Sp=Object.getOwnPropertyNames;var xp=Object.getPrototypeOf,vp=Object.prototype.hasOwnProperty;var z=(t,e)=>()=>(t&&(e=t(t=0)),e);var no=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ie=(t,e)=>{for(var r in e)ro(t,r,{get:e[r],enumerable:!0})},Tp=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Sp(e))!vp.call(t,s)&&s!==r&&ro(t,s,{get:()=>e[s],enumerable:!(a=kp(e,s))||a.enumerable});return t};var Be=(t,e,r)=>(r=t!=null?_p(xp(t)):{},Tp(e||!t||!t.__esModule?ro(r,"default",{value:t,enumerable:!0}):r,t));function Em(t){if(!/^data:/i.test(t))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');t=t.replace(/\r?\n/g,"");let e=t.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let r=t.substring(5,e).split(";"),a="",s=!1,i=r[0]||"text/plain",c=i;for(let m=1;m<r.length;m++)r[m]==="base64"?s=!0:r[m]&&(c+=`;${r[m]}`,r[m].indexOf("charset=")===0&&(a=r[m].substring(8)));!r[0]&&!a.length&&(c+=";charset=US-ASCII",a="US-ASCII");let u=s?"base64":"ascii",f=unescape(t.substring(e+1)),d=Buffer.from(f,u);return d.type=i,d.typeFull=c,d.charset=a,d}var ul,dl=z(()=>{ul=Em});var pl=no((za,fl)=>{(function(t,e){typeof za=="object"&&typeof fl<"u"?e(za):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.WebStreamsPolyfill={}))})(za,(function(t){"use strict";function e(){}function r(n){return typeof n=="object"&&n!==null||typeof n=="function"}let a=e;function s(n,o){try{Object.defineProperty(n,"name",{value:o,configurable:!0})}catch{}}let i=Promise,c=Promise.prototype.then,u=Promise.reject.bind(i);function f(n){return new i(n)}function d(n){return f(o=>o(n))}function m(n){return u(n)}function w(n,o,l){return c.call(n,o,l)}function S(n,o,l){w(w(n,o,l),void 0,a)}function R(n,o){S(n,o)}function x(n,o){S(n,void 0,o)}function N(n,o,l){return w(n,o,l)}function W(n){w(n,void 0,a)}let P=n=>{if(typeof queueMicrotask=="function")P=queueMicrotask;else{let o=d(void 0);P=l=>w(o,l)}return P(n)};function U(n,o,l){if(typeof n!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(n,o,l)}function te(n,o,l){try{return d(U(n,o,l))}catch(p){return m(p)}}let H=16384;class V{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(o){let l=this._back,p=l;l._elements.length===H-1&&(p={_elements:[],_next:void 0}),l._elements.push(o),p!==l&&(this._back=p,l._next=p),++this._size}shift(){let o=this._front,l=o,p=this._cursor,g=p+1,b=o._elements,_=b[p];return g===H&&(l=o._next,g=0),--this._size,this._cursor=g,o!==l&&(this._front=l),b[p]=void 0,_}forEach(o){let l=this._cursor,p=this._front,g=p._elements;for(;(l!==g.length||p._next!==void 0)&&!(l===g.length&&(p=p._next,g=p._elements,l=0,g.length===0));)o(g[l]),++l}peek(){let o=this._front,l=this._cursor;return o._elements[l]}}let K=Symbol("[[AbortSteps]]"),Pt=Symbol("[[ErrorSteps]]"),gn=Symbol("[[CancelSteps]]"),gs=Symbol("[[PullSteps]]"),ys=Symbol("[[ReleaseSteps]]");function vi(n,o){n._ownerReadableStream=o,o._reader=n,o._state==="readable"?ws(n):o._state==="closed"?Ad(n):Ti(n,o._storedError)}function bs(n,o){let l=n._ownerReadableStream;return We(l,o)}function dt(n){let o=n._ownerReadableStream;o._state==="readable"?_s(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):$d(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),o._readableStreamController[ys](),o._reader=void 0,n._ownerReadableStream=void 0}function na(n){return new TypeError("Cannot "+n+" a stream using a released reader")}function ws(n){n._closedPromise=f((o,l)=>{n._closedPromise_resolve=o,n._closedPromise_reject=l})}function Ti(n,o){ws(n),_s(n,o)}function Ad(n){ws(n),Ci(n)}function _s(n,o){n._closedPromise_reject!==void 0&&(W(n._closedPromise),n._closedPromise_reject(o),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}function $d(n,o){Ti(n,o)}function Ci(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}let Ri=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Pd=Math.trunc||function(n){return n<0?Math.ceil(n):Math.floor(n)};function Id(n){return typeof n=="object"||typeof n=="function"}function Xe(n,o){if(n!==void 0&&!Id(n))throw new TypeError(`${o} is not an object.`)}function Ae(n,o){if(typeof n!="function")throw new TypeError(`${o} is not a function.`)}function Od(n){return typeof n=="object"&&n!==null||typeof n=="function"}function Ei(n,o){if(!Od(n))throw new TypeError(`${o} is not an object.`)}function ft(n,o,l){if(n===void 0)throw new TypeError(`Parameter ${o} is required in '${l}'.`)}function ks(n,o,l){if(n===void 0)throw new TypeError(`${o} is required in '${l}'.`)}function Ss(n){return Number(n)}function Ai(n){return n===0?0:n}function Dd(n){return Ai(Pd(n))}function xs(n,o){let p=Number.MAX_SAFE_INTEGER,g=Number(n);if(g=Ai(g),!Ri(g))throw new TypeError(`${o} is not a finite number`);if(g=Dd(g),g<0||g>p)throw new TypeError(`${o} is outside the accepted range of 0 to ${p}, inclusive`);return!Ri(g)||g===0?0:g}function vs(n,o){if(!jt(n))throw new TypeError(`${o} is not a ReadableStream.`)}function qr(n){return new It(n)}function $i(n,o){n._reader._readRequests.push(o)}function Ts(n,o,l){let g=n._reader._readRequests.shift();l?g._closeSteps():g._chunkSteps(o)}function aa(n){return n._reader._readRequests.length}function Pi(n){let o=n._reader;return!(o===void 0||!Ot(o))}class It{constructor(o){if(ft(o,1,"ReadableStreamDefaultReader"),vs(o,"First parameter"),Ft(o))throw new TypeError("This stream has already been locked for exclusive reading by another reader");vi(this,o),this._readRequests=new V}get closed(){return Ot(this)?this._closedPromise:m(sa("closed"))}cancel(o=void 0){return Ot(this)?this._ownerReadableStream===void 0?m(na("cancel")):bs(this,o):m(sa("cancel"))}read(){if(!Ot(this))return m(sa("read"));if(this._ownerReadableStream===void 0)return m(na("read from"));let o,l,p=f((b,_)=>{o=b,l=_});return yn(this,{_chunkSteps:b=>o({value:b,done:!1}),_closeSteps:()=>o({value:void 0,done:!0}),_errorSteps:b=>l(b)}),p}releaseLock(){if(!Ot(this))throw sa("releaseLock");this._ownerReadableStream!==void 0&&Ld(this)}}Object.defineProperties(It.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(It.prototype.cancel,"cancel"),s(It.prototype.read,"read"),s(It.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(It.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ot(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_readRequests")?!1:n instanceof It}function yn(n,o){let l=n._ownerReadableStream;l._disturbed=!0,l._state==="closed"?o._closeSteps():l._state==="errored"?o._errorSteps(l._storedError):l._readableStreamController[gs](o)}function Ld(n){dt(n);let o=new TypeError("Reader was released");Ii(n,o)}function Ii(n,o){let l=n._readRequests;n._readRequests=new V,l.forEach(p=>{p._errorSteps(o)})}function sa(n){return new TypeError(`ReadableStreamDefaultReader.prototype.${n} can only be used on a ReadableStreamDefaultReader`)}let Nd=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Oi{constructor(o,l){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=o,this._preventCancel=l}next(){let o=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?N(this._ongoingPromise,o,o):o(),this._ongoingPromise}return(o){let l=()=>this._returnSteps(o);return this._ongoingPromise?N(this._ongoingPromise,l,l):l()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let o=this._reader,l,p,g=f((_,T)=>{l=_,p=T});return yn(o,{_chunkSteps:_=>{this._ongoingPromise=void 0,P(()=>l({value:_,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,dt(o),l({value:void 0,done:!0})},_errorSteps:_=>{this._ongoingPromise=void 0,this._isFinished=!0,dt(o),p(_)}}),g}_returnSteps(o){if(this._isFinished)return Promise.resolve({value:o,done:!0});this._isFinished=!0;let l=this._reader;if(!this._preventCancel){let p=bs(l,o);return dt(l),N(p,()=>({value:o,done:!0}))}return dt(l),d({value:o,done:!0})}}let Di={next(){return Li(this)?this._asyncIteratorImpl.next():m(Ni("next"))},return(n){return Li(this)?this._asyncIteratorImpl.return(n):m(Ni("return"))}};Object.setPrototypeOf(Di,Nd);function Md(n,o){let l=qr(n),p=new Oi(l,o),g=Object.create(Di);return g._asyncIteratorImpl=p,g}function Li(n){if(!r(n)||!Object.prototype.hasOwnProperty.call(n,"_asyncIteratorImpl"))return!1;try{return n._asyncIteratorImpl instanceof Oi}catch{return!1}}function Ni(n){return new TypeError(`ReadableStreamAsyncIterator.${n} can only be used on a ReadableSteamAsyncIterator`)}let Mi=Number.isNaN||function(n){return n!==n};var Cs,Rs,Es;function bn(n){return n.slice()}function ji(n,o,l,p,g){new Uint8Array(n).set(new Uint8Array(l,p,g),o)}let pt=n=>(typeof n.transfer=="function"?pt=o=>o.transfer():typeof structuredClone=="function"?pt=o=>structuredClone(o,{transfer:[o]}):pt=o=>o,pt(n)),Dt=n=>(typeof n.detached=="boolean"?Dt=o=>o.detached:Dt=o=>o.byteLength===0,Dt(n));function Fi(n,o,l){if(n.slice)return n.slice(o,l);let p=l-o,g=new ArrayBuffer(p);return ji(g,0,n,o,p),g}function oa(n,o){let l=n[o];if(l!=null){if(typeof l!="function")throw new TypeError(`${String(o)} is not a function`);return l}}function jd(n){let o={[Symbol.iterator]:()=>n.iterator},l=(async function*(){return yield*o})(),p=l.next;return{iterator:l,nextMethod:p,done:!1}}let As=(Es=(Cs=Symbol.asyncIterator)!==null&&Cs!==void 0?Cs:(Rs=Symbol.for)===null||Rs===void 0?void 0:Rs.call(Symbol,"Symbol.asyncIterator"))!==null&&Es!==void 0?Es:"@@asyncIterator";function Wi(n,o="sync",l){if(l===void 0)if(o==="async"){if(l=oa(n,As),l===void 0){let b=oa(n,Symbol.iterator),_=Wi(n,"sync",b);return jd(_)}}else l=oa(n,Symbol.iterator);if(l===void 0)throw new TypeError("The object is not iterable");let p=U(l,n,[]);if(!r(p))throw new TypeError("The iterator method must return an object");let g=p.next;return{iterator:p,nextMethod:g,done:!1}}function Fd(n){let o=U(n.nextMethod,n.iterator,[]);if(!r(o))throw new TypeError("The iterator.next() method must return an object");return o}function Wd(n){return!!n.done}function qd(n){return n.value}function Bd(n){return!(typeof n!="number"||Mi(n)||n<0)}function qi(n){let o=Fi(n.buffer,n.byteOffset,n.byteOffset+n.byteLength);return new Uint8Array(o)}function $s(n){let o=n._queue.shift();return n._queueTotalSize-=o.size,n._queueTotalSize<0&&(n._queueTotalSize=0),o.value}function Ps(n,o,l){if(!Bd(l)||l===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");n._queue.push({value:o,size:l}),n._queueTotalSize+=l}function Ud(n){return n._queue.peek().value}function Lt(n){n._queue=new V,n._queueTotalSize=0}function Bi(n){return n===DataView}function zd(n){return Bi(n.constructor)}function Hd(n){return Bi(n)?1:n.BYTES_PER_ELEMENT}class Kt{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Is(this))throw Ms("view");return this._view}respond(o){if(!Is(this))throw Ms("respond");if(ft(o,1,"respond"),o=xs(o,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Dt(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");ua(this._associatedReadableByteStreamController,o)}respondWithNewView(o){if(!Is(this))throw Ms("respondWithNewView");if(ft(o,1,"respondWithNewView"),!ArrayBuffer.isView(o))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Dt(o.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");da(this._associatedReadableByteStreamController,o)}}Object.defineProperties(Kt.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s(Kt.prototype.respond,"respond"),s(Kt.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Kt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ht{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Xt(this))throw _n("byobRequest");return Ns(this)}get desiredSize(){if(!Xt(this))throw _n("desiredSize");return Ki(this)}close(){if(!Xt(this))throw _n("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be closed`);wn(this)}enqueue(o){if(!Xt(this))throw _n("enqueue");if(ft(o,1,"enqueue"),!ArrayBuffer.isView(o))throw new TypeError("chunk must be an array buffer view");if(o.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(o.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let l=this._controlledReadableByteStream._state;if(l!=="readable")throw new TypeError(`The stream (in ${l} state) is not in the readable state and cannot be enqueued to`);la(this,o)}error(o=void 0){if(!Xt(this))throw _n("error");$e(this,o)}[gn](o){Ui(this),Lt(this);let l=this._cancelAlgorithm(o);return ca(this),l}[gs](o){let l=this._controlledReadableByteStream;if(this._queueTotalSize>0){Qi(this,o);return}let p=this._autoAllocateChunkSize;if(p!==void 0){let g;try{g=new ArrayBuffer(p)}catch(_){o._errorSteps(_);return}let b={buffer:g,bufferByteLength:p,byteOffset:0,byteLength:p,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(b)}$i(l,o),er(this)}[ys](){if(this._pendingPullIntos.length>0){let o=this._pendingPullIntos.peek();o.readerType="none",this._pendingPullIntos=new V,this._pendingPullIntos.push(o)}}}Object.defineProperties(ht.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(ht.prototype.close,"close"),s(ht.prototype.enqueue,"enqueue"),s(ht.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Xt(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableByteStream")?!1:n instanceof ht}function Is(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_associatedReadableByteStreamController")?!1:n instanceof Kt}function er(n){if(!Yd(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let l=n._pullAlgorithm();S(l,()=>(n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,er(n)),null),p=>($e(n,p),null))}function Ui(n){Ds(n),n._pendingPullIntos=new V}function Os(n,o){let l=!1;n._state==="closed"&&(l=!0);let p=zi(o);o.readerType==="default"?Ts(n,p,l):rf(n,p,l)}function zi(n){let o=n.bytesFilled,l=n.elementSize;return new n.viewConstructor(n.buffer,n.byteOffset,o/l)}function ia(n,o,l,p){n._queue.push({buffer:o,byteOffset:l,byteLength:p}),n._queueTotalSize+=p}function Hi(n,o,l,p){let g;try{g=Fi(o,l,l+p)}catch(b){throw $e(n,b),b}ia(n,g,0,p)}function Vi(n,o){o.bytesFilled>0&&Hi(n,o.buffer,o.byteOffset,o.bytesFilled),Br(n)}function Gi(n,o){let l=Math.min(n._queueTotalSize,o.byteLength-o.bytesFilled),p=o.bytesFilled+l,g=l,b=!1,_=p%o.elementSize,T=p-_;T>=o.minimumFill&&(g=T-o.bytesFilled,b=!0);let D=n._queue;for(;g>0;){let A=D.peek(),L=Math.min(g,A.byteLength),F=o.byteOffset+o.bytesFilled;ji(o.buffer,F,A.buffer,A.byteOffset,L),A.byteLength===L?D.shift():(A.byteOffset+=L,A.byteLength-=L),n._queueTotalSize-=L,Ji(n,L,o),g-=L}return b}function Ji(n,o,l){l.bytesFilled+=o}function Zi(n){n._queueTotalSize===0&&n._closeRequested?(ca(n),Cn(n._controlledReadableByteStream)):er(n)}function Ds(n){n._byobRequest!==null&&(n._byobRequest._associatedReadableByteStreamController=void 0,n._byobRequest._view=null,n._byobRequest=null)}function Ls(n){for(;n._pendingPullIntos.length>0;){if(n._queueTotalSize===0)return;let o=n._pendingPullIntos.peek();Gi(n,o)&&(Br(n),Os(n._controlledReadableByteStream,o))}}function Vd(n){let o=n._controlledReadableByteStream._reader;for(;o._readRequests.length>0;){if(n._queueTotalSize===0)return;let l=o._readRequests.shift();Qi(n,l)}}function Gd(n,o,l,p){let g=n._controlledReadableByteStream,b=o.constructor,_=Hd(b),{byteOffset:T,byteLength:D}=o,A=l*_,L;try{L=pt(o.buffer)}catch(J){p._errorSteps(J);return}let F={buffer:L,bufferByteLength:L.byteLength,byteOffset:T,byteLength:D,bytesFilled:0,minimumFill:A,elementSize:_,viewConstructor:b,readerType:"byob"};if(n._pendingPullIntos.length>0){n._pendingPullIntos.push(F),tc(g,p);return}if(g._state==="closed"){let J=new b(F.buffer,F.byteOffset,0);p._closeSteps(J);return}if(n._queueTotalSize>0){if(Gi(n,F)){let J=zi(F);Zi(n),p._chunkSteps(J);return}if(n._closeRequested){let J=new TypeError("Insufficient bytes to fill elements in the given buffer");$e(n,J),p._errorSteps(J);return}}n._pendingPullIntos.push(F),tc(g,p),er(n)}function Jd(n,o){o.readerType==="none"&&Br(n);let l=n._controlledReadableByteStream;if(js(l))for(;rc(l)>0;){let p=Br(n);Os(l,p)}}function Zd(n,o,l){if(Ji(n,o,l),l.readerType==="none"){Vi(n,l),Ls(n);return}if(l.bytesFilled<l.minimumFill)return;Br(n);let p=l.bytesFilled%l.elementSize;if(p>0){let g=l.byteOffset+l.bytesFilled;Hi(n,l.buffer,g-p,p)}l.bytesFilled-=p,Os(n._controlledReadableByteStream,l),Ls(n)}function Yi(n,o){let l=n._pendingPullIntos.peek();Ds(n),n._controlledReadableByteStream._state==="closed"?Jd(n,l):Zd(n,o,l),er(n)}function Br(n){return n._pendingPullIntos.shift()}function Yd(n){let o=n._controlledReadableByteStream;return o._state!=="readable"||n._closeRequested||!n._started?!1:!!(Pi(o)&&aa(o)>0||js(o)&&rc(o)>0||Ki(n)>0)}function ca(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0}function wn(n){let o=n._controlledReadableByteStream;if(!(n._closeRequested||o._state!=="readable")){if(n._queueTotalSize>0){n._closeRequested=!0;return}if(n._pendingPullIntos.length>0){let l=n._pendingPullIntos.peek();if(l.bytesFilled%l.elementSize!==0){let p=new TypeError("Insufficient bytes to fill elements in the given buffer");throw $e(n,p),p}}ca(n),Cn(o)}}function la(n,o){let l=n._controlledReadableByteStream;if(n._closeRequested||l._state!=="readable")return;let{buffer:p,byteOffset:g,byteLength:b}=o;if(Dt(p))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let _=pt(p);if(n._pendingPullIntos.length>0){let T=n._pendingPullIntos.peek();if(Dt(T.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Ds(n),T.buffer=pt(T.buffer),T.readerType==="none"&&Vi(n,T)}if(Pi(l))if(Vd(n),aa(l)===0)ia(n,_,g,b);else{n._pendingPullIntos.length>0&&Br(n);let T=new Uint8Array(_,g,b);Ts(l,T,!1)}else js(l)?(ia(n,_,g,b),Ls(n)):ia(n,_,g,b);er(n)}function $e(n,o){let l=n._controlledReadableByteStream;l._state==="readable"&&(Ui(n),Lt(n),ca(n),Cc(l,o))}function Qi(n,o){let l=n._queue.shift();n._queueTotalSize-=l.byteLength,Zi(n);let p=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);o._chunkSteps(p)}function Ns(n){if(n._byobRequest===null&&n._pendingPullIntos.length>0){let o=n._pendingPullIntos.peek(),l=new Uint8Array(o.buffer,o.byteOffset+o.bytesFilled,o.byteLength-o.bytesFilled),p=Object.create(Kt.prototype);Kd(p,n,l),n._byobRequest=p}return n._byobRequest}function Ki(n){let o=n._controlledReadableByteStream._state;return o==="errored"?null:o==="closed"?0:n._strategyHWM-n._queueTotalSize}function ua(n,o){let l=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(o!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(o===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(l.bytesFilled+o>l.byteLength)throw new RangeError("bytesWritten out of range")}l.buffer=pt(l.buffer),Yi(n,o)}function da(n,o){let l=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(o.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(o.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(l.byteOffset+l.bytesFilled!==o.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(l.bufferByteLength!==o.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(l.bytesFilled+o.byteLength>l.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let g=o.byteLength;l.buffer=pt(o.buffer),Yi(n,g)}function Xi(n,o,l,p,g,b,_){o._controlledReadableByteStream=n,o._pullAgain=!1,o._pulling=!1,o._byobRequest=null,o._queue=o._queueTotalSize=void 0,Lt(o),o._closeRequested=!1,o._started=!1,o._strategyHWM=b,o._pullAlgorithm=p,o._cancelAlgorithm=g,o._autoAllocateChunkSize=_,o._pendingPullIntos=new V,n._readableStreamController=o;let T=l();S(d(T),()=>(o._started=!0,er(o),null),D=>($e(o,D),null))}function Qd(n,o,l){let p=Object.create(ht.prototype),g,b,_;o.start!==void 0?g=()=>o.start(p):g=()=>{},o.pull!==void 0?b=()=>o.pull(p):b=()=>d(void 0),o.cancel!==void 0?_=D=>o.cancel(D):_=()=>d(void 0);let T=o.autoAllocateChunkSize;if(T===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Xi(n,p,g,b,_,l,T)}function Kd(n,o,l){n._associatedReadableByteStreamController=o,n._view=l}function Ms(n){return new TypeError(`ReadableStreamBYOBRequest.prototype.${n} can only be used on a ReadableStreamBYOBRequest`)}function _n(n){return new TypeError(`ReadableByteStreamController.prototype.${n} can only be used on a ReadableByteStreamController`)}function Xd(n,o){Xe(n,o);let l=n?.mode;return{mode:l===void 0?void 0:ef(l,`${o} has member 'mode' that`)}}function ef(n,o){if(n=`${n}`,n!=="byob")throw new TypeError(`${o} '${n}' is not a valid enumeration value for ReadableStreamReaderMode`);return n}function tf(n,o){var l;Xe(n,o);let p=(l=n?.min)!==null&&l!==void 0?l:1;return{min:xs(p,`${o} has member 'min' that`)}}function ec(n){return new Nt(n)}function tc(n,o){n._reader._readIntoRequests.push(o)}function rf(n,o,l){let g=n._reader._readIntoRequests.shift();l?g._closeSteps(o):g._chunkSteps(o)}function rc(n){return n._reader._readIntoRequests.length}function js(n){let o=n._reader;return!(o===void 0||!tr(o))}class Nt{constructor(o){if(ft(o,1,"ReadableStreamBYOBReader"),vs(o,"First parameter"),Ft(o))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Xt(o._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");vi(this,o),this._readIntoRequests=new V}get closed(){return tr(this)?this._closedPromise:m(fa("closed"))}cancel(o=void 0){return tr(this)?this._ownerReadableStream===void 0?m(na("cancel")):bs(this,o):m(fa("cancel"))}read(o,l={}){if(!tr(this))return m(fa("read"));if(!ArrayBuffer.isView(o))return m(new TypeError("view must be an array buffer view"));if(o.byteLength===0)return m(new TypeError("view must have non-zero byteLength"));if(o.buffer.byteLength===0)return m(new TypeError("view's buffer must have non-zero byteLength"));if(Dt(o.buffer))return m(new TypeError("view's buffer has been detached"));let p;try{p=tf(l,"options")}catch(A){return m(A)}let g=p.min;if(g===0)return m(new TypeError("options.min must be greater than 0"));if(zd(o)){if(g>o.byteLength)return m(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(g>o.length)return m(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return m(na("read from"));let b,_,T=f((A,L)=>{b=A,_=L});return nc(this,o,g,{_chunkSteps:A=>b({value:A,done:!1}),_closeSteps:A=>b({value:A,done:!0}),_errorSteps:A=>_(A)}),T}releaseLock(){if(!tr(this))throw fa("releaseLock");this._ownerReadableStream!==void 0&&nf(this)}}Object.defineProperties(Nt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(Nt.prototype.cancel,"cancel"),s(Nt.prototype.read,"read"),s(Nt.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Nt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function tr(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_readIntoRequests")?!1:n instanceof Nt}function nc(n,o,l,p){let g=n._ownerReadableStream;g._disturbed=!0,g._state==="errored"?p._errorSteps(g._storedError):Gd(g._readableStreamController,o,l,p)}function nf(n){dt(n);let o=new TypeError("Reader was released");ac(n,o)}function ac(n,o){let l=n._readIntoRequests;n._readIntoRequests=new V,l.forEach(p=>{p._errorSteps(o)})}function fa(n){return new TypeError(`ReadableStreamBYOBReader.prototype.${n} can only be used on a ReadableStreamBYOBReader`)}function kn(n,o){let{highWaterMark:l}=n;if(l===void 0)return o;if(Mi(l)||l<0)throw new RangeError("Invalid highWaterMark");return l}function pa(n){let{size:o}=n;return o||(()=>1)}function ha(n,o){Xe(n,o);let l=n?.highWaterMark,p=n?.size;return{highWaterMark:l===void 0?void 0:Ss(l),size:p===void 0?void 0:af(p,`${o} has member 'size' that`)}}function af(n,o){return Ae(n,o),l=>Ss(n(l))}function sf(n,o){Xe(n,o);let l=n?.abort,p=n?.close,g=n?.start,b=n?.type,_=n?.write;return{abort:l===void 0?void 0:of(l,n,`${o} has member 'abort' that`),close:p===void 0?void 0:cf(p,n,`${o} has member 'close' that`),start:g===void 0?void 0:lf(g,n,`${o} has member 'start' that`),write:_===void 0?void 0:uf(_,n,`${o} has member 'write' that`),type:b}}function of(n,o,l){return Ae(n,l),p=>te(n,o,[p])}function cf(n,o,l){return Ae(n,l),()=>te(n,o,[])}function lf(n,o,l){return Ae(n,l),p=>U(n,o,[p])}function uf(n,o,l){return Ae(n,l),(p,g)=>te(n,o,[p,g])}function sc(n,o){if(!Ur(n))throw new TypeError(`${o} is not a WritableStream.`)}function df(n){if(typeof n!="object"||n===null)return!1;try{return typeof n.aborted=="boolean"}catch{return!1}}let ff=typeof AbortController=="function";function pf(){if(ff)return new AbortController}class Mt{constructor(o={},l={}){o===void 0?o=null:Ei(o,"First parameter");let p=ha(l,"Second parameter"),g=sf(o,"First parameter");if(ic(this),g.type!==void 0)throw new RangeError("Invalid type is specified");let _=pa(p),T=kn(p,1);Rf(this,g,T,_)}get locked(){if(!Ur(this))throw wa("locked");return zr(this)}abort(o=void 0){return Ur(this)?zr(this)?m(new TypeError("Cannot abort a stream that already has a writer")):ma(this,o):m(wa("abort"))}close(){return Ur(this)?zr(this)?m(new TypeError("Cannot close a stream that already has a writer")):et(this)?m(new TypeError("Cannot close an already-closing stream")):cc(this):m(wa("close"))}getWriter(){if(!Ur(this))throw wa("getWriter");return oc(this)}}Object.defineProperties(Mt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(Mt.prototype.abort,"abort"),s(Mt.prototype.close,"close"),s(Mt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Mt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function oc(n){return new mt(n)}function hf(n,o,l,p,g=1,b=()=>1){let _=Object.create(Mt.prototype);ic(_);let T=Object.create(Hr.prototype);return hc(_,T,n,o,l,p,g,b),_}function ic(n){n._state="writable",n._storedError=void 0,n._writer=void 0,n._writableStreamController=void 0,n._writeRequests=new V,n._inFlightWriteRequest=void 0,n._closeRequest=void 0,n._inFlightCloseRequest=void 0,n._pendingAbortRequest=void 0,n._backpressure=!1}function Ur(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_writableStreamController")?!1:n instanceof Mt}function zr(n){return n._writer!==void 0}function ma(n,o){var l;if(n._state==="closed"||n._state==="errored")return d(void 0);n._writableStreamController._abortReason=o,(l=n._writableStreamController._abortController)===null||l===void 0||l.abort(o);let p=n._state;if(p==="closed"||p==="errored")return d(void 0);if(n._pendingAbortRequest!==void 0)return n._pendingAbortRequest._promise;let g=!1;p==="erroring"&&(g=!0,o=void 0);let b=f((_,T)=>{n._pendingAbortRequest={_promise:void 0,_resolve:_,_reject:T,_reason:o,_wasAlreadyErroring:g}});return n._pendingAbortRequest._promise=b,g||Ws(n,o),b}function cc(n){let o=n._state;if(o==="closed"||o==="errored")return m(new TypeError(`The stream (in ${o} state) is not in the writable state and cannot be closed`));let l=f((g,b)=>{let _={_resolve:g,_reject:b};n._closeRequest=_}),p=n._writer;return p!==void 0&&n._backpressure&&o==="writable"&&Js(p),Ef(n._writableStreamController),l}function mf(n){return f((l,p)=>{let g={_resolve:l,_reject:p};n._writeRequests.push(g)})}function Fs(n,o){if(n._state==="writable"){Ws(n,o);return}qs(n)}function Ws(n,o){let l=n._writableStreamController;n._state="erroring",n._storedError=o;let p=n._writer;p!==void 0&&uc(p,o),!_f(n)&&l._started&&qs(n)}function qs(n){n._state="errored",n._writableStreamController[Pt]();let o=n._storedError;if(n._writeRequests.forEach(g=>{g._reject(o)}),n._writeRequests=new V,n._pendingAbortRequest===void 0){ga(n);return}let l=n._pendingAbortRequest;if(n._pendingAbortRequest=void 0,l._wasAlreadyErroring){l._reject(o),ga(n);return}let p=n._writableStreamController[K](l._reason);S(p,()=>(l._resolve(),ga(n),null),g=>(l._reject(g),ga(n),null))}function gf(n){n._inFlightWriteRequest._resolve(void 0),n._inFlightWriteRequest=void 0}function yf(n,o){n._inFlightWriteRequest._reject(o),n._inFlightWriteRequest=void 0,Fs(n,o)}function bf(n){n._inFlightCloseRequest._resolve(void 0),n._inFlightCloseRequest=void 0,n._state==="erroring"&&(n._storedError=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._resolve(),n._pendingAbortRequest=void 0)),n._state="closed";let l=n._writer;l!==void 0&&bc(l)}function wf(n,o){n._inFlightCloseRequest._reject(o),n._inFlightCloseRequest=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._reject(o),n._pendingAbortRequest=void 0),Fs(n,o)}function et(n){return!(n._closeRequest===void 0&&n._inFlightCloseRequest===void 0)}function _f(n){return!(n._inFlightWriteRequest===void 0&&n._inFlightCloseRequest===void 0)}function kf(n){n._inFlightCloseRequest=n._closeRequest,n._closeRequest=void 0}function Sf(n){n._inFlightWriteRequest=n._writeRequests.shift()}function ga(n){n._closeRequest!==void 0&&(n._closeRequest._reject(n._storedError),n._closeRequest=void 0);let o=n._writer;o!==void 0&&Vs(o,n._storedError)}function Bs(n,o){let l=n._writer;l!==void 0&&o!==n._backpressure&&(o?Lf(l):Js(l)),n._backpressure=o}class mt{constructor(o){if(ft(o,1,"WritableStreamDefaultWriter"),sc(o,"First parameter"),zr(o))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=o,o._writer=this;let l=o._state;if(l==="writable")!et(o)&&o._backpressure?ka(this):wc(this),_a(this);else if(l==="erroring")Gs(this,o._storedError),_a(this);else if(l==="closed")wc(this),Of(this);else{let p=o._storedError;Gs(this,p),yc(this,p)}}get closed(){return rr(this)?this._closedPromise:m(nr("closed"))}get desiredSize(){if(!rr(this))throw nr("desiredSize");if(this._ownerWritableStream===void 0)throw xn("desiredSize");return Cf(this)}get ready(){return rr(this)?this._readyPromise:m(nr("ready"))}abort(o=void 0){return rr(this)?this._ownerWritableStream===void 0?m(xn("abort")):xf(this,o):m(nr("abort"))}close(){if(!rr(this))return m(nr("close"));let o=this._ownerWritableStream;return o===void 0?m(xn("close")):et(o)?m(new TypeError("Cannot close an already-closing stream")):lc(this)}releaseLock(){if(!rr(this))throw nr("releaseLock");this._ownerWritableStream!==void 0&&dc(this)}write(o=void 0){return rr(this)?this._ownerWritableStream===void 0?m(xn("write to")):fc(this,o):m(nr("write"))}}Object.defineProperties(mt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(mt.prototype.abort,"abort"),s(mt.prototype.close,"close"),s(mt.prototype.releaseLock,"releaseLock"),s(mt.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function rr(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_ownerWritableStream")?!1:n instanceof mt}function xf(n,o){let l=n._ownerWritableStream;return ma(l,o)}function lc(n){let o=n._ownerWritableStream;return cc(o)}function vf(n){let o=n._ownerWritableStream,l=o._state;return et(o)||l==="closed"?d(void 0):l==="errored"?m(o._storedError):lc(n)}function Tf(n,o){n._closedPromiseState==="pending"?Vs(n,o):Df(n,o)}function uc(n,o){n._readyPromiseState==="pending"?_c(n,o):Nf(n,o)}function Cf(n){let o=n._ownerWritableStream,l=o._state;return l==="errored"||l==="erroring"?null:l==="closed"?0:mc(o._writableStreamController)}function dc(n){let o=n._ownerWritableStream,l=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");uc(n,l),Tf(n,l),o._writer=void 0,n._ownerWritableStream=void 0}function fc(n,o){let l=n._ownerWritableStream,p=l._writableStreamController,g=Af(p,o);if(l!==n._ownerWritableStream)return m(xn("write to"));let b=l._state;if(b==="errored")return m(l._storedError);if(et(l)||b==="closed")return m(new TypeError("The stream is closing or closed and cannot be written to"));if(b==="erroring")return m(l._storedError);let _=mf(l);return $f(p,o,g),_}let pc={};class Hr{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Us(this))throw Hs("abortReason");return this._abortReason}get signal(){if(!Us(this))throw Hs("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(o=void 0){if(!Us(this))throw Hs("error");this._controlledWritableStream._state==="writable"&&gc(this,o)}[K](o){let l=this._abortAlgorithm(o);return ya(this),l}[Pt](){Lt(this)}}Object.defineProperties(Hr.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Hr.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Us(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledWritableStream")?!1:n instanceof Hr}function hc(n,o,l,p,g,b,_,T){o._controlledWritableStream=n,n._writableStreamController=o,o._queue=void 0,o._queueTotalSize=void 0,Lt(o),o._abortReason=void 0,o._abortController=pf(),o._started=!1,o._strategySizeAlgorithm=T,o._strategyHWM=_,o._writeAlgorithm=p,o._closeAlgorithm=g,o._abortAlgorithm=b;let D=zs(o);Bs(n,D);let A=l(),L=d(A);S(L,()=>(o._started=!0,ba(o),null),F=>(o._started=!0,Fs(n,F),null))}function Rf(n,o,l,p){let g=Object.create(Hr.prototype),b,_,T,D;o.start!==void 0?b=()=>o.start(g):b=()=>{},o.write!==void 0?_=A=>o.write(A,g):_=()=>d(void 0),o.close!==void 0?T=()=>o.close():T=()=>d(void 0),o.abort!==void 0?D=A=>o.abort(A):D=()=>d(void 0),hc(n,g,b,_,T,D,l,p)}function ya(n){n._writeAlgorithm=void 0,n._closeAlgorithm=void 0,n._abortAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function Ef(n){Ps(n,pc,0),ba(n)}function Af(n,o){try{return n._strategySizeAlgorithm(o)}catch(l){return Sn(n,l),1}}function mc(n){return n._strategyHWM-n._queueTotalSize}function $f(n,o,l){try{Ps(n,o,l)}catch(g){Sn(n,g);return}let p=n._controlledWritableStream;if(!et(p)&&p._state==="writable"){let g=zs(n);Bs(p,g)}ba(n)}function ba(n){let o=n._controlledWritableStream;if(!n._started||o._inFlightWriteRequest!==void 0)return;if(o._state==="erroring"){qs(o);return}if(n._queue.length===0)return;let p=Ud(n);p===pc?Pf(n):If(n,p)}function Sn(n,o){n._controlledWritableStream._state==="writable"&&gc(n,o)}function Pf(n){let o=n._controlledWritableStream;kf(o),$s(n);let l=n._closeAlgorithm();ya(n),S(l,()=>(bf(o),null),p=>(wf(o,p),null))}function If(n,o){let l=n._controlledWritableStream;Sf(l);let p=n._writeAlgorithm(o);S(p,()=>{gf(l);let g=l._state;if($s(n),!et(l)&&g==="writable"){let b=zs(n);Bs(l,b)}return ba(n),null},g=>(l._state==="writable"&&ya(n),yf(l,g),null))}function zs(n){return mc(n)<=0}function gc(n,o){let l=n._controlledWritableStream;ya(n),Ws(l,o)}function wa(n){return new TypeError(`WritableStream.prototype.${n} can only be used on a WritableStream`)}function Hs(n){return new TypeError(`WritableStreamDefaultController.prototype.${n} can only be used on a WritableStreamDefaultController`)}function nr(n){return new TypeError(`WritableStreamDefaultWriter.prototype.${n} can only be used on a WritableStreamDefaultWriter`)}function xn(n){return new TypeError("Cannot "+n+" a stream using a released writer")}function _a(n){n._closedPromise=f((o,l)=>{n._closedPromise_resolve=o,n._closedPromise_reject=l,n._closedPromiseState="pending"})}function yc(n,o){_a(n),Vs(n,o)}function Of(n){_a(n),bc(n)}function Vs(n,o){n._closedPromise_reject!==void 0&&(W(n._closedPromise),n._closedPromise_reject(o),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="rejected")}function Df(n,o){yc(n,o)}function bc(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="resolved")}function ka(n){n._readyPromise=f((o,l)=>{n._readyPromise_resolve=o,n._readyPromise_reject=l}),n._readyPromiseState="pending"}function Gs(n,o){ka(n),_c(n,o)}function wc(n){ka(n),Js(n)}function _c(n,o){n._readyPromise_reject!==void 0&&(W(n._readyPromise),n._readyPromise_reject(o),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="rejected")}function Lf(n){ka(n)}function Nf(n,o){Gs(n,o)}function Js(n){n._readyPromise_resolve!==void 0&&(n._readyPromise_resolve(void 0),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="fulfilled")}function Mf(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Zs=Mf();function jf(n){if(!(typeof n=="function"||typeof n=="object")||n.name!=="DOMException")return!1;try{return new n,!0}catch{return!1}}function Ff(){let n=Zs?.DOMException;return jf(n)?n:void 0}function Wf(){let n=function(l,p){this.message=l||"",this.name=p||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(n,"DOMException"),n.prototype=Object.create(Error.prototype),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,configurable:!0}),n}let qf=Ff()||Wf();function kc(n,o,l,p,g,b){let _=qr(n),T=oc(o);n._disturbed=!0;let D=!1,A=d(void 0);return f((L,F)=>{let J;if(b!==void 0){if(J=()=>{let $=b.reason!==void 0?b.reason:new qf("Aborted","AbortError"),B=[];p||B.push(()=>o._state==="writable"?ma(o,$):d(void 0)),g||B.push(()=>n._state==="readable"?We(n,$):d(void 0)),me(()=>Promise.all(B.map(Y=>Y())),!0,$)},b.aborted){J();return}b.addEventListener("abort",J)}function qe(){return f(($,B)=>{function Y(ke){ke?$():w(Zr(),Y,B)}Y(!1)})}function Zr(){return D?d(!0):w(T._readyPromise,()=>f(($,B)=>{yn(_,{_chunkSteps:Y=>{A=w(fc(T,Y),void 0,e),$(!1)},_closeSteps:()=>$(!0),_errorSteps:B})}))}if(yt(n,_._closedPromise,$=>(p?Pe(!0,$):me(()=>ma(o,$),!0,$),null)),yt(o,T._closedPromise,$=>(g?Pe(!0,$):me(()=>We(n,$),!0,$),null)),de(n,_._closedPromise,()=>(l?Pe():me(()=>vf(T)),null)),et(o)||o._state==="closed"){let $=new TypeError("the destination writable stream closed before all data could be piped to it");g?Pe(!0,$):me(()=>We(n,$),!0,$)}W(qe());function qt(){let $=A;return w(A,()=>$!==A?qt():void 0)}function yt($,B,Y){$._state==="errored"?Y($._storedError):x(B,Y)}function de($,B,Y){$._state==="closed"?Y():R(B,Y)}function me($,B,Y){if(D)return;D=!0,o._state==="writable"&&!et(o)?R(qt(),ke):ke();function ke(){return S($(),()=>bt(B,Y),Yr=>bt(!0,Yr)),null}}function Pe($,B){D||(D=!0,o._state==="writable"&&!et(o)?R(qt(),()=>bt($,B)):bt($,B))}function bt($,B){return dc(T),dt(_),b!==void 0&&b.removeEventListener("abort",J),$?F(B):L(void 0),null}})}class gt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Sa(this))throw va("desiredSize");return Ys(this)}close(){if(!Sa(this))throw va("close");if(!Gr(this))throw new TypeError("The stream is not in a state that permits close");ar(this)}enqueue(o=void 0){if(!Sa(this))throw va("enqueue");if(!Gr(this))throw new TypeError("The stream is not in a state that permits enqueue");return Vr(this,o)}error(o=void 0){if(!Sa(this))throw va("error");Fe(this,o)}[gn](o){Lt(this);let l=this._cancelAlgorithm(o);return xa(this),l}[gs](o){let l=this._controlledReadableStream;if(this._queue.length>0){let p=$s(this);this._closeRequested&&this._queue.length===0?(xa(this),Cn(l)):vn(this),o._chunkSteps(p)}else $i(l,o),vn(this)}[ys](){}}Object.defineProperties(gt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(gt.prototype.close,"close"),s(gt.prototype.enqueue,"enqueue"),s(gt.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gt.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Sa(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableStream")?!1:n instanceof gt}function vn(n){if(!Sc(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let l=n._pullAlgorithm();S(l,()=>(n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,vn(n)),null),p=>(Fe(n,p),null))}function Sc(n){let o=n._controlledReadableStream;return!Gr(n)||!n._started?!1:!!(Ft(o)&&aa(o)>0||Ys(n)>0)}function xa(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function ar(n){if(!Gr(n))return;let o=n._controlledReadableStream;n._closeRequested=!0,n._queue.length===0&&(xa(n),Cn(o))}function Vr(n,o){if(!Gr(n))return;let l=n._controlledReadableStream;if(Ft(l)&&aa(l)>0)Ts(l,o,!1);else{let p;try{p=n._strategySizeAlgorithm(o)}catch(g){throw Fe(n,g),g}try{Ps(n,o,p)}catch(g){throw Fe(n,g),g}}vn(n)}function Fe(n,o){let l=n._controlledReadableStream;l._state==="readable"&&(Lt(n),xa(n),Cc(l,o))}function Ys(n){let o=n._controlledReadableStream._state;return o==="errored"?null:o==="closed"?0:n._strategyHWM-n._queueTotalSize}function Bf(n){return!Sc(n)}function Gr(n){let o=n._controlledReadableStream._state;return!n._closeRequested&&o==="readable"}function xc(n,o,l,p,g,b,_){o._controlledReadableStream=n,o._queue=void 0,o._queueTotalSize=void 0,Lt(o),o._started=!1,o._closeRequested=!1,o._pullAgain=!1,o._pulling=!1,o._strategySizeAlgorithm=_,o._strategyHWM=b,o._pullAlgorithm=p,o._cancelAlgorithm=g,n._readableStreamController=o;let T=l();S(d(T),()=>(o._started=!0,vn(o),null),D=>(Fe(o,D),null))}function Uf(n,o,l,p){let g=Object.create(gt.prototype),b,_,T;o.start!==void 0?b=()=>o.start(g):b=()=>{},o.pull!==void 0?_=()=>o.pull(g):_=()=>d(void 0),o.cancel!==void 0?T=D=>o.cancel(D):T=()=>d(void 0),xc(n,g,b,_,T,l,p)}function va(n){return new TypeError(`ReadableStreamDefaultController.prototype.${n} can only be used on a ReadableStreamDefaultController`)}function zf(n,o){return Xt(n._readableStreamController)?Vf(n):Hf(n)}function Hf(n,o){let l=qr(n),p=!1,g=!1,b=!1,_=!1,T,D,A,L,F,J=f(de=>{F=de});function qe(){return p?(g=!0,d(void 0)):(p=!0,yn(l,{_chunkSteps:me=>{P(()=>{g=!1;let Pe=me,bt=me;b||Vr(A._readableStreamController,Pe),_||Vr(L._readableStreamController,bt),p=!1,g&&qe()})},_closeSteps:()=>{p=!1,b||ar(A._readableStreamController),_||ar(L._readableStreamController),(!b||!_)&&F(void 0)},_errorSteps:()=>{p=!1}}),d(void 0))}function Zr(de){if(b=!0,T=de,_){let me=bn([T,D]),Pe=We(n,me);F(Pe)}return J}function qt(de){if(_=!0,D=de,b){let me=bn([T,D]),Pe=We(n,me);F(Pe)}return J}function yt(){}return A=Tn(yt,qe,Zr),L=Tn(yt,qe,qt),x(l._closedPromise,de=>(Fe(A._readableStreamController,de),Fe(L._readableStreamController,de),(!b||!_)&&F(void 0),null)),[A,L]}function Vf(n){let o=qr(n),l=!1,p=!1,g=!1,b=!1,_=!1,T,D,A,L,F,J=f($=>{F=$});function qe($){x($._closedPromise,B=>($!==o||($e(A._readableStreamController,B),$e(L._readableStreamController,B),(!b||!_)&&F(void 0)),null))}function Zr(){tr(o)&&(dt(o),o=qr(n),qe(o)),yn(o,{_chunkSteps:B=>{P(()=>{p=!1,g=!1;let Y=B,ke=B;if(!b&&!_)try{ke=qi(B)}catch(Yr){$e(A._readableStreamController,Yr),$e(L._readableStreamController,Yr),F(We(n,Yr));return}b||la(A._readableStreamController,Y),_||la(L._readableStreamController,ke),l=!1,p?yt():g&&de()})},_closeSteps:()=>{l=!1,b||wn(A._readableStreamController),_||wn(L._readableStreamController),A._readableStreamController._pendingPullIntos.length>0&&ua(A._readableStreamController,0),L._readableStreamController._pendingPullIntos.length>0&&ua(L._readableStreamController,0),(!b||!_)&&F(void 0)},_errorSteps:()=>{l=!1}})}function qt($,B){Ot(o)&&(dt(o),o=ec(n),qe(o));let Y=B?L:A,ke=B?A:L;nc(o,$,1,{_chunkSteps:Qr=>{P(()=>{p=!1,g=!1;let Kr=B?_:b;if(B?b:_)Kr||da(Y._readableStreamController,Qr);else{let Fc;try{Fc=qi(Qr)}catch(to){$e(Y._readableStreamController,to),$e(ke._readableStreamController,to),F(We(n,to));return}Kr||da(Y._readableStreamController,Qr),la(ke._readableStreamController,Fc)}l=!1,p?yt():g&&de()})},_closeSteps:Qr=>{l=!1;let Kr=B?_:b,Ia=B?b:_;Kr||wn(Y._readableStreamController),Ia||wn(ke._readableStreamController),Qr!==void 0&&(Kr||da(Y._readableStreamController,Qr),!Ia&&ke._readableStreamController._pendingPullIntos.length>0&&ua(ke._readableStreamController,0)),(!Kr||!Ia)&&F(void 0)},_errorSteps:()=>{l=!1}})}function yt(){if(l)return p=!0,d(void 0);l=!0;let $=Ns(A._readableStreamController);return $===null?Zr():qt($._view,!1),d(void 0)}function de(){if(l)return g=!0,d(void 0);l=!0;let $=Ns(L._readableStreamController);return $===null?Zr():qt($._view,!0),d(void 0)}function me($){if(b=!0,T=$,_){let B=bn([T,D]),Y=We(n,B);F(Y)}return J}function Pe($){if(_=!0,D=$,b){let B=bn([T,D]),Y=We(n,B);F(Y)}return J}function bt(){}return A=Tc(bt,yt,me),L=Tc(bt,de,Pe),qe(o),[A,L]}function Gf(n){return r(n)&&typeof n.getReader<"u"}function Jf(n){return Gf(n)?Yf(n.getReader()):Zf(n)}function Zf(n){let o,l=Wi(n,"async"),p=e;function g(){let _;try{_=Fd(l)}catch(D){return m(D)}let T=d(_);return N(T,D=>{if(!r(D))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Wd(D))ar(o._readableStreamController);else{let L=qd(D);Vr(o._readableStreamController,L)}})}function b(_){let T=l.iterator,D;try{D=oa(T,"return")}catch(F){return m(F)}if(D===void 0)return d(void 0);let A;try{A=U(D,T,[_])}catch(F){return m(F)}let L=d(A);return N(L,F=>{if(!r(F))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return o=Tn(p,g,b,0),o}function Yf(n){let o,l=e;function p(){let b;try{b=n.read()}catch(_){return m(_)}return N(b,_=>{if(!r(_))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(_.done)ar(o._readableStreamController);else{let T=_.value;Vr(o._readableStreamController,T)}})}function g(b){try{return d(n.cancel(b))}catch(_){return m(_)}}return o=Tn(l,p,g,0),o}function Qf(n,o){Xe(n,o);let l=n,p=l?.autoAllocateChunkSize,g=l?.cancel,b=l?.pull,_=l?.start,T=l?.type;return{autoAllocateChunkSize:p===void 0?void 0:xs(p,`${o} has member 'autoAllocateChunkSize' that`),cancel:g===void 0?void 0:Kf(g,l,`${o} has member 'cancel' that`),pull:b===void 0?void 0:Xf(b,l,`${o} has member 'pull' that`),start:_===void 0?void 0:ep(_,l,`${o} has member 'start' that`),type:T===void 0?void 0:tp(T,`${o} has member 'type' that`)}}function Kf(n,o,l){return Ae(n,l),p=>te(n,o,[p])}function Xf(n,o,l){return Ae(n,l),p=>te(n,o,[p])}function ep(n,o,l){return Ae(n,l),p=>U(n,o,[p])}function tp(n,o){if(n=`${n}`,n!=="bytes")throw new TypeError(`${o} '${n}' is not a valid enumeration value for ReadableStreamType`);return n}function rp(n,o){return Xe(n,o),{preventCancel:!!n?.preventCancel}}function vc(n,o){Xe(n,o);let l=n?.preventAbort,p=n?.preventCancel,g=n?.preventClose,b=n?.signal;return b!==void 0&&np(b,`${o} has member 'signal' that`),{preventAbort:!!l,preventCancel:!!p,preventClose:!!g,signal:b}}function np(n,o){if(!df(n))throw new TypeError(`${o} is not an AbortSignal.`)}function ap(n,o){Xe(n,o);let l=n?.readable;ks(l,"readable","ReadableWritablePair"),vs(l,`${o} has member 'readable' that`);let p=n?.writable;return ks(p,"writable","ReadableWritablePair"),sc(p,`${o} has member 'writable' that`),{readable:l,writable:p}}class oe{constructor(o={},l={}){o===void 0?o=null:Ei(o,"First parameter");let p=ha(l,"Second parameter"),g=Qf(o,"First parameter");if(Qs(this),g.type==="bytes"){if(p.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let b=kn(p,0);Qd(this,g,b)}else{let b=pa(p),_=kn(p,1);Uf(this,g,_,b)}}get locked(){if(!jt(this))throw sr("locked");return Ft(this)}cancel(o=void 0){return jt(this)?Ft(this)?m(new TypeError("Cannot cancel a stream that already has a reader")):We(this,o):m(sr("cancel"))}getReader(o=void 0){if(!jt(this))throw sr("getReader");return Xd(o,"First parameter").mode===void 0?qr(this):ec(this)}pipeThrough(o,l={}){if(!jt(this))throw sr("pipeThrough");ft(o,1,"pipeThrough");let p=ap(o,"First parameter"),g=vc(l,"Second parameter");if(Ft(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(zr(p.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let b=kc(this,p.writable,g.preventClose,g.preventAbort,g.preventCancel,g.signal);return W(b),p.readable}pipeTo(o,l={}){if(!jt(this))return m(sr("pipeTo"));if(o===void 0)return m("Parameter 1 is required in 'pipeTo'.");if(!Ur(o))return m(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let p;try{p=vc(l,"Second parameter")}catch(g){return m(g)}return Ft(this)?m(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):zr(o)?m(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):kc(this,o,p.preventClose,p.preventAbort,p.preventCancel,p.signal)}tee(){if(!jt(this))throw sr("tee");let o=zf(this);return bn(o)}values(o=void 0){if(!jt(this))throw sr("values");let l=rp(o,"First parameter");return Md(this,l.preventCancel)}[As](o){return this.values(o)}static from(o){return Jf(o)}}Object.defineProperties(oe,{from:{enumerable:!0}}),Object.defineProperties(oe.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s(oe.from,"from"),s(oe.prototype.cancel,"cancel"),s(oe.prototype.getReader,"getReader"),s(oe.prototype.pipeThrough,"pipeThrough"),s(oe.prototype.pipeTo,"pipeTo"),s(oe.prototype.tee,"tee"),s(oe.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(oe.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(oe.prototype,As,{value:oe.prototype.values,writable:!0,configurable:!0});function Tn(n,o,l,p=1,g=()=>1){let b=Object.create(oe.prototype);Qs(b);let _=Object.create(gt.prototype);return xc(b,_,n,o,l,p,g),b}function Tc(n,o,l){let p=Object.create(oe.prototype);Qs(p);let g=Object.create(ht.prototype);return Xi(p,g,n,o,l,0,void 0),p}function Qs(n){n._state="readable",n._reader=void 0,n._storedError=void 0,n._disturbed=!1}function jt(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_readableStreamController")?!1:n instanceof oe}function Ft(n){return n._reader!==void 0}function We(n,o){if(n._disturbed=!0,n._state==="closed")return d(void 0);if(n._state==="errored")return m(n._storedError);Cn(n);let l=n._reader;if(l!==void 0&&tr(l)){let g=l._readIntoRequests;l._readIntoRequests=new V,g.forEach(b=>{b._closeSteps(void 0)})}let p=n._readableStreamController[gn](o);return N(p,e)}function Cn(n){n._state="closed";let o=n._reader;if(o!==void 0&&(Ci(o),Ot(o))){let l=o._readRequests;o._readRequests=new V,l.forEach(p=>{p._closeSteps()})}}function Cc(n,o){n._state="errored",n._storedError=o;let l=n._reader;l!==void 0&&(_s(l,o),Ot(l)?Ii(l,o):ac(l,o))}function sr(n){return new TypeError(`ReadableStream.prototype.${n} can only be used on a ReadableStream`)}function Rc(n,o){Xe(n,o);let l=n?.highWaterMark;return ks(l,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Ss(l)}}let Ec=n=>n.byteLength;s(Ec,"size");class Ta{constructor(o){ft(o,1,"ByteLengthQueuingStrategy"),o=Rc(o,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=o.highWaterMark}get highWaterMark(){if(!$c(this))throw Ac("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!$c(this))throw Ac("size");return Ec}}Object.defineProperties(Ta.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ta.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Ac(n){return new TypeError(`ByteLengthQueuingStrategy.prototype.${n} can only be used on a ByteLengthQueuingStrategy`)}function $c(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_byteLengthQueuingStrategyHighWaterMark")?!1:n instanceof Ta}let Pc=()=>1;s(Pc,"size");class Ca{constructor(o){ft(o,1,"CountQueuingStrategy"),o=Rc(o,"First parameter"),this._countQueuingStrategyHighWaterMark=o.highWaterMark}get highWaterMark(){if(!Oc(this))throw Ic("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Oc(this))throw Ic("size");return Pc}}Object.defineProperties(Ca.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ca.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Ic(n){return new TypeError(`CountQueuingStrategy.prototype.${n} can only be used on a CountQueuingStrategy`)}function Oc(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_countQueuingStrategyHighWaterMark")?!1:n instanceof Ca}function sp(n,o){Xe(n,o);let l=n?.cancel,p=n?.flush,g=n?.readableType,b=n?.start,_=n?.transform,T=n?.writableType;return{cancel:l===void 0?void 0:lp(l,n,`${o} has member 'cancel' that`),flush:p===void 0?void 0:op(p,n,`${o} has member 'flush' that`),readableType:g,start:b===void 0?void 0:ip(b,n,`${o} has member 'start' that`),transform:_===void 0?void 0:cp(_,n,`${o} has member 'transform' that`),writableType:T}}function op(n,o,l){return Ae(n,l),p=>te(n,o,[p])}function ip(n,o,l){return Ae(n,l),p=>U(n,o,[p])}function cp(n,o,l){return Ae(n,l),(p,g)=>te(n,o,[p,g])}function lp(n,o,l){return Ae(n,l),p=>te(n,o,[p])}class Ra{constructor(o={},l={},p={}){o===void 0&&(o=null);let g=ha(l,"Second parameter"),b=ha(p,"Third parameter"),_=sp(o,"First parameter");if(_.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(_.writableType!==void 0)throw new RangeError("Invalid writableType specified");let T=kn(b,0),D=pa(b),A=kn(g,1),L=pa(g),F,J=f(qe=>{F=qe});up(this,J,A,L,T,D),fp(this,_),_.start!==void 0?F(_.start(this._transformStreamController)):F(void 0)}get readable(){if(!Dc(this))throw jc("readable");return this._readable}get writable(){if(!Dc(this))throw jc("writable");return this._writable}}Object.defineProperties(Ra.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ra.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function up(n,o,l,p,g,b){function _(){return o}function T(J){return mp(n,J)}function D(J){return gp(n,J)}function A(){return yp(n)}n._writable=hf(_,T,A,D,l,p);function L(){return bp(n)}function F(J){return wp(n,J)}n._readable=Tn(_,L,F,g,b),n._backpressure=void 0,n._backpressureChangePromise=void 0,n._backpressureChangePromise_resolve=void 0,Ea(n,!0),n._transformStreamController=void 0}function Dc(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_transformStreamController")?!1:n instanceof Ra}function Lc(n,o){Fe(n._readable._readableStreamController,o),Ks(n,o)}function Ks(n,o){$a(n._transformStreamController),Sn(n._writable._writableStreamController,o),Xs(n)}function Xs(n){n._backpressure&&Ea(n,!1)}function Ea(n,o){n._backpressureChangePromise!==void 0&&n._backpressureChangePromise_resolve(),n._backpressureChangePromise=f(l=>{n._backpressureChangePromise_resolve=l}),n._backpressure=o}class Wt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Aa(this))throw Pa("desiredSize");let o=this._controlledTransformStream._readable._readableStreamController;return Ys(o)}enqueue(o=void 0){if(!Aa(this))throw Pa("enqueue");Nc(this,o)}error(o=void 0){if(!Aa(this))throw Pa("error");pp(this,o)}terminate(){if(!Aa(this))throw Pa("terminate");hp(this)}}Object.defineProperties(Wt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Wt.prototype.enqueue,"enqueue"),s(Wt.prototype.error,"error"),s(Wt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Wt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Aa(n){return!r(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledTransformStream")?!1:n instanceof Wt}function dp(n,o,l,p,g){o._controlledTransformStream=n,n._transformStreamController=o,o._transformAlgorithm=l,o._flushAlgorithm=p,o._cancelAlgorithm=g,o._finishPromise=void 0,o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0}function fp(n,o){let l=Object.create(Wt.prototype),p,g,b;o.transform!==void 0?p=_=>o.transform(_,l):p=_=>{try{return Nc(l,_),d(void 0)}catch(T){return m(T)}},o.flush!==void 0?g=()=>o.flush(l):g=()=>d(void 0),o.cancel!==void 0?b=_=>o.cancel(_):b=()=>d(void 0),dp(n,l,p,g,b)}function $a(n){n._transformAlgorithm=void 0,n._flushAlgorithm=void 0,n._cancelAlgorithm=void 0}function Nc(n,o){let l=n._controlledTransformStream,p=l._readable._readableStreamController;if(!Gr(p))throw new TypeError("Readable side is not in a state that permits enqueue");try{Vr(p,o)}catch(b){throw Ks(l,b),l._readable._storedError}Bf(p)!==l._backpressure&&Ea(l,!0)}function pp(n,o){Lc(n._controlledTransformStream,o)}function Mc(n,o){let l=n._transformAlgorithm(o);return N(l,void 0,p=>{throw Lc(n._controlledTransformStream,p),p})}function hp(n){let o=n._controlledTransformStream,l=o._readable._readableStreamController;ar(l);let p=new TypeError("TransformStream terminated");Ks(o,p)}function mp(n,o){let l=n._transformStreamController;if(n._backpressure){let p=n._backpressureChangePromise;return N(p,()=>{let g=n._writable;if(g._state==="erroring")throw g._storedError;return Mc(l,o)})}return Mc(l,o)}function gp(n,o){let l=n._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=n._readable;l._finishPromise=f((b,_)=>{l._finishPromise_resolve=b,l._finishPromise_reject=_});let g=l._cancelAlgorithm(o);return $a(l),S(g,()=>(p._state==="errored"?Jr(l,p._storedError):(Fe(p._readableStreamController,o),eo(l)),null),b=>(Fe(p._readableStreamController,b),Jr(l,b),null)),l._finishPromise}function yp(n){let o=n._transformStreamController;if(o._finishPromise!==void 0)return o._finishPromise;let l=n._readable;o._finishPromise=f((g,b)=>{o._finishPromise_resolve=g,o._finishPromise_reject=b});let p=o._flushAlgorithm();return $a(o),S(p,()=>(l._state==="errored"?Jr(o,l._storedError):(ar(l._readableStreamController),eo(o)),null),g=>(Fe(l._readableStreamController,g),Jr(o,g),null)),o._finishPromise}function bp(n){return Ea(n,!1),n._backpressureChangePromise}function wp(n,o){let l=n._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=n._writable;l._finishPromise=f((b,_)=>{l._finishPromise_resolve=b,l._finishPromise_reject=_});let g=l._cancelAlgorithm(o);return $a(l),S(g,()=>(p._state==="errored"?Jr(l,p._storedError):(Sn(p._writableStreamController,o),Xs(n),eo(l)),null),b=>(Sn(p._writableStreamController,b),Xs(n),Jr(l,b),null)),l._finishPromise}function Pa(n){return new TypeError(`TransformStreamDefaultController.prototype.${n} can only be used on a TransformStreamDefaultController`)}function eo(n){n._finishPromise_resolve!==void 0&&(n._finishPromise_resolve(),n._finishPromise_resolve=void 0,n._finishPromise_reject=void 0)}function Jr(n,o){n._finishPromise_reject!==void 0&&(W(n._finishPromise),n._finishPromise_reject(o),n._finishPromise_resolve=void 0,n._finishPromise_reject=void 0)}function jc(n){return new TypeError(`TransformStream.prototype.${n} can only be used on a TransformStream`)}t.ByteLengthQueuingStrategy=Ta,t.CountQueuingStrategy=Ca,t.ReadableByteStreamController=ht,t.ReadableStream=oe,t.ReadableStreamBYOBReader=Nt,t.ReadableStreamBYOBRequest=Kt,t.ReadableStreamDefaultController=gt,t.ReadableStreamDefaultReader=It,t.TransformStream=Ra,t.TransformStreamDefaultController=Wt,t.WritableStream=Mt,t.WritableStreamDefaultController=Hr,t.WritableStreamDefaultWriter=mt}))});var hl=no(()=>{if(!globalThis.ReadableStream)try{let t=require("node:process"),{emitWarning:e}=t;try{t.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),t.emitWarning=e}catch(r){throw t.emitWarning=e,r}}catch{Object.assign(globalThis,pl())}try{let{Blob:t}=require("buffer");t&&!t.prototype.stream&&(t.prototype.stream=function(r){let a=0,s=this;return new ReadableStream({type:"bytes",async pull(i){let u=await s.slice(a,Math.min(s.size,a+65536)).arrayBuffer();a+=u.byteLength,i.enqueue(new Uint8Array(u)),a===s.size&&i.close()}})})}catch{}});async function*po(t,e=!0){for(let r of t)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(e){let a=r.byteOffset,s=r.byteOffset+r.byteLength;for(;a!==s;){let i=Math.min(s-a,ml),c=r.buffer.slice(a,a+i);a+=c.byteLength,yield new Uint8Array(c)}}else yield r;else{let a=0,s=r;for(;a!==s.size;){let c=await s.slice(a,Math.min(s.size,a+ml)).arrayBuffer();a+=c.byteLength,yield new Uint8Array(c)}}}var p_,ml,gl,Am,Ve,Pn=z(()=>{p_=Be(hl(),1);ml=65536;gl=class ho{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],r={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof r!="object"&&typeof r!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");r===null&&(r={});let a=new TextEncoder;for(let i of e){let c;ArrayBuffer.isView(i)?c=new Uint8Array(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)):i instanceof ArrayBuffer?c=new Uint8Array(i.slice(0)):i instanceof ho?c=i:c=a.encode(`${i}`),this.#r+=ArrayBuffer.isView(c)?c.byteLength:c.size,this.#e.push(c)}this.#n=`${r.endings===void 0?"transparent":r.endings}`;let s=r.type===void 0?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,r="";for await(let a of po(this.#e,!1))r+=e.decode(a,{stream:!0});return r+=e.decode(),r}async arrayBuffer(){let e=new Uint8Array(this.size),r=0;for await(let a of po(this.#e,!1))e.set(a,r),r+=a.length;return e.buffer}stream(){let e=po(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(r){let a=await e.next();a.done?r.close():r.enqueue(a.value)},async cancel(){await e.return()}})}slice(e=0,r=this.size,a=""){let{size:s}=this,i=e<0?Math.max(s+e,0):Math.min(e,s),c=r<0?Math.max(s+r,0):Math.min(r,s),u=Math.max(c-i,0),f=this.#e,d=[],m=0;for(let S of f){if(m>=u)break;let R=ArrayBuffer.isView(S)?S.byteLength:S.size;if(i&&R<=i)i-=R,c-=R;else{let x;ArrayBuffer.isView(S)?(x=S.subarray(i,Math.min(R,c)),m+=x.byteLength):(x=S.slice(i,Math.min(R,c)),m+=x.size),c-=R,d.push(x),i=0}}let w=new ho([],{type:String(a).toLowerCase()});return w.#r=u,w.#e=d,w}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(gl.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Am=gl,Ve=Am});var $m,Pm,Vt,mo=z(()=>{Pn();$m=class extends Ve{#e=0;#t="";constructor(e,r,a={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,a),a===null&&(a={});let s=a.lastModified===void 0?Date.now():Number(a.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(r)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Ve&&/^(File)$/.test(e[Symbol.toStringTag])}},Pm=$m,Vt=Pm});function wl(t,e=Ve){var r=`${yl()}${yl()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),a=[],s=`--${r}\r
Content-Disposition: form-data; name="`;return t.forEach((i,c)=>typeof i=="string"?a.push(s+go(c)+`"\r
\r
${i.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):a.push(s+go(c)+`"; filename="${go(i.name,1)}"\r
Content-Type: ${i.type||"application/octet-stream"}\r
\r
`,i,`\r
`)),a.push(`--${r}--`),new e(a,{type:"multipart/form-data; boundary="+r})}var In,Im,Om,yl,Dm,bl,go,Sr,Gt,Ha=z(()=>{Pn();mo();({toStringTag:In,iterator:Im,hasInstance:Om}=Symbol),yl=Math.random,Dm="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),bl=(t,e,r)=>(t+="",/^(Blob|File)$/.test(e&&e[In])?[(r=r!==void 0?r+"":e[In]=="File"?e.name:"blob",t),e.name!==r||e[In]=="blob"?new Vt([e],r,e):e]:[t,e+""]),go=(t,e)=>(e?t:t.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Sr=(t,e,r)=>{if(e.length<r)throw new TypeError(`Failed to execute '${t}' on 'FormData': ${r} arguments required, but only ${e.length} present.`)},Gt=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[In](){return"FormData"}[Im](){return this.entries()}static[Om](e){return e&&typeof e=="object"&&e[In]==="FormData"&&!Dm.some(r=>typeof e[r]!="function")}append(...e){Sr("append",arguments,2),this.#e.push(bl(...e))}delete(e){Sr("delete",arguments,1),e+="",this.#e=this.#e.filter(([r])=>r!==e)}get(e){Sr("get",arguments,1),e+="";for(var r=this.#e,a=r.length,s=0;s<a;s++)if(r[s][0]===e)return r[s][1];return null}getAll(e,r){return Sr("getAll",arguments,1),r=[],e+="",this.#e.forEach(a=>a[0]===e&&r.push(a[1])),r}has(e){return Sr("has",arguments,1),e+="",this.#e.some(r=>r[0]===e)}forEach(e,r){Sr("forEach",arguments,1);for(var[a,s]of this)e.call(r,s,a,this)}set(...e){Sr("set",arguments,2);var r=[],a=!0;e=bl(...e),this.#e.forEach(s=>{s[0]===e[0]?a&&(a=!r.push(e)):r.push(s)}),a&&r.push(e),this.#e=r}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var xt,Va=z(()=>{xt=class extends Error{constructor(e,r){super(e),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var fe,yo=z(()=>{Va();fe=class extends xt{constructor(e,r,a){super(e,r),a&&(this.code=this.errno=a.code,this.erroredSysCall=a.syscall)}}});var Ga,bo,On,_l,kl,Sl,Ja=z(()=>{Ga=Symbol.toStringTag,bo=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[Ga]==="URLSearchParams",On=t=>t&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[Ga]),_l=t=>typeof t=="object"&&(t[Ga]==="AbortSignal"||t[Ga]==="EventTarget"),kl=(t,e)=>{let r=new URL(e).hostname,a=new URL(t).hostname;return r===a||r.endsWith(`.${a}`)},Sl=(t,e)=>{let r=new URL(e).protocol,a=new URL(t).protocol;return r===a}});var vl=no((C_,xl)=>{if(!globalThis.DOMException)try{let{MessageChannel:t}=require("worker_threads"),e=new t().port1,r=new ArrayBuffer;e.postMessage(r,[r,r])}catch(t){t.constructor.name==="DOMException"&&(globalThis.DOMException=t.constructor)}xl.exports=globalThis.DOMException});var xr,Tl,Cl,wo,Rl,El,Al,$l,Pl,Il,Za,_o=z(()=>{xr=require("node:fs"),Tl=require("node:path"),Cl=Be(vl(),1);mo();Pn();({stat:wo}=xr.promises),Rl=(t,e)=>Pl((0,xr.statSync)(t),t,e),El=(t,e)=>wo(t).then(r=>Pl(r,t,e)),Al=(t,e)=>wo(t).then(r=>Il(r,t,e)),$l=(t,e)=>Il((0,xr.statSync)(t),t,e),Pl=(t,e,r="")=>new Ve([new Za({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],{type:r}),Il=(t,e,r="")=>new Vt([new Za({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],(0,Tl.basename)(e),{type:r,lastModified:t.mtimeMs}),Za=class t{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,r){return new t({path:this.#e,lastModified:this.lastModified,size:r-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await wo(this.#e);if(e>this.lastModified)throw new Cl.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,xr.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var Dl={};Ie(Dl,{toFormData:()=>qm});function Wm(t){let e=t.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let r=e[2]||e[3]||"",a=r.slice(r.lastIndexOf("\\")+1);return a=a.replace(/%22/g,'"'),a=a.replace(/&#(\d{4});/g,(s,i)=>String.fromCharCode(i)),a}async function qm(t,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let r=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");let a=new ko(r[1]||r[2]),s,i,c,u,f,d,m=[],w=new Gt,S=P=>{c+=W.decode(P,{stream:!0})},R=P=>{m.push(P)},x=()=>{let P=new Vt(m,d,{type:f});w.append(u,P)},N=()=>{w.append(u,c)},W=new TextDecoder("utf-8");W.decode(),a.onPartBegin=function(){a.onPartData=S,a.onPartEnd=N,s="",i="",c="",u="",f="",d=null,m.length=0},a.onHeaderField=function(P){s+=W.decode(P,{stream:!0})},a.onHeaderValue=function(P){i+=W.decode(P,{stream:!0})},a.onHeaderEnd=function(){if(i+=W.decode(),s=s.toLowerCase(),s==="content-disposition"){let P=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);P&&(u=P[2]||P[3]||""),d=Wm(i),d&&(a.onPartData=R,a.onPartEnd=x)}else s==="content-type"&&(f=i);i="",s=""};for await(let P of t)a.write(P);return a.end(),w}var st,Q,Ol,Jt,Ya,Qa,Lm,Dn,Nm,Mm,jm,Fm,vr,ko,Ll=z(()=>{_o();Ha();st=0,Q={START_BOUNDARY:st++,HEADER_FIELD_START:st++,HEADER_FIELD:st++,HEADER_VALUE_START:st++,HEADER_VALUE:st++,HEADER_VALUE_ALMOST_DONE:st++,HEADERS_ALMOST_DONE:st++,PART_DATA_START:st++,PART_DATA:st++,END:st++},Ol=1,Jt={PART_BOUNDARY:Ol,LAST_BOUNDARY:Ol*=2},Ya=10,Qa=13,Lm=32,Dn=45,Nm=58,Mm=97,jm=122,Fm=t=>t|32,vr=()=>{},ko=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=vr,this.onHeaderField=vr,this.onHeadersEnd=vr,this.onHeaderValue=vr,this.onPartBegin=vr,this.onPartData=vr,this.onPartEnd=vr,this.boundaryChars={},e=`\r
--`+e;let r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a),this.boundaryChars[r[a]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=Q.START_BOUNDARY}write(e){let r=0,a=e.length,s=this.index,{lookbehind:i,boundary:c,boundaryChars:u,index:f,state:d,flags:m}=this,w=this.boundary.length,S=w-1,R=e.length,x,N,W=H=>{this[H+"Mark"]=r},P=H=>{delete this[H+"Mark"]},U=(H,V,K,Pt)=>{(V===void 0||V!==K)&&this[H](Pt&&Pt.subarray(V,K))},te=(H,V)=>{let K=H+"Mark";K in this&&(V?(U(H,this[K],r,e),delete this[K]):(U(H,this[K],e.length,e),this[K]=0))};for(r=0;r<a;r++)switch(x=e[r],d){case Q.START_BOUNDARY:if(f===c.length-2){if(x===Dn)m|=Jt.LAST_BOUNDARY;else if(x!==Qa)return;f++;break}else if(f-1===c.length-2){if(m&Jt.LAST_BOUNDARY&&x===Dn)d=Q.END,m=0;else if(!(m&Jt.LAST_BOUNDARY)&&x===Ya)f=0,U("onPartBegin"),d=Q.HEADER_FIELD_START;else return;break}x!==c[f+2]&&(f=-2),x===c[f+2]&&f++;break;case Q.HEADER_FIELD_START:d=Q.HEADER_FIELD,W("onHeaderField"),f=0;case Q.HEADER_FIELD:if(x===Qa){P("onHeaderField"),d=Q.HEADERS_ALMOST_DONE;break}if(f++,x===Dn)break;if(x===Nm){if(f===1)return;te("onHeaderField",!0),d=Q.HEADER_VALUE_START;break}if(N=Fm(x),N<Mm||N>jm)return;break;case Q.HEADER_VALUE_START:if(x===Lm)break;W("onHeaderValue"),d=Q.HEADER_VALUE;case Q.HEADER_VALUE:x===Qa&&(te("onHeaderValue",!0),U("onHeaderEnd"),d=Q.HEADER_VALUE_ALMOST_DONE);break;case Q.HEADER_VALUE_ALMOST_DONE:if(x!==Ya)return;d=Q.HEADER_FIELD_START;break;case Q.HEADERS_ALMOST_DONE:if(x!==Ya)return;U("onHeadersEnd"),d=Q.PART_DATA_START;break;case Q.PART_DATA_START:d=Q.PART_DATA,W("onPartData");case Q.PART_DATA:if(s=f,f===0){for(r+=S;r<R&&!(e[r]in u);)r+=w;r-=S,x=e[r]}if(f<c.length)c[f]===x?(f===0&&te("onPartData",!0),f++):f=0;else if(f===c.length)f++,x===Qa?m|=Jt.PART_BOUNDARY:x===Dn?m|=Jt.LAST_BOUNDARY:f=0;else if(f-1===c.length)if(m&Jt.PART_BOUNDARY){if(f=0,x===Ya){m&=~Jt.PART_BOUNDARY,U("onPartEnd"),U("onPartBegin"),d=Q.HEADER_FIELD_START;break}}else m&Jt.LAST_BOUNDARY&&x===Dn?(U("onPartEnd"),d=Q.END,m=0):f=0;if(f>0)i[f-1]=x;else if(s>0){let H=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);U("onPartData",0,s,H),s=0,W("onPartData"),r--}break;case Q.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}te("onHeaderField"),te("onHeaderValue"),te("onPartData"),this.index=f,this.state=d,this.flags=m}end(){if(this.state===Q.HEADER_FIELD_START&&this.index===0||this.state===Q.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==Q.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function So(t){if(t[be].disturbed)throw new TypeError(`body used already for: ${t.url}`);if(t[be].disturbed=!0,t[be].error)throw t[be].error;let{body:e}=t;if(e===null)return xe.Buffer.alloc(0);if(!(e instanceof Ne.default))return xe.Buffer.alloc(0);let r=[],a=0;try{for await(let s of e){if(t.size>0&&a+s.length>t.size){let i=new fe(`content size at ${t.url} over limit: ${t.size}`,"max-size");throw e.destroy(i),i}a+=s.length,r.push(s)}}catch(s){throw s instanceof xt?s:new fe(`Invalid response body while trying to fetch ${t.url}: ${s.message}`,"system",s)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return r.every(s=>typeof s=="string")?xe.Buffer.from(r.join("")):xe.Buffer.concat(r,a)}catch(s){throw new fe(`Could not create Buffer from response body for ${t.url}: ${s.message}`,"system",s)}else throw new fe(`Premature close of server response while trying to fetch ${t.url}`)}var Ne,vt,xe,Bm,be,ot,cn,Um,Ka,Nl,Ml,Xa=z(()=>{Ne=Be(require("node:stream"),1),vt=require("node:util"),xe=require("node:buffer");Pn();Ha();yo();Va();Ja();Bm=(0,vt.promisify)(Ne.default.pipeline),be=Symbol("Body internals"),ot=class{constructor(e,{size:r=0}={}){let a=null;e===null?e=null:bo(e)?e=xe.Buffer.from(e.toString()):On(e)||xe.Buffer.isBuffer(e)||(vt.types.isAnyArrayBuffer(e)?e=xe.Buffer.from(e):ArrayBuffer.isView(e)?e=xe.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Ne.default||(e instanceof Gt?(e=wl(e),a=e.type.split("=")[1]):e=xe.Buffer.from(String(e))));let s=e;xe.Buffer.isBuffer(e)?s=Ne.default.Readable.from(e):On(e)&&(s=Ne.default.Readable.from(e.stream())),this[be]={body:e,stream:s,boundary:a,disturbed:!1,error:null},this.size=r,e instanceof Ne.default&&e.on("error",i=>{let c=i instanceof xt?i:new fe(`Invalid response body while trying to fetch ${this.url}: ${i.message}`,"system",i);this[be].error=c})}get body(){return this[be].stream}get bodyUsed(){return this[be].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:r,byteLength:a}=await So(this);return e.slice(r,r+a)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let a=new Gt,s=new URLSearchParams(await this.text());for(let[i,c]of s)a.append(i,c);return a}let{toFormData:r}=await Promise.resolve().then(()=>(Ll(),Dl));return r(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[be].body&&this[be].body.type||"",r=await this.arrayBuffer();return new Ve([r],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await So(this);return new TextDecoder().decode(e)}buffer(){return So(this)}};ot.prototype.buffer=(0,vt.deprecate)(ot.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ot.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,vt.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});cn=(t,e)=>{let r,a,{body:s}=t[be];if(t.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof Ne.default&&typeof s.getBoundary!="function"&&(r=new Ne.PassThrough({highWaterMark:e}),a=new Ne.PassThrough({highWaterMark:e}),s.pipe(r),s.pipe(a),t[be].stream=r,s=a),s},Um=(0,vt.deprecate)(t=>t.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Ka=(t,e)=>t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":bo(t)?"application/x-www-form-urlencoded;charset=UTF-8":On(t)?t.type||null:xe.Buffer.isBuffer(t)||vt.types.isAnyArrayBuffer(t)||ArrayBuffer.isView(t)?null:t instanceof Gt?`multipart/form-data; boundary=${e[be].boundary}`:t&&typeof t.getBoundary=="function"?`multipart/form-data;boundary=${Um(t)}`:t instanceof Ne.default?null:"text/plain;charset=UTF-8",Nl=t=>{let{body:e}=t[be];return e===null?0:On(e)?e.size:xe.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},Ml=async(t,{body:e})=>{e===null?t.end():await Bm(e,t)}});function jl(t=[]){return new we(t.reduce((e,r,a,s)=>(a%2===0&&e.push(s.slice(a,a+2)),e),[]).filter(([e,r])=>{try{return es(e),vo(e,String(r)),!0}catch{return!1}}))}var xo,Ln,es,vo,we,ts=z(()=>{xo=require("node:util"),Ln=Be(require("node:http"),1),es=typeof Ln.default.validateHeaderName=="function"?Ln.default.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){let e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},vo=typeof Ln.default.validateHeaderValue=="function"?Ln.default.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let r=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},we=class t extends URLSearchParams{constructor(e){let r=[];if(e instanceof t){let a=e.raw();for(let[s,i]of Object.entries(a))r.push(...i.map(c=>[s,c]))}else if(e!=null)if(typeof e=="object"&&!xo.types.isBoxedPrimitive(e)){let a=e[Symbol.iterator];if(a==null)r.push(...Object.entries(e));else{if(typeof a!="function")throw new TypeError("Header pairs must be iterable");r=[...e].map(s=>{if(typeof s!="object"||xo.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([a,s])=>(es(a),vo(a,String(s)),[String(a).toLowerCase(),String(s)])):void 0,super(r),new Proxy(this,{get(a,s,i){switch(s){case"append":case"set":return(c,u)=>(es(c),vo(c,String(u)),URLSearchParams.prototype[s].call(a,String(c).toLowerCase(),String(u)));case"delete":case"has":case"getAll":return c=>(es(c),URLSearchParams.prototype[s].call(a,String(c).toLowerCase()));case"keys":return()=>(a.sort(),new Set(URLSearchParams.prototype.keys.call(a)).keys());default:return Reflect.get(a,s,i)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let r=this.getAll(e);if(r.length===0)return null;let a=r.join(", ");return/^content-encoding$/i.test(e)&&(a=a.toLowerCase()),a}forEach(e,r=void 0){for(let a of this.keys())Reflect.apply(e,r,[this.get(a),a,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,r)=>(e[r]=this.getAll(r),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,r)=>{let a=this.getAll(r);return r==="host"?e[r]=a[0]:e[r]=a.length>1?a:a[0],e},{})}};Object.defineProperties(we.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}))});var zm,Nn,To=z(()=>{zm=new Set([301,302,303,307,308]),Nn=t=>zm.has(t)});var Ge,ve,Fl=z(()=>{ts();Xa();To();Ge=Symbol("Response internals"),ve=class t extends ot{constructor(e=null,r={}){super(e,r);let a=r.status!=null?r.status:200,s=new we(r.headers);if(e!==null&&!s.has("Content-Type")){let i=Ka(e,this);i&&s.append("Content-Type",i)}this[Ge]={type:"default",url:r.url,status:a,statusText:r.statusText||"",headers:s,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[Ge].type}get url(){return this[Ge].url||""}get status(){return this[Ge].status}get ok(){return this[Ge].status>=200&&this[Ge].status<300}get redirected(){return this[Ge].counter>0}get statusText(){return this[Ge].statusText}get headers(){return this[Ge].headers}get highWaterMark(){return this[Ge].highWaterMark}clone(){return new t(cn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,r=302){if(!Nn(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new t(null,{headers:{location:new URL(e).toString()},status:r})}static error(){let e=new t(null,{status:0,statusText:""});return e[Ge].type="error",e}static json(e=void 0,r={}){let a=JSON.stringify(e);if(a===void 0)throw new TypeError("data is not JSON serializable");let s=new we(r&&r.headers);return s.has("content-type")||s.set("content-type","application/json"),new t(a,{...r,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(ve.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var Wl,ql=z(()=>{Wl=t=>{if(t.search)return t.search;let e=t.href.length-1,r=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-r.length]==="?"?"?":""}});function Bl(t,e=!1){return t==null||(t=new URL(t),/^(about|blob|data):$/.test(t.protocol))?"no-referrer":(t.username="",t.password="",t.hash="",e&&(t.pathname="",t.search=""),t)}function Vl(t){if(!zl.has(t))throw new TypeError(`Invalid referrerPolicy: ${t}`);return t}function Hm(t){if(/^(http|ws)s:$/.test(t.protocol))return!0;let e=t.host.replace(/(^\[)|(]$)/g,""),r=(0,Ul.isIP)(e);return r===4&&/^127\./.test(e)||r===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:t.host==="localhost"||t.host.endsWith(".localhost")?!1:t.protocol==="file:"}function ln(t){return/^about:(blank|srcdoc)$/.test(t)||t.protocol==="data:"||/^(blob|filesystem):$/.test(t.protocol)?!0:Hm(t)}function Gl(t,{referrerURLCallback:e,referrerOriginCallback:r}={}){if(t.referrer==="no-referrer"||t.referrerPolicy==="")return null;let a=t.referrerPolicy;if(t.referrer==="about:client")return"no-referrer";let s=t.referrer,i=Bl(s),c=Bl(s,!0);i.toString().length>4096&&(i=c),e&&(i=e(i)),r&&(c=r(c));let u=new URL(t.url);switch(a){case"no-referrer":return"no-referrer";case"origin":return c;case"unsafe-url":return i;case"strict-origin":return ln(i)&&!ln(u)?"no-referrer":c.toString();case"strict-origin-when-cross-origin":return i.origin===u.origin?i:ln(i)&&!ln(u)?"no-referrer":c;case"same-origin":return i.origin===u.origin?i:"no-referrer";case"origin-when-cross-origin":return i.origin===u.origin?i:c;case"no-referrer-when-downgrade":return ln(i)&&!ln(u)?"no-referrer":i;default:throw new TypeError(`Invalid referrerPolicy: ${a}`)}}function Jl(t){let e=(t.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let a of e)a&&zl.has(a)&&(r=a);return r}var Ul,zl,Hl,Co=z(()=>{Ul=require("node:net");zl=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Hl="strict-origin-when-cross-origin"});var Zl,Yl,re,Mn,Vm,Zt,Ql,Kl=z(()=>{Zl=require("node:url"),Yl=require("node:util");ts();Xa();Ja();ql();Co();re=Symbol("Request internals"),Mn=t=>typeof t=="object"&&typeof t[re]=="object",Vm=(0,Yl.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Zt=class t extends ot{constructor(e,r={}){let a;if(Mn(e)?a=new URL(e.url):(a=new URL(e),e={}),a.username!==""||a.password!=="")throw new TypeError(`${a} is an url with embedded credentials.`);let s=r.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Mn(r)&&"data"in r&&Vm(),(r.body!=null||Mn(e)&&e.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let i=r.body?r.body:Mn(e)&&e.body!==null?cn(e):null;super(i,{size:r.size||e.size||0});let c=new we(r.headers||e.headers||{});if(i!==null&&!c.has("Content-Type")){let d=Ka(i,this);d&&c.set("Content-Type",d)}let u=Mn(e)?e.signal:null;if("signal"in r&&(u=r.signal),u!=null&&!_l(u))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=r.referrer==null?e.referrer:r.referrer;if(f==="")f="no-referrer";else if(f){let d=new URL(f);f=/^about:(\/\/)?client$/.test(d)?"client":d}else f=void 0;this[re]={method:s,redirect:r.redirect||e.redirect||"follow",headers:c,parsedURL:a,signal:u,referrer:f},this.follow=r.follow===void 0?e.follow===void 0?20:e.follow:r.follow,this.compress=r.compress===void 0?e.compress===void 0?!0:e.compress:r.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent,this.highWaterMark=r.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=r.referrerPolicy||e.referrerPolicy||""}get method(){return this[re].method}get url(){return(0,Zl.format)(this[re].parsedURL)}get headers(){return this[re].headers}get redirect(){return this[re].redirect}get signal(){return this[re].signal}get referrer(){if(this[re].referrer==="no-referrer")return"";if(this[re].referrer==="client")return"about:client";if(this[re].referrer)return this[re].referrer.toString()}get referrerPolicy(){return this[re].referrerPolicy}set referrerPolicy(e){this[re].referrerPolicy=Vl(e)}clone(){return new t(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Zt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});Ql=t=>{let{parsedURL:e}=t[re],r=new we(t[re].headers);r.has("Accept")||r.set("Accept","*/*");let a=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(a="0"),t.body!==null){let u=Nl(t);typeof u=="number"&&!Number.isNaN(u)&&(a=String(u))}a&&r.set("Content-Length",a),t.referrerPolicy===""&&(t.referrerPolicy=Hl),t.referrer&&t.referrer!=="no-referrer"?t[re].referrer=Gl(t):t[re].referrer="no-referrer",t[re].referrer instanceof URL&&r.set("Referer",t.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=t;typeof s=="function"&&(s=s(e));let i=Wl(e),c={path:e.pathname+i,method:t.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:s};return{parsedURL:e,options:c}}});var jn,Xl=z(()=>{Va();jn=class extends xt{constructor(e,r="aborted"){super(e,r)}}});var ru={};Ie(ru,{AbortError:()=>jn,Blob:()=>Ve,FetchError:()=>fe,File:()=>Vt,FormData:()=>Gt,Headers:()=>we,Request:()=>Zt,Response:()=>ve,blobFrom:()=>El,blobFromSync:()=>Rl,default:()=>Tt,fileFrom:()=>Al,fileFromSync:()=>$l,isRedirect:()=>Nn});async function Tt(t,e){return new Promise((r,a)=>{let s=new Zt(t,e),{parsedURL:i,options:c}=Ql(s);if(!Gm.has(i.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if(i.protocol==="data:"){let x=ul(s.url),N=new ve(x,{headers:{"Content-Type":x.typeFull}});r(N);return}let u=(i.protocol==="https:"?tu.default:eu.default).request,{signal:f}=s,d=null,m=()=>{let x=new jn("The operation was aborted.");a(x),s.body&&s.body instanceof Te.default.Readable&&s.body.destroy(x),!(!d||!d.body)&&d.body.emit("error",x)};if(f&&f.aborted){m();return}let w=()=>{m(),R()},S=u(i.toString(),c);f&&f.addEventListener("abort",w);let R=()=>{S.abort(),f&&f.removeEventListener("abort",w)};S.on("error",x=>{a(new fe(`request to ${s.url} failed, reason: ${x.message}`,"system",x)),R()}),Jm(S,x=>{d&&d.body&&d.body.destroy(x)}),process.version<"v14"&&S.on("socket",x=>{let N;x.prependListener("end",()=>{N=x._eventsCount}),x.prependListener("close",W=>{if(d&&N<x._eventsCount&&!W){let P=new Error("Premature close");P.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",P)}})}),S.on("response",x=>{S.setTimeout(0);let N=jl(x.rawHeaders);if(Nn(x.statusCode)){let H=N.get("Location"),V=null;try{V=H===null?null:new URL(H,s.url)}catch{if(s.redirect!=="manual"){a(new fe(`uri requested responds with an invalid redirect URL: ${H}`,"invalid-redirect")),R();return}}switch(s.redirect){case"error":a(new fe(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),R();return;case"manual":break;case"follow":{if(V===null)break;if(s.counter>=s.follow){a(new fe(`maximum redirect reached at: ${s.url}`,"max-redirect")),R();return}let K={headers:new we(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:cn(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!kl(s.url,V)||!Sl(s.url,V))for(let gn of["authorization","www-authenticate","cookie","cookie2"])K.headers.delete(gn);if(x.statusCode!==303&&s.body&&e.body instanceof Te.default.Readable){a(new fe("Cannot follow redirect with body being a readable stream","unsupported-redirect")),R();return}(x.statusCode===303||(x.statusCode===301||x.statusCode===302)&&s.method==="POST")&&(K.method="GET",K.body=void 0,K.headers.delete("content-length"));let Pt=Jl(N);Pt&&(K.referrerPolicy=Pt),r(Tt(new Zt(V,K))),R();return}default:return a(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}f&&x.once("end",()=>{f.removeEventListener("abort",w)});let W=(0,Te.pipeline)(x,new Te.PassThrough,H=>{H&&a(H)});process.version<"v12.10"&&x.on("aborted",w);let P={url:s.url,status:x.statusCode,statusText:x.statusMessage,headers:N,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},U=N.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||U===null||x.statusCode===204||x.statusCode===304){d=new ve(W,P),r(d);return}let te={flush:Tr.default.Z_SYNC_FLUSH,finishFlush:Tr.default.Z_SYNC_FLUSH};if(U==="gzip"||U==="x-gzip"){W=(0,Te.pipeline)(W,Tr.default.createGunzip(te),H=>{H&&a(H)}),d=new ve(W,P),r(d);return}if(U==="deflate"||U==="x-deflate"){let H=(0,Te.pipeline)(x,new Te.PassThrough,V=>{V&&a(V)});H.once("data",V=>{(V[0]&15)===8?W=(0,Te.pipeline)(W,Tr.default.createInflate(),K=>{K&&a(K)}):W=(0,Te.pipeline)(W,Tr.default.createInflateRaw(),K=>{K&&a(K)}),d=new ve(W,P),r(d)}),H.once("end",()=>{d||(d=new ve(W,P),r(d))});return}if(U==="br"){W=(0,Te.pipeline)(W,Tr.default.createBrotliDecompress(),H=>{H&&a(H)}),d=new ve(W,P),r(d);return}d=new ve(W,P),r(d)}),Ml(S,s).catch(a)})}function Jm(t,e){let r=Fn.Buffer.from(`0\r
\r
`),a=!1,s=!1,i;t.on("response",c=>{let{headers:u}=c;a=u["transfer-encoding"]==="chunked"&&!u["content-length"]}),t.on("socket",c=>{let u=()=>{if(a&&!s){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},f=d=>{s=Fn.Buffer.compare(d.slice(-5),r)===0,!s&&i&&(s=Fn.Buffer.compare(i.slice(-3),r.slice(0,3))===0&&Fn.Buffer.compare(d.slice(-2),r.slice(3))===0),i=d};c.prependListener("close",u),c.on("data",f),t.on("close",()=>{c.removeListener("close",u),c.removeListener("data",f)})})}var eu,tu,Tr,Te,Fn,Gm,rs=z(()=>{eu=Be(require("node:http"),1),tu=Be(require("node:https"),1),Tr=Be(require("node:zlib"),1),Te=Be(require("node:stream"),1),Fn=require("node:buffer");dl();Xa();Fl();ts();Kl();yo();Xl();To();Ha();Ja();Co();_o();Gm=new Set(["data:","http:","https:"])});function ne(t,e,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(t):a?a.value:e.get(t)}function Ar(t,e,r,a,s){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r}var _u=z(()=>{});var Wo={};Ie(Wo,{Channel:()=>pn,PluginListener:()=>Bn,Resource:()=>Yt,SERIALIZE_TO_IPC_FN:()=>le,addPluginListener:()=>Kg,checkPermissions:()=>Xg,convertFileSrc:()=>ty,invoke:()=>y,isTauri:()=>ry,requestPermissions:()=>ey,transformCallback:()=>os});function os(t,e=!1){return window.__TAURI_INTERNALS__.transformCallback(t,e)}async function Kg(t,e,r){let a=new pn(r);try{return await y(`plugin:${t}|register_listener`,{event:e,handler:a}),new Bn(t,e,a.id)}catch{return await y(`plugin:${t}|registerListener`,{event:e,handler:a}),new Bn(t,e,a.id)}}async function Xg(t){return y(`plugin:${t}|check_permissions`)}async function ey(t){return y(`plugin:${t}|request_permissions`)}async function y(t,e={},r){return window.__TAURI_INTERNALS__.invoke(t,e,r)}function ty(t,e="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(t,e)}function ry(){return!!(globalThis||window).isTauri}var $r,je,fn,as,ss,le,pn,Bn,Yt,ct=z(()=>{_u();le="__TAURI_TO_IPC_KEY__";pn=class{constructor(e){$r.set(this,void 0),je.set(this,0),fn.set(this,[]),as.set(this,void 0),Ar(this,$r,e||(()=>{}),"f"),this.id=os(r=>{let a=r.index;if("end"in r){a==ne(this,je,"f")?this.cleanupCallback():Ar(this,as,a,"f");return}let s=r.message;if(a==ne(this,je,"f")){for(ne(this,$r,"f").call(this,s),Ar(this,je,ne(this,je,"f")+1,"f");ne(this,je,"f")in ne(this,fn,"f");){let i=ne(this,fn,"f")[ne(this,je,"f")];ne(this,$r,"f").call(this,i),delete ne(this,fn,"f")[ne(this,je,"f")],Ar(this,je,ne(this,je,"f")+1,"f")}ne(this,je,"f")===ne(this,as,"f")&&this.cleanupCallback()}else ne(this,fn,"f")[a]=s})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){Ar(this,$r,e,"f")}get onmessage(){return ne(this,$r,"f")}[($r=new WeakMap,je=new WeakMap,fn=new WeakMap,as=new WeakMap,le)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[le]()}},Bn=class{constructor(e,r,a){this.plugin=e,this.event=r,this.channelId=a}async unregister(){return y(`plugin:${this.plugin}|remove_listener`,{event:this.event,channelId:this.channelId})}};Yt=class{get rid(){return ne(this,ss,"f")}constructor(e){ss.set(this,void 0),Ar(this,ss,e,"f")}async close(){return y("plugin:resources|close",{rid:this.rid})}};ss=new WeakMap});var Su={};Ie(Su,{TauriEvent:()=>pe,emit:()=>Un,emitTo:()=>Bo,listen:()=>is,once:()=>qo});async function ku(t,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(t,e),await y("plugin:event|unlisten",{event:t,eventId:e})}async function is(t,e,r){var a;let s=typeof r?.target=="string"?{kind:"AnyLabel",label:r.target}:(a=r?.target)!==null&&a!==void 0?a:{kind:"Any"};return y("plugin:event|listen",{event:t,target:s,handler:os(e)}).then(i=>async()=>ku(t,i))}async function qo(t,e,r){return is(t,a=>{ku(t,a.id),e(a)},r)}async function Un(t,e){await y("plugin:event|emit",{event:t,payload:e})}async function Bo(t,e,r){await y("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:e,payload:r})}var pe,cs=z(()=>{ct();(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG_ENTER="tauri://drag-enter",t.DRAG_OVER="tauri://drag-over",t.DRAG_DROP="tauri://drag-drop",t.DRAG_LEAVE="tauri://drag-leave"})(pe||(pe={}))});var ls={};Ie(ls,{BaseDirectory:()=>G,appCacheDir:()=>oy,appConfigDir:()=>ny,appDataDir:()=>ay,appLocalDataDir:()=>sy,appLogDir:()=>Ty,audioDir:()=>iy,basename:()=>Dy,cacheDir:()=>cy,configDir:()=>ly,dataDir:()=>uy,delimiter:()=>Ey,desktopDir:()=>dy,dirname:()=>Iy,documentDir:()=>fy,downloadDir:()=>py,executableDir:()=>hy,extname:()=>Oy,fontDir:()=>my,homeDir:()=>gy,isAbsolute:()=>Ly,join:()=>Py,localDataDir:()=>yy,normalize:()=>$y,pictureDir:()=>by,publicDir:()=>wy,resolve:()=>Ay,resolveResource:()=>ky,resourceDir:()=>_y,runtimeDir:()=>Sy,sep:()=>Ry,tempDir:()=>Cy,templateDir:()=>xy,videoDir:()=>vy});async function ny(){return y("plugin:path|resolve_directory",{directory:G.AppConfig})}async function ay(){return y("plugin:path|resolve_directory",{directory:G.AppData})}async function sy(){return y("plugin:path|resolve_directory",{directory:G.AppLocalData})}async function oy(){return y("plugin:path|resolve_directory",{directory:G.AppCache})}async function iy(){return y("plugin:path|resolve_directory",{directory:G.Audio})}async function cy(){return y("plugin:path|resolve_directory",{directory:G.Cache})}async function ly(){return y("plugin:path|resolve_directory",{directory:G.Config})}async function uy(){return y("plugin:path|resolve_directory",{directory:G.Data})}async function dy(){return y("plugin:path|resolve_directory",{directory:G.Desktop})}async function fy(){return y("plugin:path|resolve_directory",{directory:G.Document})}async function py(){return y("plugin:path|resolve_directory",{directory:G.Download})}async function hy(){return y("plugin:path|resolve_directory",{directory:G.Executable})}async function my(){return y("plugin:path|resolve_directory",{directory:G.Font})}async function gy(){return y("plugin:path|resolve_directory",{directory:G.Home})}async function yy(){return y("plugin:path|resolve_directory",{directory:G.LocalData})}async function by(){return y("plugin:path|resolve_directory",{directory:G.Picture})}async function wy(){return y("plugin:path|resolve_directory",{directory:G.Public})}async function _y(){return y("plugin:path|resolve_directory",{directory:G.Resource})}async function ky(t){return y("plugin:path|resolve_directory",{directory:G.Resource,path:t})}async function Sy(){return y("plugin:path|resolve_directory",{directory:G.Runtime})}async function xy(){return y("plugin:path|resolve_directory",{directory:G.Template})}async function vy(){return y("plugin:path|resolve_directory",{directory:G.Video})}async function Ty(){return y("plugin:path|resolve_directory",{directory:G.AppLog})}async function Cy(){return y("plugin:path|resolve_directory",{directory:G.Temp})}function Ry(){return window.__TAURI_INTERNALS__.plugins.path.sep}function Ey(){return window.__TAURI_INTERNALS__.plugins.path.delimiter}async function Ay(...t){return y("plugin:path|resolve",{paths:t})}async function $y(t){return y("plugin:path|normalize",{path:t})}async function Py(...t){return y("plugin:path|join",{paths:t})}async function Iy(t){return y("plugin:path|dirname",{path:t})}async function Oy(t){return y("plugin:path|extname",{path:t})}async function Dy(t,e){return y("plugin:path|basename",{path:t,ext:e})}async function Ly(t){return y("plugin:path|is_absolute",{path:t})}var G,zn=z(()=>{ct();(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(G||(G={}))});var Vo={};Ie(Vo,{BaseDirectory:()=>G,FileHandle:()=>Hn,SeekMode:()=>Uo,copyFile:()=>jy,create:()=>My,exists:()=>Qy,lstat:()=>Gy,mkdir:()=>Fy,open:()=>xu,readDir:()=>Wy,readFile:()=>qy,readTextFile:()=>By,readTextFileLines:()=>Uy,remove:()=>zy,rename:()=>Hy,size:()=>eb,stat:()=>Vy,truncate:()=>Jy,watch:()=>Ky,watchImmediate:()=>Xy,writeFile:()=>Zy,writeTextFile:()=>Yy});function Ho(t){return{isFile:t.isFile,isDirectory:t.isDirectory,isSymlink:t.isSymlink,size:t.size,mtime:t.mtime!==null?new Date(t.mtime):null,atime:t.atime!==null?new Date(t.atime):null,birthtime:t.birthtime!==null?new Date(t.birthtime):null,readonly:t.readonly,fileAttributes:t.fileAttributes,dev:t.dev,ino:t.ino,mode:t.mode,nlink:t.nlink,uid:t.uid,gid:t.gid,rdev:t.rdev,blksize:t.blksize,blocks:t.blocks}}function Ny(t){let e=new Uint8ClampedArray(t),r=e.byteLength,a=0;for(let s=0;s<r;s++){let i=e[s];a*=256,a+=i}return a}async function My(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|create",{path:t instanceof URL?t.toString():t,options:e});return new Hn(r)}async function xu(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|open",{path:t instanceof URL?t.toString():t,options:e});return new Hn(r)}async function jy(t,e,r){if(t instanceof URL&&t.protocol!=="file:"||e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|copy_file",{fromPath:t instanceof URL?t.toString():t,toPath:e instanceof URL?e.toString():e,options:r})}async function Fy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|mkdir",{path:t instanceof URL?t.toString():t,options:e})}async function Wy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|read_dir",{path:t instanceof URL?t.toString():t,options:e})}async function qy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|read_file",{path:t instanceof URL?t.toString():t,options:e});return r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r)}async function By(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|read_text_file",{path:t instanceof URL?t.toString():t,options:e}),a=r instanceof ArrayBuffer?r:Uint8Array.from(r);return new TextDecoder().decode(a)}async function Uy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=t instanceof URL?t.toString():t;return await Promise.resolve({path:r,rid:null,async next(){this.rid===null&&(this.rid=await y("plugin:fs|read_text_file_lines",{path:r,options:e}));let a=await y("plugin:fs|read_text_file_lines_next",{rid:this.rid}),s=a instanceof ArrayBuffer?new Uint8Array(a):Uint8Array.from(a),i=s[s.byteLength-1]===1;return i?(this.rid=null,{value:null,done:i}):{value:new TextDecoder().decode(s.slice(0,s.byteLength-1)),done:i}},[Symbol.asyncIterator](){return this}})}async function zy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|remove",{path:t instanceof URL?t.toString():t,options:e})}async function Hy(t,e,r){if(t instanceof URL&&t.protocol!=="file:"||e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|rename",{oldPath:t instanceof URL?t.toString():t,newPath:e instanceof URL?e.toString():e,options:r})}async function Vy(t,e){let r=await y("plugin:fs|stat",{path:t instanceof URL?t.toString():t,options:e});return Ho(r)}async function Gy(t,e){let r=await y("plugin:fs|lstat",{path:t instanceof URL?t.toString():t,options:e});return Ho(r)}async function Jy(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|truncate",{path:t instanceof URL?t.toString():t,len:e,options:r})}async function Zy(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");if(e instanceof ReadableStream){let a=await xu(t,{read:!1,create:!0,write:!0,...r}),s=e.getReader();try{for(;;){let{done:i,value:c}=await s.read();if(i)break;await a.write(c)}}finally{s.releaseLock(),await a.close()}}else await y("plugin:fs|write_file",e,{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(r)}})}async function Yy(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let a=new TextEncoder;await y("plugin:fs|write_text_file",a.encode(e),{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(r)}})}async function Qy(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|exists",{path:t instanceof URL?t.toString():t,options:e})}async function vu(t,e,r){let a=Array.isArray(t)?t:[t];for(let u of a)if(u instanceof URL&&u.protocol!=="file:")throw new TypeError("Must be a file URL.");let s=new pn;s.onmessage=e;let i=await y("plugin:fs|watch",{paths:a.map(u=>u instanceof URL?u.toString():u),options:r,onEvent:s}),c=new zo(i);return()=>{c.close()}}async function Ky(t,e,r){return await vu(t,e,{delayMs:2e3,...r})}async function Xy(t,e,r){return await vu(t,e,{...r,delayMs:void 0})}async function eb(t){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|size",{path:t instanceof URL?t.toString():t})}var Uo,Hn,zo,Go=z(()=>{zn();ct();(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(Uo||(Uo={}));Hn=class extends Yt{async read(e){if(e.byteLength===0)return 0;let r=await y("plugin:fs|read",{rid:this.rid,len:e.byteLength}),a=Ny(r.slice(-8)),s=r instanceof ArrayBuffer?new Uint8Array(r):r;return e.set(s.slice(0,s.length-8)),a===0?null:a}async seek(e,r){return await y("plugin:fs|seek",{rid:this.rid,offset:e,whence:r})}async stat(){let e=await y("plugin:fs|fstat",{rid:this.rid});return Ho(e)}async truncate(e){await y("plugin:fs|ftruncate",{rid:this.rid,len:e})}async write(e){return await y("plugin:fs|write",{rid:this.rid,data:e})}};zo=class extends Yt{}});var Du={};Ie(Du,{fileOperations:()=>Pr,keyboardUtils:()=>Gn,uiUtils:()=>Jn,validationUtils:()=>Qt});var Pr,Gn,Jn,Qt,Zn=z(()=>{Pr={getExtension:t=>{let e=t.lastIndexOf(".");return e>0?t.slice(e+1).toLowerCase():""},isMarkdown:t=>{let e=Pr.getExtension(t);return["md","markdown","mdown","mkd","mdwn"].includes(e)},isImage:t=>{let e=Pr.getExtension(t);return["jpg","jpeg","png","gif","webp","svg","bmp","ico"].includes(e)},getBasename:t=>{let e=t.lastIndexOf("."),a=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"))+1,s=e>a?e:t.length;return t.slice(a,s)}},Gn={isModifierPressed:t=>t.ctrlKey||t.metaKey||t.altKey||t.shiftKey,getNormalizedKey:t=>{let e=[];(t.ctrlKey||t.metaKey)&&e.push("Ctrl"),t.altKey&&e.push("Alt"),t.shiftKey&&e.push("Shift");let r=t.key;return r===" "&&(r="Space"),r==="ArrowLeft"&&(r="Left"),r==="ArrowRight"&&(r="Right"),r==="ArrowUp"&&(r="Up"),r==="ArrowDown"&&(r="Down"),r.length===1&&(r=r.toUpperCase()),e.push(r),e.join("+")}},Jn={formatFileSize:t=>{if(t===0)return"0 B";let e=1024,r=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(t)/Math.log(e));return`${parseFloat((t/Math.pow(e,a)).toFixed(2))} ${r[a]}`},formatDate:t=>{let e=new Date(t),a=new Date-e,s=Math.floor(a/(1e3*60*60*24));if(s===0){let i=Math.floor(a/36e5);if(i===0){let c=Math.floor(a/6e4);return c===0?"Just now":`${c} minutes ago`}return`${i} hours ago`}else return s===1?"Yesterday":s<7?`${s} days ago`:e.toLocaleDateString()}},Qt={isValidFilename:t=>!/[<>:"|?*]/.test(t)&&t.trim().length>0,isValidFoldername:t=>Qt.isValidFilename(t)&&!t.startsWith(".")&&t!==".."&&t!=="."}});var Yn,Lu=z(()=>{Yn={app:{name:"Lokus",executableName:"lokus.exe",defaultInstallPath:"C:\\Program Files\\Lokus",userDataPath:"%APPDATA%\\Lokus",tempPath:"%TEMP%\\Lokus"},files:{defaultWorkspacePath:"%USERPROFILE%\\Documents\\Lokus",maxPathLength:260,reservedNames:["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],invalidChars:'<>:"|?*',associations:{".md":{progId:"Lokus.Markdown",description:"Markdown Document",icon:"markdown.ico"},".markdown":{progId:"Lokus.Markdown",description:"Markdown Document",icon:"markdown.ico"}}},terminal:{preferences:[{name:"Windows Terminal",command:"wt",args:["-d","{path}"],available:null},{name:"PowerShell",command:"powershell",args:["-NoExit","-Command",'cd "{path}"'],available:null},{name:"Command Prompt",command:"cmd",args:["/k",'cd /d "{path}"'],available:!0}]},shortcuts:{global:{newWindow:"Ctrl+Shift+N",closeWindow:"Alt+F4",minimize:"Win+Down",maximize:"Win+Up"},editor:{selectWord:"Ctrl+D",selectLine:"Ctrl+L",deleteLine:"Ctrl+Shift+K",duplicateLine:"Ctrl+Shift+D",moveLineUp:"Alt+Up",moveLineDown:"Alt+Down"}},ui:{borderRadius:"8px",acrylic:{enabled:!0,tint:"rgba(255, 255, 255, 0.05)",blur:"20px"},snapLayouts:{enabled:!0,zones:["half-left","half-right","quarter","three-quarter"]},contextMenu:{style:"windows11",animations:!0,icons:!0}},shell:{contextMenu:{enabled:!0,entries:[{key:"open_with_lokus",title:"Open with Lokus",icon:"%INSTALLDIR%\\lokus.ico",command:'"%INSTALLDIR%\\lokus.exe" "%1"'}]},jumpList:{enabled:!0,maxItems:10,categories:["Recent","Tasks"]}},notifications:{provider:"windows-native",defaultSound:"ms-winsoundevent:Notification.Default",badgeSupport:!0,actionCenter:!0},performance:{directWrite:!0,hardwareAcceleration:!0,gpuRasterization:!0},features:{windowsHello:!1,darkModeSync:!0,taskbarProgress:!0,thumbnailToolbar:!0,aeroSnap:!0}}});var ei={};Ie(ei,{cleanupWindowsFeatures:()=>ib,contextMenu:()=>Xo,fileAssociations:()=>Nu,initializeWindowsFeatures:()=>ob,jumpList:()=>Mu,notifications:()=>ab,searchIntegration:()=>sb,taskbarProgress:()=>ju,themeIntegration:()=>Fu});async function ob(t={}){let e={fileAssociations:!1,contextMenu:!1,darkModeSync:!1};return t.fileAssociations!==!1&&(e.fileAssociations=await Nu.register()),t.contextMenu!==!1&&(e.contextMenu=await Xo.register()),t.darkModeSync!==!1&&(e.darkModeSync=await Fu.syncDarkMode()),e}async function ib(){await Xo.unregister(),await Mu.clear(),await ju.clear()}var Nu,Mu,Xo,ju,ab,Fu,sb,Wu=z(()=>{ct();Lu();Nu={async register(){try{return await y("windows_register_file_associations",{associations:Yn.files.associations}),!0}catch{return!1}},async check(){try{return await y("windows_check_file_associations")}catch{return!1}}},Mu={async update(t){try{let e=t.map(r=>({type:"task",title:r.name||"Untitled Workspace",description:r.path,program:"lokus.exe",args:`"${r.path}"`,iconPath:r.path,iconIndex:0}));return await y("windows_update_jump_list",{items:e,maxItems:Yn.shell.jumpList.maxItems}),!0}catch{return!1}},async clear(){try{return await y("windows_clear_jump_list"),!0}catch{return!1}}},Xo={async register(){try{return await y("windows_register_context_menu",{entries:Yn.shell.contextMenu.entries}),!0}catch{return!1}},async unregister(){try{return await y("windows_unregister_context_menu"),!0}catch{return!1}}},ju={async setProgress(t,e="normal"){try{return await y("windows_set_taskbar_progress",{progress:Math.max(0,Math.min(1,t)),state:e}),!0}catch{return!1}},async clear(){try{return await y("windows_clear_taskbar_progress"),!0}catch{return!1}}},ab={async show(t){try{let e={title:t.title,body:t.body,icon:t.icon||"lokus.ico",sound:t.sound!==!1?Yn.notifications.defaultSound:null,actions:t.actions||[],silent:t.silent||!1};return await y("windows_show_notification",e)}catch{return null}},async clear(t){try{return await y("windows_clear_notification",{id:t}),!0}catch{return!1}}},Fu={async syncDarkMode(){try{return await y("windows_is_dark_mode")}catch{return window.matchMedia("(prefers-color-scheme: dark)").matches}},async onThemeChange(t){try{await y("windows_watch_theme_changes");let{listen:e}=await Promise.resolve().then(()=>(cs(),Su));return await e("windows-theme-changed",a=>{t(a.payload.isDarkMode)})}catch{return null}}},sb={async indexWorkspace(t){try{return await y("windows_index_workspace",{path:t}),!0}catch{return!1}},async removeFromIndex(t){try{return await y("windows_remove_from_index",{path:t}),!0}catch{return!1}}}});var Bu={};Ie(Bu,{fileOperations:()=>Pr,keyboardUtils:()=>Gn,uiUtils:()=>Jn,validationUtils:()=>Qt,windowsFeatureHelpers:()=>db,windowsFeaturesFromModule:()=>ei,windowsPathUtils:()=>Qn,windowsShell:()=>ub,windowsShortcuts:()=>cb,windowsUI:()=>lb,windowsValidation:()=>qu});var cb,Qn,qu,lb,ub,db,Uu=z(()=>{Zn();Wu();cb={newFile:"Ctrl+N",newFolder:"Ctrl+Shift+N",save:"Ctrl+S",saveAs:"Ctrl+Shift+S",close:"Ctrl+W",closeAll:"Ctrl+Shift+W",find:"Ctrl+F",findAndReplace:"Ctrl+H",findInFiles:"Ctrl+Shift+F",commandPalette:"Ctrl+K",quickOpen:"Ctrl+P",properties:"Alt+Enter",rename:"F2",refresh:"F5",fullscreen:"F11",cut:"Ctrl+X",copy:"Ctrl+C",paste:"Ctrl+V",selectAll:"Ctrl+A",undo:"Ctrl+Z",redo:"Ctrl+Y",nextTab:"Ctrl+Tab",previousTab:"Ctrl+Shift+Tab",closeTab:"Ctrl+W",reopenTab:"Ctrl+Shift+T",toggleSidebar:"Ctrl+B",togglePreview:"Ctrl+Shift+V",zoomIn:"Ctrl+Plus",zoomOut:"Ctrl+Minus",resetZoom:"Ctrl+0"},Qn={toWindowsPath:t=>t&&(t.startsWith("//")?"\\\\"+t.slice(2).replace(/\//g,"\\"):t.replace(/\//g,"\\")),toUnixPath:t=>t&&(t.startsWith("\\\\")?"//"+t.slice(2).replace(/\\/g,"/"):t.replace(/\\/g,"/")),getDriveLetter:t=>{let e=t.match(/^([A-Za-z]):/);return e?e[1].toUpperCase():null},isAbsolutePath:t=>/^[A-Za-z]:/.test(t)||t.startsWith("\\\\"),isUNCPath:t=>t.startsWith("\\\\")||t.startsWith("//"),normalizePath:t=>t&&(t.startsWith("\\\\")?"\\\\"+t.slice(2).replace(/\\+/g,"\\").replace(/\\$/,""):t.replace(/\\+/g,"\\").replace(/\\$/,"")),joinPath:(...t)=>{let e=t.filter(Boolean).join("\\").replace(/\\+/g,"\\");return t[0]&&t[0].startsWith("\\\\")?"\\\\"+e.slice(2):e},getParentDirectory:t=>{if(!t)return t;let r=Qn.normalizePath(t).split("\\");return r.length<=1||r.length===2&&r[1]===""?null:(r.pop(),r.join("\\"))},getFilename:t=>{if(!t)return"";let r=Qn.normalizePath(t).split("\\");return r[r.length-1]},isPathTooLong:t=>t.length>=260&&!t.startsWith("\\\\?\\"),toLongPath:t=>!t||t.startsWith("\\\\?\\")?t:Qn.isUNCPath(t)?"\\\\?\\UNC\\"+t.slice(2):Qn.isAbsolutePath(t)&&t.length>=260?"\\\\?\\"+t:t},qu={...Qt,isReservedFilename:t=>{let e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],r=t.split(".")[0].toUpperCase();return e.includes(r)},isValidFilename:t=>!/[<>:"|?*\x00-\x1f]/.test(t)&&!qu.isReservedFilename(t)&&!t.endsWith(".")&&!t.endsWith(" ")&&t.trim().length>0,isPathLengthValid:t=>t.length<260},lb={getAccentColor:()=>"#0078D4",isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,getWindowsStyles:()=>({borderRadius:"8px",backdropFilter:"blur(20px)",boxShadow:"0 2px 20px rgba(0, 0, 0, 0.1)"})},ub={getContextMenuItems:()=>[{id:"open-with-lokus",label:"Open with Lokus",icon:"file-text"},{id:"reveal-in-explorer",label:"Reveal in Explorer",icon:"folder-open"}],getFileAssociations:()=>({".md":{description:"Markdown Document",icon:"markdown-icon",progId:"Lokus.Markdown"},".markdown":{description:"Markdown Document",icon:"markdown-icon",progId:"Lokus.Markdown"}})},db={getJumpListItems:t=>t.map(e=>({type:"task",title:e.name,description:e.path,program:"lokus.exe",args:`--workspace "${e.path}"`,iconPath:e.path,iconIndex:0})),getNotificationOptions:()=>({badge:!0,sound:!0,actions:!0,inline:!0,persistent:!1})}});var zu={};Ie(zu,{fileOperations:()=>Pr,finderIntegration:()=>gb,keyboardUtils:()=>Gn,macosFeatures:()=>yb,macosPathUtils:()=>pb,macosShortcuts:()=>fb,macosUI:()=>mb,macosValidation:()=>hb,uiUtils:()=>Jn,validationUtils:()=>Qt});var fb,pb,hb,mb,gb,yb,Hu=z(()=>{Zn();fb={newFile:"Cmd+N",newFolder:"Cmd+Shift+N",save:"Cmd+S",saveAs:"Cmd+Shift+S",close:"Cmd+W",closeAll:"Cmd+Option+W",find:"Cmd+F",findAndReplace:"Cmd+Option+F",findInFiles:"Cmd+Shift+F",commandPalette:"Cmd+K",quickOpen:"Cmd+P",spotlight:"Cmd+Space",quickLook:"Space",getInfo:"Cmd+I",showInFinder:"Cmd+Option+R",cut:"Cmd+X",copy:"Cmd+C",paste:"Cmd+V",selectAll:"Cmd+A",undo:"Cmd+Z",redo:"Cmd+Shift+Z",nextTab:"Cmd+Option+Right",previousTab:"Cmd+Option+Left",closeTab:"Cmd+W",reopenTab:"Cmd+Shift+T",toggleSidebar:"Cmd+B",togglePreview:"Cmd+Shift+V",zoomIn:"Cmd+Plus",zoomOut:"Cmd+Minus",resetZoom:"Cmd+0",minimize:"Cmd+M",hideWindow:"Cmd+H",hideOthers:"Cmd+Option+H",fullscreen:"Cmd+Control+F"},pb={expandTilde:async t=>{if(t.startsWith("~/"))try{let{homeDir:e}=await Promise.resolve().then(()=>(zn(),ls)),r=await e();return t.replace("~/",r.endsWith("/")?r:`${r}/`)}catch{return t}return t},isICloudPath:t=>t.includes("/Library/Mobile Documents/com~apple~CloudDocs/"),getICloudRelativePath:t=>{let e="/Library/Mobile Documents/com~apple~CloudDocs/",r=t.indexOf(e);return r!==-1?t.substring(r+e.length):t},isAbsolutePath:t=>t.startsWith("/")||t.startsWith("~")},hb={...Qt,isValidFilename:t=>!/[:/]/.test(t)&&!t.startsWith(".")&&t.trim().length>0,isFilenameLengthValid:t=>t.length<=255},mb={getAccentColor:()=>"#007AFF",isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,getMacStyles:()=>({borderRadius:"10px",backdropFilter:"blur(50px)",WebkitBackdropFilter:"blur(50px)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"}),getTrafficLightInset:()=>({left:"12px",top:"12px"})},gb={getContextMenuItems:()=>[{id:"open-with-lokus",label:"Open with Lokus",icon:"file-text"},{id:"quick-look",label:"Quick Look",icon:"eye",shortcut:"Space"},{id:"reveal-in-finder",label:"Reveal in Finder",icon:"folder-open",shortcut:"Cmd+R"}],getFinderTags:()=>[{name:"Red",color:"#FF3B30"},{name:"Orange",color:"#FF9500"},{name:"Yellow",color:"#FFCC00"},{name:"Green",color:"#34C759"},{name:"Blue",color:"#007AFF"},{name:"Purple",color:"#5856D6"},{name:"Gray",color:"#8E8E93"}]},yb={getTouchBarItems:()=>[{type:"button",label:"New Note",icon:"plus",action:"new-file"},{type:"button",label:"Search",icon:"search",action:"search"},{type:"colorPicker",action:"text-highlight"}],getContinuityOptions:()=>({handoff:!0,universalClipboard:!0,airdrop:!0}),getNotificationOptions:()=>({sound:"default",badge:!0,banner:!0,alert:!1})}});var hn,Ye,Rt,mn,he,Or,ni=z(()=>{ct();hn=class{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new Ye(this.width*e,this.height*e)}[le](){return{width:this.width,height:this.height}}toJSON(){return this[le]()}},Ye=class{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new hn(this.width/e,this.height/e)}[le](){return{width:this.width,height:this.height}}toJSON(){return this[le]()}},Rt=class{constructor(e){this.size=e}toLogical(e){return this.size instanceof hn?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof Ye?this.size:this.size.toPhysical(e)}[le](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[le]()}},mn=class{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new he(this.x*e,this.y*e)}[le](){return{x:this.x,y:this.y}}toJSON(){return this[le]()}},he=class{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new mn(this.x/e,this.y/e)}[le](){return{x:this.x,y:this.y}}toJSON(){return this[le]()}},Or=class{constructor(e){this.position=e}toLogical(e){return this.position instanceof mn?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof he?this.position:this.position.toPhysical(e)}[le](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[le]()}}});function Kn(t){return t==null?null:typeof t=="string"?t:t instanceof ai?t.rid:t}var ai,Qu=z(()=>{ct();ai=class t extends Yt{constructor(e){super(e)}static async new(e,r,a){return y("plugin:image|new",{rgba:Kn(e),width:r,height:a}).then(s=>new t(s))}static async fromBytes(e){return y("plugin:image|from_bytes",{bytes:Kn(e)}).then(r=>new t(r))}static async fromPath(e){return y("plugin:image|from_path",{path:e}).then(r=>new t(r))}async rgba(){return y("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return y("plugin:image|size",{rid:this.rid})}}});var td={};Ie(td,{CloseRequestedEvent:()=>fs,Effect:()=>ii,EffectState:()=>ci,LogicalPosition:()=>mn,LogicalSize:()=>hn,PhysicalPosition:()=>he,PhysicalSize:()=>Ye,ProgressBarStatus:()=>oi,UserAttentionType:()=>ds,Window:()=>Xn,availableMonitors:()=>xb,currentMonitor:()=>_b,cursorPosition:()=>vb,getAllWindows:()=>us,getCurrentWindow:()=>ed,monitorFromPoint:()=>Sb,primaryMonitor:()=>kb});function ed(){return new Xn(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function us(){return y("plugin:window|get_all_windows").then(t=>t.map(e=>new Xn(e,{skip:!0})))}function ps(t){return t===null?null:{name:t.name,scaleFactor:t.scaleFactor,position:new he(t.position),size:new Ye(t.size),workArea:{position:new he(t.workArea.position),size:new Ye(t.workArea.size)}}}async function _b(){return y("plugin:window|current_monitor").then(ps)}async function kb(){return y("plugin:window|primary_monitor").then(ps)}async function Sb(t,e){return y("plugin:window|monitor_from_point",{x:t,y:e}).then(ps)}async function xb(){return y("plugin:window|available_monitors").then(t=>t.map(ps))}async function vb(){return y("plugin:window|cursor_position").then(t=>new he(t))}var ds,fs,oi,si,Xn,Ku,Xu,ii,ci,rd=z(()=>{ni();ni();cs();ct();Qu();(function(t){t[t.Critical=1]="Critical",t[t.Informational=2]="Informational"})(ds||(ds={}));fs=class{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}};(function(t){t.None="none",t.Normal="normal",t.Indeterminate="indeterminate",t.Paused="paused",t.Error="error"})(oi||(oi={}));si=["tauri://created","tauri://error"],Xn=class{constructor(e,r={}){var a;this.label=e,this.listeners=Object.create(null),r?.skip||y("plugin:window|create",{options:{...r,parent:typeof r.parent=="string"?r.parent:(a=r.parent)===null||a===void 0?void 0:a.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static async getByLabel(e){var r;return(r=(await us()).find(a=>a.label===e))!==null&&r!==void 0?r:null}static getCurrent(){return ed()}static async getAll(){return us()}static async getFocusedWindow(){for(let e of await us())if(await e.isFocused())return e;return null}async listen(e,r){return this._handleTauriEvent(e,r)?()=>{let a=this.listeners[e];a.splice(a.indexOf(r),1)}:is(e,r,{target:{kind:"Window",label:this.label}})}async once(e,r){return this._handleTauriEvent(e,r)?()=>{let a=this.listeners[e];a.splice(a.indexOf(r),1)}:qo(e,r,{target:{kind:"Window",label:this.label}})}async emit(e,r){if(si.includes(e)){for(let a of this.listeners[e]||[])a({event:e,id:-1,payload:r});return}return Un(e,r)}async emitTo(e,r,a){if(si.includes(r)){for(let s of this.listeners[r]||[])s({event:r,id:-1,payload:a});return}return Bo(e,r,a)}_handleTauriEvent(e,r){return si.includes(e)?(e in this.listeners?this.listeners[e].push(r):this.listeners[e]=[r],!0):!1}async scaleFactor(){return y("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return y("plugin:window|inner_position",{label:this.label}).then(e=>new he(e))}async outerPosition(){return y("plugin:window|outer_position",{label:this.label}).then(e=>new he(e))}async innerSize(){return y("plugin:window|inner_size",{label:this.label}).then(e=>new Ye(e))}async outerSize(){return y("plugin:window|outer_size",{label:this.label}).then(e=>new Ye(e))}async isFullscreen(){return y("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return y("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return y("plugin:window|is_maximized",{label:this.label})}async isFocused(){return y("plugin:window|is_focused",{label:this.label})}async isDecorated(){return y("plugin:window|is_decorated",{label:this.label})}async isResizable(){return y("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return y("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return y("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return y("plugin:window|is_closable",{label:this.label})}async isVisible(){return y("plugin:window|is_visible",{label:this.label})}async title(){return y("plugin:window|title",{label:this.label})}async theme(){return y("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return y("plugin:window|is_always_on_top",{label:this.label})}async center(){return y("plugin:window|center",{label:this.label})}async requestUserAttention(e){let r=null;return e&&(e===ds.Critical?r={type:"Critical"}:r={type:"Informational"}),y("plugin:window|request_user_attention",{label:this.label,value:r})}async setResizable(e){return y("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return y("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return y("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return y("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return y("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return y("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return y("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return y("plugin:window|maximize",{label:this.label})}async unmaximize(){return y("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return y("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return y("plugin:window|minimize",{label:this.label})}async unminimize(){return y("plugin:window|unminimize",{label:this.label})}async show(){return y("plugin:window|show",{label:this.label})}async hide(){return y("plugin:window|hide",{label:this.label})}async close(){return y("plugin:window|close",{label:this.label})}async destroy(){return y("plugin:window|destroy",{label:this.label})}async setDecorations(e){return y("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return y("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return y("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return y("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return y("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return y("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return y("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return y("plugin:window|set_size",{label:this.label,value:e instanceof Rt?e:new Rt(e)})}async setMinSize(e){return y("plugin:window|set_min_size",{label:this.label,value:e instanceof Rt?e:e?new Rt(e):null})}async setMaxSize(e){return y("plugin:window|set_max_size",{label:this.label,value:e instanceof Rt?e:e?new Rt(e):null})}async setSizeConstraints(e){function r(a){return a?{Logical:a}:null}return y("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:r(e?.minWidth),minHeight:r(e?.minHeight),maxWidth:r(e?.maxWidth),maxHeight:r(e?.maxHeight)}})}async setPosition(e){return y("plugin:window|set_position",{label:this.label,value:e instanceof Or?e:new Or(e)})}async setFullscreen(e){return y("plugin:window|set_fullscreen",{label:this.label,value:e})}async setSimpleFullscreen(e){return y("plugin:window|set_simple_fullscreen",{label:this.label,value:e})}async setFocus(){return y("plugin:window|set_focus",{label:this.label})}async setFocusable(e){return y("plugin:window|set_focusable",{label:this.label,value:e})}async setIcon(e){return y("plugin:window|set_icon",{label:this.label,value:Kn(e)})}async setSkipTaskbar(e){return y("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return y("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return y("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return y("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return y("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return y("plugin:window|set_cursor_position",{label:this.label,value:e instanceof Or?e:new Or(e)})}async setIgnoreCursorEvents(e){return y("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return y("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return y("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return y("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return y("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return y("plugin:window|set_overlay_icon",{label:this.label,value:e?Kn(e):void 0})}async setProgressBar(e){return y("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return y("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return y("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return y("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(pe.WINDOW_RESIZED,r=>{r.payload=new Ye(r.payload),e(r)})}async onMoved(e){return this.listen(pe.WINDOW_MOVED,r=>{r.payload=new he(r.payload),e(r)})}async onCloseRequested(e){return this.listen(pe.WINDOW_CLOSE_REQUESTED,async r=>{let a=new fs(r);await e(a),a.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){let r=await this.listen(pe.DRAG_ENTER,c=>{e({...c,payload:{type:"enter",paths:c.payload.paths,position:new he(c.payload.position)}})}),a=await this.listen(pe.DRAG_OVER,c=>{e({...c,payload:{type:"over",position:new he(c.payload.position)}})}),s=await this.listen(pe.DRAG_DROP,c=>{e({...c,payload:{type:"drop",paths:c.payload.paths,position:new he(c.payload.position)}})}),i=await this.listen(pe.DRAG_LEAVE,c=>{e({...c,payload:{type:"leave"}})});return()=>{r(),s(),a(),i()}}async onFocusChanged(e){let r=await this.listen(pe.WINDOW_FOCUS,s=>{e({...s,payload:!0})}),a=await this.listen(pe.WINDOW_BLUR,s=>{e({...s,payload:!1})});return()=>{r(),a()}}async onScaleChanged(e){return this.listen(pe.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(pe.WINDOW_THEME_CHANGED,e)}};(function(t){t.Disabled="disabled",t.Throttle="throttle",t.Suspend="suspend"})(Ku||(Ku={}));(function(t){t.Default="default",t.FluentOverlay="fluentOverlay"})(Xu||(Xu={}));(function(t){t.AppearanceBased="appearanceBased",t.Light="light",t.Dark="dark",t.MediumLight="mediumLight",t.UltraDark="ultraDark",t.Titlebar="titlebar",t.Selection="selection",t.Menu="menu",t.Popover="popover",t.Sidebar="sidebar",t.HeaderView="headerView",t.Sheet="sheet",t.WindowBackground="windowBackground",t.HudWindow="hudWindow",t.FullScreenUI="fullScreenUI",t.Tooltip="tooltip",t.ContentBackground="contentBackground",t.UnderWindowBackground="underWindowBackground",t.UnderPageBackground="underPageBackground",t.Mica="mica",t.Blur="blur",t.Acrylic="acrylic",t.Tabbed="tabbed",t.TabbedDark="tabbedDark",t.TabbedLight="tabbedLight"})(ii||(ii={}));(function(t){t.FollowsWindowActiveState="followsWindowActiveState",t.Active="active",t.Inactive="inactive"})(ci||(ci={}))});var h={};Ie(h,{BRAND:()=>Qp,DIRTY:()=>or,EMPTY_PATH:()=>Ap,INVALID:()=>I,NEVER:()=>Lh,OK:()=>ie,ParseStatus:()=>ae,Schema:()=>j,ZodAny:()=>zt,ZodArray:()=>St,ZodBigInt:()=>cr,ZodBoolean:()=>lr,ZodBranded:()=>En,ZodCatch:()=>_r,ZodDate:()=>ur,ZodDefault:()=>wr,ZodDiscriminatedUnion:()=>La,ZodEffects:()=>Le,ZodEnum:()=>yr,ZodError:()=>ge,ZodFirstPartyTypeKind:()=>O,ZodFunction:()=>Ma,ZodIntersection:()=>hr,ZodIssueCode:()=>k,ZodLazy:()=>mr,ZodLiteral:()=>gr,ZodMap:()=>an,ZodNaN:()=>on,ZodNativeEnum:()=>br,ZodNever:()=>Ue,ZodNull:()=>fr,ZodNullable:()=>nt,ZodNumber:()=>ir,ZodObject:()=>ye,ZodOptional:()=>Oe,ZodParsedType:()=>C,ZodPipeline:()=>An,ZodPromise:()=>Ht,ZodReadonly:()=>kr,ZodRecord:()=>Na,ZodSchema:()=>j,ZodSet:()=>sn,ZodString:()=>Ut,ZodSymbol:()=>rn,ZodTransformer:()=>Le,ZodTuple:()=>rt,ZodType:()=>j,ZodUndefined:()=>dr,ZodUnion:()=>pr,ZodUnknown:()=>kt,ZodVoid:()=>nn,addIssueToContext:()=>v,any:()=>oh,array:()=>uh,bigint:()=>th,boolean:()=>Yc,coerce:()=>Dh,custom:()=>Gc,date:()=>rh,datetimeRegex:()=>Hc,defaultErrorMap:()=>wt,discriminatedUnion:()=>hh,effect:()=>Ch,enum:()=>xh,function:()=>_h,getErrorMap:()=>Xr,getParsedType:()=>tt,instanceof:()=>Xp,intersection:()=>mh,isAborted:()=>Oa,isAsync:()=>en,isDirty:()=>Da,isValid:()=>Bt,late:()=>Kp,lazy:()=>kh,literal:()=>Sh,makeIssue:()=>Rn,map:()=>bh,nan:()=>eh,nativeEnum:()=>vh,never:()=>ch,null:()=>sh,nullable:()=>Eh,number:()=>Zc,object:()=>dh,objectUtil:()=>ao,oboolean:()=>Oh,onumber:()=>Ih,optional:()=>Rh,ostring:()=>Ph,pipeline:()=>$h,preprocess:()=>Ah,promise:()=>Th,quotelessJson:()=>Cp,record:()=>yh,set:()=>wh,setErrorMap:()=>Ep,strictObject:()=>fh,string:()=>Jc,symbol:()=>nh,transformer:()=>Ch,tuple:()=>gh,undefined:()=>ah,union:()=>ph,unknown:()=>ih,util:()=>q,void:()=>lh});var q;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{let i={};for(let c of s)i[c]=c;return i},t.getValidEnumValues=s=>{let i=t.objectKeys(s).filter(u=>typeof s[s[u]]!="number"),c={};for(let u of i)c[u]=s[u];return t.objectValues(c)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let c in s)Object.prototype.hasOwnProperty.call(s,c)&&i.push(c);return i},t.find=(s,i)=>{for(let c of s)if(i(c))return c},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function a(s,i=" | "){return s.map(c=>typeof c=="string"?`'${c}'`:c).join(i)}t.joinValues=a,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(q||(q={}));var ao;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ao||(ao={}));var C=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),tt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}};var k=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Cp=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),ge=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},a={_errors:[]},s=i=>{for(let c of i.issues)if(c.code==="invalid_union")c.unionErrors.map(s);else if(c.code==="invalid_return_type")s(c.returnTypeError);else if(c.code==="invalid_arguments")s(c.argumentsError);else if(c.path.length===0)a._errors.push(r(c));else{let u=a,f=0;for(;f<c.path.length;){let d=c.path[f];f===c.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(r(c))):u[d]=u[d]||{_errors:[]},u=u[d],f++}}};return s(this),a}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},a=[];for(let s of this.issues)if(s.path.length>0){let i=s.path[0];r[i]=r[i]||[],r[i].push(e(s))}else a.push(e(s));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}};ge.create=t=>new ge(t);var Rp=(t,e)=>{let r;switch(t.code){case k.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case k.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,q.jsonStringifyReplacer)}`;break;case k.unrecognized_keys:r=`Unrecognized key(s) in object: ${q.joinValues(t.keys,", ")}`;break;case k.invalid_union:r="Invalid input";break;case k.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${q.joinValues(t.options)}`;break;case k.invalid_enum_value:r=`Invalid enum value. Expected ${q.joinValues(t.options)}, received '${t.received}'`;break;case k.invalid_arguments:r="Invalid function arguments";break;case k.invalid_return_type:r="Invalid function return type";break;case k.invalid_date:r="Invalid date";break;case k.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case k.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case k.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case k.custom:r="Invalid input";break;case k.invalid_intersection_types:r="Intersection results could not be merged";break;case k.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case k.not_finite:r="Number must be finite";break;default:r=e.defaultError,q.assertNever(t)}return{message:r}},wt=Rp;var Wc=wt;function Ep(t){Wc=t}function Xr(){return Wc}var Rn=t=>{let{data:e,path:r,errorMaps:a,issueData:s}=t,i=[...r,...s.path||[]],c={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let u="",f=a.filter(d=>!!d).slice().reverse();for(let d of f)u=d(c,{data:e,defaultError:u}).message;return{...s,path:i,message:u}},Ap=[];function v(t,e){let r=Xr(),a=Rn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===wt?void 0:wt].filter(s=>!!s)});t.common.issues.push(a)}var ae=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let a=[];for(let s of r){if(s.status==="aborted")return I;s.status==="dirty"&&e.dirty(),a.push(s.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){let a=[];for(let s of r){let i=await s.key,c=await s.value;a.push({key:i,value:c})}return t.mergeObjectSync(e,a)}static mergeObjectSync(e,r){let a={};for(let s of r){let{key:i,value:c}=s;if(i.status==="aborted"||c.status==="aborted")return I;i.status==="dirty"&&e.dirty(),c.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof c.value<"u"||s.alwaysSet)&&(a[i.value]=c.value)}return{status:e.value,value:a}}},I=Object.freeze({status:"aborted"}),or=t=>({status:"dirty",value:t}),ie=t=>({status:"valid",value:t}),Oa=t=>t.status==="aborted",Da=t=>t.status==="dirty",Bt=t=>t.status==="valid",en=t=>typeof Promise<"u"&&t instanceof Promise;var E;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(E||(E={}));var De=class{constructor(e,r,a,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},qc=(t,e)=>{if(Bt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ge(t.common.issues);return this._error=r,this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:a,description:s}=t;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(c,u)=>{let{message:f}=t;return c.code==="invalid_enum_value"?{message:f??u.defaultError}:typeof u.data>"u"?{message:f??a??u.defaultError}:c.code!=="invalid_type"?{message:u.defaultError}:{message:f??r??u.defaultError}},description:s}}var j=class{get description(){return this._def.description}_getType(e){return tt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ae,ctx:{common:e.parent.common,data:e.data,parsedType:tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(en(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){let a={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)},s=this._parseSync({data:e,path:a.path,parent:a});return qc(a,s)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:r});return Bt(a)?{value:a.value}:{issues:r.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(a=>Bt(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(e,r){let a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){let a={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)},s=this._parse({data:e,path:a.path,parent:a}),i=await(en(s)?s:Promise.resolve(s));return qc(a,i)}refine(e,r){let a=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,i)=>{let c=e(s),u=()=>i.addIssue({code:k.custom,...a(s)});return typeof Promise<"u"&&c instanceof Promise?c.then(f=>f?!0:(u(),!1)):c?!0:(u(),!1)})}refinement(e,r){return this._refinement((a,s)=>e(a)?!0:(s.addIssue(typeof r=="function"?r(a,s):r),!1))}_refinement(e){return new Le({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Oe.create(this,this._def)}nullable(){return nt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return St.create(this)}promise(){return Ht.create(this,this._def)}or(e){return pr.create([this,e],this._def)}and(e){return hr.create(this,e,this._def)}transform(e){return new Le({...M(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new wr({...M(this._def),innerType:this,defaultValue:r,typeName:O.ZodDefault})}brand(){return new En({typeName:O.ZodBranded,type:this,...M(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new _r({...M(this._def),innerType:this,catchValue:r,typeName:O.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return An.create(this,e)}readonly(){return kr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},$p=/^c[^\s-]{8,}$/i,Pp=/^[0-9a-z]+$/,Ip=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Op=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Dp=/^[a-z0-9_-]{21}$/i,Lp=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Np=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Mp=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,jp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",so,Fp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,qp=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Bp=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Up=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,zp=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Uc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Hp=new RegExp(`^${Uc}$`);function zc(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Vp(t){return new RegExp(`^${zc(t)}$`)}function Hc(t){let e=`${Uc}T${zc(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Gp(t,e){return!!((e==="v4"||!e)&&Fp.test(t)||(e==="v6"||!e)&&qp.test(t))}function Jp(t,e){if(!Lp.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(a));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Zp(t,e){return!!((e==="v4"||!e)&&Wp.test(t)||(e==="v6"||!e)&&Bp.test(t))}var Ut=class t extends j{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let i=this._getOrReturnCtx(e);return v(i,{code:k.invalid_type,expected:C.string,received:i.parsedType}),I}let a=new ae,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:k.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:k.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="length"){let c=e.data.length>i.value,u=e.data.length<i.value;(c||u)&&(s=this._getOrReturnCtx(e,s),c?v(s,{code:k.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):u&&v(s,{code:k.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),a.dirty())}else if(i.kind==="email")Mp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"email",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="emoji")so||(so=new RegExp(jp,"u")),so.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"emoji",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="uuid")Op.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"uuid",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="nanoid")Dp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"nanoid",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid")$p.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid2")Pp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid2",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="ulid")Ip.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ulid",code:k.invalid_string,message:i.message}),a.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),v(s,{validation:"url",code:k.invalid_string,message:i.message}),a.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"regex",code:k.invalid_string,message:i.message}),a.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),a.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:{startsWith:i.value},message:i.message}),a.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:{endsWith:i.value},message:i.message}),a.dirty()):i.kind==="datetime"?Hc(i).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:"datetime",message:i.message}),a.dirty()):i.kind==="date"?Hp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:"date",message:i.message}),a.dirty()):i.kind==="time"?Vp(i).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:k.invalid_string,validation:"time",message:i.message}),a.dirty()):i.kind==="duration"?Np.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"duration",code:k.invalid_string,message:i.message}),a.dirty()):i.kind==="ip"?Gp(e.data,i.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ip",code:k.invalid_string,message:i.message}),a.dirty()):i.kind==="jwt"?Jp(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"jwt",code:k.invalid_string,message:i.message}),a.dirty()):i.kind==="cidr"?Zp(e.data,i.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cidr",code:k.invalid_string,message:i.message}),a.dirty()):i.kind==="base64"?Up.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"base64",code:k.invalid_string,message:i.message}),a.dirty()):i.kind==="base64url"?zp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"base64url",code:k.invalid_string,message:i.message}),a.dirty()):q.assertNever(i);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(s=>e.test(s),{validation:r,code:k.invalid_string,...E.errToObj(a)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...E.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...E.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...E.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...E.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...E.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...E.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...E.errToObj(r)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ut.create=t=>new Ut({checks:[],typeName:O.ZodString,coerce:t?.coerce??!1,...M(t)});function Yp(t,e){let r=(t.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,s=r>a?r:a,i=Number.parseInt(t.toFixed(s).replace(".","")),c=Number.parseInt(e.toFixed(s).replace(".",""));return i%c/10**s}var ir=class t extends j{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let i=this._getOrReturnCtx(e);return v(i,{code:k.invalid_type,expected:C.number,received:i.parsedType}),I}let a,s=new ae;for(let i of this._def.checks)i.kind==="int"?q.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),v(a,{code:k.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Yp(e.data,i.value)!==0&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),v(a,{code:k.not_finite,message:i.message}),s.dirty()):q.assertNever(i);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,E.toString(r))}gt(e,r){return this.setLimit("min",e,!1,E.toString(r))}lte(e,r){return this.setLimit("max",e,!0,E.toString(r))}lt(e,r){return this.setLimit("max",e,!1,E.toString(r))}setLimit(e,r,a,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:E.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}};ir.create=t=>new ir({checks:[],typeName:O.ZodNumber,coerce:t?.coerce||!1,...M(t)});var cr=class t extends j{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let a,s=new ae;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),v(a,{code:k.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):q.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return v(r,{code:k.invalid_type,expected:C.bigint,received:r.parsedType}),I}gte(e,r){return this.setLimit("min",e,!0,E.toString(r))}gt(e,r){return this.setLimit("min",e,!1,E.toString(r))}lte(e,r){return this.setLimit("max",e,!0,E.toString(r))}lt(e,r){return this.setLimit("max",e,!1,E.toString(r))}setLimit(e,r,a,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:E.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};cr.create=t=>new cr({checks:[],typeName:O.ZodBigInt,coerce:t?.coerce??!1,...M(t)});var lr=class extends j{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.boolean,received:a.parsedType}),I}return ie(e.data)}};lr.create=t=>new lr({typeName:O.ZodBoolean,coerce:t?.coerce||!1,...M(t)});var ur=class t extends j{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let i=this._getOrReturnCtx(e);return v(i,{code:k.invalid_type,expected:C.date,received:i.parsedType}),I}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return v(i,{code:k.invalid_date}),I}let a=new ae,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:k.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),a.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:k.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),a.dirty()):q.assertNever(i);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};ur.create=t=>new ur({checks:[],coerce:t?.coerce||!1,typeName:O.ZodDate,...M(t)});var rn=class extends j{_parse(e){if(this._getType(e)!==C.symbol){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.symbol,received:a.parsedType}),I}return ie(e.data)}};rn.create=t=>new rn({typeName:O.ZodSymbol,...M(t)});var dr=class extends j{_parse(e){if(this._getType(e)!==C.undefined){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.undefined,received:a.parsedType}),I}return ie(e.data)}};dr.create=t=>new dr({typeName:O.ZodUndefined,...M(t)});var fr=class extends j{_parse(e){if(this._getType(e)!==C.null){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.null,received:a.parsedType}),I}return ie(e.data)}};fr.create=t=>new fr({typeName:O.ZodNull,...M(t)});var zt=class extends j{constructor(){super(...arguments),this._any=!0}_parse(e){return ie(e.data)}};zt.create=t=>new zt({typeName:O.ZodAny,...M(t)});var kt=class extends j{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ie(e.data)}};kt.create=t=>new kt({typeName:O.ZodUnknown,...M(t)});var Ue=class extends j{_parse(e){let r=this._getOrReturnCtx(e);return v(r,{code:k.invalid_type,expected:C.never,received:r.parsedType}),I}};Ue.create=t=>new Ue({typeName:O.ZodNever,...M(t)});var nn=class extends j{_parse(e){if(this._getType(e)!==C.undefined){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.void,received:a.parsedType}),I}return ie(e.data)}};nn.create=t=>new nn({typeName:O.ZodVoid,...M(t)});var St=class t extends j{_parse(e){let{ctx:r,status:a}=this._processInputParams(e),s=this._def;if(r.parsedType!==C.array)return v(r,{code:k.invalid_type,expected:C.array,received:r.parsedType}),I;if(s.exactLength!==null){let c=r.data.length>s.exactLength.value,u=r.data.length<s.exactLength.value;(c||u)&&(v(r,{code:c?k.too_big:k.too_small,minimum:u?s.exactLength.value:void 0,maximum:c?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),a.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(v(r,{code:k.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),a.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(v(r,{code:k.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((c,u)=>s.type._parseAsync(new De(r,c,r.path,u)))).then(c=>ae.mergeArray(a,c));let i=[...r.data].map((c,u)=>s.type._parseSync(new De(r,c,r.path,u)));return ae.mergeArray(a,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:E.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:E.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:E.toString(r)}})}nonempty(e){return this.min(1,e)}};St.create=(t,e)=>new St({type:t,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...M(e)});function tn(t){if(t instanceof ye){let e={};for(let r in t.shape){let a=t.shape[r];e[r]=Oe.create(tn(a))}return new ye({...t._def,shape:()=>e})}else return t instanceof St?new St({...t._def,type:tn(t.element)}):t instanceof Oe?Oe.create(tn(t.unwrap())):t instanceof nt?nt.create(tn(t.unwrap())):t instanceof rt?rt.create(t.items.map(e=>tn(e))):t}var ye=class t extends j{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=q.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==C.object){let d=this._getOrReturnCtx(e);return v(d,{code:k.invalid_type,expected:C.object,received:d.parsedType}),I}let{status:a,ctx:s}=this._processInputParams(e),{shape:i,keys:c}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ue&&this._def.unknownKeys==="strip"))for(let d in s.data)c.includes(d)||u.push(d);let f=[];for(let d of c){let m=i[d],w=s.data[d];f.push({key:{status:"valid",value:d},value:m._parse(new De(s,w,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Ue){let d=this._def.unknownKeys;if(d==="passthrough")for(let m of u)f.push({key:{status:"valid",value:m},value:{status:"valid",value:s.data[m]}});else if(d==="strict")u.length>0&&(v(s,{code:k.unrecognized_keys,keys:u}),a.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let m of u){let w=s.data[m];f.push({key:{status:"valid",value:m},value:d._parse(new De(s,w,s.path,m)),alwaysSet:m in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let d=[];for(let m of f){let w=await m.key,S=await m.value;d.push({key:w,value:S,alwaysSet:m.alwaysSet})}return d}).then(d=>ae.mergeObjectSync(a,d)):ae.mergeObjectSync(a,f)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{let s=this._def.errorMap?.(r,a).message??a.defaultError;return r.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let a of q.objectKeys(e))e[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let a of q.objectKeys(this.shape))e[a]||(r[a]=this.shape[a]);return new t({...this._def,shape:()=>r})}deepPartial(){return tn(this)}partial(e){let r={};for(let a of q.objectKeys(this.shape)){let s=this.shape[a];e&&!e[a]?r[a]=s:r[a]=s.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let a of q.objectKeys(this.shape))if(e&&!e[a])r[a]=this.shape[a];else{let i=this.shape[a];for(;i instanceof Oe;)i=i._def.innerType;r[a]=i}return new t({...this._def,shape:()=>r})}keyof(){return Vc(q.objectKeys(this.shape))}};ye.create=(t,e)=>new ye({shape:()=>t,unknownKeys:"strip",catchall:Ue.create(),typeName:O.ZodObject,...M(e)});ye.strictCreate=(t,e)=>new ye({shape:()=>t,unknownKeys:"strict",catchall:Ue.create(),typeName:O.ZodObject,...M(e)});ye.lazycreate=(t,e)=>new ye({shape:t,unknownKeys:"strip",catchall:Ue.create(),typeName:O.ZodObject,...M(e)});var pr=class extends j{_parse(e){let{ctx:r}=this._processInputParams(e),a=this._def.options;function s(i){for(let u of i)if(u.result.status==="valid")return u.result;for(let u of i)if(u.result.status==="dirty")return r.common.issues.push(...u.ctx.common.issues),u.result;let c=i.map(u=>new ge(u.ctx.common.issues));return v(r,{code:k.invalid_union,unionErrors:c}),I}if(r.common.async)return Promise.all(a.map(async i=>{let c={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:c}),ctx:c}})).then(s);{let i,c=[];for(let f of a){let d={...r,common:{...r.common,issues:[]},parent:null},m=f._parseSync({data:r.data,path:r.path,parent:d});if(m.status==="valid")return m;m.status==="dirty"&&!i&&(i={result:m,ctx:d}),d.common.issues.length&&c.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let u=c.map(f=>new ge(f));return v(r,{code:k.invalid_union,unionErrors:u}),I}}get options(){return this._def.options}};pr.create=(t,e)=>new pr({options:t,typeName:O.ZodUnion,...M(e)});var _t=t=>t instanceof mr?_t(t.schema):t instanceof Le?_t(t.innerType()):t instanceof gr?[t.value]:t instanceof yr?t.options:t instanceof br?q.objectValues(t.enum):t instanceof wr?_t(t._def.innerType):t instanceof dr?[void 0]:t instanceof fr?[null]:t instanceof Oe?[void 0,..._t(t.unwrap())]:t instanceof nt?[null,..._t(t.unwrap())]:t instanceof En||t instanceof kr?_t(t.unwrap()):t instanceof _r?_t(t._def.innerType):[],La=class t extends j{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return v(r,{code:k.invalid_type,expected:C.object,received:r.parsedType}),I;let a=this.discriminator,s=r.data[a],i=this.optionsMap.get(s);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(v(r,{code:k.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),I)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,a){let s=new Map;for(let i of r){let c=_t(i.shape[e]);if(!c.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let u of c){if(s.has(u))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(u)}`);s.set(u,i)}}return new t({typeName:O.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:s,...M(a)})}};function oo(t,e){let r=tt(t),a=tt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&a===C.object){let s=q.objectKeys(e),i=q.objectKeys(t).filter(u=>s.indexOf(u)!==-1),c={...t,...e};for(let u of i){let f=oo(t[u],e[u]);if(!f.valid)return{valid:!1};c[u]=f.data}return{valid:!0,data:c}}else if(r===C.array&&a===C.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<t.length;i++){let c=t[i],u=e[i],f=oo(c,u);if(!f.valid)return{valid:!1};s.push(f.data)}return{valid:!0,data:s}}else return r===C.date&&a===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var hr=class extends j{_parse(e){let{status:r,ctx:a}=this._processInputParams(e),s=(i,c)=>{if(Oa(i)||Oa(c))return I;let u=oo(i.value,c.value);return u.valid?((Da(i)||Da(c))&&r.dirty(),{status:r.value,value:u.data}):(v(a,{code:k.invalid_intersection_types}),I)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([i,c])=>s(i,c)):s(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};hr.create=(t,e,r)=>new hr({left:t,right:e,typeName:O.ZodIntersection,...M(r)});var rt=class t extends j{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==C.array)return v(a,{code:k.invalid_type,expected:C.array,received:a.parsedType}),I;if(a.data.length<this._def.items.length)return v(a,{code:k.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),I;!this._def.rest&&a.data.length>this._def.items.length&&(v(a,{code:k.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...a.data].map((c,u)=>{let f=this._def.items[u]||this._def.rest;return f?f._parse(new De(a,c,a.path,u)):null}).filter(c=>!!c);return a.common.async?Promise.all(i).then(c=>ae.mergeArray(r,c)):ae.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};rt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new rt({items:t,typeName:O.ZodTuple,rest:null,...M(e)})};var Na=class t extends j{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==C.object)return v(a,{code:k.invalid_type,expected:C.object,received:a.parsedType}),I;let s=[],i=this._def.keyType,c=this._def.valueType;for(let u in a.data)s.push({key:i._parse(new De(a,u,a.path,u)),value:c._parse(new De(a,a.data[u],a.path,u)),alwaysSet:u in a.data});return a.common.async?ae.mergeObjectAsync(r,s):ae.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(e,r,a){return r instanceof j?new t({keyType:e,valueType:r,typeName:O.ZodRecord,...M(a)}):new t({keyType:Ut.create(),valueType:e,typeName:O.ZodRecord,...M(r)})}},an=class extends j{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==C.map)return v(a,{code:k.invalid_type,expected:C.map,received:a.parsedType}),I;let s=this._def.keyType,i=this._def.valueType,c=[...a.data.entries()].map(([u,f],d)=>({key:s._parse(new De(a,u,a.path,[d,"key"])),value:i._parse(new De(a,f,a.path,[d,"value"]))}));if(a.common.async){let u=new Map;return Promise.resolve().then(async()=>{for(let f of c){let d=await f.key,m=await f.value;if(d.status==="aborted"||m.status==="aborted")return I;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),u.set(d.value,m.value)}return{status:r.value,value:u}})}else{let u=new Map;for(let f of c){let d=f.key,m=f.value;if(d.status==="aborted"||m.status==="aborted")return I;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),u.set(d.value,m.value)}return{status:r.value,value:u}}}};an.create=(t,e,r)=>new an({valueType:e,keyType:t,typeName:O.ZodMap,...M(r)});var sn=class t extends j{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==C.set)return v(a,{code:k.invalid_type,expected:C.set,received:a.parsedType}),I;let s=this._def;s.minSize!==null&&a.data.size<s.minSize.value&&(v(a,{code:k.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&a.data.size>s.maxSize.value&&(v(a,{code:k.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());let i=this._def.valueType;function c(f){let d=new Set;for(let m of f){if(m.status==="aborted")return I;m.status==="dirty"&&r.dirty(),d.add(m.value)}return{status:r.value,value:d}}let u=[...a.data.values()].map((f,d)=>i._parse(new De(a,f,a.path,d)));return a.common.async?Promise.all(u).then(f=>c(f)):c(u)}min(e,r){return new t({...this._def,minSize:{value:e,message:E.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:E.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};sn.create=(t,e)=>new sn({valueType:t,minSize:null,maxSize:null,typeName:O.ZodSet,...M(e)});var Ma=class t extends j{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return v(r,{code:k.invalid_type,expected:C.function,received:r.parsedType}),I;function a(u,f){return Rn({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Xr(),wt].filter(d=>!!d),issueData:{code:k.invalid_arguments,argumentsError:f}})}function s(u,f){return Rn({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Xr(),wt].filter(d=>!!d),issueData:{code:k.invalid_return_type,returnTypeError:f}})}let i={errorMap:r.common.contextualErrorMap},c=r.data;if(this._def.returns instanceof Ht){let u=this;return ie(async function(...f){let d=new ge([]),m=await u._def.args.parseAsync(f,i).catch(R=>{throw d.addIssue(a(f,R)),d}),w=await Reflect.apply(c,this,m);return await u._def.returns._def.type.parseAsync(w,i).catch(R=>{throw d.addIssue(s(w,R)),d})})}else{let u=this;return ie(function(...f){let d=u._def.args.safeParse(f,i);if(!d.success)throw new ge([a(f,d.error)]);let m=Reflect.apply(c,this,d.data),w=u._def.returns.safeParse(m,i);if(!w.success)throw new ge([s(m,w.error)]);return w.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:rt.create(e).rest(kt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,a){return new t({args:e||rt.create([]).rest(kt.create()),returns:r||kt.create(),typeName:O.ZodFunction,...M(a)})}},mr=class extends j{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};mr.create=(t,e)=>new mr({getter:t,typeName:O.ZodLazy,...M(e)});var gr=class extends j{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return v(r,{received:r.data,code:k.invalid_literal,expected:this._def.value}),I}return{status:"valid",value:e.data}}get value(){return this._def.value}};gr.create=(t,e)=>new gr({value:t,typeName:O.ZodLiteral,...M(e)});function Vc(t,e){return new yr({values:t,typeName:O.ZodEnum,...M(e)})}var yr=class t extends j{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),a=this._def.values;return v(r,{expected:q.joinValues(a),received:r.parsedType,code:k.invalid_type}),I}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),a=this._def.values;return v(r,{received:r.data,code:k.invalid_enum_value,options:a}),I}return ie(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}};yr.create=Vc;var br=class extends j{_parse(e){let r=q.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==C.string&&a.parsedType!==C.number){let s=q.objectValues(r);return v(a,{expected:q.joinValues(s),received:a.parsedType,code:k.invalid_type}),I}if(this._cache||(this._cache=new Set(q.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=q.objectValues(r);return v(a,{received:a.data,code:k.invalid_enum_value,options:s}),I}return ie(e.data)}get enum(){return this._def.values}};br.create=(t,e)=>new br({values:t,typeName:O.ZodNativeEnum,...M(e)});var Ht=class extends j{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return v(r,{code:k.invalid_type,expected:C.promise,received:r.parsedType}),I;let a=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return ie(a.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ht.create=(t,e)=>new Ht({type:t,typeName:O.ZodPromise,...M(e)});var Le=class extends j{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:a}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:c=>{v(a,c),c.fatal?r.abort():r.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let c=s.transform(a.data,i);if(a.common.async)return Promise.resolve(c).then(async u=>{if(r.value==="aborted")return I;let f=await this._def.schema._parseAsync({data:u,path:a.path,parent:a});return f.status==="aborted"?I:f.status==="dirty"?or(f.value):r.value==="dirty"?or(f.value):f});{if(r.value==="aborted")return I;let u=this._def.schema._parseSync({data:c,path:a.path,parent:a});return u.status==="aborted"?I:u.status==="dirty"?or(u.value):r.value==="dirty"?or(u.value):u}}if(s.type==="refinement"){let c=u=>{let f=s.refinement(u,i);if(a.common.async)return Promise.resolve(f);if(f instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(a.common.async===!1){let u=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return u.status==="aborted"?I:(u.status==="dirty"&&r.dirty(),c(u.value),{status:r.value,value:u.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(u=>u.status==="aborted"?I:(u.status==="dirty"&&r.dirty(),c(u.value).then(()=>({status:r.value,value:u.value}))))}if(s.type==="transform")if(a.common.async===!1){let c=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Bt(c))return I;let u=s.transform(c.value,i);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:u}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(c=>Bt(c)?Promise.resolve(s.transform(c.value,i)).then(u=>({status:r.value,value:u})):I);q.assertNever(s)}};Le.create=(t,e,r)=>new Le({schema:t,typeName:O.ZodEffects,effect:e,...M(r)});Le.createWithPreprocess=(t,e,r)=>new Le({schema:e,effect:{type:"preprocess",transform:t},typeName:O.ZodEffects,...M(r)});var Oe=class extends j{_parse(e){return this._getType(e)===C.undefined?ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Oe.create=(t,e)=>new Oe({innerType:t,typeName:O.ZodOptional,...M(e)});var nt=class extends j{_parse(e){return this._getType(e)===C.null?ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};nt.create=(t,e)=>new nt({innerType:t,typeName:O.ZodNullable,...M(e)});var wr=class extends j{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return r.parsedType===C.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};wr.create=(t,e)=>new wr({innerType:t,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var _r=class extends j{_parse(e){let{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return en(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ge(a.common.issues)},input:a.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ge(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};_r.create=(t,e)=>new _r({innerType:t,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var on=class extends j{_parse(e){if(this._getType(e)!==C.nan){let a=this._getOrReturnCtx(e);return v(a,{code:k.invalid_type,expected:C.nan,received:a.parsedType}),I}return{status:"valid",value:e.data}}};on.create=t=>new on({typeName:O.ZodNaN,...M(t)});var Qp=Symbol("zod_brand"),En=class extends j{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}},An=class t extends j{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?I:i.status==="dirty"?(r.dirty(),or(i.value)):this._def.out._parseAsync({data:i.value,path:a.path,parent:a})})();{let s=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?I:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:a.path,parent:a})}}static create(e,r){return new t({in:e,out:r,typeName:O.ZodPipeline})}},kr=class extends j{_parse(e){let r=this._def.innerType._parse(e),a=s=>(Bt(s)&&(s.value=Object.freeze(s.value)),s);return en(r)?r.then(s=>a(s)):a(r)}unwrap(){return this._def.innerType}};kr.create=(t,e)=>new kr({innerType:t,typeName:O.ZodReadonly,...M(e)});function Bc(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Gc(t,e={},r){return t?zt.create().superRefine((a,s)=>{let i=t(a);if(i instanceof Promise)return i.then(c=>{if(!c){let u=Bc(e,a),f=u.fatal??r??!0;s.addIssue({code:"custom",...u,fatal:f})}});if(!i){let c=Bc(e,a),u=c.fatal??r??!0;s.addIssue({code:"custom",...c,fatal:u})}}):zt.create()}var Kp={object:ye.lazycreate},O;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(O||(O={}));var Xp=(t,e={message:`Input not instance of ${t.name}`})=>Gc(r=>r instanceof t,e),Jc=Ut.create,Zc=ir.create,eh=on.create,th=cr.create,Yc=lr.create,rh=ur.create,nh=rn.create,ah=dr.create,sh=fr.create,oh=zt.create,ih=kt.create,ch=Ue.create,lh=nn.create,uh=St.create,dh=ye.create,fh=ye.strictCreate,ph=pr.create,hh=La.create,mh=hr.create,gh=rt.create,yh=Na.create,bh=an.create,wh=sn.create,_h=Ma.create,kh=mr.create,Sh=gr.create,xh=yr.create,vh=br.create,Th=Ht.create,Ch=Le.create,Rh=Oe.create,Eh=nt.create,Ah=Le.createWithPreprocess,$h=An.create,Ph=()=>Jc().optional(),Ih=()=>Zc().optional(),Oh=()=>Yc().optional(),Dh={string:(t=>Ut.create({...t,coerce:!0})),number:(t=>ir.create({...t,coerce:!0})),boolean:(t=>lr.create({...t,coerce:!0})),bigint:(t=>cr.create({...t,coerce:!0})),date:(t=>ur.create({...t,coerce:!0}))};var Lh=I;var ja="2.0",Qc=h.union([h.string(),h.number().int()]),Kc=h.string(),ze=h.object({_meta:h.optional(h.object({progressToken:h.optional(Qc)}).passthrough())}).passthrough(),Se=h.object({method:h.string(),params:h.optional(ze)}),$n=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),at=h.object({method:h.string(),params:h.optional($n)}),He=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),Fa=h.union([h.string(),h.number().int()]),Nh=h.object({jsonrpc:h.literal(ja),id:Fa}).merge(Se).strict(),Mh=h.object({jsonrpc:h.literal(ja)}).merge(at).strict(),jh=h.object({jsonrpc:h.literal(ja),id:Fa,result:He}).strict(),io;(function(t){t[t.ConnectionClosed=-1]="ConnectionClosed",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError"})(io||(io={}));var Fh=h.object({jsonrpc:h.literal(ja),id:Fa,error:h.object({code:h.number().int(),message:h.string(),data:h.optional(h.unknown())})}).strict(),Vw=h.union([Nh,Mh,jh,Fh]),co=He.strict(),lo=at.extend({method:h.literal("notifications/cancelled"),params:$n.extend({requestId:Fa,reason:h.string().optional()})}),Xc=h.object({name:h.string(),version:h.string()}).passthrough(),Wh=h.object({experimental:h.optional(h.object({}).passthrough()),sampling:h.optional(h.object({}).passthrough()),roots:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),el=Se.extend({method:h.literal("initialize"),params:ze.extend({protocolVersion:h.string(),capabilities:Wh,clientInfo:Xc})}),qh=h.object({experimental:h.optional(h.object({}).passthrough()),logging:h.optional(h.object({}).passthrough()),prompts:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough()),resources:h.optional(h.object({subscribe:h.optional(h.boolean()),listChanged:h.optional(h.boolean())}).passthrough()),tools:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),Bh=He.extend({protocolVersion:h.string(),capabilities:qh,serverInfo:Xc}),tl=at.extend({method:h.literal("notifications/initialized")}),uo=Se.extend({method:h.literal("ping")}),Uh=h.object({progress:h.number(),total:h.optional(h.number())}).passthrough(),fo=at.extend({method:h.literal("notifications/progress"),params:$n.merge(Uh).extend({progressToken:Qc})}),Wa=Se.extend({params:ze.extend({cursor:h.optional(Kc)}).optional()}),qa=He.extend({nextCursor:h.optional(Kc)}),rl=h.object({uri:h.string(),mimeType:h.optional(h.string())}).passthrough(),nl=rl.extend({text:h.string()}),al=rl.extend({blob:h.string().base64()}),zh=h.object({uri:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),Hh=h.object({uriTemplate:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),Vh=Wa.extend({method:h.literal("resources/list")}),Gh=qa.extend({resources:h.array(zh)}),Jh=Wa.extend({method:h.literal("resources/templates/list")}),Zh=qa.extend({resourceTemplates:h.array(Hh)}),Yh=Se.extend({method:h.literal("resources/read"),params:ze.extend({uri:h.string()})}),Qh=He.extend({contents:h.array(h.union([nl,al]))}),Kh=at.extend({method:h.literal("notifications/resources/list_changed")}),Xh=Se.extend({method:h.literal("resources/subscribe"),params:ze.extend({uri:h.string()})}),em=Se.extend({method:h.literal("resources/unsubscribe"),params:ze.extend({uri:h.string()})}),tm=at.extend({method:h.literal("notifications/resources/updated"),params:$n.extend({uri:h.string()})}),rm=h.object({name:h.string(),description:h.optional(h.string()),required:h.optional(h.boolean())}).passthrough(),nm=h.object({name:h.string(),description:h.optional(h.string()),arguments:h.optional(h.array(rm))}).passthrough(),am=Wa.extend({method:h.literal("prompts/list")}),sm=qa.extend({prompts:h.array(nm)}),om=Se.extend({method:h.literal("prompts/get"),params:ze.extend({name:h.string(),arguments:h.optional(h.record(h.string()))})}),Ba=h.object({type:h.literal("text"),text:h.string()}).passthrough(),Ua=h.object({type:h.literal("image"),data:h.string().base64(),mimeType:h.string()}).passthrough(),sl=h.object({type:h.literal("resource"),resource:h.union([nl,al])}).passthrough(),im=h.object({role:h.enum(["user","assistant"]),content:h.union([Ba,Ua,sl])}).passthrough(),cm=He.extend({description:h.optional(h.string()),messages:h.array(im)}),lm=at.extend({method:h.literal("notifications/prompts/list_changed")}),um=h.object({name:h.string(),description:h.optional(h.string()),inputSchema:h.object({type:h.literal("object"),properties:h.optional(h.object({}).passthrough())}).passthrough()}).passthrough(),dm=Wa.extend({method:h.literal("tools/list")}),fm=qa.extend({tools:h.array(um)}),ol=He.extend({content:h.array(h.union([Ba,Ua,sl])),isError:h.boolean().default(!1).optional()}),Gw=ol.or(He.extend({toolResult:h.unknown()})),pm=Se.extend({method:h.literal("tools/call"),params:ze.extend({name:h.string(),arguments:h.optional(h.record(h.unknown()))})}),hm=at.extend({method:h.literal("notifications/tools/list_changed")}),il=h.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),mm=Se.extend({method:h.literal("logging/setLevel"),params:ze.extend({level:il})}),gm=at.extend({method:h.literal("notifications/message"),params:$n.extend({level:il,logger:h.optional(h.string()),data:h.unknown()})}),ym=h.object({name:h.string().optional()}).passthrough(),bm=h.object({hints:h.optional(h.array(ym)),costPriority:h.optional(h.number().min(0).max(1)),speedPriority:h.optional(h.number().min(0).max(1)),intelligencePriority:h.optional(h.number().min(0).max(1))}).passthrough(),wm=h.object({role:h.enum(["user","assistant"]),content:h.union([Ba,Ua])}).passthrough(),_m=Se.extend({method:h.literal("sampling/createMessage"),params:ze.extend({messages:h.array(wm),systemPrompt:h.optional(h.string()),includeContext:h.optional(h.enum(["none","thisServer","allServers"])),temperature:h.optional(h.number()),maxTokens:h.number().int(),stopSequences:h.optional(h.array(h.string())),metadata:h.optional(h.object({}).passthrough()),modelPreferences:h.optional(bm)})}),cl=He.extend({model:h.string(),stopReason:h.optional(h.enum(["endTurn","stopSequence","maxTokens"]).or(h.string())),role:h.enum(["user","assistant"]),content:h.discriminatedUnion("type",[Ba,Ua])}),km=h.object({type:h.literal("ref/resource"),uri:h.string()}).passthrough(),Sm=h.object({type:h.literal("ref/prompt"),name:h.string()}).passthrough(),xm=Se.extend({method:h.literal("completion/complete"),params:ze.extend({ref:h.union([Sm,km]),argument:h.object({name:h.string(),value:h.string()}).passthrough()})}),vm=He.extend({completion:h.object({values:h.array(h.string()).max(100),total:h.optional(h.number().int()),hasMore:h.optional(h.boolean())}).passthrough()}),Tm=h.object({uri:h.string().startsWith("file://"),name:h.optional(h.string())}).passthrough(),Cm=Se.extend({method:h.literal("roots/list")}),ll=He.extend({roots:h.array(Tm)}),Rm=at.extend({method:h.literal("notifications/roots/list_changed")}),Jw=h.union([uo,el,xm,mm,om,am,Vh,Jh,Yh,Xh,em,pm,dm]),Zw=h.union([lo,fo,tl,Rm]),Yw=h.union([co,cl,ll]),Qw=h.union([uo,_m,Cm]),Kw=h.union([lo,fo,gm,tm,Kh,hm,lm]),Xw=h.union([co,Bh,vm,cm,sm,Gh,Zh,Qh,ol,fm]);var Wr=require("fs/promises"),ra=require("path"),ms=require("os"),Rd=require("fs"),yS=require("url"),Ed=Be(require("http"),1);var ee=require("fs/promises"),X=require("path");var un=require("fs/promises"),Eo=require("path"),Ao=require("os");rs();function Zm(t,e){let r=[];for(let a=0;a<=e.length;a++)r[a]=[a];for(let a=0;a<=t.length;a++)r[0][a]=a;for(let a=1;a<=e.length;a++)for(let s=1;s<=t.length;s++)e.charAt(a-1)===t.charAt(s-1)?r[a][s]=r[a-1][s-1]:r[a][s]=Math.min(r[a-1][s-1]+1,r[a][s-1]+1,r[a-1][s]+1);return r[e.length][t.length]}function nu(t,e){let r=Zm(t.toLowerCase(),e.toLowerCase()),a=Math.max(t.length,e.length);return 1-r/a}function Ro(t,e,r=.6){if(!t||!e||e.length===0)return null;let a=t.toLowerCase().trim();for(let c of e)if(c.name.toLowerCase()===a)return{workspace:c,confidence:1,matchType:"exact"};for(let c of e){let u=c.name.toLowerCase();if(u.includes(a)||a.includes(u))return{workspace:c,confidence:.9,matchType:"substring"}}let s=null,i=0;for(let c of e){let u=nu(a,c.name);u>i&&u>=r&&(i=u,s=c)}return s?{workspace:s,confidence:i,matchType:"fuzzy"}:null}function au(t,e,r=.5,a=3){if(!t||!e||e.length===0)return[];let s=t.toLowerCase().trim(),i=[];for(let c of e){let u=c.name.toLowerCase(),f=0,d="fuzzy";u===s?(f=1,d="exact"):u.includes(s)||s.includes(u)?(f=.9,d="substring"):(f=nu(s,c.name),d="fuzzy"),f>=r&&i.push({workspace:c,confidence:f,matchType:d})}return i.sort((c,u)=>u.confidence-c.confidence).slice(0,a)}function su(t){let e=[],r=[/(?:in|from|to|at|on)\s+(?:my\s+)?([a-zA-Z0-9\s-]+?)(?:\s+workspace|\s+notes?|\s+folder)/gi,/(?:workspace|notes?|folder)\s+(?:named|called)\s+["']?([a-zA-Z0-9\s-]+?)["']?/gi,/["']([a-zA-Z0-9\s-]+?)["']\s+(?:workspace|notes?|folder)/gi];for(let a of r){let s;for(;(s=a.exec(t))!==null;)e.push(s[1].trim())}return[...new Set(e)]}var ou=(0,Eo.join)((0,Ao.homedir)(),".lokus","mcp-context.json"),$o=[{name:"list_all_workspaces",description:"List all available Lokus workspaces. Use this when you need to see what workspaces are available or when the user mentions a workspace name.",inputSchema:{type:"object",properties:{}}},{name:"set_workspace_context",description:"Set the active workspace context for all subsequent operations. This ensures all tools operate on the correct workspace. Always use this before performing workspace-specific operations.",inputSchema:{type:"object",properties:{workspacePath:{type:"string",description:"Full path to the workspace to set as active"}},required:["workspacePath"]}},{name:"get_current_context",description:"Get the currently active workspace context. Use this to verify which workspace you're operating on.",inputSchema:{type:"object",properties:{}}},{name:"match_workspace_by_name",description:"Smart workspace detection from natural language. Use this when the user refers to a workspace by name (e.g., 'my knowledge base', 'work notes'). Returns the best matching workspace.",inputSchema:{type:"object",properties:{query:{type:"string",description:"Natural language workspace reference (e.g., 'knowledge base', 'work notes', 'personal workspace')"},autoSet:{type:"boolean",description:"Automatically set the matched workspace as active context (default: true)"}},required:["query"]}},{name:"clear_workspace_context",description:"Clear the active workspace context. Use this when you need to reset or when switching between different tasks.",inputSchema:{type:"object",properties:{}}},{name:"detect_workspace_from_text",description:"Analyze text to automatically detect workspace references and provide suggestions. Useful when the user's message contains workspace-related context.",inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to analyze for workspace references"}},required:["text"]}}];async function iu(t,e,r){switch(t){case"list_all_workspaces":return await Ym(r);case"set_workspace_context":return await Po(e.workspacePath);case"get_current_context":return await Qm();case"match_workspace_by_name":return await Km(e.query,e.autoSet!==!1,r);case"clear_workspace_context":return await Xm();case"detect_workspace_from_text":return await eg(e.text,r);default:throw new Error(`Unknown workspace context tool: ${t}`)}}async function Ym(t){if(!t)return{content:[{type:"text",text:`\u274C API server not available. Cannot list workspaces.

Please ensure Lokus is running.`}]};try{let e=await Tt(`${t}/api/workspaces/all`);if(!e.ok)throw new Error(`API request failed: ${e.status}`);let r=await e.json();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch workspaces");let a=r.data;if(a.length===0)return{content:[{type:"text",text:`\u{1F4C2} No workspaces found.

You may need to open a workspace in Lokus first.`}]};let s=await Wn();return{content:[{type:"text",text:`**Available Workspaces:**

${a.map(c=>{let f=s.currentWorkspace===c.path?"\u{1F449} ":"   ",d=c.note_count!==null?` (${c.note_count} notes)`:"";return`${f}\u{1F4C1} **${c.name}**${d}
      Path: ${c.path}`}).join(`

`)}

${s.currentWorkspace?"\u{1F449} = Currently active workspace":"\u{1F4A1} Use `match_workspace_by_name` or `set_workspace_context` to set active workspace"}`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to list workspaces: ${e.message}

Please ensure Lokus is running and the API server is accessible.`}]}}}async function Po(t){try{let e=await Wn();return e.currentWorkspace=t,e.lastUpdated=new Date().toISOString(),await cu(e),{content:[{type:"text",text:`\u2705 Workspace context set to:
\u{1F4C1} **${t}**

All subsequent operations will use this workspace.`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to set workspace context: ${e.message}`}]}}}async function Qm(){try{let t=await Wn();if(!t.currentWorkspace)return{content:[{type:"text",text:"\u26A0\uFE0F No workspace context is currently set.\n\n\u{1F4A1} Use `list_all_workspaces` to see available workspaces, then use `match_workspace_by_name` or `set_workspace_context` to set one."}]};let e=new Date-new Date(t.lastUpdated),r=Math.floor(e/6e4),a=r<1?"just now":`${r} minute${r!==1?"s":""} ago`;return{content:[{type:"text",text:`**Current Workspace Context:**

\u{1F4C1} ${t.currentWorkspace}
\u23F1\uFE0F Last updated: ${a}

\u2705 All operations will use this workspace.`}]}}catch(t){return{content:[{type:"text",text:`\u274C Failed to get context: ${t.message}`}]}}}async function Km(t,e,r){if(!r)return{content:[{type:"text",text:"\u274C API server not available. Cannot match workspaces."}]};try{let a=await Tt(`${r}/api/workspaces/all`);if(!a.ok)throw new Error(`API request failed: ${a.status}`);let s=await a.json();if(!s.success||!s.data)throw new Error(s.error||"Failed to fetch workspaces");let i=s.data;if(i.length===0)return{content:[{type:"text",text:"\u{1F4C2} No workspaces available to match against."}]};let c=Ro(t,i,.6);if(!c){let m=au(t,i,.4,3);if(m.length>0){let w=m.map(S=>`  - ${S.workspace.name} (${Math.round(S.confidence*100)}% match)`).join(`
`);return{content:[{type:"text",text:`\u274C No strong match found for "${t}".

Did you mean:
${w}

\u{1F4A1} Try being more specific or use \`list_all_workspaces\` to see all available workspaces.`}]}}return{content:[{type:"text",text:`\u274C No workspace matches "${t}".

\u{1F4A1} Use \`list_all_workspaces\` to see all available workspaces.`}]}}let u=Math.round(c.confidence*100),d=`${c.matchType==="exact"?"\u{1F3AF}":c.matchType==="substring"?"\u2705":"\u{1F50D}"} **Match Found** (${u}% confidence)

\u{1F4C1} **${c.workspace.name}**
   Path: ${c.workspace.path}
   Match type: ${c.matchType}`;return e?(await Po(c.workspace.path),d+=`

\u2705 Workspace context has been automatically set.
All subsequent operations will use this workspace.`):d+="\n\n\u{1F4A1} Use `set_workspace_context` to activate this workspace.",{content:[{type:"text",text:d}]}}catch(a){return{content:[{type:"text",text:`\u274C Failed to match workspace: ${a.message}`}]}}}async function Xm(){try{let t=await Wn(),e=t.currentWorkspace;return t.currentWorkspace=null,t.lastUpdated=new Date().toISOString(),await cu(t),{content:[{type:"text",text:e?`\u2705 Workspace context cleared.
Previously: ${e}`:"\u2705 Workspace context cleared (no context was set)."}]}}catch(t){return{content:[{type:"text",text:`\u274C Failed to clear context: ${t.message}`}]}}}async function eg(t,e){if(!e)return{content:[{type:"text",text:"\u274C API server not available."}]};try{let r=su(t);if(r.length===0)return{content:[{type:"text",text:`\u{1F50D} No workspace references detected in the text.

\u{1F4A1} Try phrases like 'in my knowledge base' or 'from work notes'.`}]};let a=await Tt(`${e}/api/workspaces/all`);if(!a.ok)throw new Error(`API request failed: ${a.status}`);let s=await a.json();if(!s.success||!s.data)throw new Error(s.error||"Failed to fetch workspaces");let i=s.data,c=[];for(let d of r){let m=Ro(d,i,.5);m&&c.push({reference:d,match:m})}if(c.length===0)return{content:[{type:"text",text:`\u{1F50D} Found potential workspace references but couldn't match them:
${r.map(d=>`  - "${d}"`).join(`
`)}

\u{1F4A1} Use \`list_all_workspaces\` to see available workspaces.`}]};let u=c.map(d=>`  - "${d.reference}" \u2192 **${d.match.workspace.name}** (${Math.round(d.match.confidence*100)}% confidence)`).join(`
`),f=c.sort((d,m)=>m.match.confidence-d.match.confidence)[0];return await Po(f.match.workspace.path),{content:[{type:"text",text:`\u{1F50D} **Workspace References Detected:**

${u}

\u2705 Automatically set context to: **${f.match.workspace.name}**`}]}}catch(r){return{content:[{type:"text",text:`\u274C Failed to detect workspace: ${r.message}`}]}}}async function Wn(){try{let t=await(0,un.readFile)(ou,"utf-8");return JSON.parse(t)}catch{return{currentWorkspace:null,lastUpdated:null}}}async function cu(t){let e=(0,Eo.join)((0,Ao.homedir)(),".lokus");try{await(0,un.mkdir)(e,{recursive:!0})}catch{}await(0,un.writeFile)(ou,JSON.stringify(t,null,2),"utf-8")}async function lu(){return(await Wn()).currentWorkspace}function uu(t){return t?`\u{1F3AF} **Operating on:** ${t.split("/").pop()} (${t})`:"\u26A0\uFE0F **No workspace context set** - Using default or last workspace"}var Io=[{name:"list_notes",description:"List all notes in the workspace with metadata",inputSchema:{type:"object",properties:{folder:{type:"string",description:"Folder to list notes from (optional)"},sortBy:{type:"string",enum:["name","modified","created","size"],description:"Sort notes by"},includeContent:{type:"boolean",description:"Include first 200 chars of content"}}}},{name:"read_note",description:"Read the full content of a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note file"}},required:["path"]}},{name:"create_note",description:"Create a new note with optional frontmatter",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path for the new note"},content:{type:"string",description:"Note content"},frontmatter:{type:"object",description:"Optional frontmatter metadata"}},required:["path","content"]}},{name:"update_note",description:"Update an existing note's content",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"},content:{type:"string",description:"New content"},preserveFrontmatter:{type:"boolean",description:"Preserve existing frontmatter"}},required:["path","content"]}},{name:"delete_note",description:"Delete a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note to delete"}},required:["path"]}},{name:"search_notes",description:"Search notes by content or metadata",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},searchIn:{type:"string",enum:["content","title","tags","all"],description:"Where to search"},regex:{type:"boolean",description:"Use regex search"}},required:["query"]}},{name:"get_note_links",description:"Get all wiki links in a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"get_note_backlinks",description:"Find all notes that link to a specific note",inputSchema:{type:"object",properties:{noteName:{type:"string",description:"Name of the note to find backlinks for"}},required:["noteName"]}},{name:"extract_note_metadata",description:"Extract frontmatter and metadata from a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"rename_note",description:"Rename a note and update all references",inputSchema:{type:"object",properties:{oldPath:{type:"string",description:"Current path of the note"},newPath:{type:"string",description:"New path for the note"},updateLinks:{type:"boolean",description:"Update wiki links in other notes"}},required:["oldPath","newPath"]}}];async function du(t,e,r,a){let i=await lu()||r;switch(t){case"list_notes":return await tg(i,e);case"read_note":return await rg(i,e.path);case"create_note":return await ng(i,e);case"update_note":return await ag(i,e);case"delete_note":return await sg(i,e.path);case"search_notes":return await og(i,e);case"get_note_links":return await ig(i,e.path);case"get_note_backlinks":return await cg(i,e.noteName);case"extract_note_metadata":return await lg(i,e.path);case"rename_note":return await ug(i,e);default:throw new Error(`Unknown notes tool: ${t}`)}}async function tg(t,e={}){let r=await qn(t);if(e.sortBy&&r.sort((a,s)=>{switch(e.sortBy){case"modified":return s.modified-a.modified;case"created":return s.created-a.created;case"size":return s.size-a.size;default:return a.name.localeCompare(s.name)}}),e.includeContent)for(let a of r)try{let s=await(0,ee.readFile)(a.path,"utf-8");a.preview=s.substring(0,200).replace(/\n/g," ")}catch{a.preview=null}return{content:[{type:"text",text:`${uu(t)}

Found ${r.length} notes

${r.map(a=>`- ${a.name} (${a.relativePath})${a.preview?`
  `+a.preview+"...":""}`).join(`
`)}`}]}}async function qn(t,e=t){let r=[],a=await(0,ee.readdir)(t,{withFileTypes:!0});for(let s of a){let i=(0,X.join)(t,s.name);if(!s.name.startsWith(".")){if(s.isDirectory()){let c=await qn(i,e);r.push(...c)}else if(s.isFile()&&[".md",".txt"].includes((0,X.extname)(s.name))){let c=await(0,ee.stat)(i);r.push({path:i,relativePath:i.replace(e+"/",""),name:(0,X.basename)(s.name,(0,X.extname)(s.name)),size:c.size,created:c.birthtime?.getTime(),modified:c.mtime?.getTime()})}}}return r}async function rg(t,e){let r=e.startsWith("/")?e:(0,X.join)(t,e);return{content:[{type:"text",text:await(0,ee.readFile)(r,"utf-8")}]}}async function ng(t,{path:e,content:r,frontmatter:a}){let s=(0,X.join)(t,e);await(0,ee.mkdir)((0,X.dirname)(s),{recursive:!0});let i=r;return a&&(i=`---
${Object.entries(a).map(([u,f])=>`${u}: ${JSON.stringify(f)}`).join(`
`)}
---

${r}`),await(0,ee.writeFile)(s,i),{content:[{type:"text",text:`\u2705 Note created: ${e}`}]}}async function ag(t,{path:e,content:r,preserveFrontmatter:a}){let s=(0,X.join)(t,e);if(a){let c=(await(0,ee.readFile)(s,"utf-8")).match(/^---\n([\s\S]*?)\n---\n/);c&&(r=c[0]+r)}return await(0,ee.writeFile)(s,r),{content:[{type:"text",text:`\u2705 Note updated: ${e}`}]}}async function sg(t,e){let r=(0,X.join)(t,e),{unlink:a}=await import("fs/promises");return await a(r),{content:[{type:"text",text:`\u2705 Note deleted: ${e}`}]}}async function og(t,{query:e,searchIn:r="all",regex:a=!1}){let s=await qn(t),i=[],c=a?new RegExp(e,"gi"):e.toLowerCase();for(let u of s)try{let f=await(0,ee.readFile)(u.path,"utf-8"),d=!1,m="";if((r==="title"||r==="all")&&(a?c.test(u.name):u.name.toLowerCase().includes(e.toLowerCase()))&&(d=!0,m=`Title match: ${u.name}`),!d&&(r==="content"||r==="all")&&(a?c.test(f):f.toLowerCase().includes(e.toLowerCase()))){d=!0;let w=f.toLowerCase().indexOf(e.toLowerCase()),S=Math.max(0,w-50),R=Math.min(f.length,w+e.length+50);m=f.substring(S,R).replace(/\n/g," ")}d&&i.push({note:u.name,path:u.relativePath,context:m})}catch{}return{content:[{type:"text",text:`Found ${i.length} matches for "${e}":

${i.map(u=>`**${u.note}** (${u.path})
  ${u.context}`).join(`

`)}`}]}}async function ig(t,e){let r=(0,X.join)(t,e),i=((await(0,ee.readFile)(r,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(c=>c.slice(2,-2));return{content:[{type:"text",text:`Found ${i.length} wiki links in the note:
${i.map(c=>`- [[${c}]]`).join(`
`)}`}]}}async function cg(t,e){let r=await qn(t),a=[];for(let s of r)try{(await(0,ee.readFile)(s.path,"utf-8")).includes(`[[${e}]]`)&&a.push({note:s.name,path:s.relativePath})}catch{}return{content:[{type:"text",text:`Found ${a.length} backlinks to "${e}":
${a.map(s=>`- ${s.note} (${s.path})`).join(`
`)}`}]}}async function lg(t,e){let r=(0,X.join)(t,e),a=await(0,ee.readFile)(r,"utf-8"),s=a.match(/^---\n([\s\S]*?)\n---/),i={};if(s){let m=s[1].split(`
`);for(let w of m){let[S,...R]=w.split(":");S&&R.length&&(i[S.trim()]=R.join(":").trim())}}let c=await(0,ee.stat)(r),u=a.split(/\s+/).length,f=a.split(`
`).length;return{content:[{type:"text",text:JSON.stringify({frontmatter:i,stats:{wordCount:u,lineCount:f,size:c.size,created:c.birthtime,modified:c.mtime}},null,2)}]}}async function ug(t,{oldPath:e,newPath:r,updateLinks:a=!0}){let s=(0,X.join)(t,e),i=(0,X.join)(t,r);await(0,ee.mkdir)((0,X.dirname)(i),{recursive:!0});let{rename:c}=await import("fs/promises");if(await c(s,i),a){let u=(0,X.basename)(e,(0,X.extname)(e)),f=(0,X.basename)(r,(0,X.extname)(r)),d=await qn(t),m=0;for(let w of d)try{let S=await(0,ee.readFile)(w.path,"utf-8");if(S.includes(`[[${u}]]`)){let R=S.replace(new RegExp(`\\[\\[${u}\\]\\]`,"g"),`[[${f}]]`);await(0,ee.writeFile)(w.path,R),m++}}catch{}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}
${a?`Updated ${m} references`:""}`}]}}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}`}]}}var Me=require("fs/promises"),Cr=require("path");rs();var Oo=[{name:"get_workspace_info",description:"Get comprehensive information about the current workspace",inputSchema:{type:"object",properties:{}}},{name:"get_workspace_stats",description:"Get statistics about the workspace (note count, size, etc)",inputSchema:{type:"object",properties:{}}},{name:"list_folders",description:"List all folders in the workspace",inputSchema:{type:"object",properties:{maxDepth:{type:"number",description:"Maximum depth to traverse"}}}},{name:"get_workspace_settings",description:"Get workspace-specific settings",inputSchema:{type:"object",properties:{}}},{name:"search_workspace",description:"Global search across all workspace content",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},fileTypes:{type:"array",items:{type:"string"},description:"File types to search (md, txt, json, etc)"},limit:{type:"number",description:"Maximum results to return"}},required:["query"]}},{name:"get_recent_files",description:"Get recently modified files in the workspace",inputSchema:{type:"object",properties:{count:{type:"number",description:"Number of files to return"},fileTypes:{type:"array",items:{type:"string"},description:"Filter by file types"}}}}];async function fu(t,e,r,a){switch(t){case"get_workspace_info":return await dg(r,a);case"get_workspace_stats":return await pu(r);case"list_folders":return await fg(r,e.maxDepth||3);case"get_workspace_settings":return await pg(r);case"search_workspace":return await hg(r,e);case"get_recent_files":return await mg(r,e);default:throw new Error(`Unknown workspace tool: ${t}`)}}async function dg(t,e){if(e)try{let i=await Tt(`${e}/api/workspace`);if(i.ok){let c=await i.json();if(c.success&&c.data)return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${c.data.workspace}
\u{1F4DD} Name: ${c.data.name}
\u{1F4CA} Total Notes: ${c.data.total_notes}
${c.data.has_bases?"\u2705 Bases enabled":"\u274C Bases not configured"}
${c.data.has_canvas?"\u2705 Canvas enabled":"\u274C Canvas not configured"}
${c.data.has_tasks?"\u2705 Tasks enabled":"\u274C Tasks not configured"}`}]}}}catch{}let r=await pu(t),a=(0,Cr.join)(t,".lokus"),s=await gg(a);return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${t}
\u{1F4DD} Notes: ${r.noteCount}
\u{1F4C2} Folders: ${r.folderCount}
\u{1F4BE} Total Size: ${yg(r.totalSize)}
\u{1F527} Lokus Features: ${s?"Configured":"Not configured"}`}]}}async function pu(t){let e={noteCount:0,folderCount:0,totalSize:0,fileTypes:{}};async function r(a){let s=await(0,Me.readdir)(a,{withFileTypes:!0});for(let i of s){if(i.name.startsWith("."))continue;let c=(0,Cr.join)(a,i.name);if(i.isDirectory())e.folderCount++,await r(c);else if(i.isFile()){let u=await(0,Me.stat)(c);e.totalSize+=u.size;let f=i.name.split(".").pop();e.fileTypes[f]=(e.fileTypes[f]||0)+1,["md","txt"].includes(f)&&e.noteCount++}}}return await r(t),e}async function fg(t,e){let r=[];async function a(i,c=0,u=""){if(c>=e)return;let f=await(0,Me.readdir)(i,{withFileTypes:!0});for(let d of f)if(!d.name.startsWith(".")&&d.isDirectory()){let m=u?`${u}/${d.name}`:d.name;r.push({name:d.name,path:m,depth:c}),await a((0,Cr.join)(i,d.name),c+1,m)}}return await a(t),{content:[{type:"text",text:`**Workspace Folders:**

${r.sort((i,c)=>i.path.localeCompare(c.path)).map(i=>"  ".repeat(i.depth)+"\u{1F4C1} "+i.name).join(`
`)}`}]}}async function pg(t){let e=(0,Cr.join)(t,".lokus","settings.json");try{let r=await(0,Me.readFile)(e,"utf-8"),a=JSON.parse(r);return{content:[{type:"text",text:`**Workspace Settings:**

${JSON.stringify(a,null,2)}`}]}}catch{return{content:[{type:"text",text:"No workspace settings found. This workspace may not be configured for Lokus."}]}}}async function hg(t,{query:e,fileTypes:r=["md","txt"],limit:a=20}){let s=[];async function i(c){let u=await(0,Me.readdir)(c,{withFileTypes:!0});for(let f of u){if(f.name.startsWith("."))continue;let d=(0,Cr.join)(c,f.name);if(f.isDirectory())await i(d);else if(f.isFile()){let m=f.name.split(".").pop();if(r.includes(m))try{let w=await(0,Me.readFile)(d,"utf-8");if(w.toLowerCase().includes(e.toLowerCase())){let S=w.toLowerCase().indexOf(e.toLowerCase()),R=Math.max(0,S-50),x=Math.min(w.length,S+e.length+50),N=w.substring(R,x).replace(/\n/g," ");if(s.push({file:d.replace(t+"/",""),context:N}),s.length>=a)return}}catch{}}}}return await i(t),{content:[{type:"text",text:`Found ${s.length} matches for "${e}":

${s.map(c=>`**${c.file}**
  ...${c.context}...`).join(`

`)}`}]}}async function mg(t,{count:e=10,fileTypes:r=null}){let a=[];async function s(c){let u=await(0,Me.readdir)(c,{withFileTypes:!0});for(let f of u){if(f.name.startsWith("."))continue;let d=(0,Cr.join)(c,f.name);if(f.isDirectory())await s(d);else if(f.isFile()){let m=f.name.split(".").pop();if(!r||r.includes(m)){let w=await(0,Me.stat)(d);a.push({path:d.replace(t+"/",""),name:f.name,modified:w.mtime,size:w.size})}}}}return await s(t),a.sort((c,u)=>u.modified-c.modified),{content:[{type:"text",text:`**Recently Modified Files:**

${a.slice(0,e).map(c=>`- ${c.name} (${c.path})
  Modified: ${c.modified.toISOString()}`).join(`
`)}`}]}}async function gg(t){try{return await(0,Me.stat)(t),!0}catch{return!1}}function yg(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`}var se=require("fs/promises"),Je=require("path"),Do=[{name:"list_bases",description:"List all bases (databases) in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_base",description:"Get details of a specific base including schema and records",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}},{name:"create_base",description:"Create a new base with specified schema",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the new base"},schema:{type:"object",description:"Schema definition for the base",properties:{fields:{type:"array",description:"Field definitions"}}},description:{type:"string",description:"Description of the base"}},required:["name","schema"]}},{name:"add_base_record",description:"Add a new record to a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},record:{type:"object",description:"Record data"}},required:["baseName","record"]}},{name:"query_base",description:"Query records from a base with filters",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},filter:{type:"object",description:"Filter criteria"},sort:{type:"object",description:"Sort criteria"},limit:{type:"number",description:"Maximum records to return"}},required:["baseName"]}},{name:"update_base_record",description:"Update a record in a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to update"},updates:{type:"object",description:"Fields to update"}},required:["baseName","recordId","updates"]}},{name:"delete_base_record",description:"Delete a record from a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to delete"}},required:["baseName","recordId"]}},{name:"get_base_stats",description:"Get statistics about a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}}];async function hu(t,e,r,a){switch(t){case"list_bases":return await bg(r);case"get_base":return await wg(r,e.baseName);case"create_base":return await _g(r,e);case"add_base_record":return await kg(r,e);case"query_base":return await Sg(r,e);case"update_base_record":return await xg(r,e);case"delete_base_record":return await vg(r,e);case"get_base_stats":return await Tg(r,e.baseName);default:throw new Error(`Unknown bases tool: ${t}`)}}async function bg(t){let e=(0,Je.join)(t,".lokus","bases");try{let r=await(0,se.readdir)(e,{withFileTypes:!0}),a=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let i=s.name.replace(".json","");try{let c=await(0,se.readFile)((0,Je.join)(e,s.name),"utf-8"),u=JSON.parse(c);a.push({name:i,recordCount:u.records?u.records.length:0,fields:u.schema?.fields?.length||0,description:u.description})}catch{}}return{content:[{type:"text",text:`**Bases in Workspace:**

${a.length>0?a.map(s=>`\u{1F4CA} **${s.name}**
  - Records: ${s.recordCount}
  - Fields: ${s.fields}
  - ${s.description||"No description"}`).join(`

`):"No bases found in this workspace"}`}]}}catch{return{content:[{type:"text",text:"Bases feature not configured in this workspace"}]}}}async function wg(t,e){let r=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let a=await(0,se.readFile)(r,"utf-8"),s=JSON.parse(a);return{content:[{type:"text",text:`**Base: ${e}**

Description: ${s.description||"No description"}
Created: ${s.created||"Unknown"}
Modified: ${s.modified||"Unknown"}

**Schema:**
${s.schema?.fields?.map(i=>`- ${i.name} (${i.type})`).join(`
`)||"No schema defined"}

**Records (${s.records?.length||0}):**
${s.records?.slice(0,5).map(i=>JSON.stringify(i)).join(`
`)||"No records"}
${s.records?.length>5?`
... and ${s.records.length-5} more records`:""}`}]}}catch{return{content:[{type:"text",text:`Base "${e}" not found`}]}}}async function _g(t,{name:e,schema:r,description:a}){let s=(0,Je.join)(t,".lokus","bases"),i=(0,Je.join)(s,`${e}.json`);await(0,se.mkdir)(s,{recursive:!0});let c={name:e,description:a,schema:r,records:[],created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,se.writeFile)(i,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Base "${e}" created successfully with ${r.fields?.length||0} fields`}]}}async function kg(t,{baseName:e,record:r}){let a=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let s=await(0,se.readFile)(a,"utf-8"),i=JSON.parse(s);return r.id||(r.id=Date.now().toString(36)+Math.random().toString(36).substr(2)),r.created=new Date().toISOString(),r.modified=new Date().toISOString(),i.records=i.records||[],i.records.push(r),i.modified=new Date().toISOString(),await(0,se.writeFile)(a,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Record added to base "${e}" with ID: ${r.id}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to add record: ${s.message}`}]}}}async function Sg(t,{baseName:e,filter:r={},sort:a=null,limit:s=100}){let i=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let c=await(0,se.readFile)(i,"utf-8"),f=JSON.parse(c).records||[];if(Object.keys(r).length>0&&(f=f.filter(d=>{for(let[m,w]of Object.entries(r))if(d[m]!==w)return!1;return!0})),a){let d=Object.keys(a)[0],m=a[d];f.sort((w,S)=>m==="asc"?w[d]>S[d]?1:-1:w[d]<S[d]?1:-1)}return f=f.slice(0,s),{content:[{type:"text",text:`**Query Results (${f.length} records):**

${f.map(d=>JSON.stringify(d,null,2)).join(`
---
`)}`}]}}catch(c){return{content:[{type:"text",text:`\u274C Query failed: ${c.message}`}]}}}async function xg(t,{baseName:e,recordId:r,updates:a}){let s=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let i=await(0,se.readFile)(s,"utf-8"),c=JSON.parse(i),u=c.records?.findIndex(f=>f.id===r);if(u===-1)throw new Error(`Record with ID ${r} not found`);return c.records[u]={...c.records[u],...a,id:r,modified:new Date().toISOString()},c.modified=new Date().toISOString(),await(0,se.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} updated in base "${e}"`}]}}catch(i){return{content:[{type:"text",text:`\u274C Update failed: ${i.message}`}]}}}async function vg(t,{baseName:e,recordId:r}){let a=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let s=await(0,se.readFile)(a,"utf-8"),i=JSON.parse(s),c=i.records?.length||0;if(i.records=i.records?.filter(u=>u.id!==r)||[],i.records.length===c)throw new Error(`Record with ID ${r} not found`);return i.modified=new Date().toISOString(),await(0,se.writeFile)(a,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} deleted from base "${e}"`}]}}catch(s){return{content:[{type:"text",text:`\u274C Delete failed: ${s.message}`}]}}}async function Tg(t,e){let r=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let a=await(0,se.readFile)(r,"utf-8"),s=JSON.parse(a),i={recordCount:s.records?.length||0,fieldCount:s.schema?.fields?.length||0,created:s.created,modified:s.modified,sizeBytes:Buffer.byteLength(a,"utf8"),fieldTypes:{}};if(s.schema?.fields)for(let c of s.schema.fields)i.fieldTypes[c.type]=(i.fieldTypes[c.type]||0)+1;if(s.records?.length>0){i.fillRates={};for(let c of s.schema?.fields||[]){let u=s.records.filter(f=>f[c.name]!=null).length;i.fillRates[c.name]=`${(u/s.records.length*100).toFixed(1)}%`}}return{content:[{type:"text",text:`**Base Statistics: ${e}**

\u{1F4CA} Records: ${i.recordCount}
\u{1F4CB} Fields: ${i.fieldCount}
\u{1F4C5} Created: ${i.created}
\u{1F504} Modified: ${i.modified}
\u{1F4BE} Size: ${(i.sizeBytes/1024).toFixed(2)} KB

**Field Types:**
${Object.entries(i.fieldTypes).map(([c,u])=>`- ${c}: ${u}`).join(`
`)}

${i.fillRates?`**Field Fill Rates:**
${Object.entries(i.fillRates).map(([c,u])=>`- ${c}: ${u}`).join(`
`)}`:""}`}]}}catch(a){return{content:[{type:"text",text:`\u274C Failed to get stats: ${a.message}`}]}}}var Ce=require("fs/promises"),Ct=require("path"),Lo=[{name:"list_canvases",description:"List all canvases in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_canvas",description:"Get canvas data including shapes and connections",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID or name"}},required:["canvasId"]}},{name:"create_canvas",description:"Create a new canvas",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the canvas"},description:{type:"string",description:"Canvas description"}},required:["name"]}},{name:"add_canvas_shape",description:"Add a shape to canvas (text, rectangle, arrow, etc)",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},shape:{type:"object",description:"Shape data (type, position, content, style)"}},required:["canvasId","shape"]}},{name:"get_canvas_connections",description:"Get all connections/arrows between shapes",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"}},required:["canvasId"]}},{name:"export_canvas",description:"Export canvas as JSON or markdown",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},format:{type:"string",enum:["json","markdown","mermaid"],description:"Export format"}},required:["canvasId"]}}];async function mu(t,e,r,a){switch(t){case"list_canvases":return await Cg(r);case"get_canvas":return await Rg(r,e.canvasId);case"create_canvas":return await Eg(r,e);case"add_canvas_shape":return await Ag(r,e);case"get_canvas_connections":return await $g(r,e.canvasId);case"export_canvas":return await Pg(r,e);default:throw new Error(`Unknown canvas tool: ${t}`)}}async function Cg(t){let e=(0,Ct.join)(t,".lokus","canvas");try{let r=await(0,Ce.readdir)(e,{withFileTypes:!0}),a=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let i=s.name.replace(".json","");try{let c=await(0,Ce.readFile)((0,Ct.join)(e,s.name),"utf-8"),u=JSON.parse(c);a.push({id:i,name:u.name||i,shapeCount:u.shapes?.length||0,created:u.created,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Canvases in Workspace:**

${a.length>0?a.map(s=>`\u{1F3A8} **${s.name}**
  - ID: ${s.id}
  - Shapes: ${s.shapeCount}
  - Modified: ${s.modified||"Unknown"}`).join(`

`):"No canvases found"}`}]}}catch{return{content:[{type:"text",text:"Canvas feature not configured in this workspace"}]}}}async function Rg(t,e){let r=(0,Ct.join)(t,".lokus","canvas",`${e}.json`);try{let a=await(0,Ce.readFile)(r,"utf-8"),s=JSON.parse(a),i=s.shapes||[],c=i.filter(f=>f.type==="arrow"||f.type==="line"),u=i.filter(f=>f.type!=="arrow"&&f.type!=="line");return{content:[{type:"text",text:`**Canvas: ${s.name||e}**

\u{1F4CA} Nodes: ${u.length}
\u{1F517} Connections: ${c.length}
\u{1F4C5} Modified: ${s.modified||"Unknown"}

**Shapes:**
${u.slice(0,10).map(f=>`- ${f.type}: ${f.text||f.label||"No text"}`).join(`
`)}
${u.length>10?`... and ${u.length-10} more shapes`:""}

**Connections:**
${c.slice(0,5).map(f=>`- ${f.from||"unknown"} \u2192 ${f.to||"unknown"}`).join(`
`)}
${c.length>5?`... and ${c.length-5} more connections`:""}`}]}}catch{return{content:[{type:"text",text:`Canvas "${e}" not found`}]}}}async function Eg(t,{name:e,description:r}){let a=(0,Ct.join)(t,".lokus","canvas");await(0,Ce.mkdir)(a,{recursive:!0});let s=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),i=(0,Ct.join)(a,`${s}.json`),c={id:s,name:e,description:r,shapes:[],viewport:{x:0,y:0,zoom:1},created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,Ce.writeFile)(i,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Canvas "${e}" created with ID: ${s}`}]}}async function Ag(t,{canvasId:e,shape:r}){let a=(0,Ct.join)(t,".lokus","canvas",`${e}.json`);try{let s=await(0,Ce.readFile)(a,"utf-8"),i=JSON.parse(s),c={id:r.id||Date.now().toString(36)+Math.random().toString(36).substr(2),type:r.type||"rectangle",x:r.x||100,y:r.y||100,width:r.width||200,height:r.height||100,text:r.text||"",style:r.style||{},...r};return i.shapes=i.shapes||[],i.shapes.push(c),i.modified=new Date().toISOString(),await(0,Ce.writeFile)(a,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Shape added to canvas "${e}" with ID: ${c.id}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to add shape: ${s.message}`}]}}}async function $g(t,e){let r=(0,Ct.join)(t,".lokus","canvas",`${e}.json`);try{let a=await(0,Ce.readFile)(r,"utf-8"),i=(JSON.parse(a).shapes||[]).filter(u=>u.type==="arrow"||u.type==="line"||u.type==="connection"),c={};return i.forEach(u=>{let f=u.from||u.startId||"unknown",d=u.to||u.endId||"unknown";c[f]||(c[f]=[]),c[f].push(d)}),{content:[{type:"text",text:`**Canvas Connections:**

${Object.entries(c).map(([u,f])=>`\u{1F4CD} ${u}
${f.map(d=>`  \u2192 ${d}`).join(`
`)}`).join(`

`)}

Total connections: ${i.length}`}]}}catch(a){return{content:[{type:"text",text:`\u274C Failed to get connections: ${a.message}`}]}}}async function Pg(t,{canvasId:e,format:r="markdown"}){let a=(0,Ct.join)(t,".lokus","canvas",`${e}.json`);try{let s=await(0,Ce.readFile)(a,"utf-8"),i=JSON.parse(s),c="";switch(r){case"markdown":c=`# ${i.name||e}

`,c+=i.description?`${i.description}

`:"",(i.shapes||[]).filter(d=>d.type!=="arrow"&&d.type!=="line").forEach(d=>{c+=`## ${d.text||d.label||"Node"}

`,d.description&&(c+=`${d.description}

`)});break;case"mermaid":c=`graph TD
`,(i.shapes||[]).forEach(d=>{d.type==="arrow"||d.type==="connection"?c+=`  ${d.from||d.startId} --> ${d.to||d.endId}
`:d.text&&(c+=`  ${d.id}["${d.text}"]
`)});break;case"json":default:c=JSON.stringify(i,null,2);break}return{content:[{type:"text",text:c}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to export canvas: ${s.message}`}]}}}var ce=require("fs/promises"),it=require("path"),No=[{name:"list_boards",description:"List all kanban boards in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_board",description:"Get kanban board with columns and cards",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID or name"}},required:["boardId"]}},{name:"create_board",description:"Create a new kanban board. Supports automatic date-based column creation.",inputSchema:{type:"object",properties:{name:{type:"string",description:"Board name"},columns:{type:"array",items:{type:"string"},description:"Column names (e.g., ['To Do', 'In Progress', 'Done'])"},dateType:{type:"string",enum:["monthly","quarterly","yearly","custom"],description:"Type of date-based columns to create (optional)"},startDate:{type:"string",description:"Start date for date-based columns (YYYY-MM-DD format, optional)"},endDate:{type:"string",description:"End date for date-based columns (YYYY-MM-DD format, optional)"},additionalColumns:{type:"array",items:{type:"string"},description:"Additional status columns (e.g., ['Applied', 'Accepted', 'Rejected'])"}},required:["name"]}},{name:"add_card",description:"Add a card to a kanban column",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},column:{type:"string",description:"Column name"},card:{type:"object",description:"Card data (title, description, tags, etc)"}},required:["boardId","column","card"]}},{name:"move_card",description:"Move a card between columns",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},fromColumn:{type:"string",description:"Source column"},toColumn:{type:"string",description:"Target column"}},required:["boardId","cardId","fromColumn","toColumn"]}},{name:"update_card",description:"Update card properties",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},updates:{type:"object",description:"Fields to update"}},required:["boardId","cardId","updates"]}},{name:"get_board_stats",description:"Get statistics for a kanban board",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"}},required:["boardId"]}}];async function gu(t,e,r,a){switch(t){case"list_boards":return await Ig(r);case"get_board":return await Og(r,e.boardId);case"create_board":return await Dg(r,e);case"add_card":return await Ng(r,e);case"move_card":return await Mg(r,e);case"update_card":return await jg(r,e);case"get_board_stats":return await Fg(r,e.boardId);default:throw new Error(`Unknown kanban tool: ${t}`)}}async function Ig(t){let e=(0,it.join)(t,".lokus","kanban");try{let r=await(0,ce.readdir)(e,{withFileTypes:!0}),a=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let i=s.name.replace(".json","");try{let c=await(0,ce.readFile)((0,it.join)(e,s.name),"utf-8"),u=JSON.parse(c),f=Object.values(u.columns||{}).reduce((d,m)=>d+(m.cards?.length||0),0);a.push({id:i,name:u.name||i,columns:Object.keys(u.columns||{}).length,cards:f,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Kanban Boards:**

${a.length>0?a.map(s=>`\u{1F4CB} **${s.name}**
  - ID: ${s.id}
  - Columns: ${s.columns}
  - Cards: ${s.cards}
  - Modified: ${s.modified||"Unknown"}`).join(`

`):"No kanban boards found"}`}]}}catch{return{content:[{type:"text",text:"Kanban feature not configured in this workspace"}]}}}async function Og(t,e){let r=(0,it.join)(t,".lokus","kanban",`${e}.json`);try{let a=await(0,ce.readFile)(r,"utf-8"),s=JSON.parse(a),i=`**Kanban Board: ${s.name||e}**

`;for(let[c,u]of Object.entries(s.columns||{})){let f=u.cards||[];i+=`**${c}** (${f.length} cards)
`,f.slice(0,5).forEach(d=>{i+=`  \u2022 ${d.title}`,d.tags?.length&&(i+=` [${d.tags.join(", ")}]`),d.assignee&&(i+=` @${d.assignee}`),i+=`
`}),f.length>5&&(i+=`  ... and ${f.length-5} more cards
`),i+=`
`}return{content:[{type:"text",text:i}]}}catch{return{content:[{type:"text",text:`Board "${e}" not found`}]}}}async function Dg(t,{name:e,columns:r,dateType:a,startDate:s,endDate:i,additionalColumns:c=[]}){let u=(0,it.join)(t,".lokus","kanban");await(0,ce.mkdir)(u,{recursive:!0});let f=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),d=(0,it.join)(u,`${f}.json`),m=new Date().toISOString(),w={version:"1.0.0",name:e,columns:{},settings:{card_template:{},automations:[],custom_fields:[]},metadata:{created:m,modified:m,created_with:"Lokus MCP"}},S=r||["To Do","In Progress","Done"];a&&s&&(S=Lg(a,s,i),c.length>0&&(S=[...S,...c]));for(let R=0;R<S.length;R++){let x=S[R],N=x.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");w.columns[N]={name:x,order:R,cards:[]}}return await(0,ce.writeFile)(d,JSON.stringify(w,null,2)),{content:[{type:"text",text:`\u2705 Kanban board "${e}" created with ${Object.keys(w.columns).length} columns:
${S.map(R=>`  - ${R}`).join(`
`)}`}]}}function Lg(t,e,r){let a=[],s=new Date(e),i=r?new Date(r):new Date(s.getFullYear()+1,s.getMonth(),1);if(t==="monthly"){let c=new Date(s);for(;c<=i;){let u=c.toLocaleDateString("en-US",{month:"long",year:"numeric"});a.push(`\u{1F4C5} ${u}`),c.setMonth(c.getMonth()+1)}}else if(t==="quarterly"){let c=new Date(s),u=Math.floor(c.getMonth()/3)+1;for(;c<=i;)a.push(`\u{1F4C5} Q${u} ${c.getFullYear()}`),c.setMonth(c.getMonth()+3),u=Math.floor(c.getMonth()/3)+1}else if(t==="yearly"){let c=s.getFullYear(),u=i.getFullYear();for(;c<=u;)a.push(`\u{1F4C5} ${c}`),c++}return a}async function Ng(t,{boardId:e,column:r,card:a}){let s=(0,it.join)(t,".lokus","kanban",`${e}.json`);try{let i=await(0,ce.readFile)(s,"utf-8"),c=JSON.parse(i);if(!c.columns[r])throw new Error(`Column "${r}" not found`);let u=new Date().toISOString(),f={id:a.id||Date.now().toString(36)+Math.random().toString(36).substr(2),title:a.title||"Untitled",description:a.description||"",tags:a.tags||[],assignee:a.assignee||null,priority:a.priority||"normal",due_date:a.due_date||a.dueDate||null,linked_notes:a.linked_notes||[],checklist:a.checklist||[],created:u,modified:u};return c.columns[r].cards=c.columns[r].cards||[],c.columns[r].cards.push(f),c.metadata.modified=u,await(0,ce.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Card "${f.title}" added to column "${r}" with ID: ${f.id}`}]}}catch(i){return{content:[{type:"text",text:`\u274C Failed to add card: ${i.message}`}]}}}async function Mg(t,{boardId:e,cardId:r,fromColumn:a,toColumn:s}){let i=(0,it.join)(t,".lokus","kanban",`${e}.json`);try{let c=await(0,ce.readFile)(i,"utf-8"),u=JSON.parse(c);if(!u.columns[a]||!u.columns[s])throw new Error("Column not found");let f=u.columns[a].cards?.findIndex(m=>m.id===r);if(f===-1)throw new Error(`Card ${r} not found in column ${a}`);let[d]=u.columns[a].cards.splice(f,1);return d.modified=new Date().toISOString(),u.columns[s].cards=u.columns[s].cards||[],u.columns[s].cards.push(d),u.metadata.modified=new Date().toISOString(),await(0,ce.writeFile)(i,JSON.stringify(u,null,2)),{content:[{type:"text",text:`\u2705 Card "${d.title}" moved from "${a}" to "${s}"`}]}}catch(c){return{content:[{type:"text",text:`\u274C Failed to move card: ${c.message}`}]}}}async function jg(t,{boardId:e,cardId:r,updates:a}){let s=(0,it.join)(t,".lokus","kanban",`${e}.json`);try{let i=await(0,ce.readFile)(s,"utf-8"),c=JSON.parse(i),u=!1;for(let f of Object.values(c.columns||{})){let d=f.cards?.findIndex(m=>m.id===r);if(d!==-1){f.cards[d]={...f.cards[d],...a,id:r,modified:new Date().toISOString()},u=!0;break}}if(!u)throw new Error(`Card ${r} not found`);return c.metadata.modified=new Date().toISOString(),await(0,ce.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Card ${r} updated successfully`}]}}catch(i){return{content:[{type:"text",text:`\u274C Failed to update card: ${i.message}`}]}}}async function Fg(t,e){let r=(0,it.join)(t,".lokus","kanban",`${e}.json`);try{let a=await(0,ce.readFile)(r,"utf-8"),s=JSON.parse(a),i={columnCount:Object.keys(s.columns||{}).length,totalCards:0,cardsByColumn:{},cardsByPriority:{high:0,normal:0,low:0},cardsByAssignee:{},overdueTasks:0},c=new Date;for(let[u,f]of Object.entries(s.columns||{})){let d=f.cards||[];i.totalCards+=d.length,i.cardsByColumn[u]=d.length;for(let m of d)i.cardsByPriority[m.priority||"normal"]++,m.assignee&&(i.cardsByAssignee[m.assignee]=(i.cardsByAssignee[m.assignee]||0)+1),m.dueDate&&new Date(m.dueDate)<c&&i.overdueTasks++}return{content:[{type:"text",text:`**Board Statistics: ${s.name||e}**

\u{1F4CA} Total Cards: ${i.totalCards}
\u{1F4CB} Columns: ${i.columnCount}
\u26A0\uFE0F Overdue Tasks: ${i.overdueTasks}

**Cards by Column:**
${Object.entries(i.cardsByColumn).map(([u,f])=>`  - ${u}: ${f}`).join(`
`)}

**Cards by Priority:**
  - High: ${i.cardsByPriority.high}
  - Normal: ${i.cardsByPriority.normal}
  - Low: ${i.cardsByPriority.low}

**Cards by Assignee:**
${Object.entries(i.cardsByAssignee).map(([u,f])=>`  - @${u}: ${f}`).join(`
`)||"  No assignments"}`}]}}catch(a){return{content:[{type:"text",text:`\u274C Failed to get stats: ${a.message}`}]}}}var ns=require("fs/promises"),Rr=require("path"),Mo=[{name:"get_graph_overview",description:"Get overview of the knowledge graph",inputSchema:{type:"object",properties:{}}},{name:"get_node_connections",description:"Get all connections for a specific node (note)",inputSchema:{type:"object",properties:{nodeName:{type:"string",description:"Name of the node/note"}},required:["nodeName"]}},{name:"find_path",description:"Find path between two nodes in the graph",inputSchema:{type:"object",properties:{from:{type:"string",description:"Starting node"},to:{type:"string",description:"Target node"}},required:["from","to"]}},{name:"get_orphan_notes",description:"Find notes with no connections (orphans)",inputSchema:{type:"object",properties:{}}},{name:"get_hub_notes",description:"Find most connected notes (hubs)",inputSchema:{type:"object",properties:{limit:{type:"number",description:"Number of top hubs to return"}}}},{name:"get_clusters",description:"Identify clusters of related notes",inputSchema:{type:"object",properties:{}}}];async function yu(t,e,r,a){switch(t){case"get_graph_overview":return await Wg(r);case"get_node_connections":return await qg(r,e.nodeName);case"find_path":return await Bg(r,e.from,e.to);case"get_orphan_notes":return await Ug(r);case"get_hub_notes":return await zg(r,e.limit||10);case"get_clusters":return await Hg(r);default:throw new Error(`Unknown graph tool: ${t}`)}}async function dn(t){let e={nodes:new Set,edges:[],adjacencyList:{}};async function r(a){let s=await(0,ns.readdir)(a,{withFileTypes:!0});for(let i of s){if(i.name.startsWith("."))continue;let c=(0,Rr.join)(a,i.name);if(i.isDirectory())await r(c);else if(i.isFile()&&[".md",".txt"].includes((0,Rr.extname)(i.name))){let u=(0,Rr.basename)(i.name,(0,Rr.extname)(i.name));e.nodes.add(u);try{let m=((await(0,ns.readFile)(c,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(w=>w.slice(2,-2));e.adjacencyList[u]=m;for(let w of m)e.edges.push({from:u,to:w})}catch{}}}}return await r(t),e}async function Wg(t){let e=await dn(t),r={totalNodes:e.nodes.size,totalEdges:e.edges.length,avgConnections:e.edges.length/Math.max(e.nodes.size,1),orphanCount:0,hubCount:0};for(let a of e.nodes){let s=(e.adjacencyList[a]||[]).length,i=e.edges.filter(u=>u.to===a).length,c=s+i;c===0&&r.orphanCount++,c>5&&r.hubCount++}return{content:[{type:"text",text:`**Knowledge Graph Overview**

\u{1F535} Total Notes: ${r.totalNodes}
\u{1F517} Total Connections: ${r.totalEdges}
\u{1F4CA} Avg Connections: ${r.avgConnections.toFixed(2)}
\u{1F3DD}\uFE0F Orphan Notes: ${r.orphanCount}
\u{1F31F} Hub Notes (>5 connections): ${r.hubCount}

The knowledge graph shows how your notes are interconnected through wiki links.`}]}}async function qg(t,e){let r=await dn(t),a=r.adjacencyList[e]||[],s=r.edges.filter(c=>c.to===e).map(c=>c.from),i=new Set([...a,...s]);return{content:[{type:"text",text:`**Connections for "${e}"**

**Outgoing Links (${a.length}):**
${a.map(c=>`  \u2192 ${c}`).join(`
`)||"  None"}

**Incoming Links (${s.length}):**
${s.map(c=>`  \u2190 ${c}`).join(`
`)||"  None"}

**All Related Notes (${i.size}):**
${Array.from(i).map(c=>`  \u2022 ${c}`).join(`
`)||"  None"}`}]}}async function Bg(t,e,r){let a=await dn(t),s=[[e]],i=new Set([e]);for(;s.length>0;){let c=s.shift(),u=c[c.length-1];if(u===r)return{content:[{type:"text",text:`**Path from "${e}" to "${r}":**

${c.map((d,m)=>m===0?`\u{1F7E2} ${d}`:m===c.length-1?`\u{1F534} ${d}`:`\u26AA ${d}`).join(" \u2192 ")}

Path length: ${c.length-1} steps`}]};let f=a.adjacencyList[u]||[];for(let d of f)i.has(d)||(i.add(d),s.push([...c,d]))}return{content:[{type:"text",text:`No path found from "${e}" to "${r}". These notes are not connected in the knowledge graph.`}]}}async function Ug(t){let e=await dn(t),r=[];for(let a of e.nodes){let s=(e.adjacencyList[a]||[]).length,i=e.edges.filter(c=>c.to===a).length;s===0&&i===0&&r.push(a)}return{content:[{type:"text",text:`**Orphan Notes (${r.length}):**

These notes have no connections to other notes:

${r.map(a=>`  \u2022 ${a}`).join(`
`)||"No orphan notes found!"}

Consider linking these notes to integrate them into your knowledge graph.`}]}}async function zg(t,e){let r=await dn(t),a={};for(let i of r.nodes){let c=(r.adjacencyList[i]||[]).length,u=r.edges.filter(f=>f.to===i).length;a[i]=c+u}let s=Object.entries(a).sort((i,c)=>c[1]-i[1]).slice(0,e);return{content:[{type:"text",text:`**Top ${e} Hub Notes:**

These notes are most connected in your knowledge graph:

${s.map(([i,c],u)=>`${u+1}. **${i}** - ${c} connections`).join(`
`)}

Hub notes are central to your knowledge structure and often represent key concepts.`}]}}async function Hg(t){let e=await dn(t),r=new Set,a=[];function s(i,c){if(r.has(i))return;r.add(i),c.add(i);let u=e.adjacencyList[i]||[];for(let d of u)s(d,c);let f=e.edges.filter(d=>d.to===i).map(d=>d.from);for(let d of f)s(d,c)}for(let i of e.nodes)if(!r.has(i)){let c=new Set;s(i,c),c.size>1&&a.push(Array.from(c))}return a.sort((i,c)=>c.length-i.length),{content:[{type:"text",text:`**Knowledge Clusters (${a.length}):**

${a.slice(0,5).map((i,c)=>`**Cluster ${c+1}** (${i.length} notes):
${i.slice(0,10).map(u=>`  \u2022 ${u}`).join(`
`)}${i.length>10?`
  ... and ${i.length-10} more`:""}`).join(`

`)}${a.length>5?`

... and ${a.length-5} more clusters`:""}

Clusters represent groups of related notes that are interconnected.`}]}}var Re=require("fs/promises"),Er=require("path"),jo=[{name:"list_templates",description:"List all templates in the workspace",inputSchema:{type:"object",properties:{category:{type:"string",description:"Filter by category (optional)"}}}},{name:"create_template",description:"Create a new template with proper frontmatter. Templates support variables like {{date}}, {{time}}, {{cursor}}, {{title}}, and custom variables.",inputSchema:{type:"object",properties:{id:{type:"string",description:"Unique template ID (lowercase, hyphenated)"},name:{type:"string",description:"Display name for the template"},content:{type:"string",description:"Template content with variables (e.g., {{date}}, {{time}}, {{cursor}})"},category:{type:"string",description:"Category for organization (Personal, Work, Documentation, etc.)",default:"Personal"},tags:{type:"array",items:{type:"string"},description:"Tags for categorization"}},required:["id","name","content"]}},{name:"read_template",description:"Read a template's content and metadata",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID"}},required:["id"]}},{name:"update_template",description:"Update an existing template",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID"},name:{type:"string",description:"New name (optional)"},content:{type:"string",description:"New content (optional)"},category:{type:"string",description:"New category (optional)"},tags:{type:"array",items:{type:"string"},description:"New tags (optional)"}},required:["id"]}},{name:"delete_template",description:"Delete a template",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID to delete"}},required:["id"]}}];async function bu(t,e,r,a){let s=(0,Er.join)(r,"templates");try{await(0,Re.mkdir)(s,{recursive:!0})}catch{}switch(t){case"list_templates":return await Vg(s,e);case"create_template":return await Gg(s,e);case"read_template":return await Jg(s,e);case"update_template":return await Zg(s,e);case"delete_template":return await Yg(s,e);default:throw new Error(`Unknown template tool: ${t}`)}}async function Vg(t,e){try{let r=await(0,Re.readdir)(t),a=[];for(let s of r)if(s.endsWith(".md"))try{let i=(0,Er.join)(t,s),c=await(0,Re.readFile)(i,"utf-8"),u=Fo(c,s);(!e.category||u.category===e.category)&&a.push({id:u.id,name:u.name,category:u.category,tags:u.tags,createdAt:u.createdAt,updatedAt:u.updatedAt})}catch{}return{content:[{type:"text",text:JSON.stringify({templates:a,total:a.length},null,2)}]}}catch(r){return{content:[{type:"text",text:`Error listing templates: ${r.message}`}],isError:!0}}}async function Gg(t,e){try{let{id:r,name:a,content:s,category:i="Personal",tags:c=[]}=e;if(!/^[a-z0-9-_]+$/.test(r))throw new Error("Template ID must be lowercase alphanumeric with hyphens/underscores");let u=`${r}.md`,f=(0,Er.join)(t,u),d=new Date().toISOString(),w=`---
${wu({id:r,name:a,category:i,tags:c,createdAt:d,updatedAt:d})}---

${s}`;return await(0,Re.writeFile)(f,w,"utf-8"),{content:[{type:"text",text:`Template "${a}" created successfully!

ID: ${r}
File: ${f}

**Important**: The template has been created as a file, but to see it in the UI:
1. Open Template Manager in Lokus
2. Click the "Refresh" button
3. The template will now appear in the list

Alternatively, restart the Lokus app to load the new template.`}]}}catch(r){return{content:[{type:"text",text:`Error creating template: ${r.message}`}],isError:!0}}}async function Jg(t,e){try{let{id:r}=e,a=(0,Er.join)(t,`${r}.md`),s=await(0,Re.readFile)(a,"utf-8"),i=Fo(s,`${r}.md`);return{content:[{type:"text",text:JSON.stringify(i,null,2)}]}}catch(r){return{content:[{type:"text",text:`Error reading template: ${r.message}`}],isError:!0}}}async function Zg(t,e){try{let{id:r,name:a,content:s,category:i,tags:c}=e,u=(0,Er.join)(t,`${r}.md`),f=await(0,Re.readFile)(u,"utf-8"),d=Fo(f,`${r}.md`),m={id:d.id,name:a||d.name,content:s||d.content,category:i||d.category,tags:c||d.tags,createdAt:d.createdAt,updatedAt:new Date().toISOString()},S=`---
${wu(m)}---

${m.content}`;return await(0,Re.writeFile)(u,S,"utf-8"),{content:[{type:"text",text:`Template "${m.name}" updated successfully!

**Remember to refresh the Template Manager** to see the changes.`}]}}catch(r){return{content:[{type:"text",text:`Error updating template: ${r.message}`}],isError:!0}}}async function Yg(t,e){try{let{id:r}=e,a=(0,Er.join)(t,`${r}.md`);return await(0,Re.unlink)(a),{content:[{type:"text",text:`Template "${r}" deleted successfully!

**Remember to refresh the Template Manager** to see the changes.`}]}}catch(r){return{content:[{type:"text",text:`Error deleting template: ${r.message}`}],isError:!0}}}function wu(t){let e="";return e+=`id: ${t.id}
`,e+=`name: "${t.name}"
`,e+=`category: ${t.category}
`,t.tags&&t.tags.length>0?(e+=`tags:
`,t.tags.forEach(r=>{e+=`  - ${r}
`})):e+=`tags: []
`,e+=`createdAt: ${t.createdAt}
`,e+=`updatedAt: ${t.updatedAt}
`,e}function Fo(t,e){let r=/^---\n([\s\S]*?)\n---\n([\s\S]*)$/,a=t.match(r);if(!a){let u=e.replace(".md","");return{id:u,name:u,content:t.trim(),category:"Personal",tags:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}let s=a[1],i=a[2].trim(),c=Qg(s);return{id:c.id||e.replace(".md",""),name:c.name||c.id||e.replace(".md",""),content:i,category:c.category||"Personal",tags:c.tags||[],createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}}function Qg(t){let e=t.split(`
`),r={},a=null,s=[];for(let i of e){let c=i.trim();if(!c)continue;if(c.startsWith("- ")){a&&s.push(c.substring(2).trim());continue}a&&s.length>0&&(r[a]=s,s=[],a=null);let u=c.indexOf(":");if(u>-1){let f=c.substring(0,u).trim(),d=c.substring(u+1).trim();d.startsWith('"')&&d.endsWith('"')&&(d=d.substring(1,d.length-1)),d==="[]"?r[f]=[]:d?r[f]=d:(a=f,s=[])}}return a&&s.length>0&&(r[a]=s),r}cs();var lt=!1;try{let t=typeof window<"u"?window:void 0;lt=!!(t&&(t.__TAURI_INTERNALS__&&typeof t.__TAURI_INTERNALS__.invoke=="function"||t.__TAURI_METADATA__||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.includes("Tauri")))}catch{}var Jo,Zo,Ru,Eu,Au,$u;async function Vn(){if(lt&&!Jo)try{({appDataDir:Jo,join:Zo}=await Promise.resolve().then(()=>(zn(),ls))),{readTextFile:Ru,writeTextFile:Eu,mkdir:Au,exists:$u}=await Promise.resolve().then(()=>(Go(),Vo))}catch{lt=!1}}var Tu="Lokus",Cu="config.json",Pu="lokus:config";async function Yo(t){await Vn(),lt&&(await $u(t)||await Au(t,{recursive:!0}))}async function tb(t){if(await Vn(),!lt)try{return JSON.parse(localStorage.getItem(Pu)||"null")}catch{return null}try{let e=await Ru(t);return JSON.parse(e)}catch{return null}}async function rb(t,e){if(await Vn(),!lt){localStorage.setItem(Pu,JSON.stringify(e??{}));return}await Eu(t,JSON.stringify(e,null,2))}async function Qo(){if(await Vn(),!lt)return Tu;let t=await Zo(await Jo(),Tu);return await Yo(t),t}async function Iu(){return await Vn(),lt?await Zo(await Qo(),Cu):Cu}async function Ko(){let t=await Iu();if(lt){let r=await Qo();await Yo(r)}let e=await tb(t);return e===null&&(e={}),e}async function nb(t){let e=await Iu();if(lt){let a=await Qo();await Yo(a)}return await rb(e,t)}async function Ou(t){let r={...await Ko(),...t};return await nb(r),r}Zn();var Ir=()=>{if(typeof window>"u")return"unknown";let t=window.navigator.platform?.toLowerCase()||"",e=window.navigator.userAgent?.toLowerCase()||"";return/iphone|ipad|ipod/.test(e)||t==="macintel"&&navigator.maxTouchPoints>1?"ios":e.includes("android")?"android":t.includes("win")||e.includes("windows")?"windows":t.includes("mac")||e.includes("mac")?"macos":t.includes("linux")||e.includes("linux")?"linux":"unknown"},Ze=()=>Ir()==="windows",Ee=()=>Ir()==="macos",Vu=()=>Ir()==="linux";var Gu=()=>Ee()?"Cmd":"Ctrl";var Ju=()=>Ze()?"\\":"/";var bb={windows:{shellIntegration:!0,jumpList:!0,snapLayouts:!0,contextMenus:!0,registryAccess:!0,windowsNotifications:!0,darkModeSync:!0,fileDialog:!0,multiWindow:!0},macos:{quickLook:!0,touchBar:!0,continuity:!0,spotlight:!0,finderIntegration:!0,darkModeSync:!0,fileDialog:!0,multiWindow:!0},linux:{desktopIntegration:!0,contextMenus:!0,darkModeSync:!1,fileDialog:!0,multiWindow:!0},ios:{touchSupport:!0,darkModeSync:!0,fileDialog:!1,multiWindow:!1,hapticFeedback:!0},android:{touchSupport:!0,darkModeSync:!0,fileDialog:!1,multiWindow:!1,hapticFeedback:!0}},Zu=t=>{let e=Ir();return bb[e]?.[t]||!1},wb=async()=>{switch(Ir()){case"windows":return Promise.resolve().then(()=>(Uu(),Bu));case"macos":return Promise.resolve().then(()=>(Hu(),zu));default:return Promise.resolve().then(()=>(Zn(),Du))}},ti=null,Yu=async()=>(ti||(ti=await wb()),ti);var ri=class{constructor(){this.platform=Ir(),this.platformModule=null,this.initialized=!1}async initialize(){if(!this.initialized)try{this.platformModule=await Yu(),this.initialized=!0}catch(e){console.error("PlatformService: Failed to load platform module",e)}}getPlatform(){return this.platform}isWindows(){return Ze()}isMacOS(){return Ee()}isLinux(){return Vu()}hasCapability(e){return Zu(e)}async getShortcuts(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsShortcuts||{}:Ee()?this.platformModule.macosShortcuts||{}:this.platformModule.windowsShortcuts||{}:{}}async getShortcut(e){return(await this.getShortcuts())[e]||null}formatShortcut(e){if(!e)return"";let r=e;return Ee()&&(r=r.replace(/Cmd/g,"\u2318"),r=r.replace(/Option/g,"\u2325"),r=r.replace(/Shift/g,"\u21E7"),r=r.replace(/Control/g,"\u2303")),r}async getPathUtils(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsPathUtils||{}:Ee()?this.platformModule.macosPathUtils||{}:this.platformModule||{}:{}}async normalizePath(e){let r=await this.getPathUtils();return Ze()&&r.normalizePath?r.normalizePath(e):e}getPathSeparator(){return Ju()}async getValidation(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsValidation||{isValidFilename:()=>!0}:Ee()?this.platformModule.macosValidation||{isValidFilename:()=>!0}:this.platformModule.validationUtils||{isValidFilename:()=>!0}:{isValidFilename:()=>!0}}async isValidFilename(e){return(await this.getValidation()).isValidFilename(e)}async getUIUtils(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsUI||{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:Ee()?this.platformModule.macosUI||{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}}async getPlatformStyles(){let e=await this.getUIUtils();return Ze()&&e.getWindowsStyles?e.getWindowsStyles():Ee()&&e.getMacStyles?e.getMacStyles():{}}async getShellIntegration(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsShell||null:Ee()&&this.platformModule.finderIntegration||null:null}async getContextMenuItems(){return(await this.getShellIntegration())?.getContextMenuItems?.()||[]}async getPlatformFeatures(){return await this.initialize(),Ze()?this.platformModule.windowsFeatureHelpers||this.platformModule.windowsFeaturesFromModule:Ee()?this.platformModule.macosFeatures:{}}getModifierKey(){return Gu()}getModifierSymbol(){return Ee()?"\u2318":"Ctrl"}convertShortcut(e){let r=e;return Ee()?(r=r.replace(/Ctrl/g,"Cmd"),r=r.replace(/Alt/g,"Option")):(r=r.replace(/Cmd/g,"Ctrl"),r=r.replace(/Option/g,"Alt")),r}matchesShortcut(e,r){if(!this.platformModule)return!1;let a=this.platformModule?.keyboardUtils?.getNormalizedKey?.(e);if(!a)return!1;let s=this.convertShortcut(r);return a===s.replace(/\+/g,"+")}},Uk=new ri;var Tb=["--bg","--text","--panel","--border","--muted","--accent","--accent-fg","--tab-active","--task-todo","--task-progress","--task-urgent","--task-question","--task-completed","--task-cancelled","--task-delegated","--danger","--success","--warning","--info","--editor-placeholder","--app-bg","--app-text","--app-panel","--app-border","--app-muted","--app-accent","--app-accent-fg"],nd={"--bg":"15 23 42","--text":"241 245 249","--panel":"30 41 59","--border":"51 65 85","--muted":"148 163 184","--accent":"139 92 246","--accent-fg":"255 255 255","--tab-active":"30 41 59","--task-todo":"107 114 128","--task-progress":"59 130 246","--task-urgent":"239 68 68","--task-question":"245 158 11","--task-completed":"16 185 129","--task-cancelled":"107 114 128","--task-delegated":"139 92 246","--danger":"239 68 68","--success":"16 185 129","--warning":"245 158 11","--info":"59 130 246","--editor-placeholder":"148 163 184"},Cb=["lokus-dark","dracula","nord","one-dark-pro","minimal-light","neon-dark"],li={"lokus-dark":'{"name": "Lokus Dark", "tokens": {"--bg": "#0f172a", "--text": "#f1f5f9", "--panel": "#1e293b", "--border": "#334155", "--muted": "#94a3b8", "--accent": "#8b5cf6", "--accent-fg": "#ffffff", "--task-todo": "#64748b", "--task-progress": "#3b82f6", "--task-urgent": "#ef4444", "--task-question": "#f59e0b", "--task-completed": "#10b981", "--task-cancelled": "#64748b", "--task-delegated": "#8b5cf6", "--danger": "#ef4444", "--success": "#10b981", "--warning": "#f59e0b", "--info": "#3b82f6", "--editor-placeholder": "#64748b"}}',dracula:'{"name": "Dracula", "tokens": {"--bg": "#282a36", "--text": "#f8f8f2", "--panel": "#21222c", "--border": "#44475a", "--muted": "#6272a4", "--accent": "#bd93f9", "--accent-fg": "#ffffff", "--task-todo": "#6272a4", "--task-progress": "#8be9fd", "--task-urgent": "#ff5555", "--task-question": "#f1fa8c", "--task-completed": "#50fa7b", "--task-cancelled": "#6272a4", "--task-delegated": "#bd93f9", "--danger": "#ff5555", "--success": "#50fa7b", "--warning": "#f1fa8c", "--info": "#8be9fd", "--editor-placeholder": "#6272a4"}}',nord:'{"name": "Nord", "tokens": {"--bg": "#2E3440", "--text": "#ECEFF4", "--panel": "#3B4252", "--border": "#4C566A", "--muted": "#D8DEE9", "--accent": "#88C0D0", "--accent-fg": "#2E3440", "--task-todo": "#4C566A", "--task-progress": "#5E81AC", "--task-urgent": "#BF616A", "--task-question": "#EBCB8B", "--task-completed": "#A3BE8C", "--task-cancelled": "#4C566A", "--task-delegated": "#B48EAD", "--danger": "#BF616A", "--success": "#A3BE8C", "--warning": "#EBCB8B", "--info": "#5E81AC", "--editor-placeholder": "#4C566A"}}',"one-dark-pro":'{"name": "One Dark Pro", "tokens": {"--bg": "#282c34", "--text": "#abb2bf", "--panel": "#21252b", "--border": "#3a3f4b", "--muted": "#5c6370", "--accent": "#61afef", "--accent-fg": "#ffffff", "--task-todo": "#5c6370", "--task-progress": "#61afef", "--task-urgent": "#e06c75", "--task-question": "#d19a66", "--task-completed": "#98c379", "--task-cancelled": "#5c6370", "--task-delegated": "#c678dd", "--danger": "#e06c75", "--success": "#98c379", "--warning": "#d19a66", "--info": "#61afef", "--editor-placeholder": "#5c6370"}}',"minimal-light":'{"name": "Minimal Light", "tokens": {"--bg": "#ffffff", "--text": "#1a1a1a", "--panel": "#f8f9fa", "--border": "#e5e7eb", "--muted": "#6b7280", "--accent": "#3b82f6", "--accent-fg": "#ffffff", "--task-todo": "#9ca3af", "--task-progress": "#3b82f6", "--task-urgent": "#ef4444", "--task-question": "#f59e0b", "--task-completed": "#10b981", "--task-cancelled": "#9ca3af", "--task-delegated": "#8b5cf6", "--danger": "#ef4444", "--success": "#10b981", "--warning": "#f59e0b", "--info": "#3b82f6", "--editor-placeholder": "#9ca3af"}}',"neon-dark":'{"name": "Neon Dark", "tokens": {"--bg": "#0a0a0f", "--text": "#e2e8f0", "--panel": "#1a1a2e", "--border": "#16213e", "--muted": "#64748b", "--accent": "#00d4ff", "--accent-fg": "#0a0a0f", "--task-todo": "#64748b", "--task-progress": "#00d4ff", "--task-urgent": "#ff0080", "--task-question": "#ffea00", "--task-completed": "#00ff88", "--task-cancelled": "#64748b", "--task-delegated": "#8000ff", "--danger": "#ff0080", "--success": "#00ff88", "--warning": "#ffea00", "--info": "#00d4ff", "--editor-placeholder": "#64748b"}}'},_e=!1;try{let t=typeof window<"u"?window:void 0;_e=!!(t&&(t.__TAURI_INTERNALS__&&typeof t.__TAURI_INTERNALS__.invoke=="function"||t.__TAURI_METADATA__||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.includes("Tauri")))}catch{}var Rb,Eb,Ab,$b,Pb,Ib,Ob,ad=!1;async function Dr(){if(ad)return;let t=typeof process<"u"&&process.env.NODE_ENV==="test";if(_e||t)try{({join:Rb,appDataDir:Ib}=await Promise.resolve().then(()=>(zn(),ls))),{exists:Eb,readDir:Ab,readTextFile:$b,writeTextFile:Pb,mkdir:Ob}=await Promise.resolve().then(()=>(Go(),Vo)),ad=!0,t&&(_e=!0)}catch{t||(_e=!1)}}function Db(t){if(typeof t!="string")return t;if(t=t.trim(),t.startsWith("#")){let e=t.replace("#","");if(!/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$/.test(e))return t;let r=e.length===3?e.split("").map(s=>s+s).join(""):e,a=parseInt(r,16);return`${a>>16&255} ${a>>8&255} ${a&255}`}return t}async function Lb(t){if(!t||typeof t!="object")return;let e=document.documentElement,r={};for(let[a,s]of Object.entries(t)){if(a.startsWith("--app-")){let i=a.replace("--app-","--");r[i]=s}r[a]=s}for(let a of Tb){let s=r[a];if(s){let i=Db(s);e.style.setProperty(a,i)}else e.style.removeProperty(a)}if(_e)try{let{invoke:a}=await Promise.resolve().then(()=>(ct(),Wo)),{getCurrentWindow:s}=await Promise.resolve().then(()=>(rd(),td)),i=r["--bg"]||"15 23 42",c=document.documentElement.classList.contains("dark")||window.matchMedia("(prefers-color-scheme: dark)").matches;await a("sync_window_theme",{isDark:c,bgColor:i})}catch{}}async function Nb(t){try{await Un("theme:apply",t)}catch{try{window.dispatchEvent(new CustomEvent("theme:apply",{detail:t}))}catch{}}}async function ea(t){if(!t)return null;if(await Dr(),li[t])try{return JSON.parse(li[t])}catch{}if(_e)try{return await Lr(),{tokens:await Et("get_theme_tokens",{themeId:t})}}catch{}return null}async function sd(){let t=new Map;for(let e of Cb)try{let r=JSON.parse(li[e]);t.set(e,{id:e,name:r.name})}catch{t.set(e,{id:e,name:e})}if(_e)try{let e=await Mb();for(let r of e){let a=r.name.toLowerCase().replace(/[^a-z0-9_-]/g,"_");t.set(a,{id:a,name:r.name})}}catch{}return Array.from(t.values())}async function od(){return{theme:(await Ko()).theme||null}}async function id(t){try{await Ou({theme:t})}catch{return}let r=(await ea(t))?.tokens||nd;r={...nd,...r},await Lb(r),await Nb({tokens:r,visuals:{theme:t}})}var Et;async function Lr(){Et||_e&&(Et=(await Promise.resolve().then(()=>(ct(),Wo))).invoke)}async function cd(t,e=!1){if(await Dr(),await Lr(),!_e)throw new Error("Theme import only available in desktop app");return await Et("import_theme_file",{filePath:t,overwrite:e})}async function ld(t){if(await Dr(),await Lr(),!_e)throw new Error("Theme validation only available in desktop app");return await Et("validate_theme_file",{filePath:t})}async function ud(t,e){if(await Dr(),await Lr(),!_e)throw new Error("Theme export only available in desktop app");await Et("export_theme",{themeId:t,exportPath:e})}async function dd(t){if(await Dr(),await Lr(),!_e)throw new Error("Theme deletion only available in desktop app");await Et("delete_custom_theme",{themeId:t})}async function Mb(){return await Dr(),await Lr(),_e?await Et("list_custom_themes"):[]}async function ui(t,e){if(await Dr(),await Lr(),!_e)throw new Error("Theme saving only available in desktop app");await Et("save_theme_tokens",{themeId:t,tokens:e})}var Fb={"--bg":"Background color (hex or RGB)","--text":"Primary text color","--panel":"Panel/sidebar background","--border":"Border color","--muted":"Muted/secondary text","--accent":"Accent/highlight color","--accent-fg":"Foreground color for accent (text on accent background)","--tab-active":"Active tab background","--task-todo":"Todo task color","--task-progress":"In-progress task color","--task-urgent":"Urgent task color","--task-question":"Question task color","--task-completed":"Completed task color","--task-cancelled":"Cancelled task color","--task-delegated":"Delegated task color","--danger":"Danger/error color","--success":"Success color","--warning":"Warning color","--info":"Info color","--editor-placeholder":"Editor placeholder text color"};async function Wb(){try{let t=await sd();return{themes:t,count:t.length,builtIn:["dracula","nord","one-dark-pro","minimal-light","neon-dark"]}}catch(t){throw new Error(`Failed to list themes: ${t.message}`)}}async function qb(t){try{let e=await ea(t);if(!e)throw new Error(`Theme "${t}" not found`);return{id:t,name:e.name||t,tokens:e.tokens,tokenDescriptions:Fb}}catch(e){throw new Error(`Failed to get theme: ${e.message}`)}}async function Bb(t,e){if(!t||typeof t!="string")throw new Error("Theme name is required");if(!e||typeof e!="object")throw new Error("Theme tokens object is required");let a=["--bg","--text","--panel","--border","--muted","--accent","--accent-fg"].filter(i=>!e[i]);if(a.length>0)throw new Error(`Missing required tokens: ${a.join(", ")}`);for(let[i,c]of Object.entries(e)){if(typeof c!="string")throw new Error(`Invalid token value for ${i}: must be a string`);let u=/^#[0-9A-Fa-f]{3}$|^#[0-9A-Fa-f]{6}$/.test(c.trim()),f=/^\d+\s+\d+\s+\d+$/.test(c.trim());if(!u&&!f)throw new Error(`Invalid color format for ${i}: "${c}". Use hex (#282a36) or RGB (40 42 54)`)}let s=t.toLowerCase().replace(/[^a-z0-9_-]/g,"_");try{return await ui(s,e),{id:s,name:t,tokens:e,message:`Theme "${t}" created successfully`}}catch(i){throw new Error(`Failed to create theme: ${i.message}`)}}async function Ub(t,e){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(!e||typeof e!="object")throw new Error("Theme tokens object is required");let r=await ea(t);if(!r)throw new Error(`Theme "${t}" not found`);let a={...r.tokens,...e};try{return await ui(t,a),{id:t,tokens:a,message:`Theme "${t}" updated successfully`}}catch(s){throw new Error(`Failed to update theme: ${s.message}`)}}async function zb(t){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(["dracula","nord","one-dark-pro","minimal-light","neon-dark"].includes(t))throw new Error(`Cannot delete built-in theme "${t}"`);try{return await dd(t),{id:t,message:`Theme "${t}" deleted successfully`}}catch(r){throw new Error(`Failed to delete theme: ${r.message}`)}}async function Hb(t){if(!t||typeof t!="string")throw new Error("Theme ID is required");try{return await id(t),{id:t,message:`Theme "${t}" applied successfully`}}catch(e){throw new Error(`Failed to apply theme: ${e.message}`)}}async function Vb(t,e){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(!e||typeof e!="string")throw new Error("Export path is required");try{return await ud(t,e),{id:t,path:e,message:`Theme "${t}" exported to ${e}`}}catch(r){throw new Error(`Failed to export theme: ${r.message}`)}}async function Gb(t,e=!1){if(!t||typeof t!="string")throw new Error("File path is required");try{let r=await ld(t);if(!r.valid)throw new Error(`Invalid theme file: ${r.error}`);let a=await cd(t,e);return{id:a,path:t,message:`Theme imported successfully as "${a}"`}}catch(r){throw new Error(`Failed to import theme: ${r.message}`)}}async function Jb(){try{let e=(await od()).theme;if(!e)return{id:null,message:"No theme currently active"};let r=await ea(e);return{id:e,name:r?.name||e,tokens:r?.tokens||{}}}catch(t){throw new Error(`Failed to get current theme: ${t.message}`)}}var di=[{name:"list_themes",description:"List all available themes (built-in and custom)",inputSchema:{type:"object",properties:{},required:[]}},{name:"get_theme",description:"Get details of a specific theme including all token values",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID (e.g., 'dracula', 'nord', 'my-custom-theme')"}},required:["themeId"]}},{name:"create_theme",description:"Create a new custom theme with specified colors. Supports hex (#282a36) or RGB (40 42 54) format.",inputSchema:{type:"object",properties:{name:{type:"string",description:"Theme name (will be converted to safe ID)"},tokens:{type:"object",description:"Theme color tokens. Required: --bg, --text, --panel, --border, --muted, --accent, --accent-fg. Optional: --tab-active, --task-*, --danger, --success, --warning, --info, --editor-placeholder",properties:{"--bg":{type:"string",description:"Background color"},"--text":{type:"string",description:"Primary text color"},"--panel":{type:"string",description:"Panel background"},"--border":{type:"string",description:"Border color"},"--muted":{type:"string",description:"Muted text"},"--accent":{type:"string",description:"Accent color"},"--accent-fg":{type:"string",description:"Accent foreground"},"--tab-active":{type:"string",description:"Active tab background"},"--task-todo":{type:"string",description:"Todo task color"},"--task-progress":{type:"string",description:"In-progress task color"},"--task-urgent":{type:"string",description:"Urgent task color"},"--task-question":{type:"string",description:"Question task color"},"--task-completed":{type:"string",description:"Completed task color"},"--task-cancelled":{type:"string",description:"Cancelled task color"},"--task-delegated":{type:"string",description:"Delegated task color"},"--danger":{type:"string",description:"Danger/error color"},"--success":{type:"string",description:"Success color"},"--warning":{type:"string",description:"Warning color"},"--info":{type:"string",description:"Info color"},"--editor-placeholder":{type:"string",description:"Editor placeholder color"}},required:["--bg","--text","--panel","--border","--muted","--accent","--accent-fg"]}},required:["name","tokens"]}},{name:"update_theme",description:"Update an existing theme's tokens (partial updates allowed)",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to update"},tokens:{type:"object",description:"Token values to update (only changed tokens needed)"}},required:["themeId","tokens"]}},{name:"delete_theme",description:"Delete a custom theme (cannot delete built-in themes)",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to delete"}},required:["themeId"]}},{name:"apply_theme",description:"Apply a theme to the application",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to apply"}},required:["themeId"]}},{name:"get_current_theme",description:"Get the currently active theme",inputSchema:{type:"object",properties:{},required:[]}},{name:"export_theme",description:"Export a theme to a JSON file",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to export"},exportPath:{type:"string",description:"Full path where to save the theme file"}},required:["themeId","exportPath"]}},{name:"import_theme",description:"Import a theme from a JSON file",inputSchema:{type:"object",properties:{filePath:{type:"string",description:"Path to theme JSON file"},overwrite:{type:"boolean",description:"Overwrite existing theme if it exists",default:!1}},required:["filePath"]}}];async function fd(t,e){switch(t){case"list_themes":return await Wb();case"get_theme":return await qb(e.themeId);case"create_theme":return await Bb(e.name,e.tokens);case"update_theme":return await Ub(e.themeId,e.tokens);case"delete_theme":return await zb(e.themeId);case"apply_theme":return await Hb(e.themeId);case"get_current_theme":return await Jb();case"export_theme":return await Vb(e.themeId,e.exportPath);case"import_theme":return await Gb(e.filePath,e.overwrite);default:throw new Error(`Unknown theme tool: ${t}`)}}var ut=require("fs/promises"),ta=require("path"),Nr=(t,e="yyyy-MM-dd")=>{let r=new Date(t),a=c=>c.toString().padStart(2,"0"),s={yyyy:r.getFullYear(),MM:a(r.getMonth()+1),dd:a(r.getDate()),EEEE:r.toLocaleDateString("en-US",{weekday:"long"}),EEE:r.toLocaleDateString("en-US",{weekday:"short"}),MMMM:r.toLocaleDateString("en-US",{month:"long"}),MMM:r.toLocaleDateString("en-US",{month:"short"}),HH:a(r.getHours()),mm:a(r.getMinutes()),ss:a(r.getSeconds())},i=e;for(let[c,u]of Object.entries(s))i=i.replace(new RegExp(c,"g"),u);return i},hd=(t,e="yyyy-MM-dd")=>{let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let[,a,s,i]=r,c=new Date(parseInt(a),parseInt(s)-1,parseInt(i));if(!isNaN(c.getTime()))return c}return null},pd=(t,e)=>{let r=new Date(t);return r.setDate(r.getDate()+e),r},fi={format:"yyyy-MM-dd",folder:"Daily Notes"};async function hs(t,e,r=fi){let a=(0,ta.join)(t,r.folder),s=`${Nr(e,r.format)}.md`,i=(0,ta.join)(a,s);try{await(0,ut.mkdir)(a,{recursive:!0})}catch{}let c=null,u=!1;try{c=await(0,ut.readFile)(i,"utf-8")}catch{let d=Nr(e,"EEEE");c=`# ${Nr(e,r.format)} - ${d}

`,await(0,ut.writeFile)(i,c,"utf-8"),u=!0}return{path:i,date:Nr(e,r.format),dayName:Nr(e,"EEEE"),content:c,created:u}}async function Zb(t,e=fi,r=30){let a=(0,ta.join)(t,e.folder);try{let s=await(0,ut.readdir)(a),i=[];for(let c of s){if(!c.endsWith(".md"))continue;let u=c.replace(/\.md$/,""),f=hd(u,e.format);if(f){let d=(0,ta.join)(a,c),m=await(0,ut.stat)(d);i.push({path:d,name:c,date:Nr(f,e.format),dayName:Nr(f,"EEEE"),modified:m.mtime.toISOString()})}}return i.sort((c,u)=>u.date.localeCompare(c.date)),i.slice(0,r)}catch{return[]}}var pi=[{name:"daily_note",description:"Manage daily notes - open today, yesterday, tomorrow, or a specific date. Daily notes are automatically created if they don't exist.",inputSchema:{type:"object",properties:{action:{type:"string",enum:["today","yesterday","tomorrow","date","list"],description:"Action to perform: today (get/create today's note), yesterday, tomorrow, date (specific date), list (list all daily notes)"},date:{type:"string",description:'Date in YYYY-MM-DD format (required for "date" action)'},limit:{type:"number",description:'Maximum number of notes to return for "list" action (default: 30)'}},required:["action"]}}];async function md(t,e,r){if(t!=="daily_note")throw new Error(`Unknown tool: ${t}`);let{action:a,date:s,limit:i=30}=e,c;switch(a){case"today":{let u=await hs(r,new Date);c={success:!0,action:"today",...u,message:u.created?`Created today's daily note: ${u.path}`:`Opened today's daily note: ${u.path}`};break}case"yesterday":{let u=await hs(r,pd(new Date,-1));c={success:!0,action:"yesterday",...u,message:u.created?`Created yesterday's daily note: ${u.path}`:`Opened yesterday's daily note: ${u.path}`};break}case"tomorrow":{let u=await hs(r,pd(new Date,1));c={success:!0,action:"tomorrow",...u,message:u.created?`Created tomorrow's daily note: ${u.path}`:`Opened tomorrow's daily note: ${u.path}`};break}case"date":{if(!s)throw new Error('Date parameter required for "date" action (format: YYYY-MM-DD)');let u=hd(s);if(!u)throw new Error(`Invalid date format: ${s}. Use YYYY-MM-DD format.`);let f=await hs(r,u);c={success:!0,action:"date",...f,message:f.created?`Created daily note for ${s}: ${f.path}`:`Opened daily note for ${s}: ${f.path}`};break}case"list":{let u=await Zb(r,fi,i);c={success:!0,action:"list",count:u.length,notes:u,message:u.length>0?`Found ${u.length} daily notes`:'No daily notes found. Use action "today" to create one.'};break}default:throw new Error(`Unknown action: ${a}. Use: today, yesterday, tomorrow, date, or list`)}return{content:[{type:"text",text:JSON.stringify(c,null,2)}]}}var At=require("fs/promises"),Mr=require("path"),Z={TODO:"todo",IN_PROGRESS:"in-progress",URGENT:"urgent",QUESTION:"question",COMPLETED:"completed",CANCELLED:"cancelled",DELEGATED:"delegated"},Yb={" ":Z.TODO,x:Z.COMPLETED,X:Z.COMPLETED,"/":Z.IN_PROGRESS,"!":Z.URGENT,"?":Z.QUESTION,"-":Z.CANCELLED,">":Z.DELEGATED},gd={[Z.TODO]:" ",[Z.COMPLETED]:"x",[Z.IN_PROGRESS]:"/",[Z.URGENT]:"!",[Z.QUESTION]:"?",[Z.CANCELLED]:"-",[Z.DELEGATED]:">"},Qb=/^(\s*)-\s*\[([x X/!?\->]|\s)\]\s*(.+)$/;function bd(t,e){let r=t.match(Qb);if(!r)return null;let[,a,s,i]=r,c=Yb[s]||Z.TODO,u=[],f=i.matchAll(/#(\w+)/g);for(let S of f)u.push(S[1]);let d=[],m=i.matchAll(/@(\w+)/g);for(let S of m)d.push(S[1]);let w="normal";return/\b(urgent|asap|critical)\b/i.test(i)?w="urgent":/\b(high priority|important)\b/i.test(i)?w="high":/\b(low priority)\b/i.test(i)&&(w="low"),{title:i.trim(),status:c,symbol:s,priority:w,tags:u,mentions:d,lineNumber:e+1,indent:a.length,originalLine:t}}async function wd(t,e){try{let a=(await(0,At.readFile)(t,"utf-8")).split(`
`),s=[];return a.forEach((i,c)=>{let u=bd(i,c);u&&(u.notePath=(0,Mr.relative)(e,t),u.id=`${u.notePath}:${u.lineNumber}`,s.push(u))}),s}catch{return[]}}async function hi(t,e=[]){try{let r=await(0,At.readdir)(t);for(let a of r){if(a.startsWith(".")||a==="node_modules")continue;let s=(0,Mr.join)(t,a);(await(0,At.stat)(s)).isDirectory()?await hi(s,e):(0,Mr.extname)(a)===".md"&&e.push(s)}return e}catch{return e}}async function yd(t,e={}){let{status:r,tag:a,limit:s=100,includeCompleted:i=!1}=e,c=await hi(t),u=[];for(let d of c){let m=await wd(d,t);u.push(...m)}r?u=u.filter(d=>d.status===r):i||(u=u.filter(d=>d.status!==Z.COMPLETED&&d.status!==Z.CANCELLED)),a&&(u=u.filter(d=>d.tags.includes(a)));let f={[Z.URGENT]:0,[Z.IN_PROGRESS]:1,[Z.QUESTION]:2,[Z.TODO]:3,[Z.DELEGATED]:4,[Z.COMPLETED]:5,[Z.CANCELLED]:6};return u.sort((d,m)=>{let w=(f[d.status]||99)-(f[m.status]||99);return w!==0?w:d.notePath.localeCompare(m.notePath)}),u.slice(0,s)}async function Kb(t,e,r){let[a,s]=e.split(":"),i=parseInt(s);if(!a||isNaN(i))throw new Error(`Invalid task ID format: ${e}`);let c=(0,Mr.join)(t,a),f=(await(0,At.readFile)(c,"utf-8")).split(`
`),d=i-1;if(d<0||d>=f.length)throw new Error(`Line ${i} not found in file`);let m=f[d],w=bd(m,d);if(!w)throw new Error(`Line ${i} is not a task`);let S=gd[r];if(!S&&S!==" ")throw new Error(`Invalid status: ${r}. Valid: ${Object.keys(gd).join(", ")}`);let R=m.replace(/\[([x X/!?\->]|\s)\]/,`[${S}]`);return f[d]=R,await(0,At.writeFile)(c,f.join(`
`),"utf-8"),{id:e,title:w.title,oldStatus:w.status,newStatus:r,notePath:a,lineNumber:i}}async function Xb(t){let e=await hi(t),r=[];for(let u of e){let f=await wd(u,t);r.push(...f)}let a={total:r.length,byStatus:{},byPriority:{},byTag:{},filesWithTasks:new Set};for(let u of r){a.byStatus[u.status]=(a.byStatus[u.status]||0)+1,a.byPriority[u.priority]=(a.byPriority[u.priority]||0)+1;for(let f of u.tags)a.byTag[f]=(a.byTag[f]||0)+1;a.filesWithTasks.add(u.notePath)}a.filesWithTasks=a.filesWithTasks.size;let s=a.byStatus[Z.COMPLETED]||0,i=a.byStatus[Z.CANCELLED]||0,c=a.total-s-i;return a.completionRate=a.total>0?Math.round(s/a.total*100):0,a.activeTasks=c,a}var mi=[{name:"manage_tasks",description:"Manage tasks extracted from markdown notes. Tasks use checkbox syntax: - [ ] todo, - [x] done, - [/] in progress, - [!] urgent, - [?] question, - [-] cancelled, - [>] delegated",inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","search","update","stats"],description:"Action: list (all tasks), search (filter by query/tag/status), update (change status), stats (statistics)"},taskId:{type:"string",description:"Task ID for update action (format: path/to/note.md:lineNumber)"},status:{type:"string",enum:["todo","in-progress","urgent","question","completed","cancelled","delegated"],description:"Filter by status (list/search) or new status (update)"},tag:{type:"string",description:"Filter tasks by tag (without #)"},query:{type:"string",description:"Search query to filter task titles"},includeCompleted:{type:"boolean",description:"Include completed tasks in list (default: false)"},limit:{type:"number",description:"Maximum tasks to return (default: 100)"}},required:["action"]}}];async function _d(t,e,r){if(t!=="manage_tasks")throw new Error(`Unknown tool: ${t}`);let{action:a,taskId:s,status:i,tag:c,query:u,includeCompleted:f=!1,limit:d=100}=e,m;switch(a){case"list":{let w=await yd(r,{status:i,tag:c,limit:d,includeCompleted:f});m={success:!0,action:"list",count:w.length,tasks:w,message:w.length>0?`Found ${w.length} tasks`:"No tasks found"};break}case"search":{let w=await yd(r,{status:i,tag:c,limit:500,includeCompleted:f});if(u){let S=u.toLowerCase();w=w.filter(R=>R.title.toLowerCase().includes(S)||R.notePath.toLowerCase().includes(S))}w=w.slice(0,d),m={success:!0,action:"search",query:u||null,status:i||null,tag:c||null,count:w.length,tasks:w,message:`Found ${w.length} matching tasks`};break}case"update":{if(!s)throw new Error("taskId required for update action");if(!i)throw new Error("status required for update action");let w=await Kb(r,s,i);m={success:!0,action:"update",...w,message:`Task updated: ${w.oldStatus} -> ${w.newStatus}`};break}case"stats":{let w=await Xb(r);m={success:!0,action:"stats",...w,message:`${w.total} tasks across ${w.filesWithTasks} files (${w.completionRate}% complete)`};break}default:throw new Error(`Unknown action: ${a}. Use: list, search, update, or stats`)}return{content:[{type:"text",text:JSON.stringify(m,null,2)}]}}var jr=require("fs/promises"),Ke=require("path");var $t=require("fs/promises"),Qe=require("path"),ew=/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,yi=class{constructor(e){this.workspacePath=e,this.indexPath=(0,Qe.join)(e,".lokus","mcp-graph-index.json"),this.graph=null,this.lastBuilt=null}async load(e=!1){if(!e&&!this.graph)try{let r=await this.loadFromCache();if(r&&this.isCacheFresh(r))return this.graph=r.graph,this.lastBuilt=r.lastBuilt,this.graph}catch{}return await this.build(),this.graph}isCacheFresh(e){return e.lastBuilt?Date.now()-new Date(e.lastBuilt).getTime()<300*1e3:!1}async loadFromCache(){let e=await(0,$t.readFile)(this.indexPath,"utf-8");return JSON.parse(e)}async saveToCache(){let e={graph:this.graph,lastBuilt:this.lastBuilt,version:"1.0"};await(0,$t.writeFile)(this.indexPath,JSON.stringify(e,null,2),"utf-8")}async build(){this.graph={nodes:{},edges:[],stats:{}};let e=await this.scanDirectory(this.workspacePath);for(let r of e){let a=(0,Qe.relative)(this.workspacePath,r),s=(0,Qe.basename)(r,".md"),i=this.normalizeNodeId(s);this.graph.nodes[i]={id:i,path:a,name:s,outgoingLinks:[],incomingLinks:[],metadata:{}}}for(let r of e)await this.processFile(r);this.graph.stats=this.calculateStats(),this.lastBuilt=new Date().toISOString();try{await this.saveToCache()}catch{}return this.graph}normalizeNodeId(e){return e.trim().toLowerCase().replace(/\.md$/,"")}async processFile(e){let r=await(0,$t.readFile)(e,"utf-8"),a=(0,Qe.relative)(this.workspacePath,e),s=(0,Qe.basename)(e,".md"),i=this.normalizeNodeId(s),c=r.matchAll(ew);for(let u of c){let[,f,d]=u,m=this.normalizeNodeId(f);i!==m&&(this.graph.nodes[i]&&(this.graph.nodes[i].outgoingLinks.includes(m)||this.graph.nodes[i].outgoingLinks.push(m)),this.graph.nodes[m]&&(this.graph.nodes[m].incomingLinks.includes(i)||this.graph.nodes[m].incomingLinks.push(i)),this.graph.edges.push({from:i,to:m,label:d||f}))}this.graph.nodes[i]&&(this.graph.nodes[i].metadata={linkCount:this.graph.nodes[i].outgoingLinks.length,wordCount:r.split(/\s+/).length})}async scanDirectory(e,r=[]){try{let a=await(0,$t.readdir)(e);for(let s of a){if(s.startsWith(".")||s==="node_modules")continue;let i=(0,Qe.join)(e,s);(await(0,$t.stat)(i)).isDirectory()?await this.scanDirectory(i,r):(0,Qe.extname)(s)===".md"&&r.push(i)}return r}catch{return r}}calculateStats(){let e=Object.values(this.graph.nodes),r=this.graph.edges.length,a=e.filter(i=>i.outgoingLinks.length===0&&i.incomingLinks.length===0).length,s=e.map(i=>i.outgoingLinks.length+i.incomingLinks.length);return{nodeCount:e.length,edgeCount:r,orphanCount:a,averageConnections:e.length>0?(s.reduce((i,c)=>i+c,0)/e.length).toFixed(2):0,maxConnections:Math.max(...s,0)}}getRelatedNotes(e,r={}){let{depth:a=1,direction:s="both",limit:i=20}=r,c=this.normalizeNodeId(e);if(!this.graph?.nodes[c])return{found:!1,related:[]};let u=new Set([c]),f=[],d=(m,w)=>{if(w>a)return;let S=this.graph.nodes[m];if(!S)return;let R=[];(s==="outgoing"||s==="both")&&R.push(...S.outgoingLinks.map(x=>({id:x,type:"outgoing"}))),(s==="incoming"||s==="both")&&R.push(...S.incomingLinks.map(x=>({id:x,type:"incoming"})));for(let x of R)if(!u.has(x.id)){u.add(x.id);let N=this.graph.nodes[x.id];N&&(f.push({id:x.id,name:N.name,path:N.path,depth:w,direction:x.type,connections:N.outgoingLinks.length+N.incomingLinks.length}),d(x.id,w+1))}};return d(c,1),f.sort((m,w)=>m.depth!==w.depth?m.depth-w.depth:w.connections-m.connections),{found:!0,source:this.graph.nodes[c],related:f.slice(0,i)}}findPath(e,r){let a=this.normalizeNodeId(e),s=this.normalizeNodeId(r);if(!this.graph?.nodes[a]||!this.graph?.nodes[s])return{found:!1,path:[],message:"One or both notes not found"};if(a===s)return{found:!0,path:[this.graph.nodes[a]],distance:0};let i=[[a]],c=new Set([a]);for(;i.length>0;){let u=i.shift(),f=u[u.length-1],d=this.graph.nodes[f];if(!d)continue;let m=[...new Set([...d.outgoingLinks,...d.incomingLinks])];for(let w of m){if(w===s){let S=[...u,s].map(R=>this.graph.nodes[R]);return{found:!0,path:S,distance:S.length-1}}c.has(w)||(c.add(w),i.push([...u,w]))}}return{found:!1,path:[],message:"No path exists between these notes"}}getOrphans(){return this.graph?Object.values(this.graph.nodes).filter(e=>e.outgoingLinks.length===0&&e.incomingLinks.length===0).map(e=>({id:e.id,name:e.name,path:e.path})):[]}getHubs(e=10){return this.graph?Object.values(this.graph.nodes).map(r=>({id:r.id,name:r.name,path:r.path,outgoing:r.outgoingLinks.length,incoming:r.incomingLinks.length,total:r.outgoingLinks.length+r.incomingLinks.length})).filter(r=>r.total>0).sort((r,a)=>a.total-r.total).slice(0,e):[]}getClusters(){if(!this.graph)return[];let e=new Set,r=[],a=(s,i)=>{if(e.has(s))return;e.add(s);let c=this.graph.nodes[s];if(c){i.push({id:s,name:c.name,path:c.path});for(let u of[...c.outgoingLinks,...c.incomingLinks])a(u,i)}};for(let s of Object.keys(this.graph.nodes))if(!e.has(s)){let i=[];a(s,i),i.length>0&&r.push(i)}return r.sort((s,i)=>i.length-s.length),r.map((s,i)=>({id:i+1,size:s.length,nodes:s}))}searchByName(e,r=20){if(!this.graph)return[];let a=e.toLowerCase();return Object.values(this.graph.nodes).filter(s=>s.name.toLowerCase().includes(a)).map(s=>({id:s.id,name:s.name,path:s.path,connections:s.outgoingLinks.length+s.incomingLinks.length})).sort((s,i)=>{let c=s.name.toLowerCase()===a?0:1,u=i.name.toLowerCase()===a?0:1;return c!==u?c-u:i.connections-s.connections}).slice(0,r)}getOverview(){return this.graph?{stats:this.graph.stats,hubs:this.getHubs(5),orphanCount:this.graph.stats.orphanCount,clusterCount:this.getClusters().length,lastBuilt:this.lastBuilt}:null}},gi=new Map;function bi(t){return gi.has(t)||gi.set(t,new yi(t)),gi.get(t)}async function tw(t,e,r){try{let a=await(0,jr.readFile)(t,"utf-8"),s=a.toLowerCase(),i=e.toLowerCase();if(!s.includes(i))return null;let c=a.split(`
`),u=[];c.forEach((m,w)=>{m.toLowerCase().includes(i)&&u.push({lineNumber:w+1,text:m.trim().substring(0,200)})});let f=(s.match(new RegExp(i,"gi"))||[]).length,d=(0,Ke.basename)(t,".md").toLowerCase().includes(i);return{path:(0,Ke.relative)(r,t),name:(0,Ke.basename)(t,".md"),matches:u,occurrences:f,titleMatch:d,score:f+(d?10:0)+(u.length>0?5:0)}}catch{return null}}async function kd(t,e=[]){try{let r=await(0,jr.readdir)(t);for(let a of r){if(a.startsWith(".")||a==="node_modules")continue;let s=(0,Ke.join)(t,a);(await(0,jr.stat)(s)).isDirectory()?await kd(s,e):(0,Ke.extname)(a)===".md"&&e.push(s)}return e}catch{return e}}async function rw(t,e,r={}){let{depth:a=1,limit:s=20,folder:i=null,includeRelated:c=!0}=r,u=bi(t);await u.load();let f=await kd(t);if(i){let S=(0,Ke.join)(t,i);f=f.filter(R=>R.startsWith(S))}let d=f.map(S=>tw(S,e,t)),m=(await Promise.all(d)).filter(S=>S!==null);m.sort((S,R)=>R.score-S.score);let w=[];for(let S of m.slice(0,s)){let R={...S};if(c){let x=u.getRelatedNotes(S.name,{depth:a,limit:5});x.found&&(R.relatedNotes=x.related.map(N=>({name:N.name,path:N.path,depth:N.depth,direction:N.direction})),R.connectionCount=x.source.outgoingLinks.length+x.source.incomingLinks.length)}w.push(R)}return{query:e,totalMatches:m.length,results:w,graphEnabled:c}}async function nw(t,e,r={}){let{depth:a=2,direction:s="both",includeContent:i=!1,limit:c=30}=r,u=bi(t);await u.load();let f=u.searchByName(e,5);if(f.length===0)return{found:!1,topic:e,message:`No note found matching "${e}". Try a different search term.`,suggestions:u.getHubs(5).map(P=>P.name)};let d=f[0],m=u.getRelatedNotes(d.name,{depth:a,direction:s,limit:c}),w=m.related.filter(P=>P.depth===1),S=m.related.filter(P=>P.depth===2),R=m.related.filter(P=>P.depth>=3),x=null;if(i)try{let P=(0,Ke.join)(t,d.path),U=await(0,jr.readFile)(P,"utf-8");x=U.substring(0,500).trim(),U.length>500&&(x+="...")}catch{}let N=u.getHubs(3).filter(P=>P.id!==d.id),W=[];for(let P of N.slice(0,2)){let U=u.findPath(d.name,P.name);U.found&&U.distance<=3&&W.push({to:P.name,distance:U.distance,path:U.path.map(te=>te.name)})}return{found:!0,topic:{name:d.name,path:d.path,connections:d.connections,content:x},exploration:{direction:s,depth:a,totalRelated:m.related.length},directlyLinked:w,secondDegree:S.slice(0,10),thirdDegree:R.slice(0,5),pathsToHubs:W,graphStats:u.getOverview().stats}}var wi=[{name:"smart_search",description:"Search notes using content AND knowledge graph. Returns matching notes plus their connected notes via wiki links. Much smarter than just text search.",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query (searches note content and titles)"},depth:{type:"number",description:"How many wiki link hops to follow for related notes (1-3, default: 1)"},folder:{type:"string",description:'Filter to specific folder (e.g., "Projects" or "Daily Notes")'},limit:{type:"number",description:"Maximum results to return (default: 20)"},includeRelated:{type:"boolean",description:"Include graph-related notes in results (default: true)"}},required:["query"]}},{name:"explore_topic",description:"Explore a topic through the knowledge graph. Finds a note and all its connections via wiki links. Great for understanding how ideas connect.",inputSchema:{type:"object",properties:{topic:{type:"string",description:"Topic or note name to explore"},depth:{type:"number",description:"How deep to traverse links (1-3, default: 2)"},direction:{type:"string",enum:["outgoing","incoming","both"],description:"Link direction: outgoing (notes this links to), incoming (notes linking here), both"},includeContent:{type:"boolean",description:"Include content snippet of the topic note (default: false)"},limit:{type:"number",description:"Max related notes to return (default: 30)"}},required:["topic"]}}];async function Sd(t,e,r){let a;switch(t){case"smart_search":{let{query:s,depth:i=1,folder:c,limit:u=20,includeRelated:f=!0}=e;if(!s)throw new Error("Query is required for smart_search");let d=await rw(r,s,{depth:Math.min(i,3),folder:c,limit:u,includeRelated:f});a={success:!0,...d,message:d.totalMatches>0?`Found ${d.totalMatches} notes matching "${s}"${d.graphEnabled?" (with graph connections)":""}`:`No notes found matching "${s}"`};break}case"explore_topic":{let{topic:s,depth:i=2,direction:c="both",includeContent:u=!1,limit:f=30}=e;if(!s)throw new Error("Topic is required for explore_topic");let d=await nw(r,s,{depth:Math.min(i,3),direction:c,includeContent:u,limit:f});d.found?a={success:!0,...d,message:`Explored "${d.topic.name}" with ${d.exploration.totalRelated} connected notes`}:a={success:!1,...d};break}default:throw new Error(`Unknown tool: ${t}`)}return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}var _i=require("fs/promises"),xd=require("path"),aw=require("os"),sw=require("fs");var vd=[{uri:"lokus://markdown-syntax/overview",name:"Lokus Markdown Syntax Overview",description:"Complete guide to all supported markdown syntax in Lokus",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/callouts",name:"Callout Syntax",description:"How to create callouts/admonitions in Lokus",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/images",name:"Image Embedding Syntax",description:"How to embed images in Lokus notes",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/wiki-links",name:"Wiki Link Syntax",description:"How to create wiki-style links and embeds",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/math",name:"Math Equations (LaTeX/KaTeX)",description:"How to write inline and block math equations using LaTeX syntax",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/tables",name:"Tables",description:"How to create and format markdown tables",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/code",name:"Code Blocks",description:"How to add inline code and code blocks with syntax highlighting",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/lists",name:"Lists and Tasks",description:"How to create ordered lists, unordered lists, and task lists",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/formatting",name:"Text Formatting",description:"Bold, italic, strikethrough, highlights, superscript, subscript",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/diagrams",name:"Mermaid Diagrams",description:"How to create flowcharts, sequence diagrams, and more with Mermaid",mimeType:"text/markdown"}];async function Td(t){switch(t){case"lokus://markdown-syntax/overview":return ow();case"lokus://markdown-syntax/callouts":return iw();case"lokus://markdown-syntax/images":return cw();case"lokus://markdown-syntax/wiki-links":return lw();case"lokus://markdown-syntax/math":return uw();case"lokus://markdown-syntax/tables":return dw();case"lokus://markdown-syntax/code":return fw();case"lokus://markdown-syntax/lists":return pw();case"lokus://markdown-syntax/formatting":return hw();case"lokus://markdown-syntax/diagrams":return mw();default:throw new Error(`Unknown markdown syntax resource: ${t}`)}}function ow(){return{contents:[{uri:"lokus://markdown-syntax/overview",mimeType:"text/markdown",text:`# Lokus Markdown Syntax Guide

Lokus supports extended markdown with special features for note-taking and knowledge management.

## Basic Markdown

All standard markdown is supported:
- **Bold** with \`**text**\` or \`__text__\`
- *Italic* with \`*text*\` or \`_text_\`
- \`inline code\` with backticks
- Links: \`[text](url)\`
- Images: \`![alt](url)\`
- Headings: \`# H1\`, \`## H2\`, etc.
- Lists (ordered and unordered)
- Tables
- Blockquotes: \`> quote\`
- Code blocks with \`\`\`language\`\`\`

## Extended Features

### 1. Callouts/Admonitions
Create colored, collapsible callouts:
\`\`\`
>[!note] Optional Title
Content goes here

>[!warning] Be Careful
Important warning message

>[!tip]- Collapsed by default
This callout starts collapsed (note the dash)
\`\`\`

**Available types:** note, tip, warning, danger, info, success, question, example

### 2. Wiki Links
Link to other notes:
\`\`\`
[[Note Name]]
[[Note Name|Display Text]]
[[Note Name#Heading]]
[[Note Name^blockid]]
\`\`\`

### 3. Image Embeds
Embed images using wiki-style syntax:
\`\`\`
![[image.png]]
![[folder/image.jpg]]
![[image.png|Custom Alt Text]]
\`\`\`

Also supports standard markdown:
\`\`\`
![alt text](path/to/image.png)
![alt text](https://example.com/image.jpg)
\`\`\`

### 4. Block Embeds
Embed content from other notes:
\`\`\`
![[Note Name^blockid]]
\`\`\`

### 5. Math Equations
Inline: \`$E = mc^2$\`
Block:
\`\`\`
$$
\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}
$$
\`\`\`

### 6. Task Lists
\`\`\`
- [ ] Incomplete task
- [x] Completed task
\`\`\`

### 7. Highlights
\`==highlighted text==\`

### 8. Strikethrough
\`~~strikethrough text~~\`

### 9. Superscript & Subscript
- Superscript: \`H^2^O\` renders as H\xB2O
- Subscript: \`H~2~O\` renders as H\u2082O

### 10. Mermaid Diagrams
\`\`\`mermaid
graph TD
    A[Start] --> B[Process]
    B --> C[End]
\`\`\`

## Best Practices

1. **Always use proper syntax** - Don't mix formats
2. **For images**, prefer wiki-style \`![[image.png]]\` for local files
3. **For callouts**, always include the type: \`>[!type]\`
4. **For wiki links**, use \`[[Note Name]]\` not \`[Note Name]\`
5. **For math**, use \`$inline$\` or \`$$block$$\` delimiters

## Common Mistakes

\u274C **Wrong:**
- \`> [!note]\` (space after >)
- \`[[!image.png]]\` (using [[ for images without !)
- \`[!note]\` (missing >)
- Standard link syntax for local files: \`[text](file.md)\`

\u2705 **Correct:**
- \`>[!note]\` (no space)
- \`![[image.png]]\` (! before [[)
- \`>[!note]\` (> before [)
- Wiki link syntax: \`[[Note Name]]\`
`}]}}function iw(){return{contents:[{uri:"lokus://markdown-syntax/callouts",mimeType:"text/markdown",text:`# Callout/Admonition Syntax

## Basic Syntax

\`\`\`
>[!type] Optional Title
Content goes here on the next lines.
Can be multiple paragraphs.
\`\`\`

**IMPORTANT:** No space between \`>\` and \`[!\`

## Available Types

- \`>[!note]\` - Blue, informational (default)
- \`>[!tip]\` - Green, helpful tips
- \`>[!warning]\` - Orange, caution/warnings
- \`>[!danger]\` - Red, critical warnings
- \`>[!info]\` - Cyan, general information
- \`>[!success]\` - Green, success messages
- \`>[!question]\` - Purple, questions/help
- \`>[!example]\` - Gray, examples

## Collapsible Callouts

Add a dash \`-\` after the type to make it collapsible and start collapsed:

\`\`\`
>[!tip]- Click to expand
This content starts hidden
\`\`\`

Without dash, callouts are expanded by default:

\`\`\`
>[!tip] Always visible
This is always shown
\`\`\`

## Custom Titles

\`\`\`
>[!warning] Custom Warning Title
Your content here
\`\`\`

If no title is provided, the type name is used:

\`\`\`
>[!warning]
This will show "Warning" as the title
\`\`\`

## Nested Content

Callouts can contain any markdown:

\`\`\`
>[!note] Advanced Example
This callout contains:

- Bullet points
- **Bold text**
- \`code\`

\`\`\`code
Code blocks
\`\`\`

And even [[Wiki Links]]
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`> [!note]\` - Space after >
- \`[!note]\` - Missing >
- \`> [! note]\` - Spaces in tag
- \`>[note]\` - Missing !

\u2705 **Correct:**
- \`>[!note]\` - Proper syntax
`}]}}function cw(){return{contents:[{uri:"lokus://markdown-syntax/images",mimeType:"text/markdown",text:`# Image Embedding Syntax

## Wiki-Style Images (Recommended for Local Files)

\`\`\`
![[image.png]]
![[folder/subfolder/image.jpg]]
![[image.png|Custom Alt Text]]
\`\`\`

**Supported formats:** PNG, JPG, JPEG, GIF, SVG, WebP

## Standard Markdown Images

\`\`\`
![alt text](image.png)
![alt text](folder/image.jpg)
![alt text](https://example.com/image.jpg)
\`\`\`

## Syntax Comparison

| Style | Syntax | Use Case |
|-------|--------|----------|
| Wiki | \`![[image.png]]\` | Local workspace images |
| Wiki with alt | \`![[image.png\\|Alt Text]]\` | Local with custom alt |
| Markdown | \`![alt](image.png)\` | Standard markdown |
| Markdown URL | \`![alt](https://...)\` | External images |

## Path Resolution

Images are resolved relative to:
1. Current note's directory
2. Workspace root
3. Attachments folder (if configured)

## Best Practices

\u2705 **Do:**
- Use \`![[image.png]]\` for local workspace images
- Place images in descriptive folders: \`assets/\`, \`images/\`, etc.
- Use descriptive filenames: \`diagram-architecture.png\`
- Provide alt text for accessibility

\u274C **Don't:**
- Use \`[[!image.png]]\` - Wrong! The \`!\` goes BEFORE \`[[\`
- Use absolute system paths: \`/Users/name/image.png\`
- Use spaces in filenames (use hyphens: \`my-image.png\`)

## Examples

**Basic image:**
\`\`\`
![[screenshot.png]]
\`\`\`

**Image in folder:**
\`\`\`
![[diagrams/architecture.png]]
\`\`\`

**With alt text:**
\`\`\`
![[diagram.png|System Architecture Diagram]]
\`\`\`

**External image:**
\`\`\`
![Logo](https://example.com/logo.png)
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`[[!image.png]]\` - ! is in wrong position
- \`[!image.png]\` - Missing one bracket
- \`![[image]]\` - Missing file extension
- \`![[image .png]]\` - Space in filename

\u2705 **Correct:**
- \`![[image.png]]\` - Proper wiki-style
- \`![alt](image.png)\` - Standard markdown
`}]}}function lw(){return{contents:[{uri:"lokus://markdown-syntax/wiki-links",mimeType:"text/markdown",text:`# Wiki Link Syntax

Wiki-style links connect notes and enable bidirectional linking in your knowledge base.

## Basic Links

Link to another note:

\`\`\`
[[Note Name]]
[[Note Name|Custom Display Text]]
\`\`\`

Examples:
\`\`\`
[[Project Ideas]]
[[Meeting Notes 2024-01-15]]
[[JavaScript Guide|JS Guide]]
\`\`\`

## Heading Links

Link to specific sections within notes using \`#\`:

\`\`\`
[[Note Name#Heading]]
[[Note Name#Heading|Custom Text]]
\`\`\`

Examples:
\`\`\`
[[Documentation#Installation]]
[[API Reference#Authentication|Auth docs]]
[[Project Plan#Phase 2]]
\`\`\`

**How it works:**
- \`#\` links to a heading (# Heading, ## Heading, etc.)
- Case-insensitive heading matching
- Spaces in heading names work automatically

## Block References (Block IDs)

Link to specific blocks/paragraphs within notes using \`^\`:

\`\`\`
[[Note Name^blockid]]
[[Note Name^blockid|Custom Text]]
\`\`\`

### What are Block IDs?

Block IDs let you reference specific paragraphs, list items, or blocks of content. Each block can have a unique identifier.

### Creating Block IDs

Add \`^blockid\` at the END of any block:

\`\`\`
This is a paragraph with a block ID. ^intro-para

- This is a list item ^list-item-1
- Another list item ^list-item-2

> This is a quote block ^important-quote
\`\`\`

**Block ID Rules:**
- Use lowercase letters, numbers, hyphens, underscores
- No spaces allowed
- Must be unique within the note
- Format: \`^block-id-name\`

### Linking to Blocks

Reference the block from another note:

\`\`\`
See the introduction: [[Project Notes^intro-para]]
Check out [[Meeting Notes^action-items]]
Reference [[Research^key-finding-1|this finding]]
\`\`\`

### Examples

**In source note (Research.md):**
\`\`\`
# Research Findings

Our study found significant results. ^key-finding

## Methodology
We used a double-blind approach. ^methodology

- Sample size: 1000 participants ^sample-size
- Duration: 6 months ^duration
\`\`\`

**In another note:**
\`\`\`
According to [[Research^key-finding]], the results were significant.
The [[Research^methodology|study methodology]] was rigorous.
With [[Research^sample-size|1000 participants]], the data is reliable.
\`\`\`

## Block Embeds

Embed actual content from blocks using \`!\`:

\`\`\`
![[Note Name^blockid]]
\`\`\`

**Difference:**
- \`[[Note^block]]\` - Creates a LINK to the block
- \`![[Note^block]]\` - EMBEDS the block content inline

### Embed Examples

**Source note (Quotes.md):**
\`\`\`
> "The only way to do great work is to love what you do." - Steve Jobs ^jobs-quote

The key to success is persistence. ^success-key
\`\`\`

**In another note:**
\`\`\`
# Daily Inspiration

![[Quotes^jobs-quote]]

Remember: ![[Quotes^success-key]]
\`\`\`

Result: The actual content will be displayed inline, not just a link.

## Image Embeds

Embed images from your workspace:

\`\`\`
![[image.png]]
![[folder/subfolder/diagram.jpg]]
![[screenshot.png|Custom Alt Text]]
\`\`\`

**Supported formats:** PNG, JPG, JPEG, GIF, SVG, WebP

Examples:
\`\`\`
![[architecture-diagram.png]]
![[Screenshots/bug-report.png]]
![[logo.svg|Company Logo]]
\`\`\`

## Syntax Summary

| Syntax | Purpose | Example |
|--------|---------|---------|
| \`[[Note]]\` | Link to note | \`[[Meeting Notes]]\` |
| \`[[Note\\|Text]]\` | Link with custom text | \`[[API Docs\\|Documentation]]\` |
| \`[[Note#Heading]]\` | Link to section | \`[[Guide#Installation]]\` |
| \`[[Note^block]]\` | Link to block | \`[[Research^finding-1]]\` |
| \`![[Note^block]]\` | Embed block content | \`![[Quotes^quote-1]]\` |
| \`![[image.png]]\` | Embed image | \`![[diagram.png]]\` |

## Path Resolution

Lokus resolves links intelligently:

1. **By filename** - \`[[Note]]\` finds \`Note.md\`
2. **By path** - \`[[folder/Note]]\` finds specific location
3. **Same folder** - Prefers notes in current folder
4. **Workspace root** - Falls back to workspace search
5. **Case-insensitive** - \`[[note]]\` matches \`Note.md\`

## Best Practices

\u2705 **Do:**
- Use \`[[Note Name]]\` for internal note links
- Use \`|alt text\` for descriptive link text
- Use \`#heading\` to link to specific sections
- Use \`^blockid\` for paragraph-level references
- Use \`![[Note^block]]\` to embed reusable content
- Keep block IDs descriptive: \`^key-finding\` not \`^1\`

\u274C **Don't:**
- Use \`[Note Name]\` - Need TWO brackets
- Use \`[[Note.md]]\` - Omit file extension
- Use spaces in block IDs: \`^my block\` (wrong)
- Use special characters in block IDs: \`^block!@#\` (wrong)
- Mix wiki and markdown link syntax

## Common Use Cases

**Research notes:**
\`\`\`
Key findings: [[Study 2024^results]]
See methodology: [[Study 2024#Methods]]
Full report: [[Study 2024]]
\`\`\`

**Meeting notes:**
\`\`\`
Action items from last meeting: ![[Meeting 2024-01-15^action-items]]
Decision made: [[Meeting 2024-01-15^decision-architecture]]
\`\`\`

**Documentation:**
\`\`\`
Setup guide: [[Installation#Prerequisites]]
API endpoint: [[API Reference#Authentication]]
Example: ![[Examples^basic-usage]]
\`\`\`

**Knowledge base:**
\`\`\`
Related concept: [[Machine Learning]]
See definition: [[Glossary^neural-network]]
Visual diagram: ![[diagrams/architecture.png]]
\`\`\`

## Heading vs Block Reference

**When to use \`#heading\`:**
- Link to entire sections
- Section has a heading
- Content under heading may change
- Example: \`[[Guide#Installation]]\`

**When to use \`^blockid\`:**
- Link to specific paragraph/quote
- Need stable reference to exact content
- Want to embed specific block
- Example: \`[[Research^key-finding]]\`
`}]}}function uw(){return{contents:[{uri:"lokus://markdown-syntax/math",mimeType:"text/markdown",text:`# Math Equations (LaTeX/KaTeX)

Lokus supports LaTeX math equations using KaTeX renderer.

## Inline Math

Use single dollar signs \`$\` for inline equations:

\`\`\`
The equation $E = mc^2$ represents energy-mass equivalence.
The quadratic formula is $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$.
\`\`\`

**IMPORTANT:** No spaces after opening \`$\` or before closing \`$\`

## Block Math

Use double dollar signs \`$$\` for block equations:

\`\`\`
$$
E = mc^2
$$

$$
\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}
$$

$$
\\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}
$$
\`\`\`

## Common Syntax

### Fractions
\`\`\`
$\\frac{a}{b}$ - Simple fraction
$\\frac{\\partial f}{\\partial x}$ - Partial derivative
\`\`\`

### Superscripts & Subscripts
\`\`\`
$x^2$ - Superscript
$x_i$ - Subscript
$x^{2y}$ - Multiple characters (use braces)
$x_{i,j}$ - Multiple subscript characters
\`\`\`

### Square Roots
\`\`\`
$\\sqrt{x}$ - Square root
$\\sqrt[3]{x}$ - Cube root
$\\sqrt{x^2 + y^2}$ - Complex expression
\`\`\`

### Sums & Products
\`\`\`
$\\sum_{i=1}^{n} x_i$ - Summation
$\\prod_{i=1}^{n} x_i$ - Product
$\\int_{a}^{b} f(x) dx$ - Integral
\`\`\`

### Greek Letters
\`\`\`
$\\alpha, \\beta, \\gamma, \\delta$ - Lowercase
$\\Alpha, \\Beta, \\Gamma, \\Delta$ - Uppercase
$\\pi, \\theta, \\lambda, \\omega$ - Common symbols
\`\`\`

### Matrices
\`\`\`
$$
\\begin{bmatrix}
a & b \\\\
c & d
\\end{bmatrix}
$$

$$
\\begin{pmatrix}
1 & 2 & 3 \\\\
4 & 5 & 6
\\end{pmatrix}
$$
\`\`\`

### Special Symbols
\`\`\`
$\\infty$ - Infinity
$\\pm$ - Plus-minus
$\\times$ - Multiplication
$\\div$ - Division
$\\neq$ - Not equal
$\\leq, \\geq$ - Less/greater than or equal
$\\approx$ - Approximately
$\\in$ - Element of
$\\subset$ - Subset
$\\cup, \\cap$ - Union, intersection
\`\`\`

### Calculus
\`\`\`
$\\frac{d}{dx}$ - Derivative
$\\frac{\\partial}{\\partial x}$ - Partial derivative
$\\int$ - Integral
$\\oint$ - Contour integral
$\\lim_{x \\to \\infty}$ - Limit
\`\`\`

### Logic & Sets
\`\`\`
$\\forall$ - For all
$\\exists$ - There exists
$\\in$ - Element of
$\\emptyset$ - Empty set
$\\mathbb{R}$ - Real numbers
$\\mathbb{N}$ - Natural numbers
$\\mathbb{Z}$ - Integers
\`\`\`

## Common Equations Examples

**Physics:**
\`\`\`
$E = mc^2$
$F = ma$
$v = v_0 + at$
$s = ut + \\frac{1}{2}at^2$
\`\`\`

**Chemistry:**
\`\`\`
$H_2O$
$CO_2$
$C_6H_{12}O_6$
\`\`\`

**Statistics:**
\`\`\`
$\\mu = \\frac{1}{n}\\sum_{i=1}^{n} x_i$ - Mean
$\\sigma = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}(x_i - \\mu)^2}$ - Standard deviation
\`\`\`

**Calculus:**
\`\`\`
$$
\\frac{d}{dx}(x^n) = nx^{n-1}
$$

$$
\\int x^n dx = \\frac{x^{n+1}}{n+1} + C
$$
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`$ E=mc^2$\` - Space before closing $
- \`$E=mc^2 $\` - Space before closing $
- \`$E = mc^2\` - Missing closing $
- \`E = mc^2$\` - Missing opening $
- \`$$E = mc^2\` - Missing closing $$

\u2705 **Correct:**
- \`$E = mc^2$\` - Proper inline
- \`$$E = mc^2$$\` - Proper block (can be on separate lines)

## Block Math Formatting

Block math can be written on multiple lines:

\`\`\`
$$
\\begin{aligned}
E &= mc^2 \\\\
p &= mv \\\\
F &= ma
\\end{aligned}
$$
\`\`\`

## Best Practices

\u2705 **Do:**
- Use \`$\` for inline math (within text)
- Use \`$$\` for block math (standalone equations)
- Use \`{}\` braces to group multiple characters
- Use \`\\\\\\\\\` for line breaks in aligned equations
- Escape special characters with backslash

\u274C **Don't:**
- Add spaces after \`$\` or before \`$\`
- Forget closing delimiters
- Use \`\` for math (that's for code)
- Mix inline and block delimiters
`}]}}function dw(){return{contents:[{uri:"lokus://markdown-syntax/tables",mimeType:"text/markdown",text:`# Markdown Tables

## Basic Table

\`\`\`
| Header 1 | Header 2 | Header 3 |
| -------- | -------- | -------- |
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |
\`\`\`

Renders as:

| Header 1 | Header 2 | Header 3 |
| -------- | -------- | -------- |
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |

## Alignment

Use colons to align columns:

\`\`\`
| Left Aligned | Center Aligned | Right Aligned |
| :----------- | :------------: | ------------: |
| Left         | Center         | Right         |
| Text         | Text           | Text          |
\`\`\`

- \`:---\` Left aligned
- \`:---:\` Center aligned
- \`---:\` Right aligned

## Formatting in Cells

Tables support inline formatting:

\`\`\`
| **Bold** | *Italic* | \`Code\` |
| -------- | -------- | -------- |
| **Text** | *Text*   | \`text\` |
\`\`\`

## Tips

\u2705 **Do:**
- Keep separator row (| --- | --- |)
- Align pipes for readability (optional)
- Use at least 3 hyphens in separator

\u274C **Don't:**
- Forget separator row
- Put spaces inside cells at edges (optional)
- Use newlines inside cells

## Examples

**Simple 2-column table:**
\`\`\`
| Name | Age |
| ---- | --- |
| John | 25  |
| Jane | 30  |
\`\`\`

**With alignment:**
\`\`\`
| Item     | Price   | Quantity |
| :------- | ------: | :------: |
| Apple    | $1.50   | 10       |
| Banana   | $0.75   | 20       |
\`\`\`
`}]}}function fw(){return{contents:[{uri:"lokus://markdown-syntax/code",mimeType:"text/markdown",text:'# Code Syntax\n\n## Inline Code\n\nUse single backticks for inline code:\n\n```\nUse the `console.log()` function to print.\nThe `Array.map()` method is useful.\n```\n\nResult: Use the `console.log()` function to print.\n\n## Code Blocks\n\nUse triple backticks for code blocks:\n\n\\`\\`\\`\nfunction hello() {\n}\n\\`\\`\\`\n\n## Syntax Highlighting\n\nAdd language identifier after opening backticks:\n\n\\`\\`\\`javascript\nfunction greet(name) {\n  return `Hello, ${name}!`;\n}\n\\`\\`\\`\n\n\\`\\`\\`python\ndef greet(name):\n    return f"Hello, {name}!"\n\\`\\`\\`\n\n\\`\\`\\`rust\nfn greet(name: &str) -> String {\n    format!("Hello, {}!", name)\n}\n\\`\\`\\`\n\n## Supported Languages\n\nCommon languages with syntax highlighting:\n- **JavaScript/TypeScript**: `javascript`, `typescript`, `js`, `ts`\n- **Python**: `python`, `py`\n- **Rust**: `rust`, `rs`\n- **Java**: `java`\n- **C/C++**: `c`, `cpp`, `c++`\n- **Go**: `go`\n- **Ruby**: `ruby`, `rb`\n- **PHP**: `php`\n- **Shell**: `bash`, `sh`, `shell`\n- **HTML**: `html`\n- **CSS**: `css`, `scss`, `sass`\n- **SQL**: `sql`\n- **JSON**: `json`\n- **YAML**: `yaml`, `yml`\n- **Markdown**: `markdown`, `md`\n\n## Examples\n\n**JavaScript:**\n\\`\\`\\`javascript\nconst users = [\'Alice\', \'Bob\', \'Charlie\'];\nusers.map(name => `Hello, ${name}!`);\n\\`\\`\\`\n\n**Python:**\n\\`\\`\\`python\nusers = [\'Alice\', \'Bob\', \'Charlie\']\ngreetings = [f"Hello, {name}!" for name in users]\n\\`\\`\\`\n\n**JSON:**\n\\`\\`\\`json\n{\n  "name": "John Doe",\n  "age": 30,\n  "email": "john@example.com"\n}\n\\`\\`\\`\n\n## Tips\n\n\u2705 **Do:**\n- Use specific language identifier for syntax highlighting\n- Keep code properly indented\n- Close code blocks with triple backticks\n\n\u274C **Don\'t:**\n- Forget closing backticks\n- Use 4-space indentation (use triple backticks instead)\n- Nest backticks incorrectly\n'}]}}function pw(){return{contents:[{uri:"lokus://markdown-syntax/lists",mimeType:"text/markdown",text:`# Lists and Tasks

## Unordered Lists

Use \`-\`, \`*\`, or \`+\` for bullet points:

\`\`\`
- Item 1
- Item 2
- Item 3
\`\`\`

Result:
- Item 1
- Item 2
- Item 3

## Ordered Lists

Use numbers followed by period:

\`\`\`
1. First item
2. Second item
3. Third item
\`\`\`

Result:
1. First item
2. Second item
3. Third item

## Nested Lists

Indent with 2-4 spaces:

\`\`\`
- Main item 1
  - Sub item 1.1
  - Sub item 1.2
    - Sub sub item 1.2.1
- Main item 2
  - Sub item 2.1
\`\`\`

Result:
- Main item 1
  - Sub item 1.1
  - Sub item 1.2
    - Sub sub item 1.2.1
- Main item 2
  - Sub item 2.1

## Task Lists (Checkboxes)

Use \`- [ ]\` for unchecked, \`- [x]\` for checked:

\`\`\`
- [ ] Incomplete task
- [x] Completed task
- [ ] Another incomplete task
- [x] Another completed task
\`\`\`

Result:
- [ ] Incomplete task
- [x] Completed task
- [ ] Another incomplete task
- [x] Another completed task

**IMPORTANT:** Space required after \`-\` and inside brackets!

## Mixed Lists

Combine ordered and unordered:

\`\`\`
1. First step
   - Sub-point A
   - Sub-point B
2. Second step
   - Sub-point A
   - Sub-point B
\`\`\`

## Task Lists with Nesting

\`\`\`
- [x] Project setup
  - [x] Initialize repository
  - [x] Install dependencies
- [ ] Development
  - [x] Create components
  - [ ] Write tests
  - [ ] Documentation
\`\`\`

## Tips

\u2705 **Do:**
- Use consistent markers (\`-\` or \`*\` or \`+\`)
- Add space after marker
- Indent nested items consistently
- For tasks: \`[ ]\` or \`[x]\` only

\u274C **Don't:**
- Mix markers in same list
- Forget space: \`-item\` (wrong), \`- item\` (correct)
- Use \`[X]\` (capital X) - use lowercase \`[x]\`
- Use other characters in brackets

## Examples

**Shopping list:**
\`\`\`
- [ ] Groceries
  - [x] Milk
  - [x] Bread
  - [ ] Eggs
- [ ] Hardware store
  - [ ] Screws
  - [ ] Paint
\`\`\`

**Project tasks:**
\`\`\`
1. [x] Planning phase
2. [x] Design phase
3. [ ] Development phase
   - [x] Backend API
   - [ ] Frontend UI
   - [ ] Testing
4. [ ] Deployment
\`\`\`
`}]}}function hw(){return{contents:[{uri:"lokus://markdown-syntax/formatting",mimeType:"text/markdown",text:`# Text Formatting

## Bold

Use double asterisks or double underscores:

\`\`\`
**This is bold text**
__This is also bold__
\`\`\`

Result: **This is bold text**

## Italic

Use single asterisk or single underscore:

\`\`\`
*This is italic text*
_This is also italic_
\`\`\`

Result: *This is italic text*

## Bold + Italic

Combine both:

\`\`\`
***Bold and italic***
___Bold and italic___
**_Bold and italic_**
*__Bold and italic__*
\`\`\`

Result: ***Bold and italic***

## Strikethrough

Use double tildes:

\`\`\`
~~This text is crossed out~~
\`\`\`

Result: ~~This text is crossed out~~

## Highlight

Use double equals signs:

\`\`\`
==This text is highlighted==
\`\`\`

Result: ==This text is highlighted==

## Superscript

Use \`^\` with content between them:

\`\`\`
H^2^O
E = mc^2^
x^2^
\`\`\`

Result: H\xB2O, E = mc\xB2, x\xB2

## Subscript

Use \`~\` with content between them:

\`\`\`
H~2~O
CO~2~
x~i~
\`\`\`

Result: H\u2082O, CO\u2082, x\u1D62

## Combining Formats

You can combine multiple formats:

\`\`\`
**Bold with _italic inside_**
*Italic with **bold inside***
~~Strikethrough with **bold**~~
==Highlight with *italic*==
\`\`\`

## Blockquotes

Use \`>\` for quotes:

\`\`\`
> This is a quote
> It can span multiple lines
\`\`\`

Result:
> This is a quote
> It can span multiple lines

**Nested quotes:**
\`\`\`
> Level 1 quote
>> Level 2 quote
>>> Level 3 quote
\`\`\`

## Horizontal Rules

Use three or more hyphens, asterisks, or underscores:

\`\`\`
---
***
___
\`\`\`

Result:

---

## Line Breaks

Two spaces at end of line or backslash:

\`\`\`
Line 1  
Line 2

OR

Line 1\\
Line 2
\`\`\`

## Escape Characters

Use backslash to escape special characters:

\`\`\`
\\* Not a bullet point
\\** Not bold **
\\# Not a heading
\`\`\`

## Common Combinations

**Chemistry formulas:**
\`\`\`
H~2~O (water)
CO~2~ (carbon dioxide)
C~6~H~12~O~6~ (glucose)
\`\`\`

**Math expressions:**
\`\`\`
x^2^ + y^2^ = z^2^
a~n~ = a~1~ + (n-1)d
\`\`\`

**Emphasized text:**
\`\`\`
**Important:** This is ==critical== information!
*Note:* ~~Old info~~ Updated: **New info**
\`\`\`

## Tips

\u2705 **Do:**
- Use \`**bold**\` for strong emphasis
- Use \`*italic*\` for subtle emphasis
- Use \`==highlight==\` for important points
- Use \`~~strikethrough~~\` for deleted/outdated info

\u274C **Don't:**
- Use spaces: \`** bold **\` (wrong)
- Mix markers: \`*bold**\` (wrong)
- Forget closing markers
- Use \`<u>\` for underline (not supported)
`}]}}function mw(){return{contents:[{uri:"lokus://markdown-syntax/diagrams",mimeType:"text/markdown",text:`# Mermaid Diagrams

Lokus supports Mermaid for creating diagrams using text.

## Flowcharts

\\\`\\\`\\\`mermaid
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Action 1]
    B -->|No| D[Action 2]
    C --> E[End]
    D --> E
\\\`\\\`\\\`

**Direction options:**
- \`graph TD\` - Top to Down
- \`graph LR\` - Left to Right
- \`graph BT\` - Bottom to Top
- \`graph RL\` - Right to Left

## Sequence Diagrams

\\\`\\\`\\\`mermaid
sequenceDiagram
    participant User
    participant App
    participant Server
    
    User->>App: Click button
    App->>Server: Send request
    Server-->>App: Return data
    App-->>User: Display result
\\\`\\\`\\\`

## Class Diagrams

\\\`\\\`\\\`mermaid
classDiagram
    class Animal {
        +String name
        +int age
        +makeSound()
    }
    class Dog {
        +bark()
    }
    class Cat {
        +meow()
    }
    Animal <|-- Dog
    Animal <|-- Cat
\\\`\\\`\\\`

## State Diagrams

\\\`\\\`\\\`mermaid
stateDiagram-v2
    [*] --> Idle
    Idle --> Processing
    Processing --> Success
    Processing --> Error
    Success --> [*]
    Error --> Idle
\\\`\\\`\\\`

## Gantt Charts

\\\`\\\`\\\`mermaid
gantt
    title Project Timeline
    dateFormat  YYYY-MM-DD
    section Planning
    Task 1           :2024-01-01, 30d
    Task 2           :2024-02-01, 20d
    section Development
    Task 3           :2024-02-15, 45d
    Task 4           :2024-03-01, 30d
\\\`\\\`\\\`

## Pie Charts

\\\`\\\`\\\`mermaid
pie
    title Distribution
    "Category A" : 45
    "Category B" : 30
    "Category C" : 25
\\\`\\\`\\\`

## Entity Relationship Diagrams

\\\`\\\`\\\`mermaid
erDiagram
    USER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_ITEM : contains
    PRODUCT ||--o{ ORDER_ITEM : "ordered in"
    
    USER {
        int id
        string name
        string email
    }
    ORDER {
        int id
        date order_date
    }
\\\`\\\`\\\`

## Node Shapes

Different shapes for flowchart nodes:

\\\`\\\`\\\`mermaid
graph LR
    A[Rectangle]
    B(Rounded)
    C([Stadium])
    D[[Subroutine]]
    E[(Database)]
    F((Circle))
    G>Flag]
    H{Diamond}
    I{{Hexagon}}
\\\`\\\`\\\`

## Arrow Types

Different connection styles:

\\\`\\\`\\\`mermaid
graph LR
    A --> B
    C --- D
    E -.-> F
    G ==> H
    I --text--> J
\\\`\\\`\\\`

- \`-->\` Solid arrow
- \`---\` Solid line
- \`-.->

\` Dotted arrow
- \`==>\` Thick arrow
- \`--text-->\` Labeled arrow

## Tips

\u2705 **Do:**
- Use \`\`\`mermaid\`\`\` code block
- Follow Mermaid syntax exactly
- Use meaningful labels
- Keep diagrams simple

\u274C **Don't:**
- Forget closing \`\`\`
- Use invalid Mermaid syntax
- Make diagrams too complex
- Mix diagram types in one block

## Common Use Cases

**Project workflow:**
\\\`\\\`\\\`mermaid
graph TD
    A[Start] --> B[Planning]
    B --> C[Design]
    C --> D[Development]
    D --> E[Testing]
    E --> F{Pass?}
    F -->|Yes| G[Deploy]
    F -->|No| D
    G --> H[End]
\\\`\\\`\\\`

**API interaction:**
\\\`\\\`\\\`mermaid
sequenceDiagram
    Client->>API: POST /login
    API->>Database: Verify credentials
    Database-->>API: User data
    API-->>Client: JWT token
\\\`\\\`\\\`
`}]}}var Fr={defaultWorkspace:(0,ra.join)((0,ms.homedir)(),"Documents","Lokus Workspace"),lokusConfigDir:(0,ra.join)((0,ms.homedir)(),".lokus"),lastWorkspaceFile:(0,ra.join)((0,ms.homedir)(),".lokus","last-workspace.json"),apiUrl:"http://127.0.0.1:3333",port:parseInt(process.argv[2])||3456},ue={info:(...t)=>console.error("[MCP-HTTP]",...t),error:(...t)=>console.error("[MCP-HTTP ERROR]",...t),warn:(...t)=>console.error("[MCP-HTTP WARN]",...t)},Si=class{constructor(){this.currentWorkspace=null,this.apiAvailable=!1}async getWorkspace(){return this.currentWorkspace?this.currentWorkspace:(this.currentWorkspace=await this.getWorkspaceFromAPI(),this.currentWorkspace?(this.apiAvailable=!0,this.currentWorkspace):(this.currentWorkspace=await this.getLastWorkspace(),this.currentWorkspace?this.currentWorkspace:(this.currentWorkspace=await this.getDefaultWorkspace(),this.currentWorkspace)))}async getWorkspaceFromAPI(){try{let e=(await Promise.resolve().then(()=>(rs(),ru))).default,r=await e(`${Fr.apiUrl}/api/workspace`,{timeout:2e3});if(r.ok){let a=await r.json();if(a.success&&a.data)return a.data.workspace}}catch{}return null}async getLastWorkspace(){try{let e=await(0,Wr.readFile)(Fr.lastWorkspaceFile,"utf-8"),r=JSON.parse(e);if(r.workspace)return r.workspace}catch{}return null}async getDefaultWorkspace(){let e=Fr.defaultWorkspace;try{await(0,Wr.access)(e,Rd.constants.F_OK)}catch{await(0,Wr.mkdir)(e,{recursive:!0}),await(0,Wr.mkdir)((0,ra.join)(e,".lokus"),{recursive:!0})}return e}},Cd=new Si,ki=Ed.default.createServer(async(t,e)=>{if(e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type"),t.method==="OPTIONS"){e.writeHead(200),e.end();return}if(t.method==="GET"&&t.url==="/health"){e.writeHead(200,{"Content-Type":"application/json"}),e.end(JSON.stringify({status:"healthy",service:"lokus-mcp-http"}));return}if(t.method==="GET"&&t.url==="/mcp/info"){e.writeHead(200,{"Content-Type":"application/json"}),e.end(JSON.stringify({name:"lokus-mcp-http",version:"1.0.0",transport:"http",tools:xi().length}));return}if(t.method==="POST"&&(t.url==="/mcp"||t.url==="/")){let r="";t.on("data",a=>{r+=a.toString()}),t.on("end",async()=>{try{let a=JSON.parse(r),s=await gw(a);e.writeHead(200,{"Content-Type":"application/json"}),e.end(JSON.stringify(s))}catch(a){ue.error("Request error:",a),e.writeHead(500,{"Content-Type":"application/json"}),e.end(JSON.stringify({jsonrpc:"2.0",error:{code:-32603,message:a.message},id:null}))}});return}e.writeHead(404,{"Content-Type":"application/json"}),e.end(JSON.stringify({error:"Not found"}))}),xi=()=>[...$o,...Io,...Oo,...Do,...Lo,...No,...Mo,...jo,...di,...pi,...mi,...wi];async function gw(t){let{method:e,params:r,id:a}=t;try{if(e==="initialize")return{jsonrpc:"2.0",result:{protocolVersion:"2024-11-05",capabilities:{tools:{},resources:{}},serverInfo:{name:"lokus-mcp-http",version:"1.0.0"}},id:a};if(e==="notifications/initialized")return ue.info("Client initialized successfully"),{jsonrpc:"2.0",result:{},id:a};if(e==="tools/list")return{jsonrpc:"2.0",result:{tools:xi()},id:a};if(e==="tools/call"){let{name:s,arguments:i}=r,c=await Cd.getWorkspace(),u=Cd.apiAvailable?Fr.apiUrl:null;ue.info(`Executing tool: ${s}`);let f;if($o.some(d=>d.name===s))f=await iu(s,i,u);else if(Io.some(d=>d.name===s))f=await du(s,i,c,u);else if(Oo.some(d=>d.name===s))f=await fu(s,i,c,u);else if(Do.some(d=>d.name===s))f=await hu(s,i,c,u);else if(Lo.some(d=>d.name===s))f=await mu(s,i,c,u);else if(No.some(d=>d.name===s))f=await gu(s,i,c,u);else if(Mo.some(d=>d.name===s))f=await yu(s,i,c,u);else if(jo.some(d=>d.name===s))f=await bu(s,i,c,u);else if(di.some(d=>d.name===s)){let d=await fd(s,i);f={content:[{type:"text",text:JSON.stringify(d,null,2)}]}}else if(pi.some(d=>d.name===s))f=await md(s,i,c);else if(mi.some(d=>d.name===s))f=await _d(s,i,c);else if(wi.some(d=>d.name===s))f=await Sd(s,i,c);else throw new Error(`Unknown tool: ${s}`);return{jsonrpc:"2.0",result:f,id:a}}if(e==="resources/list")return{jsonrpc:"2.0",result:{resources:vd},id:a};if(e==="resources/read"){let{uri:s}=r;ue.info(`Reading resource: ${s}`);try{return{jsonrpc:"2.0",result:await Td(s),id:a}}catch(i){return{jsonrpc:"2.0",error:{code:-32603,message:i.message},id:a}}}return{jsonrpc:"2.0",error:{code:-32601,message:`Method not found: ${e}`},id:a}}catch(s){return ue.error("Request failed:",s),{jsonrpc:"2.0",error:{code:-32603,message:s.message},id:a}}}async function yw(){try{ki.listen(Fr.port,"127.0.0.1",()=>{ue.info("==========================================="),ue.info("Lokus MCP HTTP Server v1.0 started"),ue.info(`Port: ${Fr.port}`),ue.info(`URL: http://127.0.0.1:${Fr.port}/mcp`),ue.info(`Tools: ${xi().length}`),ue.info("===========================================")}),process.on("SIGTERM",()=>{ue.info("SIGTERM received, closing server..."),ki.close(()=>{ue.info("Server closed"),process.exit(0)})}),process.on("SIGINT",()=>{ue.info("SIGINT received, closing server..."),ki.close(()=>{ue.info("Server closed"),process.exit(0)})})}catch(t){ue.error("Fatal error:",t),process.exit(1)}}yw();
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)
*/
