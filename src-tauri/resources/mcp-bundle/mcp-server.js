#!/usr/bin/env node
#!/usr/bin/env node
var Np=Object.create;var _o=Object.defineProperty;var Mp=Object.getOwnPropertyDescriptor;var Fp=Object.getOwnPropertyNames;var jp=Object.getPrototypeOf,Wp=Object.prototype.hasOwnProperty;var z=(t,e)=>()=>(t&&(e=t(t=0)),e);var ko=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ie=(t,e)=>{for(var r in e)_o(t,r,{get:e[r],enumerable:!0})},qp=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Fp(e))!Wp.call(t,s)&&s!==r&&_o(t,s,{get:()=>e[s],enumerable:!(n=Mp(e,s))||n.enumerable});return t};var Be=(t,e,r)=>(r=t!=null?Np(jp(t)):{},qp(e||!t||!t.__esModule?_o(r,"default",{value:t,enumerable:!0}):r,t));function qm(t){if(!/^data:/i.test(t))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');t=t.replace(/\r?\n/g,"");let e=t.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let r=t.substring(5,e).split(";"),n="",s=!1,o=r[0]||"text/plain",c=o;for(let m=1;m<r.length;m++)r[m]==="base64"?s=!0:r[m]&&(c+=`;${r[m]}`,r[m].indexOf("charset=")===0&&(n=r[m].substring(8)));!r[0]&&!n.length&&(c+=";charset=US-ASCII",n="US-ASCII");let u=s?"base64":"ascii",f=unescape(t.substring(e+1)),d=Buffer.from(f,u);return d.type=o,d.typeFull=c,d.charset=n,d}var $l,Pl=z(()=>{$l=qm});var Dl=ko((ss,Il)=>{(function(t,e){typeof ss=="object"&&typeof Il<"u"?e(ss):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.WebStreamsPolyfill={}))})(ss,(function(t){"use strict";function e(){}function r(a){return typeof a=="object"&&a!==null||typeof a=="function"}let n=e;function s(a,i){try{Object.defineProperty(a,"name",{value:i,configurable:!0})}catch{}}let o=Promise,c=Promise.prototype.then,u=Promise.reject.bind(o);function f(a){return new o(a)}function d(a){return f(i=>i(a))}function m(a){return u(a)}function w(a,i,l){return c.call(a,i,l)}function k(a,i,l){w(w(a,i,l),void 0,n)}function R(a,i){k(a,i)}function x(a,i){k(a,void 0,i)}function N(a,i,l){return w(a,i,l)}function W(a){w(a,void 0,n)}let P=a=>{if(typeof queueMicrotask=="function")P=queueMicrotask;else{let i=d(void 0);P=l=>w(i,l)}return P(a)};function U(a,i,l){if(typeof a!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(a,i,l)}function re(a,i,l){try{return d(U(a,i,l))}catch(p){return m(p)}}let H=16384;class V{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let l=this._back,p=l;l._elements.length===H-1&&(p={_elements:[],_next:void 0}),l._elements.push(i),p!==l&&(this._back=p,l._next=p),++this._size}shift(){let i=this._front,l=i,p=this._cursor,g=p+1,b=i._elements,_=b[p];return g===H&&(l=i._next,g=0),--this._size,this._cursor=g,i!==l&&(this._front=l),b[p]=void 0,_}forEach(i){let l=this._cursor,p=this._front,g=p._elements;for(;(l!==g.length||p._next!==void 0)&&!(l===g.length&&(p=p._next,g=p._elements,l=0,g.length===0));)i(g[l]),++l}peek(){let i=this._front,l=this._cursor;return i._elements[l]}}let K=Symbol("[[AbortSteps]]"),Dt=Symbol("[[ErrorSteps]]"),_n=Symbol("[[CancelSteps]]"),Ds=Symbol("[[PullSteps]]"),Os=Symbol("[[ReleaseSteps]]");function Hi(a,i){a._ownerReadableStream=i,i._reader=a,i._state==="readable"?Ns(a):i._state==="closed"?Hd(a):Vi(a,i._storedError)}function Ls(a,i){let l=a._ownerReadableStream;return We(l,i)}function pt(a){let i=a._ownerReadableStream;i._state==="readable"?Ms(a,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Vd(a,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[Os](),i._reader=void 0,a._ownerReadableStream=void 0}function ua(a){return new TypeError("Cannot "+a+" a stream using a released reader")}function Ns(a){a._closedPromise=f((i,l)=>{a._closedPromise_resolve=i,a._closedPromise_reject=l})}function Vi(a,i){Ns(a),Ms(a,i)}function Hd(a){Ns(a),Gi(a)}function Ms(a,i){a._closedPromise_reject!==void 0&&(W(a._closedPromise),a._closedPromise_reject(i),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}function Vd(a,i){Vi(a,i)}function Gi(a){a._closedPromise_resolve!==void 0&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}let Ji=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},Gd=Math.trunc||function(a){return a<0?Math.ceil(a):Math.floor(a)};function Jd(a){return typeof a=="object"||typeof a=="function"}function Xe(a,i){if(a!==void 0&&!Jd(a))throw new TypeError(`${i} is not an object.`)}function Ae(a,i){if(typeof a!="function")throw new TypeError(`${i} is not a function.`)}function Zd(a){return typeof a=="object"&&a!==null||typeof a=="function"}function Zi(a,i){if(!Zd(a))throw new TypeError(`${i} is not an object.`)}function ht(a,i,l){if(a===void 0)throw new TypeError(`Parameter ${i} is required in '${l}'.`)}function Fs(a,i,l){if(a===void 0)throw new TypeError(`${i} is required in '${l}'.`)}function js(a){return Number(a)}function Yi(a){return a===0?0:a}function Yd(a){return Yi(Gd(a))}function Ws(a,i){let p=Number.MAX_SAFE_INTEGER,g=Number(a);if(g=Yi(g),!Ji(g))throw new TypeError(`${i} is not a finite number`);if(g=Yd(g),g<0||g>p)throw new TypeError(`${i} is outside the accepted range of 0 to ${p}, inclusive`);return!Ji(g)||g===0?0:g}function qs(a,i){if(!Wt(a))throw new TypeError(`${i} is not a ReadableStream.`)}function Br(a){return new Ot(a)}function Qi(a,i){a._reader._readRequests.push(i)}function Bs(a,i,l){let g=a._reader._readRequests.shift();l?g._closeSteps():g._chunkSteps(i)}function da(a){return a._reader._readRequests.length}function Ki(a){let i=a._reader;return!(i===void 0||!Lt(i))}class Ot{constructor(i){if(ht(i,1,"ReadableStreamDefaultReader"),qs(i,"First parameter"),qt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Hi(this,i),this._readRequests=new V}get closed(){return Lt(this)?this._closedPromise:m(fa("closed"))}cancel(i=void 0){return Lt(this)?this._ownerReadableStream===void 0?m(ua("cancel")):Ls(this,i):m(fa("cancel"))}read(){if(!Lt(this))return m(fa("read"));if(this._ownerReadableStream===void 0)return m(ua("read from"));let i,l,p=f((b,_)=>{i=b,l=_});return kn(this,{_chunkSteps:b=>i({value:b,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:b=>l(b)}),p}releaseLock(){if(!Lt(this))throw fa("releaseLock");this._ownerReadableStream!==void 0&&Qd(this)}}Object.defineProperties(Ot.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(Ot.prototype.cancel,"cancel"),s(Ot.prototype.read,"read"),s(Ot.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ot.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Lt(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_readRequests")?!1:a instanceof Ot}function kn(a,i){let l=a._ownerReadableStream;l._disturbed=!0,l._state==="closed"?i._closeSteps():l._state==="errored"?i._errorSteps(l._storedError):l._readableStreamController[Ds](i)}function Qd(a){pt(a);let i=new TypeError("Reader was released");Xi(a,i)}function Xi(a,i){let l=a._readRequests;a._readRequests=new V,l.forEach(p=>{p._errorSteps(i)})}function fa(a){return new TypeError(`ReadableStreamDefaultReader.prototype.${a} can only be used on a ReadableStreamDefaultReader`)}let Kd=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class ec{constructor(i,l){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=l}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?N(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let l=()=>this._returnSteps(i);return this._ongoingPromise?N(this._ongoingPromise,l,l):l()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,l,p,g=f((_,T)=>{l=_,p=T});return kn(i,{_chunkSteps:_=>{this._ongoingPromise=void 0,P(()=>l({value:_,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,pt(i),l({value:void 0,done:!0})},_errorSteps:_=>{this._ongoingPromise=void 0,this._isFinished=!0,pt(i),p(_)}}),g}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let l=this._reader;if(!this._preventCancel){let p=Ls(l,i);return pt(l),N(p,()=>({value:i,done:!0}))}return pt(l),d({value:i,done:!0})}}let tc={next(){return rc(this)?this._asyncIteratorImpl.next():m(nc("next"))},return(a){return rc(this)?this._asyncIteratorImpl.return(a):m(nc("return"))}};Object.setPrototypeOf(tc,Kd);function Xd(a,i){let l=Br(a),p=new ec(l,i),g=Object.create(tc);return g._asyncIteratorImpl=p,g}function rc(a){if(!r(a)||!Object.prototype.hasOwnProperty.call(a,"_asyncIteratorImpl"))return!1;try{return a._asyncIteratorImpl instanceof ec}catch{return!1}}function nc(a){return new TypeError(`ReadableStreamAsyncIterator.${a} can only be used on a ReadableSteamAsyncIterator`)}let ac=Number.isNaN||function(a){return a!==a};var Us,zs,Hs;function Sn(a){return a.slice()}function sc(a,i,l,p,g){new Uint8Array(a).set(new Uint8Array(l,p,g),i)}let mt=a=>(typeof a.transfer=="function"?mt=i=>i.transfer():typeof structuredClone=="function"?mt=i=>structuredClone(i,{transfer:[i]}):mt=i=>i,mt(a)),Nt=a=>(typeof a.detached=="boolean"?Nt=i=>i.detached:Nt=i=>i.byteLength===0,Nt(a));function oc(a,i,l){if(a.slice)return a.slice(i,l);let p=l-i,g=new ArrayBuffer(p);return sc(g,0,a,i,p),g}function pa(a,i){let l=a[i];if(l!=null){if(typeof l!="function")throw new TypeError(`${String(i)} is not a function`);return l}}function ef(a){let i={[Symbol.iterator]:()=>a.iterator},l=(async function*(){return yield*i})(),p=l.next;return{iterator:l,nextMethod:p,done:!1}}let Vs=(Hs=(Us=Symbol.asyncIterator)!==null&&Us!==void 0?Us:(zs=Symbol.for)===null||zs===void 0?void 0:zs.call(Symbol,"Symbol.asyncIterator"))!==null&&Hs!==void 0?Hs:"@@asyncIterator";function ic(a,i="sync",l){if(l===void 0)if(i==="async"){if(l=pa(a,Vs),l===void 0){let b=pa(a,Symbol.iterator),_=ic(a,"sync",b);return ef(_)}}else l=pa(a,Symbol.iterator);if(l===void 0)throw new TypeError("The object is not iterable");let p=U(l,a,[]);if(!r(p))throw new TypeError("The iterator method must return an object");let g=p.next;return{iterator:p,nextMethod:g,done:!1}}function tf(a){let i=U(a.nextMethod,a.iterator,[]);if(!r(i))throw new TypeError("The iterator.next() method must return an object");return i}function rf(a){return!!a.done}function nf(a){return a.value}function af(a){return!(typeof a!="number"||ac(a)||a<0)}function cc(a){let i=oc(a.buffer,a.byteOffset,a.byteOffset+a.byteLength);return new Uint8Array(i)}function Gs(a){let i=a._queue.shift();return a._queueTotalSize-=i.size,a._queueTotalSize<0&&(a._queueTotalSize=0),i.value}function Js(a,i,l){if(!af(l)||l===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");a._queue.push({value:i,size:l}),a._queueTotalSize+=l}function sf(a){return a._queue.peek().value}function Mt(a){a._queue=new V,a._queueTotalSize=0}function lc(a){return a===DataView}function of(a){return lc(a.constructor)}function cf(a){return lc(a)?1:a.BYTES_PER_ELEMENT}class tr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Zs(this))throw eo("view");return this._view}respond(i){if(!Zs(this))throw eo("respond");if(ht(i,1,"respond"),i=Ws(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Nt(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");ya(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!Zs(this))throw eo("respondWithNewView");if(ht(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Nt(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");ba(this._associatedReadableByteStreamController,i)}}Object.defineProperties(tr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s(tr.prototype.respond,"respond"),s(tr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(tr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class gt{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!rr(this))throw vn("byobRequest");return Xs(this)}get desiredSize(){if(!rr(this))throw vn("desiredSize");return wc(this)}close(){if(!rr(this))throw vn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);xn(this)}enqueue(i){if(!rr(this))throw vn("enqueue");if(ht(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let l=this._controlledReadableByteStream._state;if(l!=="readable")throw new TypeError(`The stream (in ${l} state) is not in the readable state and cannot be enqueued to`);ga(this,i)}error(i=void 0){if(!rr(this))throw vn("error");$e(this,i)}[_n](i){uc(this),Mt(this);let l=this._cancelAlgorithm(i);return ma(this),l}[Ds](i){let l=this._controlledReadableByteStream;if(this._queueTotalSize>0){bc(this,i);return}let p=this._autoAllocateChunkSize;if(p!==void 0){let g;try{g=new ArrayBuffer(p)}catch(_){i._errorSteps(_);return}let b={buffer:g,bufferByteLength:p,byteOffset:0,byteLength:p,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(b)}Qi(l,i),nr(this)}[Os](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new V,this._pendingPullIntos.push(i)}}}Object.defineProperties(gt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(gt.prototype.close,"close"),s(gt.prototype.enqueue,"enqueue"),s(gt.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gt.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function rr(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_controlledReadableByteStream")?!1:a instanceof gt}function Zs(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_associatedReadableByteStreamController")?!1:a instanceof tr}function nr(a){if(!pf(a))return;if(a._pulling){a._pullAgain=!0;return}a._pulling=!0;let l=a._pullAlgorithm();k(l,()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,nr(a)),null),p=>($e(a,p),null))}function uc(a){Qs(a),a._pendingPullIntos=new V}function Ys(a,i){let l=!1;a._state==="closed"&&(l=!0);let p=dc(i);i.readerType==="default"?Bs(a,p,l):wf(a,p,l)}function dc(a){let i=a.bytesFilled,l=a.elementSize;return new a.viewConstructor(a.buffer,a.byteOffset,i/l)}function ha(a,i,l,p){a._queue.push({buffer:i,byteOffset:l,byteLength:p}),a._queueTotalSize+=p}function fc(a,i,l,p){let g;try{g=oc(i,l,l+p)}catch(b){throw $e(a,b),b}ha(a,g,0,p)}function pc(a,i){i.bytesFilled>0&&fc(a,i.buffer,i.byteOffset,i.bytesFilled),Ur(a)}function hc(a,i){let l=Math.min(a._queueTotalSize,i.byteLength-i.bytesFilled),p=i.bytesFilled+l,g=l,b=!1,_=p%i.elementSize,T=p-_;T>=i.minimumFill&&(g=T-i.bytesFilled,b=!0);let O=a._queue;for(;g>0;){let A=O.peek(),L=Math.min(g,A.byteLength),j=i.byteOffset+i.bytesFilled;sc(i.buffer,j,A.buffer,A.byteOffset,L),A.byteLength===L?O.shift():(A.byteOffset+=L,A.byteLength-=L),a._queueTotalSize-=L,mc(a,L,i),g-=L}return b}function mc(a,i,l){l.bytesFilled+=i}function gc(a){a._queueTotalSize===0&&a._closeRequested?(ma(a),$n(a._controlledReadableByteStream)):nr(a)}function Qs(a){a._byobRequest!==null&&(a._byobRequest._associatedReadableByteStreamController=void 0,a._byobRequest._view=null,a._byobRequest=null)}function Ks(a){for(;a._pendingPullIntos.length>0;){if(a._queueTotalSize===0)return;let i=a._pendingPullIntos.peek();hc(a,i)&&(Ur(a),Ys(a._controlledReadableByteStream,i))}}function lf(a){let i=a._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(a._queueTotalSize===0)return;let l=i._readRequests.shift();bc(a,l)}}function uf(a,i,l,p){let g=a._controlledReadableByteStream,b=i.constructor,_=cf(b),{byteOffset:T,byteLength:O}=i,A=l*_,L;try{L=mt(i.buffer)}catch(J){p._errorSteps(J);return}let j={buffer:L,bufferByteLength:L.byteLength,byteOffset:T,byteLength:O,bytesFilled:0,minimumFill:A,elementSize:_,viewConstructor:b,readerType:"byob"};if(a._pendingPullIntos.length>0){a._pendingPullIntos.push(j),Sc(g,p);return}if(g._state==="closed"){let J=new b(j.buffer,j.byteOffset,0);p._closeSteps(J);return}if(a._queueTotalSize>0){if(hc(a,j)){let J=dc(j);gc(a),p._chunkSteps(J);return}if(a._closeRequested){let J=new TypeError("Insufficient bytes to fill elements in the given buffer");$e(a,J),p._errorSteps(J);return}}a._pendingPullIntos.push(j),Sc(g,p),nr(a)}function df(a,i){i.readerType==="none"&&Ur(a);let l=a._controlledReadableByteStream;if(to(l))for(;xc(l)>0;){let p=Ur(a);Ys(l,p)}}function ff(a,i,l){if(mc(a,i,l),l.readerType==="none"){pc(a,l),Ks(a);return}if(l.bytesFilled<l.minimumFill)return;Ur(a);let p=l.bytesFilled%l.elementSize;if(p>0){let g=l.byteOffset+l.bytesFilled;fc(a,l.buffer,g-p,p)}l.bytesFilled-=p,Ys(a._controlledReadableByteStream,l),Ks(a)}function yc(a,i){let l=a._pendingPullIntos.peek();Qs(a),a._controlledReadableByteStream._state==="closed"?df(a,l):ff(a,i,l),nr(a)}function Ur(a){return a._pendingPullIntos.shift()}function pf(a){let i=a._controlledReadableByteStream;return i._state!=="readable"||a._closeRequested||!a._started?!1:!!(Ki(i)&&da(i)>0||to(i)&&xc(i)>0||wc(a)>0)}function ma(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0}function xn(a){let i=a._controlledReadableByteStream;if(!(a._closeRequested||i._state!=="readable")){if(a._queueTotalSize>0){a._closeRequested=!0;return}if(a._pendingPullIntos.length>0){let l=a._pendingPullIntos.peek();if(l.bytesFilled%l.elementSize!==0){let p=new TypeError("Insufficient bytes to fill elements in the given buffer");throw $e(a,p),p}}ma(a),$n(i)}}function ga(a,i){let l=a._controlledReadableByteStream;if(a._closeRequested||l._state!=="readable")return;let{buffer:p,byteOffset:g,byteLength:b}=i;if(Nt(p))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let _=mt(p);if(a._pendingPullIntos.length>0){let T=a._pendingPullIntos.peek();if(Nt(T.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Qs(a),T.buffer=mt(T.buffer),T.readerType==="none"&&pc(a,T)}if(Ki(l))if(lf(a),da(l)===0)ha(a,_,g,b);else{a._pendingPullIntos.length>0&&Ur(a);let T=new Uint8Array(_,g,b);Bs(l,T,!1)}else to(l)?(ha(a,_,g,b),Ks(a)):ha(a,_,g,b);nr(a)}function $e(a,i){let l=a._controlledReadableByteStream;l._state==="readable"&&(uc(a),Mt(a),ma(a),Gc(l,i))}function bc(a,i){let l=a._queue.shift();a._queueTotalSize-=l.byteLength,gc(a);let p=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);i._chunkSteps(p)}function Xs(a){if(a._byobRequest===null&&a._pendingPullIntos.length>0){let i=a._pendingPullIntos.peek(),l=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),p=Object.create(tr.prototype);mf(p,a,l),a._byobRequest=p}return a._byobRequest}function wc(a){let i=a._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:a._strategyHWM-a._queueTotalSize}function ya(a,i){let l=a._pendingPullIntos.peek();if(a._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(l.bytesFilled+i>l.byteLength)throw new RangeError("bytesWritten out of range")}l.buffer=mt(l.buffer),yc(a,i)}function ba(a,i){let l=a._pendingPullIntos.peek();if(a._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(l.byteOffset+l.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(l.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(l.bytesFilled+i.byteLength>l.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let g=i.byteLength;l.buffer=mt(i.buffer),yc(a,g)}function _c(a,i,l,p,g,b,_){i._controlledReadableByteStream=a,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Mt(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=b,i._pullAlgorithm=p,i._cancelAlgorithm=g,i._autoAllocateChunkSize=_,i._pendingPullIntos=new V,a._readableStreamController=i;let T=l();k(d(T),()=>(i._started=!0,nr(i),null),O=>($e(i,O),null))}function hf(a,i,l){let p=Object.create(gt.prototype),g,b,_;i.start!==void 0?g=()=>i.start(p):g=()=>{},i.pull!==void 0?b=()=>i.pull(p):b=()=>d(void 0),i.cancel!==void 0?_=O=>i.cancel(O):_=()=>d(void 0);let T=i.autoAllocateChunkSize;if(T===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");_c(a,p,g,b,_,l,T)}function mf(a,i,l){a._associatedReadableByteStreamController=i,a._view=l}function eo(a){return new TypeError(`ReadableStreamBYOBRequest.prototype.${a} can only be used on a ReadableStreamBYOBRequest`)}function vn(a){return new TypeError(`ReadableByteStreamController.prototype.${a} can only be used on a ReadableByteStreamController`)}function gf(a,i){Xe(a,i);let l=a?.mode;return{mode:l===void 0?void 0:yf(l,`${i} has member 'mode' that`)}}function yf(a,i){if(a=`${a}`,a!=="byob")throw new TypeError(`${i} '${a}' is not a valid enumeration value for ReadableStreamReaderMode`);return a}function bf(a,i){var l;Xe(a,i);let p=(l=a?.min)!==null&&l!==void 0?l:1;return{min:Ws(p,`${i} has member 'min' that`)}}function kc(a){return new Ft(a)}function Sc(a,i){a._reader._readIntoRequests.push(i)}function wf(a,i,l){let g=a._reader._readIntoRequests.shift();l?g._closeSteps(i):g._chunkSteps(i)}function xc(a){return a._reader._readIntoRequests.length}function to(a){let i=a._reader;return!(i===void 0||!ar(i))}class Ft{constructor(i){if(ht(i,1,"ReadableStreamBYOBReader"),qs(i,"First parameter"),qt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!rr(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Hi(this,i),this._readIntoRequests=new V}get closed(){return ar(this)?this._closedPromise:m(wa("closed"))}cancel(i=void 0){return ar(this)?this._ownerReadableStream===void 0?m(ua("cancel")):Ls(this,i):m(wa("cancel"))}read(i,l={}){if(!ar(this))return m(wa("read"));if(!ArrayBuffer.isView(i))return m(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return m(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return m(new TypeError("view's buffer must have non-zero byteLength"));if(Nt(i.buffer))return m(new TypeError("view's buffer has been detached"));let p;try{p=bf(l,"options")}catch(A){return m(A)}let g=p.min;if(g===0)return m(new TypeError("options.min must be greater than 0"));if(of(i)){if(g>i.byteLength)return m(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(g>i.length)return m(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return m(ua("read from"));let b,_,T=f((A,L)=>{b=A,_=L});return vc(this,i,g,{_chunkSteps:A=>b({value:A,done:!1}),_closeSteps:A=>b({value:A,done:!0}),_errorSteps:A=>_(A)}),T}releaseLock(){if(!ar(this))throw wa("releaseLock");this._ownerReadableStream!==void 0&&_f(this)}}Object.defineProperties(Ft.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(Ft.prototype.cancel,"cancel"),s(Ft.prototype.read,"read"),s(Ft.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ft.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function ar(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_readIntoRequests")?!1:a instanceof Ft}function vc(a,i,l,p){let g=a._ownerReadableStream;g._disturbed=!0,g._state==="errored"?p._errorSteps(g._storedError):uf(g._readableStreamController,i,l,p)}function _f(a){pt(a);let i=new TypeError("Reader was released");Tc(a,i)}function Tc(a,i){let l=a._readIntoRequests;a._readIntoRequests=new V,l.forEach(p=>{p._errorSteps(i)})}function wa(a){return new TypeError(`ReadableStreamBYOBReader.prototype.${a} can only be used on a ReadableStreamBYOBReader`)}function Tn(a,i){let{highWaterMark:l}=a;if(l===void 0)return i;if(ac(l)||l<0)throw new RangeError("Invalid highWaterMark");return l}function _a(a){let{size:i}=a;return i||(()=>1)}function ka(a,i){Xe(a,i);let l=a?.highWaterMark,p=a?.size;return{highWaterMark:l===void 0?void 0:js(l),size:p===void 0?void 0:kf(p,`${i} has member 'size' that`)}}function kf(a,i){return Ae(a,i),l=>js(a(l))}function Sf(a,i){Xe(a,i);let l=a?.abort,p=a?.close,g=a?.start,b=a?.type,_=a?.write;return{abort:l===void 0?void 0:xf(l,a,`${i} has member 'abort' that`),close:p===void 0?void 0:vf(p,a,`${i} has member 'close' that`),start:g===void 0?void 0:Tf(g,a,`${i} has member 'start' that`),write:_===void 0?void 0:Cf(_,a,`${i} has member 'write' that`),type:b}}function xf(a,i,l){return Ae(a,l),p=>re(a,i,[p])}function vf(a,i,l){return Ae(a,l),()=>re(a,i,[])}function Tf(a,i,l){return Ae(a,l),p=>U(a,i,[p])}function Cf(a,i,l){return Ae(a,l),(p,g)=>re(a,i,[p,g])}function Cc(a,i){if(!zr(a))throw new TypeError(`${i} is not a WritableStream.`)}function Rf(a){if(typeof a!="object"||a===null)return!1;try{return typeof a.aborted=="boolean"}catch{return!1}}let Ef=typeof AbortController=="function";function Af(){if(Ef)return new AbortController}class jt{constructor(i={},l={}){i===void 0?i=null:Zi(i,"First parameter");let p=ka(l,"Second parameter"),g=Sf(i,"First parameter");if(Ec(this),g.type!==void 0)throw new RangeError("Invalid type is specified");let _=_a(p),T=Tn(p,1);Uf(this,g,T,_)}get locked(){if(!zr(this))throw Ca("locked");return Hr(this)}abort(i=void 0){return zr(this)?Hr(this)?m(new TypeError("Cannot abort a stream that already has a writer")):Sa(this,i):m(Ca("abort"))}close(){return zr(this)?Hr(this)?m(new TypeError("Cannot close a stream that already has a writer")):et(this)?m(new TypeError("Cannot close an already-closing stream")):Ac(this):m(Ca("close"))}getWriter(){if(!zr(this))throw Ca("getWriter");return Rc(this)}}Object.defineProperties(jt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(jt.prototype.abort,"abort"),s(jt.prototype.close,"close"),s(jt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(jt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Rc(a){return new yt(a)}function $f(a,i,l,p,g=1,b=()=>1){let _=Object.create(jt.prototype);Ec(_);let T=Object.create(Vr.prototype);return Lc(_,T,a,i,l,p,g,b),_}function Ec(a){a._state="writable",a._storedError=void 0,a._writer=void 0,a._writableStreamController=void 0,a._writeRequests=new V,a._inFlightWriteRequest=void 0,a._closeRequest=void 0,a._inFlightCloseRequest=void 0,a._pendingAbortRequest=void 0,a._backpressure=!1}function zr(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_writableStreamController")?!1:a instanceof jt}function Hr(a){return a._writer!==void 0}function Sa(a,i){var l;if(a._state==="closed"||a._state==="errored")return d(void 0);a._writableStreamController._abortReason=i,(l=a._writableStreamController._abortController)===null||l===void 0||l.abort(i);let p=a._state;if(p==="closed"||p==="errored")return d(void 0);if(a._pendingAbortRequest!==void 0)return a._pendingAbortRequest._promise;let g=!1;p==="erroring"&&(g=!0,i=void 0);let b=f((_,T)=>{a._pendingAbortRequest={_promise:void 0,_resolve:_,_reject:T,_reason:i,_wasAlreadyErroring:g}});return a._pendingAbortRequest._promise=b,g||no(a,i),b}function Ac(a){let i=a._state;if(i==="closed"||i==="errored")return m(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let l=f((g,b)=>{let _={_resolve:g,_reject:b};a._closeRequest=_}),p=a._writer;return p!==void 0&&a._backpressure&&i==="writable"&&fo(p),zf(a._writableStreamController),l}function Pf(a){return f((l,p)=>{let g={_resolve:l,_reject:p};a._writeRequests.push(g)})}function ro(a,i){if(a._state==="writable"){no(a,i);return}ao(a)}function no(a,i){let l=a._writableStreamController;a._state="erroring",a._storedError=i;let p=a._writer;p!==void 0&&Pc(p,i),!Nf(a)&&l._started&&ao(a)}function ao(a){a._state="errored",a._writableStreamController[Dt]();let i=a._storedError;if(a._writeRequests.forEach(g=>{g._reject(i)}),a._writeRequests=new V,a._pendingAbortRequest===void 0){xa(a);return}let l=a._pendingAbortRequest;if(a._pendingAbortRequest=void 0,l._wasAlreadyErroring){l._reject(i),xa(a);return}let p=a._writableStreamController[K](l._reason);k(p,()=>(l._resolve(),xa(a),null),g=>(l._reject(g),xa(a),null))}function If(a){a._inFlightWriteRequest._resolve(void 0),a._inFlightWriteRequest=void 0}function Df(a,i){a._inFlightWriteRequest._reject(i),a._inFlightWriteRequest=void 0,ro(a,i)}function Of(a){a._inFlightCloseRequest._resolve(void 0),a._inFlightCloseRequest=void 0,a._state==="erroring"&&(a._storedError=void 0,a._pendingAbortRequest!==void 0&&(a._pendingAbortRequest._resolve(),a._pendingAbortRequest=void 0)),a._state="closed";let l=a._writer;l!==void 0&&jc(l)}function Lf(a,i){a._inFlightCloseRequest._reject(i),a._inFlightCloseRequest=void 0,a._pendingAbortRequest!==void 0&&(a._pendingAbortRequest._reject(i),a._pendingAbortRequest=void 0),ro(a,i)}function et(a){return!(a._closeRequest===void 0&&a._inFlightCloseRequest===void 0)}function Nf(a){return!(a._inFlightWriteRequest===void 0&&a._inFlightCloseRequest===void 0)}function Mf(a){a._inFlightCloseRequest=a._closeRequest,a._closeRequest=void 0}function Ff(a){a._inFlightWriteRequest=a._writeRequests.shift()}function xa(a){a._closeRequest!==void 0&&(a._closeRequest._reject(a._storedError),a._closeRequest=void 0);let i=a._writer;i!==void 0&&lo(i,a._storedError)}function so(a,i){let l=a._writer;l!==void 0&&i!==a._backpressure&&(i?Qf(l):fo(l)),a._backpressure=i}class yt{constructor(i){if(ht(i,1,"WritableStreamDefaultWriter"),Cc(i,"First parameter"),Hr(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let l=i._state;if(l==="writable")!et(i)&&i._backpressure?Ea(this):Wc(this),Ra(this);else if(l==="erroring")uo(this,i._storedError),Ra(this);else if(l==="closed")Wc(this),Zf(this);else{let p=i._storedError;uo(this,p),Fc(this,p)}}get closed(){return sr(this)?this._closedPromise:m(or("closed"))}get desiredSize(){if(!sr(this))throw or("desiredSize");if(this._ownerWritableStream===void 0)throw Rn("desiredSize");return Bf(this)}get ready(){return sr(this)?this._readyPromise:m(or("ready"))}abort(i=void 0){return sr(this)?this._ownerWritableStream===void 0?m(Rn("abort")):jf(this,i):m(or("abort"))}close(){if(!sr(this))return m(or("close"));let i=this._ownerWritableStream;return i===void 0?m(Rn("close")):et(i)?m(new TypeError("Cannot close an already-closing stream")):$c(this)}releaseLock(){if(!sr(this))throw or("releaseLock");this._ownerWritableStream!==void 0&&Ic(this)}write(i=void 0){return sr(this)?this._ownerWritableStream===void 0?m(Rn("write to")):Dc(this,i):m(or("write"))}}Object.defineProperties(yt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(yt.prototype.abort,"abort"),s(yt.prototype.close,"close"),s(yt.prototype.releaseLock,"releaseLock"),s(yt.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(yt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function sr(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_ownerWritableStream")?!1:a instanceof yt}function jf(a,i){let l=a._ownerWritableStream;return Sa(l,i)}function $c(a){let i=a._ownerWritableStream;return Ac(i)}function Wf(a){let i=a._ownerWritableStream,l=i._state;return et(i)||l==="closed"?d(void 0):l==="errored"?m(i._storedError):$c(a)}function qf(a,i){a._closedPromiseState==="pending"?lo(a,i):Yf(a,i)}function Pc(a,i){a._readyPromiseState==="pending"?qc(a,i):Kf(a,i)}function Bf(a){let i=a._ownerWritableStream,l=i._state;return l==="errored"||l==="erroring"?null:l==="closed"?0:Nc(i._writableStreamController)}function Ic(a){let i=a._ownerWritableStream,l=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Pc(a,l),qf(a,l),i._writer=void 0,a._ownerWritableStream=void 0}function Dc(a,i){let l=a._ownerWritableStream,p=l._writableStreamController,g=Hf(p,i);if(l!==a._ownerWritableStream)return m(Rn("write to"));let b=l._state;if(b==="errored")return m(l._storedError);if(et(l)||b==="closed")return m(new TypeError("The stream is closing or closed and cannot be written to"));if(b==="erroring")return m(l._storedError);let _=Pf(l);return Vf(p,i,g),_}let Oc={};class Vr{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!oo(this))throw co("abortReason");return this._abortReason}get signal(){if(!oo(this))throw co("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!oo(this))throw co("error");this._controlledWritableStream._state==="writable"&&Mc(this,i)}[K](i){let l=this._abortAlgorithm(i);return va(this),l}[Dt](){Mt(this)}}Object.defineProperties(Vr.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Vr.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function oo(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_controlledWritableStream")?!1:a instanceof Vr}function Lc(a,i,l,p,g,b,_,T){i._controlledWritableStream=a,a._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Mt(i),i._abortReason=void 0,i._abortController=Af(),i._started=!1,i._strategySizeAlgorithm=T,i._strategyHWM=_,i._writeAlgorithm=p,i._closeAlgorithm=g,i._abortAlgorithm=b;let O=io(i);so(a,O);let A=l(),L=d(A);k(L,()=>(i._started=!0,Ta(i),null),j=>(i._started=!0,ro(a,j),null))}function Uf(a,i,l,p){let g=Object.create(Vr.prototype),b,_,T,O;i.start!==void 0?b=()=>i.start(g):b=()=>{},i.write!==void 0?_=A=>i.write(A,g):_=()=>d(void 0),i.close!==void 0?T=()=>i.close():T=()=>d(void 0),i.abort!==void 0?O=A=>i.abort(A):O=()=>d(void 0),Lc(a,g,b,_,T,O,l,p)}function va(a){a._writeAlgorithm=void 0,a._closeAlgorithm=void 0,a._abortAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function zf(a){Js(a,Oc,0),Ta(a)}function Hf(a,i){try{return a._strategySizeAlgorithm(i)}catch(l){return Cn(a,l),1}}function Nc(a){return a._strategyHWM-a._queueTotalSize}function Vf(a,i,l){try{Js(a,i,l)}catch(g){Cn(a,g);return}let p=a._controlledWritableStream;if(!et(p)&&p._state==="writable"){let g=io(a);so(p,g)}Ta(a)}function Ta(a){let i=a._controlledWritableStream;if(!a._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){ao(i);return}if(a._queue.length===0)return;let p=sf(a);p===Oc?Gf(a):Jf(a,p)}function Cn(a,i){a._controlledWritableStream._state==="writable"&&Mc(a,i)}function Gf(a){let i=a._controlledWritableStream;Mf(i),Gs(a);let l=a._closeAlgorithm();va(a),k(l,()=>(Of(i),null),p=>(Lf(i,p),null))}function Jf(a,i){let l=a._controlledWritableStream;Ff(l);let p=a._writeAlgorithm(i);k(p,()=>{If(l);let g=l._state;if(Gs(a),!et(l)&&g==="writable"){let b=io(a);so(l,b)}return Ta(a),null},g=>(l._state==="writable"&&va(a),Df(l,g),null))}function io(a){return Nc(a)<=0}function Mc(a,i){let l=a._controlledWritableStream;va(a),no(l,i)}function Ca(a){return new TypeError(`WritableStream.prototype.${a} can only be used on a WritableStream`)}function co(a){return new TypeError(`WritableStreamDefaultController.prototype.${a} can only be used on a WritableStreamDefaultController`)}function or(a){return new TypeError(`WritableStreamDefaultWriter.prototype.${a} can only be used on a WritableStreamDefaultWriter`)}function Rn(a){return new TypeError("Cannot "+a+" a stream using a released writer")}function Ra(a){a._closedPromise=f((i,l)=>{a._closedPromise_resolve=i,a._closedPromise_reject=l,a._closedPromiseState="pending"})}function Fc(a,i){Ra(a),lo(a,i)}function Zf(a){Ra(a),jc(a)}function lo(a,i){a._closedPromise_reject!==void 0&&(W(a._closedPromise),a._closedPromise_reject(i),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="rejected")}function Yf(a,i){Fc(a,i)}function jc(a){a._closedPromise_resolve!==void 0&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="resolved")}function Ea(a){a._readyPromise=f((i,l)=>{a._readyPromise_resolve=i,a._readyPromise_reject=l}),a._readyPromiseState="pending"}function uo(a,i){Ea(a),qc(a,i)}function Wc(a){Ea(a),fo(a)}function qc(a,i){a._readyPromise_reject!==void 0&&(W(a._readyPromise),a._readyPromise_reject(i),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="rejected")}function Qf(a){Ea(a)}function Kf(a,i){uo(a,i)}function fo(a){a._readyPromise_resolve!==void 0&&(a._readyPromise_resolve(void 0),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="fulfilled")}function Xf(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let po=Xf();function ep(a){if(!(typeof a=="function"||typeof a=="object")||a.name!=="DOMException")return!1;try{return new a,!0}catch{return!1}}function tp(){let a=po?.DOMException;return ep(a)?a:void 0}function rp(){let a=function(l,p){this.message=l||"",this.name=p||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(a,"DOMException"),a.prototype=Object.create(Error.prototype),Object.defineProperty(a.prototype,"constructor",{value:a,writable:!0,configurable:!0}),a}let np=tp()||rp();function Bc(a,i,l,p,g,b){let _=Br(a),T=Rc(i);a._disturbed=!0;let O=!1,A=d(void 0);return f((L,j)=>{let J;if(b!==void 0){if(J=()=>{let $=b.reason!==void 0?b.reason:new np("Aborted","AbortError"),B=[];p||B.push(()=>i._state==="writable"?Sa(i,$):d(void 0)),g||B.push(()=>a._state==="readable"?We(a,$):d(void 0)),me(()=>Promise.all(B.map(Y=>Y())),!0,$)},b.aborted){J();return}b.addEventListener("abort",J)}function qe(){return f(($,B)=>{function Y(ke){ke?$():w(Yr(),Y,B)}Y(!1)})}function Yr(){return O?d(!0):w(T._readyPromise,()=>f(($,B)=>{kn(_,{_chunkSteps:Y=>{A=w(Dc(T,Y),void 0,e),$(!1)},_closeSteps:()=>$(!0),_errorSteps:B})}))}if(wt(a,_._closedPromise,$=>(p?Pe(!0,$):me(()=>Sa(i,$),!0,$),null)),wt(i,T._closedPromise,$=>(g?Pe(!0,$):me(()=>We(a,$),!0,$),null)),de(a,_._closedPromise,()=>(l?Pe():me(()=>Wf(T)),null)),et(i)||i._state==="closed"){let $=new TypeError("the destination writable stream closed before all data could be piped to it");g?Pe(!0,$):me(()=>We(a,$),!0,$)}W(qe());function Ut(){let $=A;return w(A,()=>$!==A?Ut():void 0)}function wt($,B,Y){$._state==="errored"?Y($._storedError):x(B,Y)}function de($,B,Y){$._state==="closed"?Y():R(B,Y)}function me($,B,Y){if(O)return;O=!0,i._state==="writable"&&!et(i)?R(Ut(),ke):ke();function ke(){return k($(),()=>_t(B,Y),Qr=>_t(!0,Qr)),null}}function Pe($,B){O||(O=!0,i._state==="writable"&&!et(i)?R(Ut(),()=>_t($,B)):_t($,B))}function _t($,B){return Ic(T),pt(_),b!==void 0&&b.removeEventListener("abort",J),$?j(B):L(void 0),null}})}class bt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Aa(this))throw Pa("desiredSize");return ho(this)}close(){if(!Aa(this))throw Pa("close");if(!Jr(this))throw new TypeError("The stream is not in a state that permits close");ir(this)}enqueue(i=void 0){if(!Aa(this))throw Pa("enqueue");if(!Jr(this))throw new TypeError("The stream is not in a state that permits enqueue");return Gr(this,i)}error(i=void 0){if(!Aa(this))throw Pa("error");je(this,i)}[_n](i){Mt(this);let l=this._cancelAlgorithm(i);return $a(this),l}[Ds](i){let l=this._controlledReadableStream;if(this._queue.length>0){let p=Gs(this);this._closeRequested&&this._queue.length===0?($a(this),$n(l)):En(this),i._chunkSteps(p)}else Qi(l,i),En(this)}[Os](){}}Object.defineProperties(bt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(bt.prototype.close,"close"),s(bt.prototype.enqueue,"enqueue"),s(bt.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(bt.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Aa(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_controlledReadableStream")?!1:a instanceof bt}function En(a){if(!Uc(a))return;if(a._pulling){a._pullAgain=!0;return}a._pulling=!0;let l=a._pullAlgorithm();k(l,()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,En(a)),null),p=>(je(a,p),null))}function Uc(a){let i=a._controlledReadableStream;return!Jr(a)||!a._started?!1:!!(qt(i)&&da(i)>0||ho(a)>0)}function $a(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function ir(a){if(!Jr(a))return;let i=a._controlledReadableStream;a._closeRequested=!0,a._queue.length===0&&($a(a),$n(i))}function Gr(a,i){if(!Jr(a))return;let l=a._controlledReadableStream;if(qt(l)&&da(l)>0)Bs(l,i,!1);else{let p;try{p=a._strategySizeAlgorithm(i)}catch(g){throw je(a,g),g}try{Js(a,i,p)}catch(g){throw je(a,g),g}}En(a)}function je(a,i){let l=a._controlledReadableStream;l._state==="readable"&&(Mt(a),$a(a),Gc(l,i))}function ho(a){let i=a._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:a._strategyHWM-a._queueTotalSize}function ap(a){return!Uc(a)}function Jr(a){let i=a._controlledReadableStream._state;return!a._closeRequested&&i==="readable"}function zc(a,i,l,p,g,b,_){i._controlledReadableStream=a,i._queue=void 0,i._queueTotalSize=void 0,Mt(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=_,i._strategyHWM=b,i._pullAlgorithm=p,i._cancelAlgorithm=g,a._readableStreamController=i;let T=l();k(d(T),()=>(i._started=!0,En(i),null),O=>(je(i,O),null))}function sp(a,i,l,p){let g=Object.create(bt.prototype),b,_,T;i.start!==void 0?b=()=>i.start(g):b=()=>{},i.pull!==void 0?_=()=>i.pull(g):_=()=>d(void 0),i.cancel!==void 0?T=O=>i.cancel(O):T=()=>d(void 0),zc(a,g,b,_,T,l,p)}function Pa(a){return new TypeError(`ReadableStreamDefaultController.prototype.${a} can only be used on a ReadableStreamDefaultController`)}function op(a,i){return rr(a._readableStreamController)?cp(a):ip(a)}function ip(a,i){let l=Br(a),p=!1,g=!1,b=!1,_=!1,T,O,A,L,j,J=f(de=>{j=de});function qe(){return p?(g=!0,d(void 0)):(p=!0,kn(l,{_chunkSteps:me=>{P(()=>{g=!1;let Pe=me,_t=me;b||Gr(A._readableStreamController,Pe),_||Gr(L._readableStreamController,_t),p=!1,g&&qe()})},_closeSteps:()=>{p=!1,b||ir(A._readableStreamController),_||ir(L._readableStreamController),(!b||!_)&&j(void 0)},_errorSteps:()=>{p=!1}}),d(void 0))}function Yr(de){if(b=!0,T=de,_){let me=Sn([T,O]),Pe=We(a,me);j(Pe)}return J}function Ut(de){if(_=!0,O=de,b){let me=Sn([T,O]),Pe=We(a,me);j(Pe)}return J}function wt(){}return A=An(wt,qe,Yr),L=An(wt,qe,Ut),x(l._closedPromise,de=>(je(A._readableStreamController,de),je(L._readableStreamController,de),(!b||!_)&&j(void 0),null)),[A,L]}function cp(a){let i=Br(a),l=!1,p=!1,g=!1,b=!1,_=!1,T,O,A,L,j,J=f($=>{j=$});function qe($){x($._closedPromise,B=>($!==i||($e(A._readableStreamController,B),$e(L._readableStreamController,B),(!b||!_)&&j(void 0)),null))}function Yr(){ar(i)&&(pt(i),i=Br(a),qe(i)),kn(i,{_chunkSteps:B=>{P(()=>{p=!1,g=!1;let Y=B,ke=B;if(!b&&!_)try{ke=cc(B)}catch(Qr){$e(A._readableStreamController,Qr),$e(L._readableStreamController,Qr),j(We(a,Qr));return}b||ga(A._readableStreamController,Y),_||ga(L._readableStreamController,ke),l=!1,p?wt():g&&de()})},_closeSteps:()=>{l=!1,b||xn(A._readableStreamController),_||xn(L._readableStreamController),A._readableStreamController._pendingPullIntos.length>0&&ya(A._readableStreamController,0),L._readableStreamController._pendingPullIntos.length>0&&ya(L._readableStreamController,0),(!b||!_)&&j(void 0)},_errorSteps:()=>{l=!1}})}function Ut($,B){Lt(i)&&(pt(i),i=kc(a),qe(i));let Y=B?L:A,ke=B?A:L;vc(i,$,1,{_chunkSteps:Kr=>{P(()=>{p=!1,g=!1;let Xr=B?_:b;if(B?b:_)Xr||ba(Y._readableStreamController,Kr);else{let ol;try{ol=cc(Kr)}catch(wo){$e(Y._readableStreamController,wo),$e(ke._readableStreamController,wo),j(We(a,wo));return}Xr||ba(Y._readableStreamController,Kr),ga(ke._readableStreamController,ol)}l=!1,p?wt():g&&de()})},_closeSteps:Kr=>{l=!1;let Xr=B?_:b,ja=B?b:_;Xr||xn(Y._readableStreamController),ja||xn(ke._readableStreamController),Kr!==void 0&&(Xr||ba(Y._readableStreamController,Kr),!ja&&ke._readableStreamController._pendingPullIntos.length>0&&ya(ke._readableStreamController,0)),(!Xr||!ja)&&j(void 0)},_errorSteps:()=>{l=!1}})}function wt(){if(l)return p=!0,d(void 0);l=!0;let $=Xs(A._readableStreamController);return $===null?Yr():Ut($._view,!1),d(void 0)}function de(){if(l)return g=!0,d(void 0);l=!0;let $=Xs(L._readableStreamController);return $===null?Yr():Ut($._view,!0),d(void 0)}function me($){if(b=!0,T=$,_){let B=Sn([T,O]),Y=We(a,B);j(Y)}return J}function Pe($){if(_=!0,O=$,b){let B=Sn([T,O]),Y=We(a,B);j(Y)}return J}function _t(){}return A=Vc(_t,wt,me),L=Vc(_t,de,Pe),qe(i),[A,L]}function lp(a){return r(a)&&typeof a.getReader<"u"}function up(a){return lp(a)?fp(a.getReader()):dp(a)}function dp(a){let i,l=ic(a,"async"),p=e;function g(){let _;try{_=tf(l)}catch(O){return m(O)}let T=d(_);return N(T,O=>{if(!r(O))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(rf(O))ir(i._readableStreamController);else{let L=nf(O);Gr(i._readableStreamController,L)}})}function b(_){let T=l.iterator,O;try{O=pa(T,"return")}catch(j){return m(j)}if(O===void 0)return d(void 0);let A;try{A=U(O,T,[_])}catch(j){return m(j)}let L=d(A);return N(L,j=>{if(!r(j))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=An(p,g,b,0),i}function fp(a){let i,l=e;function p(){let b;try{b=a.read()}catch(_){return m(_)}return N(b,_=>{if(!r(_))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(_.done)ir(i._readableStreamController);else{let T=_.value;Gr(i._readableStreamController,T)}})}function g(b){try{return d(a.cancel(b))}catch(_){return m(_)}}return i=An(l,p,g,0),i}function pp(a,i){Xe(a,i);let l=a,p=l?.autoAllocateChunkSize,g=l?.cancel,b=l?.pull,_=l?.start,T=l?.type;return{autoAllocateChunkSize:p===void 0?void 0:Ws(p,`${i} has member 'autoAllocateChunkSize' that`),cancel:g===void 0?void 0:hp(g,l,`${i} has member 'cancel' that`),pull:b===void 0?void 0:mp(b,l,`${i} has member 'pull' that`),start:_===void 0?void 0:gp(_,l,`${i} has member 'start' that`),type:T===void 0?void 0:yp(T,`${i} has member 'type' that`)}}function hp(a,i,l){return Ae(a,l),p=>re(a,i,[p])}function mp(a,i,l){return Ae(a,l),p=>re(a,i,[p])}function gp(a,i,l){return Ae(a,l),p=>U(a,i,[p])}function yp(a,i){if(a=`${a}`,a!=="bytes")throw new TypeError(`${i} '${a}' is not a valid enumeration value for ReadableStreamType`);return a}function bp(a,i){return Xe(a,i),{preventCancel:!!a?.preventCancel}}function Hc(a,i){Xe(a,i);let l=a?.preventAbort,p=a?.preventCancel,g=a?.preventClose,b=a?.signal;return b!==void 0&&wp(b,`${i} has member 'signal' that`),{preventAbort:!!l,preventCancel:!!p,preventClose:!!g,signal:b}}function wp(a,i){if(!Rf(a))throw new TypeError(`${i} is not an AbortSignal.`)}function _p(a,i){Xe(a,i);let l=a?.readable;Fs(l,"readable","ReadableWritablePair"),qs(l,`${i} has member 'readable' that`);let p=a?.writable;return Fs(p,"writable","ReadableWritablePair"),Cc(p,`${i} has member 'writable' that`),{readable:l,writable:p}}class ie{constructor(i={},l={}){i===void 0?i=null:Zi(i,"First parameter");let p=ka(l,"Second parameter"),g=pp(i,"First parameter");if(mo(this),g.type==="bytes"){if(p.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let b=Tn(p,0);hf(this,g,b)}else{let b=_a(p),_=Tn(p,1);sp(this,g,_,b)}}get locked(){if(!Wt(this))throw cr("locked");return qt(this)}cancel(i=void 0){return Wt(this)?qt(this)?m(new TypeError("Cannot cancel a stream that already has a reader")):We(this,i):m(cr("cancel"))}getReader(i=void 0){if(!Wt(this))throw cr("getReader");return gf(i,"First parameter").mode===void 0?Br(this):kc(this)}pipeThrough(i,l={}){if(!Wt(this))throw cr("pipeThrough");ht(i,1,"pipeThrough");let p=_p(i,"First parameter"),g=Hc(l,"Second parameter");if(qt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Hr(p.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let b=Bc(this,p.writable,g.preventClose,g.preventAbort,g.preventCancel,g.signal);return W(b),p.readable}pipeTo(i,l={}){if(!Wt(this))return m(cr("pipeTo"));if(i===void 0)return m("Parameter 1 is required in 'pipeTo'.");if(!zr(i))return m(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let p;try{p=Hc(l,"Second parameter")}catch(g){return m(g)}return qt(this)?m(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Hr(i)?m(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Bc(this,i,p.preventClose,p.preventAbort,p.preventCancel,p.signal)}tee(){if(!Wt(this))throw cr("tee");let i=op(this);return Sn(i)}values(i=void 0){if(!Wt(this))throw cr("values");let l=bp(i,"First parameter");return Xd(this,l.preventCancel)}[Vs](i){return this.values(i)}static from(i){return up(i)}}Object.defineProperties(ie,{from:{enumerable:!0}}),Object.defineProperties(ie.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s(ie.from,"from"),s(ie.prototype.cancel,"cancel"),s(ie.prototype.getReader,"getReader"),s(ie.prototype.pipeThrough,"pipeThrough"),s(ie.prototype.pipeTo,"pipeTo"),s(ie.prototype.tee,"tee"),s(ie.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ie.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ie.prototype,Vs,{value:ie.prototype.values,writable:!0,configurable:!0});function An(a,i,l,p=1,g=()=>1){let b=Object.create(ie.prototype);mo(b);let _=Object.create(bt.prototype);return zc(b,_,a,i,l,p,g),b}function Vc(a,i,l){let p=Object.create(ie.prototype);mo(p);let g=Object.create(gt.prototype);return _c(p,g,a,i,l,0,void 0),p}function mo(a){a._state="readable",a._reader=void 0,a._storedError=void 0,a._disturbed=!1}function Wt(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_readableStreamController")?!1:a instanceof ie}function qt(a){return a._reader!==void 0}function We(a,i){if(a._disturbed=!0,a._state==="closed")return d(void 0);if(a._state==="errored")return m(a._storedError);$n(a);let l=a._reader;if(l!==void 0&&ar(l)){let g=l._readIntoRequests;l._readIntoRequests=new V,g.forEach(b=>{b._closeSteps(void 0)})}let p=a._readableStreamController[_n](i);return N(p,e)}function $n(a){a._state="closed";let i=a._reader;if(i!==void 0&&(Gi(i),Lt(i))){let l=i._readRequests;i._readRequests=new V,l.forEach(p=>{p._closeSteps()})}}function Gc(a,i){a._state="errored",a._storedError=i;let l=a._reader;l!==void 0&&(Ms(l,i),Lt(l)?Xi(l,i):Tc(l,i))}function cr(a){return new TypeError(`ReadableStream.prototype.${a} can only be used on a ReadableStream`)}function Jc(a,i){Xe(a,i);let l=a?.highWaterMark;return Fs(l,"highWaterMark","QueuingStrategyInit"),{highWaterMark:js(l)}}let Zc=a=>a.byteLength;s(Zc,"size");class Ia{constructor(i){ht(i,1,"ByteLengthQueuingStrategy"),i=Jc(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Qc(this))throw Yc("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Qc(this))throw Yc("size");return Zc}}Object.defineProperties(Ia.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ia.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Yc(a){return new TypeError(`ByteLengthQueuingStrategy.prototype.${a} can only be used on a ByteLengthQueuingStrategy`)}function Qc(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_byteLengthQueuingStrategyHighWaterMark")?!1:a instanceof Ia}let Kc=()=>1;s(Kc,"size");class Da{constructor(i){ht(i,1,"CountQueuingStrategy"),i=Jc(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!el(this))throw Xc("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!el(this))throw Xc("size");return Kc}}Object.defineProperties(Da.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Da.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Xc(a){return new TypeError(`CountQueuingStrategy.prototype.${a} can only be used on a CountQueuingStrategy`)}function el(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_countQueuingStrategyHighWaterMark")?!1:a instanceof Da}function kp(a,i){Xe(a,i);let l=a?.cancel,p=a?.flush,g=a?.readableType,b=a?.start,_=a?.transform,T=a?.writableType;return{cancel:l===void 0?void 0:Tp(l,a,`${i} has member 'cancel' that`),flush:p===void 0?void 0:Sp(p,a,`${i} has member 'flush' that`),readableType:g,start:b===void 0?void 0:xp(b,a,`${i} has member 'start' that`),transform:_===void 0?void 0:vp(_,a,`${i} has member 'transform' that`),writableType:T}}function Sp(a,i,l){return Ae(a,l),p=>re(a,i,[p])}function xp(a,i,l){return Ae(a,l),p=>U(a,i,[p])}function vp(a,i,l){return Ae(a,l),(p,g)=>re(a,i,[p,g])}function Tp(a,i,l){return Ae(a,l),p=>re(a,i,[p])}class Oa{constructor(i={},l={},p={}){i===void 0&&(i=null);let g=ka(l,"Second parameter"),b=ka(p,"Third parameter"),_=kp(i,"First parameter");if(_.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(_.writableType!==void 0)throw new RangeError("Invalid writableType specified");let T=Tn(b,0),O=_a(b),A=Tn(g,1),L=_a(g),j,J=f(qe=>{j=qe});Cp(this,J,A,L,T,O),Ep(this,_),_.start!==void 0?j(_.start(this._transformStreamController)):j(void 0)}get readable(){if(!tl(this))throw sl("readable");return this._readable}get writable(){if(!tl(this))throw sl("writable");return this._writable}}Object.defineProperties(Oa.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Oa.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Cp(a,i,l,p,g,b){function _(){return i}function T(J){return Pp(a,J)}function O(J){return Ip(a,J)}function A(){return Dp(a)}a._writable=$f(_,T,A,O,l,p);function L(){return Op(a)}function j(J){return Lp(a,J)}a._readable=An(_,L,j,g,b),a._backpressure=void 0,a._backpressureChangePromise=void 0,a._backpressureChangePromise_resolve=void 0,La(a,!0),a._transformStreamController=void 0}function tl(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_transformStreamController")?!1:a instanceof Oa}function rl(a,i){je(a._readable._readableStreamController,i),go(a,i)}function go(a,i){Ma(a._transformStreamController),Cn(a._writable._writableStreamController,i),yo(a)}function yo(a){a._backpressure&&La(a,!1)}function La(a,i){a._backpressureChangePromise!==void 0&&a._backpressureChangePromise_resolve(),a._backpressureChangePromise=f(l=>{a._backpressureChangePromise_resolve=l}),a._backpressure=i}class Bt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Na(this))throw Fa("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return ho(i)}enqueue(i=void 0){if(!Na(this))throw Fa("enqueue");nl(this,i)}error(i=void 0){if(!Na(this))throw Fa("error");Ap(this,i)}terminate(){if(!Na(this))throw Fa("terminate");$p(this)}}Object.defineProperties(Bt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Bt.prototype.enqueue,"enqueue"),s(Bt.prototype.error,"error"),s(Bt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Bt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Na(a){return!r(a)||!Object.prototype.hasOwnProperty.call(a,"_controlledTransformStream")?!1:a instanceof Bt}function Rp(a,i,l,p,g){i._controlledTransformStream=a,a._transformStreamController=i,i._transformAlgorithm=l,i._flushAlgorithm=p,i._cancelAlgorithm=g,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function Ep(a,i){let l=Object.create(Bt.prototype),p,g,b;i.transform!==void 0?p=_=>i.transform(_,l):p=_=>{try{return nl(l,_),d(void 0)}catch(T){return m(T)}},i.flush!==void 0?g=()=>i.flush(l):g=()=>d(void 0),i.cancel!==void 0?b=_=>i.cancel(_):b=()=>d(void 0),Rp(a,l,p,g,b)}function Ma(a){a._transformAlgorithm=void 0,a._flushAlgorithm=void 0,a._cancelAlgorithm=void 0}function nl(a,i){let l=a._controlledTransformStream,p=l._readable._readableStreamController;if(!Jr(p))throw new TypeError("Readable side is not in a state that permits enqueue");try{Gr(p,i)}catch(b){throw go(l,b),l._readable._storedError}ap(p)!==l._backpressure&&La(l,!0)}function Ap(a,i){rl(a._controlledTransformStream,i)}function al(a,i){let l=a._transformAlgorithm(i);return N(l,void 0,p=>{throw rl(a._controlledTransformStream,p),p})}function $p(a){let i=a._controlledTransformStream,l=i._readable._readableStreamController;ir(l);let p=new TypeError("TransformStream terminated");go(i,p)}function Pp(a,i){let l=a._transformStreamController;if(a._backpressure){let p=a._backpressureChangePromise;return N(p,()=>{let g=a._writable;if(g._state==="erroring")throw g._storedError;return al(l,i)})}return al(l,i)}function Ip(a,i){let l=a._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=a._readable;l._finishPromise=f((b,_)=>{l._finishPromise_resolve=b,l._finishPromise_reject=_});let g=l._cancelAlgorithm(i);return Ma(l),k(g,()=>(p._state==="errored"?Zr(l,p._storedError):(je(p._readableStreamController,i),bo(l)),null),b=>(je(p._readableStreamController,b),Zr(l,b),null)),l._finishPromise}function Dp(a){let i=a._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=a._readable;i._finishPromise=f((g,b)=>{i._finishPromise_resolve=g,i._finishPromise_reject=b});let p=i._flushAlgorithm();return Ma(i),k(p,()=>(l._state==="errored"?Zr(i,l._storedError):(ir(l._readableStreamController),bo(i)),null),g=>(je(l._readableStreamController,g),Zr(i,g),null)),i._finishPromise}function Op(a){return La(a,!1),a._backpressureChangePromise}function Lp(a,i){let l=a._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=a._writable;l._finishPromise=f((b,_)=>{l._finishPromise_resolve=b,l._finishPromise_reject=_});let g=l._cancelAlgorithm(i);return Ma(l),k(g,()=>(p._state==="errored"?Zr(l,p._storedError):(Cn(p._writableStreamController,i),yo(a),bo(l)),null),b=>(Cn(p._writableStreamController,b),yo(a),Zr(l,b),null)),l._finishPromise}function Fa(a){return new TypeError(`TransformStreamDefaultController.prototype.${a} can only be used on a TransformStreamDefaultController`)}function bo(a){a._finishPromise_resolve!==void 0&&(a._finishPromise_resolve(),a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0)}function Zr(a,i){a._finishPromise_reject!==void 0&&(W(a._finishPromise),a._finishPromise_reject(i),a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0)}function sl(a){return new TypeError(`TransformStream.prototype.${a} can only be used on a TransformStream`)}t.ByteLengthQueuingStrategy=Ia,t.CountQueuingStrategy=Da,t.ReadableByteStreamController=gt,t.ReadableStream=ie,t.ReadableStreamBYOBReader=Ft,t.ReadableStreamBYOBRequest=tr,t.ReadableStreamDefaultController=bt,t.ReadableStreamDefaultReader=Ot,t.TransformStream=Oa,t.TransformStreamDefaultController=Bt,t.WritableStream=jt,t.WritableStreamDefaultController=Vr,t.WritableStreamDefaultWriter=yt}))});var Ol=ko(()=>{if(!globalThis.ReadableStream)try{let t=require("node:process"),{emitWarning:e}=t;try{t.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),t.emitWarning=e}catch(r){throw t.emitWarning=e,r}}catch{Object.assign(globalThis,Dl())}try{let{Blob:t}=require("buffer");t&&!t.prototype.stream&&(t.prototype.stream=function(r){let n=0,s=this;return new ReadableStream({type:"bytes",async pull(o){let u=await s.slice(n,Math.min(s.size,n+65536)).arrayBuffer();n+=u.byteLength,o.enqueue(new Uint8Array(u)),n===s.size&&o.close()}})})}catch{}});async function*Lo(t,e=!0){for(let r of t)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(e){let n=r.byteOffset,s=r.byteOffset+r.byteLength;for(;n!==s;){let o=Math.min(s-n,Ll),c=r.buffer.slice(n,n+o);n+=c.byteLength,yield new Uint8Array(c)}}else yield r;else{let n=0,s=r;for(;n!==s.size;){let c=await s.slice(n,Math.min(s.size,n+Ll)).arrayBuffer();n+=c.byteLength,yield new Uint8Array(c)}}}var R_,Ll,Nl,Bm,Ve,Nn=z(()=>{R_=Be(Ol(),1);Ll=65536;Nl=class No{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],r={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof r!="object"&&typeof r!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");r===null&&(r={});let n=new TextEncoder;for(let o of e){let c;ArrayBuffer.isView(o)?c=new Uint8Array(o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)):o instanceof ArrayBuffer?c=new Uint8Array(o.slice(0)):o instanceof No?c=o:c=n.encode(`${o}`),this.#r+=ArrayBuffer.isView(c)?c.byteLength:c.size,this.#e.push(c)}this.#n=`${r.endings===void 0?"transparent":r.endings}`;let s=r.type===void 0?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,r="";for await(let n of Lo(this.#e,!1))r+=e.decode(n,{stream:!0});return r+=e.decode(),r}async arrayBuffer(){let e=new Uint8Array(this.size),r=0;for await(let n of Lo(this.#e,!1))e.set(n,r),r+=n.length;return e.buffer}stream(){let e=Lo(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(r){let n=await e.next();n.done?r.close():r.enqueue(n.value)},async cancel(){await e.return()}})}slice(e=0,r=this.size,n=""){let{size:s}=this,o=e<0?Math.max(s+e,0):Math.min(e,s),c=r<0?Math.max(s+r,0):Math.min(r,s),u=Math.max(c-o,0),f=this.#e,d=[],m=0;for(let k of f){if(m>=u)break;let R=ArrayBuffer.isView(k)?k.byteLength:k.size;if(o&&R<=o)o-=R,c-=R;else{let x;ArrayBuffer.isView(k)?(x=k.subarray(o,Math.min(R,c)),m+=x.byteLength):(x=k.slice(o,Math.min(R,c)),m+=x.size),c-=R,d.push(x),o=0}}let w=new No([],{type:String(n).toLowerCase()});return w.#r=u,w.#e=d,w}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Nl.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Bm=Nl,Ve=Bm});var Um,zm,Jt,Mo=z(()=>{Nn();Um=class extends Ve{#e=0;#t="";constructor(e,r,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),n===null&&(n={});let s=n.lastModified===void 0?Date.now():Number(n.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(r)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Ve&&/^(File)$/.test(e[Symbol.toStringTag])}},zm=Um,Jt=zm});function jl(t,e=Ve){var r=`${Ml()}${Ml()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],s=`--${r}\r
Content-Disposition: form-data; name="`;return t.forEach((o,c)=>typeof o=="string"?n.push(s+Fo(c)+`"\r
\r
${o.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):n.push(s+Fo(c)+`"; filename="${Fo(o.name,1)}"\r
Content-Type: ${o.type||"application/octet-stream"}\r
\r
`,o,`\r
`)),n.push(`--${r}--`),new e(n,{type:"multipart/form-data; boundary="+r})}var Mn,Hm,Vm,Ml,Gm,Fl,Fo,Tr,Zt,os=z(()=>{Nn();Mo();({toStringTag:Mn,iterator:Hm,hasInstance:Vm}=Symbol),Ml=Math.random,Gm="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Fl=(t,e,r)=>(t+="",/^(Blob|File)$/.test(e&&e[Mn])?[(r=r!==void 0?r+"":e[Mn]=="File"?e.name:"blob",t),e.name!==r||e[Mn]=="blob"?new Jt([e],r,e):e]:[t,e+""]),Fo=(t,e)=>(e?t:t.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Tr=(t,e,r)=>{if(e.length<r)throw new TypeError(`Failed to execute '${t}' on 'FormData': ${r} arguments required, but only ${e.length} present.`)},Zt=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Mn](){return"FormData"}[Hm](){return this.entries()}static[Vm](e){return e&&typeof e=="object"&&e[Mn]==="FormData"&&!Gm.some(r=>typeof e[r]!="function")}append(...e){Tr("append",arguments,2),this.#e.push(Fl(...e))}delete(e){Tr("delete",arguments,1),e+="",this.#e=this.#e.filter(([r])=>r!==e)}get(e){Tr("get",arguments,1),e+="";for(var r=this.#e,n=r.length,s=0;s<n;s++)if(r[s][0]===e)return r[s][1];return null}getAll(e,r){return Tr("getAll",arguments,1),r=[],e+="",this.#e.forEach(n=>n[0]===e&&r.push(n[1])),r}has(e){return Tr("has",arguments,1),e+="",this.#e.some(r=>r[0]===e)}forEach(e,r){Tr("forEach",arguments,1);for(var[n,s]of this)e.call(r,s,n,this)}set(...e){Tr("set",arguments,2);var r=[],n=!0;e=Fl(...e),this.#e.forEach(s=>{s[0]===e[0]?n&&(n=!r.push(e)):r.push(s)}),n&&r.push(e),this.#e=r}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var Tt,is=z(()=>{Tt=class extends Error{constructor(e,r){super(e),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var fe,jo=z(()=>{is();fe=class extends Tt{constructor(e,r,n){super(e,r),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}});var cs,Wo,Fn,Wl,ql,Bl,ls=z(()=>{cs=Symbol.toStringTag,Wo=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[cs]==="URLSearchParams",Fn=t=>t&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[cs]),Wl=t=>typeof t=="object"&&(t[cs]==="AbortSignal"||t[cs]==="EventTarget"),ql=(t,e)=>{let r=new URL(e).hostname,n=new URL(t).hostname;return r===n||r.endsWith(`.${n}`)},Bl=(t,e)=>{let r=new URL(e).protocol,n=new URL(t).protocol;return r===n}});var zl=ko((W_,Ul)=>{if(!globalThis.DOMException)try{let{MessageChannel:t}=require("worker_threads"),e=new t().port1,r=new ArrayBuffer;e.postMessage(r,[r,r])}catch(t){t.constructor.name==="DOMException"&&(globalThis.DOMException=t.constructor)}Ul.exports=globalThis.DOMException});var Cr,Hl,Vl,qo,Gl,Jl,Zl,Yl,Ql,Kl,us,Bo=z(()=>{Cr=require("node:fs"),Hl=require("node:path"),Vl=Be(zl(),1);Mo();Nn();({stat:qo}=Cr.promises),Gl=(t,e)=>Ql((0,Cr.statSync)(t),t,e),Jl=(t,e)=>qo(t).then(r=>Ql(r,t,e)),Zl=(t,e)=>qo(t).then(r=>Kl(r,t,e)),Yl=(t,e)=>Kl((0,Cr.statSync)(t),t,e),Ql=(t,e,r="")=>new Ve([new us({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],{type:r}),Kl=(t,e,r="")=>new Jt([new us({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],(0,Hl.basename)(e),{type:r,lastModified:t.mtimeMs}),us=class t{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,r){return new t({path:this.#e,lastModified:this.lastModified,size:r-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await qo(this.#e);if(e>this.lastModified)throw new Vl.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Cr.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var eu={};Ie(eu,{toFormData:()=>eg});function Xm(t){let e=t.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let r=e[2]||e[3]||"",n=r.slice(r.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(s,o)=>String.fromCharCode(o)),n}async function eg(t,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let r=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");let n=new Uo(r[1]||r[2]),s,o,c,u,f,d,m=[],w=new Zt,k=P=>{c+=W.decode(P,{stream:!0})},R=P=>{m.push(P)},x=()=>{let P=new Jt(m,d,{type:f});w.append(u,P)},N=()=>{w.append(u,c)},W=new TextDecoder("utf-8");W.decode(),n.onPartBegin=function(){n.onPartData=k,n.onPartEnd=N,s="",o="",c="",u="",f="",d=null,m.length=0},n.onHeaderField=function(P){s+=W.decode(P,{stream:!0})},n.onHeaderValue=function(P){o+=W.decode(P,{stream:!0})},n.onHeaderEnd=function(){if(o+=W.decode(),s=s.toLowerCase(),s==="content-disposition"){let P=o.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);P&&(u=P[2]||P[3]||""),d=Xm(o),d&&(n.onPartData=R,n.onPartEnd=x)}else s==="content-type"&&(f=o);o="",s=""};for await(let P of t)n.write(P);return n.end(),w}var st,Q,Xl,Yt,ds,fs,Jm,jn,Zm,Ym,Qm,Km,Rr,Uo,tu=z(()=>{Bo();os();st=0,Q={START_BOUNDARY:st++,HEADER_FIELD_START:st++,HEADER_FIELD:st++,HEADER_VALUE_START:st++,HEADER_VALUE:st++,HEADER_VALUE_ALMOST_DONE:st++,HEADERS_ALMOST_DONE:st++,PART_DATA_START:st++,PART_DATA:st++,END:st++},Xl=1,Yt={PART_BOUNDARY:Xl,LAST_BOUNDARY:Xl*=2},ds=10,fs=13,Jm=32,jn=45,Zm=58,Ym=97,Qm=122,Km=t=>t|32,Rr=()=>{},Uo=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Rr,this.onHeaderField=Rr,this.onHeadersEnd=Rr,this.onHeaderValue=Rr,this.onPartBegin=Rr,this.onPartData=Rr,this.onPartEnd=Rr,this.boundaryChars={},e=`\r
--`+e;let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n),this.boundaryChars[r[n]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=Q.START_BOUNDARY}write(e){let r=0,n=e.length,s=this.index,{lookbehind:o,boundary:c,boundaryChars:u,index:f,state:d,flags:m}=this,w=this.boundary.length,k=w-1,R=e.length,x,N,W=H=>{this[H+"Mark"]=r},P=H=>{delete this[H+"Mark"]},U=(H,V,K,Dt)=>{(V===void 0||V!==K)&&this[H](Dt&&Dt.subarray(V,K))},re=(H,V)=>{let K=H+"Mark";K in this&&(V?(U(H,this[K],r,e),delete this[K]):(U(H,this[K],e.length,e),this[K]=0))};for(r=0;r<n;r++)switch(x=e[r],d){case Q.START_BOUNDARY:if(f===c.length-2){if(x===jn)m|=Yt.LAST_BOUNDARY;else if(x!==fs)return;f++;break}else if(f-1===c.length-2){if(m&Yt.LAST_BOUNDARY&&x===jn)d=Q.END,m=0;else if(!(m&Yt.LAST_BOUNDARY)&&x===ds)f=0,U("onPartBegin"),d=Q.HEADER_FIELD_START;else return;break}x!==c[f+2]&&(f=-2),x===c[f+2]&&f++;break;case Q.HEADER_FIELD_START:d=Q.HEADER_FIELD,W("onHeaderField"),f=0;case Q.HEADER_FIELD:if(x===fs){P("onHeaderField"),d=Q.HEADERS_ALMOST_DONE;break}if(f++,x===jn)break;if(x===Zm){if(f===1)return;re("onHeaderField",!0),d=Q.HEADER_VALUE_START;break}if(N=Km(x),N<Ym||N>Qm)return;break;case Q.HEADER_VALUE_START:if(x===Jm)break;W("onHeaderValue"),d=Q.HEADER_VALUE;case Q.HEADER_VALUE:x===fs&&(re("onHeaderValue",!0),U("onHeaderEnd"),d=Q.HEADER_VALUE_ALMOST_DONE);break;case Q.HEADER_VALUE_ALMOST_DONE:if(x!==ds)return;d=Q.HEADER_FIELD_START;break;case Q.HEADERS_ALMOST_DONE:if(x!==ds)return;U("onHeadersEnd"),d=Q.PART_DATA_START;break;case Q.PART_DATA_START:d=Q.PART_DATA,W("onPartData");case Q.PART_DATA:if(s=f,f===0){for(r+=k;r<R&&!(e[r]in u);)r+=w;r-=k,x=e[r]}if(f<c.length)c[f]===x?(f===0&&re("onPartData",!0),f++):f=0;else if(f===c.length)f++,x===fs?m|=Yt.PART_BOUNDARY:x===jn?m|=Yt.LAST_BOUNDARY:f=0;else if(f-1===c.length)if(m&Yt.PART_BOUNDARY){if(f=0,x===ds){m&=~Yt.PART_BOUNDARY,U("onPartEnd"),U("onPartBegin"),d=Q.HEADER_FIELD_START;break}}else m&Yt.LAST_BOUNDARY&&x===jn?(U("onPartEnd"),d=Q.END,m=0):f=0;if(f>0)o[f-1]=x;else if(s>0){let H=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);U("onPartData",0,s,H),s=0,W("onPartData"),r--}break;case Q.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}re("onHeaderField"),re("onHeaderValue"),re("onPartData"),this.index=f,this.state=d,this.flags=m}end(){if(this.state===Q.HEADER_FIELD_START&&this.index===0||this.state===Q.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==Q.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function zo(t){if(t[be].disturbed)throw new TypeError(`body used already for: ${t.url}`);if(t[be].disturbed=!0,t[be].error)throw t[be].error;let{body:e}=t;if(e===null)return xe.Buffer.alloc(0);if(!(e instanceof Ne.default))return xe.Buffer.alloc(0);let r=[],n=0;try{for await(let s of e){if(t.size>0&&n+s.length>t.size){let o=new fe(`content size at ${t.url} over limit: ${t.size}`,"max-size");throw e.destroy(o),o}n+=s.length,r.push(s)}}catch(s){throw s instanceof Tt?s:new fe(`Invalid response body while trying to fetch ${t.url}: ${s.message}`,"system",s)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return r.every(s=>typeof s=="string")?xe.Buffer.from(r.join("")):xe.Buffer.concat(r,n)}catch(s){throw new fe(`Could not create Buffer from response body for ${t.url}: ${s.message}`,"system",s)}else throw new fe(`Premature close of server response while trying to fetch ${t.url}`)}var Ne,Ct,xe,tg,be,ot,un,rg,ps,ru,nu,hs=z(()=>{Ne=Be(require("node:stream"),1),Ct=require("node:util"),xe=require("node:buffer");Nn();os();jo();is();ls();tg=(0,Ct.promisify)(Ne.default.pipeline),be=Symbol("Body internals"),ot=class{constructor(e,{size:r=0}={}){let n=null;e===null?e=null:Wo(e)?e=xe.Buffer.from(e.toString()):Fn(e)||xe.Buffer.isBuffer(e)||(Ct.types.isAnyArrayBuffer(e)?e=xe.Buffer.from(e):ArrayBuffer.isView(e)?e=xe.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Ne.default||(e instanceof Zt?(e=jl(e),n=e.type.split("=")[1]):e=xe.Buffer.from(String(e))));let s=e;xe.Buffer.isBuffer(e)?s=Ne.default.Readable.from(e):Fn(e)&&(s=Ne.default.Readable.from(e.stream())),this[be]={body:e,stream:s,boundary:n,disturbed:!1,error:null},this.size=r,e instanceof Ne.default&&e.on("error",o=>{let c=o instanceof Tt?o:new fe(`Invalid response body while trying to fetch ${this.url}: ${o.message}`,"system",o);this[be].error=c})}get body(){return this[be].stream}get bodyUsed(){return this[be].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:r,byteLength:n}=await zo(this);return e.slice(r,r+n)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let n=new Zt,s=new URLSearchParams(await this.text());for(let[o,c]of s)n.append(o,c);return n}let{toFormData:r}=await Promise.resolve().then(()=>(tu(),eu));return r(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[be].body&&this[be].body.type||"",r=await this.arrayBuffer();return new Ve([r],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await zo(this);return new TextDecoder().decode(e)}buffer(){return zo(this)}};ot.prototype.buffer=(0,Ct.deprecate)(ot.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ot.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Ct.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});un=(t,e)=>{let r,n,{body:s}=t[be];if(t.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof Ne.default&&typeof s.getBoundary!="function"&&(r=new Ne.PassThrough({highWaterMark:e}),n=new Ne.PassThrough({highWaterMark:e}),s.pipe(r),s.pipe(n),t[be].stream=r,s=n),s},rg=(0,Ct.deprecate)(t=>t.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),ps=(t,e)=>t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":Wo(t)?"application/x-www-form-urlencoded;charset=UTF-8":Fn(t)?t.type||null:xe.Buffer.isBuffer(t)||Ct.types.isAnyArrayBuffer(t)||ArrayBuffer.isView(t)?null:t instanceof Zt?`multipart/form-data; boundary=${e[be].boundary}`:t&&typeof t.getBoundary=="function"?`multipart/form-data;boundary=${rg(t)}`:t instanceof Ne.default?null:"text/plain;charset=UTF-8",ru=t=>{let{body:e}=t[be];return e===null?0:Fn(e)?e.size:xe.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},nu=async(t,{body:e})=>{e===null?t.end():await tg(e,t)}});function au(t=[]){return new we(t.reduce((e,r,n,s)=>(n%2===0&&e.push(s.slice(n,n+2)),e),[]).filter(([e,r])=>{try{return ms(e),Vo(e,String(r)),!0}catch{return!1}}))}var Ho,Wn,ms,Vo,we,gs=z(()=>{Ho=require("node:util"),Wn=Be(require("node:http"),1),ms=typeof Wn.default.validateHeaderName=="function"?Wn.default.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){let e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},Vo=typeof Wn.default.validateHeaderValue=="function"?Wn.default.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let r=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},we=class t extends URLSearchParams{constructor(e){let r=[];if(e instanceof t){let n=e.raw();for(let[s,o]of Object.entries(n))r.push(...o.map(c=>[s,c]))}else if(e!=null)if(typeof e=="object"&&!Ho.types.isBoxedPrimitive(e)){let n=e[Symbol.iterator];if(n==null)r.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");r=[...e].map(s=>{if(typeof s!="object"||Ho.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([n,s])=>(ms(n),Vo(n,String(s)),[String(n).toLowerCase(),String(s)])):void 0,super(r),new Proxy(this,{get(n,s,o){switch(s){case"append":case"set":return(c,u)=>(ms(c),Vo(c,String(u)),URLSearchParams.prototype[s].call(n,String(c).toLowerCase(),String(u)));case"delete":case"has":case"getAll":return c=>(ms(c),URLSearchParams.prototype[s].call(n,String(c).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,s,o)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let r=this.getAll(e);if(r.length===0)return null;let n=r.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,r=void 0){for(let n of this.keys())Reflect.apply(e,r,[this.get(n),n,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,r)=>(e[r]=this.getAll(r),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,r)=>{let n=this.getAll(r);return r==="host"?e[r]=n[0]:e[r]=n.length>1?n:n[0],e},{})}};Object.defineProperties(we.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}))});var ng,qn,Go=z(()=>{ng=new Set([301,302,303,307,308]),qn=t=>ng.has(t)});var Ge,ve,su=z(()=>{gs();hs();Go();Ge=Symbol("Response internals"),ve=class t extends ot{constructor(e=null,r={}){super(e,r);let n=r.status!=null?r.status:200,s=new we(r.headers);if(e!==null&&!s.has("Content-Type")){let o=ps(e,this);o&&s.append("Content-Type",o)}this[Ge]={type:"default",url:r.url,status:n,statusText:r.statusText||"",headers:s,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[Ge].type}get url(){return this[Ge].url||""}get status(){return this[Ge].status}get ok(){return this[Ge].status>=200&&this[Ge].status<300}get redirected(){return this[Ge].counter>0}get statusText(){return this[Ge].statusText}get headers(){return this[Ge].headers}get highWaterMark(){return this[Ge].highWaterMark}clone(){return new t(un(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,r=302){if(!qn(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new t(null,{headers:{location:new URL(e).toString()},status:r})}static error(){let e=new t(null,{status:0,statusText:""});return e[Ge].type="error",e}static json(e=void 0,r={}){let n=JSON.stringify(e);if(n===void 0)throw new TypeError("data is not JSON serializable");let s=new we(r&&r.headers);return s.has("content-type")||s.set("content-type","application/json"),new t(n,{...r,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(ve.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var ou,iu=z(()=>{ou=t=>{if(t.search)return t.search;let e=t.href.length-1,r=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-r.length]==="?"?"?":""}});function cu(t,e=!1){return t==null||(t=new URL(t),/^(about|blob|data):$/.test(t.protocol))?"no-referrer":(t.username="",t.password="",t.hash="",e&&(t.pathname="",t.search=""),t)}function fu(t){if(!uu.has(t))throw new TypeError(`Invalid referrerPolicy: ${t}`);return t}function ag(t){if(/^(http|ws)s:$/.test(t.protocol))return!0;let e=t.host.replace(/(^\[)|(]$)/g,""),r=(0,lu.isIP)(e);return r===4&&/^127\./.test(e)||r===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:t.host==="localhost"||t.host.endsWith(".localhost")?!1:t.protocol==="file:"}function dn(t){return/^about:(blank|srcdoc)$/.test(t)||t.protocol==="data:"||/^(blob|filesystem):$/.test(t.protocol)?!0:ag(t)}function pu(t,{referrerURLCallback:e,referrerOriginCallback:r}={}){if(t.referrer==="no-referrer"||t.referrerPolicy==="")return null;let n=t.referrerPolicy;if(t.referrer==="about:client")return"no-referrer";let s=t.referrer,o=cu(s),c=cu(s,!0);o.toString().length>4096&&(o=c),e&&(o=e(o)),r&&(c=r(c));let u=new URL(t.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return c;case"unsafe-url":return o;case"strict-origin":return dn(o)&&!dn(u)?"no-referrer":c.toString();case"strict-origin-when-cross-origin":return o.origin===u.origin?o:dn(o)&&!dn(u)?"no-referrer":c;case"same-origin":return o.origin===u.origin?o:"no-referrer";case"origin-when-cross-origin":return o.origin===u.origin?o:c;case"no-referrer-when-downgrade":return dn(o)&&!dn(u)?"no-referrer":o;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}function hu(t){let e=(t.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let n of e)n&&uu.has(n)&&(r=n);return r}var lu,uu,du,Jo=z(()=>{lu=require("node:net");uu=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),du="strict-origin-when-cross-origin"});var mu,gu,ne,Bn,sg,Qt,yu,bu=z(()=>{mu=require("node:url"),gu=require("node:util");gs();hs();ls();iu();Jo();ne=Symbol("Request internals"),Bn=t=>typeof t=="object"&&typeof t[ne]=="object",sg=(0,gu.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Qt=class t extends ot{constructor(e,r={}){let n;if(Bn(e)?n=new URL(e.url):(n=new URL(e),e={}),n.username!==""||n.password!=="")throw new TypeError(`${n} is an url with embedded credentials.`);let s=r.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Bn(r)&&"data"in r&&sg(),(r.body!=null||Bn(e)&&e.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let o=r.body?r.body:Bn(e)&&e.body!==null?un(e):null;super(o,{size:r.size||e.size||0});let c=new we(r.headers||e.headers||{});if(o!==null&&!c.has("Content-Type")){let d=ps(o,this);d&&c.set("Content-Type",d)}let u=Bn(e)?e.signal:null;if("signal"in r&&(u=r.signal),u!=null&&!Wl(u))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=r.referrer==null?e.referrer:r.referrer;if(f==="")f="no-referrer";else if(f){let d=new URL(f);f=/^about:(\/\/)?client$/.test(d)?"client":d}else f=void 0;this[ne]={method:s,redirect:r.redirect||e.redirect||"follow",headers:c,parsedURL:n,signal:u,referrer:f},this.follow=r.follow===void 0?e.follow===void 0?20:e.follow:r.follow,this.compress=r.compress===void 0?e.compress===void 0?!0:e.compress:r.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent,this.highWaterMark=r.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=r.referrerPolicy||e.referrerPolicy||""}get method(){return this[ne].method}get url(){return(0,mu.format)(this[ne].parsedURL)}get headers(){return this[ne].headers}get redirect(){return this[ne].redirect}get signal(){return this[ne].signal}get referrer(){if(this[ne].referrer==="no-referrer")return"";if(this[ne].referrer==="client")return"about:client";if(this[ne].referrer)return this[ne].referrer.toString()}get referrerPolicy(){return this[ne].referrerPolicy}set referrerPolicy(e){this[ne].referrerPolicy=fu(e)}clone(){return new t(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Qt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});yu=t=>{let{parsedURL:e}=t[ne],r=new we(t[ne].headers);r.has("Accept")||r.set("Accept","*/*");let n=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(n="0"),t.body!==null){let u=ru(t);typeof u=="number"&&!Number.isNaN(u)&&(n=String(u))}n&&r.set("Content-Length",n),t.referrerPolicy===""&&(t.referrerPolicy=du),t.referrer&&t.referrer!=="no-referrer"?t[ne].referrer=pu(t):t[ne].referrer="no-referrer",t[ne].referrer instanceof URL&&r.set("Referer",t.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=t;typeof s=="function"&&(s=s(e));let o=ou(e),c={path:e.pathname+o,method:t.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:s};return{parsedURL:e,options:c}}});var Un,wu=z(()=>{is();Un=class extends Tt{constructor(e,r="aborted"){super(e,r)}}});var Zo={};Ie(Zo,{AbortError:()=>Un,Blob:()=>Ve,FetchError:()=>fe,File:()=>Jt,FormData:()=>Zt,Headers:()=>we,Request:()=>Qt,Response:()=>ve,blobFrom:()=>Jl,blobFromSync:()=>Gl,default:()=>Rt,fileFrom:()=>Zl,fileFromSync:()=>Yl,isRedirect:()=>qn});async function Rt(t,e){return new Promise((r,n)=>{let s=new Qt(t,e),{parsedURL:o,options:c}=yu(s);if(!og.has(o.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${o.protocol.replace(/:$/,"")}" is not supported.`);if(o.protocol==="data:"){let x=$l(s.url),N=new ve(x,{headers:{"Content-Type":x.typeFull}});r(N);return}let u=(o.protocol==="https:"?ku.default:_u.default).request,{signal:f}=s,d=null,m=()=>{let x=new Un("The operation was aborted.");n(x),s.body&&s.body instanceof Te.default.Readable&&s.body.destroy(x),!(!d||!d.body)&&d.body.emit("error",x)};if(f&&f.aborted){m();return}let w=()=>{m(),R()},k=u(o.toString(),c);f&&f.addEventListener("abort",w);let R=()=>{k.abort(),f&&f.removeEventListener("abort",w)};k.on("error",x=>{n(new fe(`request to ${s.url} failed, reason: ${x.message}`,"system",x)),R()}),ig(k,x=>{d&&d.body&&d.body.destroy(x)}),process.version<"v14"&&k.on("socket",x=>{let N;x.prependListener("end",()=>{N=x._eventsCount}),x.prependListener("close",W=>{if(d&&N<x._eventsCount&&!W){let P=new Error("Premature close");P.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",P)}})}),k.on("response",x=>{k.setTimeout(0);let N=au(x.rawHeaders);if(qn(x.statusCode)){let H=N.get("Location"),V=null;try{V=H===null?null:new URL(H,s.url)}catch{if(s.redirect!=="manual"){n(new fe(`uri requested responds with an invalid redirect URL: ${H}`,"invalid-redirect")),R();return}}switch(s.redirect){case"error":n(new fe(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),R();return;case"manual":break;case"follow":{if(V===null)break;if(s.counter>=s.follow){n(new fe(`maximum redirect reached at: ${s.url}`,"max-redirect")),R();return}let K={headers:new we(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:un(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!ql(s.url,V)||!Bl(s.url,V))for(let _n of["authorization","www-authenticate","cookie","cookie2"])K.headers.delete(_n);if(x.statusCode!==303&&s.body&&e.body instanceof Te.default.Readable){n(new fe("Cannot follow redirect with body being a readable stream","unsupported-redirect")),R();return}(x.statusCode===303||(x.statusCode===301||x.statusCode===302)&&s.method==="POST")&&(K.method="GET",K.body=void 0,K.headers.delete("content-length"));let Dt=hu(N);Dt&&(K.referrerPolicy=Dt),r(Rt(new Qt(V,K))),R();return}default:return n(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}f&&x.once("end",()=>{f.removeEventListener("abort",w)});let W=(0,Te.pipeline)(x,new Te.PassThrough,H=>{H&&n(H)});process.version<"v12.10"&&x.on("aborted",w);let P={url:s.url,status:x.statusCode,statusText:x.statusMessage,headers:N,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},U=N.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||U===null||x.statusCode===204||x.statusCode===304){d=new ve(W,P),r(d);return}let re={flush:Er.default.Z_SYNC_FLUSH,finishFlush:Er.default.Z_SYNC_FLUSH};if(U==="gzip"||U==="x-gzip"){W=(0,Te.pipeline)(W,Er.default.createGunzip(re),H=>{H&&n(H)}),d=new ve(W,P),r(d);return}if(U==="deflate"||U==="x-deflate"){let H=(0,Te.pipeline)(x,new Te.PassThrough,V=>{V&&n(V)});H.once("data",V=>{(V[0]&15)===8?W=(0,Te.pipeline)(W,Er.default.createInflate(),K=>{K&&n(K)}):W=(0,Te.pipeline)(W,Er.default.createInflateRaw(),K=>{K&&n(K)}),d=new ve(W,P),r(d)}),H.once("end",()=>{d||(d=new ve(W,P),r(d))});return}if(U==="br"){W=(0,Te.pipeline)(W,Er.default.createBrotliDecompress(),H=>{H&&n(H)}),d=new ve(W,P),r(d);return}d=new ve(W,P),r(d)}),nu(k,s).catch(n)})}function ig(t,e){let r=zn.Buffer.from(`0\r
\r
`),n=!1,s=!1,o;t.on("response",c=>{let{headers:u}=c;n=u["transfer-encoding"]==="chunked"&&!u["content-length"]}),t.on("socket",c=>{let u=()=>{if(n&&!s){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},f=d=>{s=zn.Buffer.compare(d.slice(-5),r)===0,!s&&o&&(s=zn.Buffer.compare(o.slice(-3),r.slice(0,3))===0&&zn.Buffer.compare(d.slice(-2),r.slice(3))===0),o=d};c.prependListener("close",u),c.on("data",f),t.on("close",()=>{c.removeListener("close",u),c.removeListener("data",f)})})}var _u,ku,Er,Te,zn,og,Hn=z(()=>{_u=Be(require("node:http"),1),ku=Be(require("node:https"),1),Er=Be(require("node:zlib"),1),Te=Be(require("node:stream"),1),zn=require("node:buffer");Pl();hs();su();gs();bu();jo();wu();Go();os();ls();Jo();Bo();og=new Set(["data:","http:","https:"])});function ae(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function Ir(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r}var Wu=z(()=>{});var li={};Ie(li,{Channel:()=>mn,PluginListener:()=>Jn,Resource:()=>Xt,SERIALIZE_TO_IPC_FN:()=>ue,addPluginListener:()=>gy,checkPermissions:()=>yy,convertFileSrc:()=>wy,invoke:()=>y,isTauri:()=>_y,requestPermissions:()=>by,transformCallback:()=>Ss});function Ss(t,e=!1){return window.__TAURI_INTERNALS__.transformCallback(t,e)}async function gy(t,e,r){let n=new mn(r);try{return await y(`plugin:${t}|register_listener`,{event:e,handler:n}),new Jn(t,e,n.id)}catch{return await y(`plugin:${t}|registerListener`,{event:e,handler:n}),new Jn(t,e,n.id)}}async function yy(t){return y(`plugin:${t}|check_permissions`)}async function by(t){return y(`plugin:${t}|request_permissions`)}async function y(t,e={},r){return window.__TAURI_INTERNALS__.invoke(t,e,r)}function wy(t,e="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(t,e)}function _y(){return!!(globalThis||window).isTauri}var Dr,Fe,hn,_s,ks,ue,mn,Jn,Xt,lt=z(()=>{Wu();ue="__TAURI_TO_IPC_KEY__";mn=class{constructor(e){Dr.set(this,void 0),Fe.set(this,0),hn.set(this,[]),_s.set(this,void 0),Ir(this,Dr,e||(()=>{}),"f"),this.id=Ss(r=>{let n=r.index;if("end"in r){n==ae(this,Fe,"f")?this.cleanupCallback():Ir(this,_s,n,"f");return}let s=r.message;if(n==ae(this,Fe,"f")){for(ae(this,Dr,"f").call(this,s),Ir(this,Fe,ae(this,Fe,"f")+1,"f");ae(this,Fe,"f")in ae(this,hn,"f");){let o=ae(this,hn,"f")[ae(this,Fe,"f")];ae(this,Dr,"f").call(this,o),delete ae(this,hn,"f")[ae(this,Fe,"f")],Ir(this,Fe,ae(this,Fe,"f")+1,"f")}ae(this,Fe,"f")===ae(this,_s,"f")&&this.cleanupCallback()}else ae(this,hn,"f")[n]=s})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){Ir(this,Dr,e,"f")}get onmessage(){return ae(this,Dr,"f")}[(Dr=new WeakMap,Fe=new WeakMap,hn=new WeakMap,_s=new WeakMap,ue)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[ue]()}},Jn=class{constructor(e,r,n){this.plugin=e,this.event=r,this.channelId=n}async unregister(){return y(`plugin:${this.plugin}|remove_listener`,{event:this.event,channelId:this.channelId})}};Xt=class{get rid(){return ae(this,ks,"f")}constructor(e){ks.set(this,void 0),Ir(this,ks,e,"f")}async close(){return y("plugin:resources|close",{rid:this.rid})}};ks=new WeakMap});var Bu={};Ie(Bu,{TauriEvent:()=>pe,emit:()=>Zn,emitTo:()=>di,listen:()=>xs,once:()=>ui});async function qu(t,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(t,e),await y("plugin:event|unlisten",{event:t,eventId:e})}async function xs(t,e,r){var n;let s=typeof r?.target=="string"?{kind:"AnyLabel",label:r.target}:(n=r?.target)!==null&&n!==void 0?n:{kind:"Any"};return y("plugin:event|listen",{event:t,target:s,handler:Ss(e)}).then(o=>async()=>qu(t,o))}async function ui(t,e,r){return xs(t,n=>{qu(t,n.id),e(n)},r)}async function Zn(t,e){await y("plugin:event|emit",{event:t,payload:e})}async function di(t,e,r){await y("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:e,payload:r})}var pe,vs=z(()=>{lt();(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG_ENTER="tauri://drag-enter",t.DRAG_OVER="tauri://drag-over",t.DRAG_DROP="tauri://drag-drop",t.DRAG_LEAVE="tauri://drag-leave"})(pe||(pe={}))});var Ts={};Ie(Ts,{BaseDirectory:()=>G,appCacheDir:()=>vy,appConfigDir:()=>ky,appDataDir:()=>Sy,appLocalDataDir:()=>xy,appLogDir:()=>Uy,audioDir:()=>Ty,basename:()=>Ky,cacheDir:()=>Cy,configDir:()=>Ry,dataDir:()=>Ey,delimiter:()=>Vy,desktopDir:()=>Ay,dirname:()=>Yy,documentDir:()=>$y,downloadDir:()=>Py,executableDir:()=>Iy,extname:()=>Qy,fontDir:()=>Dy,homeDir:()=>Oy,isAbsolute:()=>Xy,join:()=>Zy,localDataDir:()=>Ly,normalize:()=>Jy,pictureDir:()=>Ny,publicDir:()=>My,resolve:()=>Gy,resolveResource:()=>jy,resourceDir:()=>Fy,runtimeDir:()=>Wy,sep:()=>Hy,tempDir:()=>zy,templateDir:()=>qy,videoDir:()=>By});async function ky(){return y("plugin:path|resolve_directory",{directory:G.AppConfig})}async function Sy(){return y("plugin:path|resolve_directory",{directory:G.AppData})}async function xy(){return y("plugin:path|resolve_directory",{directory:G.AppLocalData})}async function vy(){return y("plugin:path|resolve_directory",{directory:G.AppCache})}async function Ty(){return y("plugin:path|resolve_directory",{directory:G.Audio})}async function Cy(){return y("plugin:path|resolve_directory",{directory:G.Cache})}async function Ry(){return y("plugin:path|resolve_directory",{directory:G.Config})}async function Ey(){return y("plugin:path|resolve_directory",{directory:G.Data})}async function Ay(){return y("plugin:path|resolve_directory",{directory:G.Desktop})}async function $y(){return y("plugin:path|resolve_directory",{directory:G.Document})}async function Py(){return y("plugin:path|resolve_directory",{directory:G.Download})}async function Iy(){return y("plugin:path|resolve_directory",{directory:G.Executable})}async function Dy(){return y("plugin:path|resolve_directory",{directory:G.Font})}async function Oy(){return y("plugin:path|resolve_directory",{directory:G.Home})}async function Ly(){return y("plugin:path|resolve_directory",{directory:G.LocalData})}async function Ny(){return y("plugin:path|resolve_directory",{directory:G.Picture})}async function My(){return y("plugin:path|resolve_directory",{directory:G.Public})}async function Fy(){return y("plugin:path|resolve_directory",{directory:G.Resource})}async function jy(t){return y("plugin:path|resolve_directory",{directory:G.Resource,path:t})}async function Wy(){return y("plugin:path|resolve_directory",{directory:G.Runtime})}async function qy(){return y("plugin:path|resolve_directory",{directory:G.Template})}async function By(){return y("plugin:path|resolve_directory",{directory:G.Video})}async function Uy(){return y("plugin:path|resolve_directory",{directory:G.AppLog})}async function zy(){return y("plugin:path|resolve_directory",{directory:G.Temp})}function Hy(){return window.__TAURI_INTERNALS__.plugins.path.sep}function Vy(){return window.__TAURI_INTERNALS__.plugins.path.delimiter}async function Gy(...t){return y("plugin:path|resolve",{paths:t})}async function Jy(t){return y("plugin:path|normalize",{path:t})}async function Zy(...t){return y("plugin:path|join",{paths:t})}async function Yy(t){return y("plugin:path|dirname",{path:t})}async function Qy(t){return y("plugin:path|extname",{path:t})}async function Ky(t,e){return y("plugin:path|basename",{path:t,ext:e})}async function Xy(t){return y("plugin:path|is_absolute",{path:t})}var G,Yn=z(()=>{lt();(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(G||(G={}))});var mi={};Ie(mi,{BaseDirectory:()=>G,FileHandle:()=>Qn,SeekMode:()=>fi,copyFile:()=>rb,create:()=>tb,exists:()=>mb,lstat:()=>db,mkdir:()=>nb,open:()=>Uu,readDir:()=>ab,readFile:()=>sb,readTextFile:()=>ob,readTextFileLines:()=>ib,remove:()=>cb,rename:()=>lb,size:()=>bb,stat:()=>ub,truncate:()=>fb,watch:()=>gb,watchImmediate:()=>yb,writeFile:()=>pb,writeTextFile:()=>hb});function hi(t){return{isFile:t.isFile,isDirectory:t.isDirectory,isSymlink:t.isSymlink,size:t.size,mtime:t.mtime!==null?new Date(t.mtime):null,atime:t.atime!==null?new Date(t.atime):null,birthtime:t.birthtime!==null?new Date(t.birthtime):null,readonly:t.readonly,fileAttributes:t.fileAttributes,dev:t.dev,ino:t.ino,mode:t.mode,nlink:t.nlink,uid:t.uid,gid:t.gid,rdev:t.rdev,blksize:t.blksize,blocks:t.blocks}}function eb(t){let e=new Uint8ClampedArray(t),r=e.byteLength,n=0;for(let s=0;s<r;s++){let o=e[s];n*=256,n+=o}return n}async function tb(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|create",{path:t instanceof URL?t.toString():t,options:e});return new Qn(r)}async function Uu(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|open",{path:t instanceof URL?t.toString():t,options:e});return new Qn(r)}async function rb(t,e,r){if(t instanceof URL&&t.protocol!=="file:"||e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|copy_file",{fromPath:t instanceof URL?t.toString():t,toPath:e instanceof URL?e.toString():e,options:r})}async function nb(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|mkdir",{path:t instanceof URL?t.toString():t,options:e})}async function ab(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|read_dir",{path:t instanceof URL?t.toString():t,options:e})}async function sb(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|read_file",{path:t instanceof URL?t.toString():t,options:e});return r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r)}async function ob(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=await y("plugin:fs|read_text_file",{path:t instanceof URL?t.toString():t,options:e}),n=r instanceof ArrayBuffer?r:Uint8Array.from(r);return new TextDecoder().decode(n)}async function ib(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let r=t instanceof URL?t.toString():t;return await Promise.resolve({path:r,rid:null,async next(){this.rid===null&&(this.rid=await y("plugin:fs|read_text_file_lines",{path:r,options:e}));let n=await y("plugin:fs|read_text_file_lines_next",{rid:this.rid}),s=n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n),o=s[s.byteLength-1]===1;return o?(this.rid=null,{value:null,done:o}):{value:new TextDecoder().decode(s.slice(0,s.byteLength-1)),done:o}},[Symbol.asyncIterator](){return this}})}async function cb(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|remove",{path:t instanceof URL?t.toString():t,options:e})}async function lb(t,e,r){if(t instanceof URL&&t.protocol!=="file:"||e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|rename",{oldPath:t instanceof URL?t.toString():t,newPath:e instanceof URL?e.toString():e,options:r})}async function ub(t,e){let r=await y("plugin:fs|stat",{path:t instanceof URL?t.toString():t,options:e});return hi(r)}async function db(t,e){let r=await y("plugin:fs|lstat",{path:t instanceof URL?t.toString():t,options:e});return hi(r)}async function fb(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await y("plugin:fs|truncate",{path:t instanceof URL?t.toString():t,len:e,options:r})}async function pb(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");if(e instanceof ReadableStream){let n=await Uu(t,{read:!1,create:!0,write:!0,...r}),s=e.getReader();try{for(;;){let{done:o,value:c}=await s.read();if(o)break;await n.write(c)}}finally{s.releaseLock(),await n.close()}}else await y("plugin:fs|write_file",e,{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(r)}})}async function hb(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");let n=new TextEncoder;await y("plugin:fs|write_text_file",n.encode(e),{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(r)}})}async function mb(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|exists",{path:t instanceof URL?t.toString():t,options:e})}async function zu(t,e,r){let n=Array.isArray(t)?t:[t];for(let u of n)if(u instanceof URL&&u.protocol!=="file:")throw new TypeError("Must be a file URL.");let s=new mn;s.onmessage=e;let o=await y("plugin:fs|watch",{paths:n.map(u=>u instanceof URL?u.toString():u),options:r,onEvent:s}),c=new pi(o);return()=>{c.close()}}async function gb(t,e,r){return await zu(t,e,{delayMs:2e3,...r})}async function yb(t,e,r){return await zu(t,e,{...r,delayMs:void 0})}async function bb(t){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await y("plugin:fs|size",{path:t instanceof URL?t.toString():t})}var fi,Qn,pi,gi=z(()=>{Yn();lt();(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(fi||(fi={}));Qn=class extends Xt{async read(e){if(e.byteLength===0)return 0;let r=await y("plugin:fs|read",{rid:this.rid,len:e.byteLength}),n=eb(r.slice(-8)),s=r instanceof ArrayBuffer?new Uint8Array(r):r;return e.set(s.slice(0,s.length-8)),n===0?null:n}async seek(e,r){return await y("plugin:fs|seek",{rid:this.rid,offset:e,whence:r})}async stat(){let e=await y("plugin:fs|fstat",{rid:this.rid});return hi(e)}async truncate(e){await y("plugin:fs|ftruncate",{rid:this.rid,len:e})}async write(e){return await y("plugin:fs|write",{rid:this.rid,data:e})}};pi=class extends Xt{}});var ed={};Ie(ed,{fileOperations:()=>Or,keyboardUtils:()=>Xn,uiUtils:()=>ea,validationUtils:()=>er});var Or,Xn,ea,er,ta=z(()=>{Or={getExtension:t=>{let e=t.lastIndexOf(".");return e>0?t.slice(e+1).toLowerCase():""},isMarkdown:t=>{let e=Or.getExtension(t);return["md","markdown","mdown","mkd","mdwn"].includes(e)},isImage:t=>{let e=Or.getExtension(t);return["jpg","jpeg","png","gif","webp","svg","bmp","ico"].includes(e)},getBasename:t=>{let e=t.lastIndexOf("."),n=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"))+1,s=e>n?e:t.length;return t.slice(n,s)}},Xn={isModifierPressed:t=>t.ctrlKey||t.metaKey||t.altKey||t.shiftKey,getNormalizedKey:t=>{let e=[];(t.ctrlKey||t.metaKey)&&e.push("Ctrl"),t.altKey&&e.push("Alt"),t.shiftKey&&e.push("Shift");let r=t.key;return r===" "&&(r="Space"),r==="ArrowLeft"&&(r="Left"),r==="ArrowRight"&&(r="Right"),r==="ArrowUp"&&(r="Up"),r==="ArrowDown"&&(r="Down"),r.length===1&&(r=r.toUpperCase()),e.push(r),e.join("+")}},ea={formatFileSize:t=>{if(t===0)return"0 B";let e=1024,r=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(t)/Math.log(e));return`${parseFloat((t/Math.pow(e,n)).toFixed(2))} ${r[n]}`},formatDate:t=>{let e=new Date(t),n=new Date-e,s=Math.floor(n/(1e3*60*60*24));if(s===0){let o=Math.floor(n/36e5);if(o===0){let c=Math.floor(n/6e4);return c===0?"Just now":`${c} minutes ago`}return`${o} hours ago`}else return s===1?"Yesterday":s<7?`${s} days ago`:e.toLocaleDateString()}},er={isValidFilename:t=>!/[<>:"|?*]/.test(t)&&t.trim().length>0,isValidFoldername:t=>er.isValidFilename(t)&&!t.startsWith(".")&&t!==".."&&t!=="."}});var ra,td=z(()=>{ra={app:{name:"Lokus",executableName:"lokus.exe",defaultInstallPath:"C:\\Program Files\\Lokus",userDataPath:"%APPDATA%\\Lokus",tempPath:"%TEMP%\\Lokus"},files:{defaultWorkspacePath:"%USERPROFILE%\\Documents\\Lokus",maxPathLength:260,reservedNames:["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],invalidChars:'<>:"|?*',associations:{".md":{progId:"Lokus.Markdown",description:"Markdown Document",icon:"markdown.ico"},".markdown":{progId:"Lokus.Markdown",description:"Markdown Document",icon:"markdown.ico"}}},terminal:{preferences:[{name:"Windows Terminal",command:"wt",args:["-d","{path}"],available:null},{name:"PowerShell",command:"powershell",args:["-NoExit","-Command",'cd "{path}"'],available:null},{name:"Command Prompt",command:"cmd",args:["/k",'cd /d "{path}"'],available:!0}]},shortcuts:{global:{newWindow:"Ctrl+Shift+N",closeWindow:"Alt+F4",minimize:"Win+Down",maximize:"Win+Up"},editor:{selectWord:"Ctrl+D",selectLine:"Ctrl+L",deleteLine:"Ctrl+Shift+K",duplicateLine:"Ctrl+Shift+D",moveLineUp:"Alt+Up",moveLineDown:"Alt+Down"}},ui:{borderRadius:"8px",acrylic:{enabled:!0,tint:"rgba(255, 255, 255, 0.05)",blur:"20px"},snapLayouts:{enabled:!0,zones:["half-left","half-right","quarter","three-quarter"]},contextMenu:{style:"windows11",animations:!0,icons:!0}},shell:{contextMenu:{enabled:!0,entries:[{key:"open_with_lokus",title:"Open with Lokus",icon:"%INSTALLDIR%\\lokus.ico",command:'"%INSTALLDIR%\\lokus.exe" "%1"'}]},jumpList:{enabled:!0,maxItems:10,categories:["Recent","Tasks"]}},notifications:{provider:"windows-native",defaultSound:"ms-winsoundevent:Notification.Default",badgeSupport:!0,actionCenter:!0},performance:{directWrite:!0,hardwareAcceleration:!0,gpuRasterization:!0},features:{windowsHello:!1,darkModeSync:!0,taskbarProgress:!0,thumbnailToolbar:!0,aeroSnap:!0}}});var xi={};Ie(xi,{cleanupWindowsFeatures:()=>Tb,contextMenu:()=>Si,fileAssociations:()=>rd,initializeWindowsFeatures:()=>vb,jumpList:()=>nd,notifications:()=>Sb,searchIntegration:()=>xb,taskbarProgress:()=>ad,themeIntegration:()=>sd});async function vb(t={}){let e={fileAssociations:!1,contextMenu:!1,darkModeSync:!1};return t.fileAssociations!==!1&&(e.fileAssociations=await rd.register()),t.contextMenu!==!1&&(e.contextMenu=await Si.register()),t.darkModeSync!==!1&&(e.darkModeSync=await sd.syncDarkMode()),e}async function Tb(){await Si.unregister(),await nd.clear(),await ad.clear()}var rd,nd,Si,ad,Sb,sd,xb,od=z(()=>{lt();td();rd={async register(){try{return await y("windows_register_file_associations",{associations:ra.files.associations}),!0}catch{return!1}},async check(){try{return await y("windows_check_file_associations")}catch{return!1}}},nd={async update(t){try{let e=t.map(r=>({type:"task",title:r.name||"Untitled Workspace",description:r.path,program:"lokus.exe",args:`"${r.path}"`,iconPath:r.path,iconIndex:0}));return await y("windows_update_jump_list",{items:e,maxItems:ra.shell.jumpList.maxItems}),!0}catch{return!1}},async clear(){try{return await y("windows_clear_jump_list"),!0}catch{return!1}}},Si={async register(){try{return await y("windows_register_context_menu",{entries:ra.shell.contextMenu.entries}),!0}catch{return!1}},async unregister(){try{return await y("windows_unregister_context_menu"),!0}catch{return!1}}},ad={async setProgress(t,e="normal"){try{return await y("windows_set_taskbar_progress",{progress:Math.max(0,Math.min(1,t)),state:e}),!0}catch{return!1}},async clear(){try{return await y("windows_clear_taskbar_progress"),!0}catch{return!1}}},Sb={async show(t){try{let e={title:t.title,body:t.body,icon:t.icon||"lokus.ico",sound:t.sound!==!1?ra.notifications.defaultSound:null,actions:t.actions||[],silent:t.silent||!1};return await y("windows_show_notification",e)}catch{return null}},async clear(t){try{return await y("windows_clear_notification",{id:t}),!0}catch{return!1}}},sd={async syncDarkMode(){try{return await y("windows_is_dark_mode")}catch{return window.matchMedia("(prefers-color-scheme: dark)").matches}},async onThemeChange(t){try{await y("windows_watch_theme_changes");let{listen:e}=await Promise.resolve().then(()=>(vs(),Bu));return await e("windows-theme-changed",n=>{t(n.payload.isDarkMode)})}catch{return null}}},xb={async indexWorkspace(t){try{return await y("windows_index_workspace",{path:t}),!0}catch{return!1}},async removeFromIndex(t){try{return await y("windows_remove_from_index",{path:t}),!0}catch{return!1}}}});var cd={};Ie(cd,{fileOperations:()=>Or,keyboardUtils:()=>Xn,uiUtils:()=>ea,validationUtils:()=>er,windowsFeatureHelpers:()=>Ab,windowsFeaturesFromModule:()=>xi,windowsPathUtils:()=>na,windowsShell:()=>Eb,windowsShortcuts:()=>Cb,windowsUI:()=>Rb,windowsValidation:()=>id});var Cb,na,id,Rb,Eb,Ab,ld=z(()=>{ta();od();Cb={newFile:"Ctrl+N",newFolder:"Ctrl+Shift+N",save:"Ctrl+S",saveAs:"Ctrl+Shift+S",close:"Ctrl+W",closeAll:"Ctrl+Shift+W",find:"Ctrl+F",findAndReplace:"Ctrl+H",findInFiles:"Ctrl+Shift+F",commandPalette:"Ctrl+K",quickOpen:"Ctrl+P",properties:"Alt+Enter",rename:"F2",refresh:"F5",fullscreen:"F11",cut:"Ctrl+X",copy:"Ctrl+C",paste:"Ctrl+V",selectAll:"Ctrl+A",undo:"Ctrl+Z",redo:"Ctrl+Y",nextTab:"Ctrl+Tab",previousTab:"Ctrl+Shift+Tab",closeTab:"Ctrl+W",reopenTab:"Ctrl+Shift+T",toggleSidebar:"Ctrl+B",togglePreview:"Ctrl+Shift+V",zoomIn:"Ctrl+Plus",zoomOut:"Ctrl+Minus",resetZoom:"Ctrl+0"},na={toWindowsPath:t=>t&&(t.startsWith("//")?"\\\\"+t.slice(2).replace(/\//g,"\\"):t.replace(/\//g,"\\")),toUnixPath:t=>t&&(t.startsWith("\\\\")?"//"+t.slice(2).replace(/\\/g,"/"):t.replace(/\\/g,"/")),getDriveLetter:t=>{let e=t.match(/^([A-Za-z]):/);return e?e[1].toUpperCase():null},isAbsolutePath:t=>/^[A-Za-z]:/.test(t)||t.startsWith("\\\\"),isUNCPath:t=>t.startsWith("\\\\")||t.startsWith("//"),normalizePath:t=>t&&(t.startsWith("\\\\")?"\\\\"+t.slice(2).replace(/\\+/g,"\\").replace(/\\$/,""):t.replace(/\\+/g,"\\").replace(/\\$/,"")),joinPath:(...t)=>{let e=t.filter(Boolean).join("\\").replace(/\\+/g,"\\");return t[0]&&t[0].startsWith("\\\\")?"\\\\"+e.slice(2):e},getParentDirectory:t=>{if(!t)return t;let r=na.normalizePath(t).split("\\");return r.length<=1||r.length===2&&r[1]===""?null:(r.pop(),r.join("\\"))},getFilename:t=>{if(!t)return"";let r=na.normalizePath(t).split("\\");return r[r.length-1]},isPathTooLong:t=>t.length>=260&&!t.startsWith("\\\\?\\"),toLongPath:t=>!t||t.startsWith("\\\\?\\")?t:na.isUNCPath(t)?"\\\\?\\UNC\\"+t.slice(2):na.isAbsolutePath(t)&&t.length>=260?"\\\\?\\"+t:t},id={...er,isReservedFilename:t=>{let e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],r=t.split(".")[0].toUpperCase();return e.includes(r)},isValidFilename:t=>!/[<>:"|?*\x00-\x1f]/.test(t)&&!id.isReservedFilename(t)&&!t.endsWith(".")&&!t.endsWith(" ")&&t.trim().length>0,isPathLengthValid:t=>t.length<260},Rb={getAccentColor:()=>"#0078D4",isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,getWindowsStyles:()=>({borderRadius:"8px",backdropFilter:"blur(20px)",boxShadow:"0 2px 20px rgba(0, 0, 0, 0.1)"})},Eb={getContextMenuItems:()=>[{id:"open-with-lokus",label:"Open with Lokus",icon:"file-text"},{id:"reveal-in-explorer",label:"Reveal in Explorer",icon:"folder-open"}],getFileAssociations:()=>({".md":{description:"Markdown Document",icon:"markdown-icon",progId:"Lokus.Markdown"},".markdown":{description:"Markdown Document",icon:"markdown-icon",progId:"Lokus.Markdown"}})},Ab={getJumpListItems:t=>t.map(e=>({type:"task",title:e.name,description:e.path,program:"lokus.exe",args:`--workspace "${e.path}"`,iconPath:e.path,iconIndex:0})),getNotificationOptions:()=>({badge:!0,sound:!0,actions:!0,inline:!0,persistent:!1})}});var ud={};Ie(ud,{fileOperations:()=>Or,finderIntegration:()=>Ob,keyboardUtils:()=>Xn,macosFeatures:()=>Lb,macosPathUtils:()=>Pb,macosShortcuts:()=>$b,macosUI:()=>Db,macosValidation:()=>Ib,uiUtils:()=>ea,validationUtils:()=>er});var $b,Pb,Ib,Db,Ob,Lb,dd=z(()=>{ta();$b={newFile:"Cmd+N",newFolder:"Cmd+Shift+N",save:"Cmd+S",saveAs:"Cmd+Shift+S",close:"Cmd+W",closeAll:"Cmd+Option+W",find:"Cmd+F",findAndReplace:"Cmd+Option+F",findInFiles:"Cmd+Shift+F",commandPalette:"Cmd+K",quickOpen:"Cmd+P",spotlight:"Cmd+Space",quickLook:"Space",getInfo:"Cmd+I",showInFinder:"Cmd+Option+R",cut:"Cmd+X",copy:"Cmd+C",paste:"Cmd+V",selectAll:"Cmd+A",undo:"Cmd+Z",redo:"Cmd+Shift+Z",nextTab:"Cmd+Option+Right",previousTab:"Cmd+Option+Left",closeTab:"Cmd+W",reopenTab:"Cmd+Shift+T",toggleSidebar:"Cmd+B",togglePreview:"Cmd+Shift+V",zoomIn:"Cmd+Plus",zoomOut:"Cmd+Minus",resetZoom:"Cmd+0",minimize:"Cmd+M",hideWindow:"Cmd+H",hideOthers:"Cmd+Option+H",fullscreen:"Cmd+Control+F"},Pb={expandTilde:async t=>{if(t.startsWith("~/"))try{let{homeDir:e}=await Promise.resolve().then(()=>(Yn(),Ts)),r=await e();return t.replace("~/",r.endsWith("/")?r:`${r}/`)}catch{return t}return t},isICloudPath:t=>t.includes("/Library/Mobile Documents/com~apple~CloudDocs/"),getICloudRelativePath:t=>{let e="/Library/Mobile Documents/com~apple~CloudDocs/",r=t.indexOf(e);return r!==-1?t.substring(r+e.length):t},isAbsolutePath:t=>t.startsWith("/")||t.startsWith("~")},Ib={...er,isValidFilename:t=>!/[:/]/.test(t)&&!t.startsWith(".")&&t.trim().length>0,isFilenameLengthValid:t=>t.length<=255},Db={getAccentColor:()=>"#007AFF",isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,getMacStyles:()=>({borderRadius:"10px",backdropFilter:"blur(50px)",WebkitBackdropFilter:"blur(50px)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"}),getTrafficLightInset:()=>({left:"12px",top:"12px"})},Ob={getContextMenuItems:()=>[{id:"open-with-lokus",label:"Open with Lokus",icon:"file-text"},{id:"quick-look",label:"Quick Look",icon:"eye",shortcut:"Space"},{id:"reveal-in-finder",label:"Reveal in Finder",icon:"folder-open",shortcut:"Cmd+R"}],getFinderTags:()=>[{name:"Red",color:"#FF3B30"},{name:"Orange",color:"#FF9500"},{name:"Yellow",color:"#FFCC00"},{name:"Green",color:"#34C759"},{name:"Blue",color:"#007AFF"},{name:"Purple",color:"#5856D6"},{name:"Gray",color:"#8E8E93"}]},Lb={getTouchBarItems:()=>[{type:"button",label:"New Note",icon:"plus",action:"new-file"},{type:"button",label:"Search",icon:"search",action:"search"},{type:"colorPicker",action:"text-highlight"}],getContinuityOptions:()=>({handoff:!0,universalClipboard:!0,airdrop:!0}),getNotificationOptions:()=>({sound:"default",badge:!0,banner:!0,alert:!1})}});var gn,Ye,At,yn,he,Nr,Ci=z(()=>{lt();gn=class{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new Ye(this.width*e,this.height*e)}[ue](){return{width:this.width,height:this.height}}toJSON(){return this[ue]()}},Ye=class{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new gn(this.width/e,this.height/e)}[ue](){return{width:this.width,height:this.height}}toJSON(){return this[ue]()}},At=class{constructor(e){this.size=e}toLogical(e){return this.size instanceof gn?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof Ye?this.size:this.size.toPhysical(e)}[ue](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[ue]()}},yn=class{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new he(this.x*e,this.y*e)}[ue](){return{x:this.x,y:this.y}}toJSON(){return this[ue]()}},he=class{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new yn(this.x/e,this.y/e)}[ue](){return{x:this.x,y:this.y}}toJSON(){return this[ue]()}},Nr=class{constructor(e){this.position=e}toLogical(e){return this.position instanceof yn?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof he?this.position:this.position.toPhysical(e)}[ue](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[ue]()}}});function aa(t){return t==null?null:typeof t=="string"?t:t instanceof Ri?t.rid:t}var Ri,yd=z(()=>{lt();Ri=class t extends Xt{constructor(e){super(e)}static async new(e,r,n){return y("plugin:image|new",{rgba:aa(e),width:r,height:n}).then(s=>new t(s))}static async fromBytes(e){return y("plugin:image|from_bytes",{bytes:aa(e)}).then(r=>new t(r))}static async fromPath(e){return y("plugin:image|from_path",{path:e}).then(r=>new t(r))}async rgba(){return y("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return y("plugin:image|size",{rid:this.rid})}}});var kd={};Ie(kd,{CloseRequestedEvent:()=>Es,Effect:()=>$i,EffectState:()=>Pi,LogicalPosition:()=>yn,LogicalSize:()=>gn,PhysicalPosition:()=>he,PhysicalSize:()=>Ye,ProgressBarStatus:()=>Ai,UserAttentionType:()=>Rs,Window:()=>sa,availableMonitors:()=>qb,currentMonitor:()=>Fb,cursorPosition:()=>Bb,getAllWindows:()=>Cs,getCurrentWindow:()=>_d,monitorFromPoint:()=>Wb,primaryMonitor:()=>jb});function _d(){return new sa(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function Cs(){return y("plugin:window|get_all_windows").then(t=>t.map(e=>new sa(e,{skip:!0})))}function As(t){return t===null?null:{name:t.name,scaleFactor:t.scaleFactor,position:new he(t.position),size:new Ye(t.size),workArea:{position:new he(t.workArea.position),size:new Ye(t.workArea.size)}}}async function Fb(){return y("plugin:window|current_monitor").then(As)}async function jb(){return y("plugin:window|primary_monitor").then(As)}async function Wb(t,e){return y("plugin:window|monitor_from_point",{x:t,y:e}).then(As)}async function qb(){return y("plugin:window|available_monitors").then(t=>t.map(As))}async function Bb(){return y("plugin:window|cursor_position").then(t=>new he(t))}var Rs,Es,Ai,Ei,sa,bd,wd,$i,Pi,Sd=z(()=>{Ci();Ci();vs();lt();yd();(function(t){t[t.Critical=1]="Critical",t[t.Informational=2]="Informational"})(Rs||(Rs={}));Es=class{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}};(function(t){t.None="none",t.Normal="normal",t.Indeterminate="indeterminate",t.Paused="paused",t.Error="error"})(Ai||(Ai={}));Ei=["tauri://created","tauri://error"],sa=class{constructor(e,r={}){var n;this.label=e,this.listeners=Object.create(null),r?.skip||y("plugin:window|create",{options:{...r,parent:typeof r.parent=="string"?r.parent:(n=r.parent)===null||n===void 0?void 0:n.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static async getByLabel(e){var r;return(r=(await Cs()).find(n=>n.label===e))!==null&&r!==void 0?r:null}static getCurrent(){return _d()}static async getAll(){return Cs()}static async getFocusedWindow(){for(let e of await Cs())if(await e.isFocused())return e;return null}async listen(e,r){return this._handleTauriEvent(e,r)?()=>{let n=this.listeners[e];n.splice(n.indexOf(r),1)}:xs(e,r,{target:{kind:"Window",label:this.label}})}async once(e,r){return this._handleTauriEvent(e,r)?()=>{let n=this.listeners[e];n.splice(n.indexOf(r),1)}:ui(e,r,{target:{kind:"Window",label:this.label}})}async emit(e,r){if(Ei.includes(e)){for(let n of this.listeners[e]||[])n({event:e,id:-1,payload:r});return}return Zn(e,r)}async emitTo(e,r,n){if(Ei.includes(r)){for(let s of this.listeners[r]||[])s({event:r,id:-1,payload:n});return}return di(e,r,n)}_handleTauriEvent(e,r){return Ei.includes(e)?(e in this.listeners?this.listeners[e].push(r):this.listeners[e]=[r],!0):!1}async scaleFactor(){return y("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return y("plugin:window|inner_position",{label:this.label}).then(e=>new he(e))}async outerPosition(){return y("plugin:window|outer_position",{label:this.label}).then(e=>new he(e))}async innerSize(){return y("plugin:window|inner_size",{label:this.label}).then(e=>new Ye(e))}async outerSize(){return y("plugin:window|outer_size",{label:this.label}).then(e=>new Ye(e))}async isFullscreen(){return y("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return y("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return y("plugin:window|is_maximized",{label:this.label})}async isFocused(){return y("plugin:window|is_focused",{label:this.label})}async isDecorated(){return y("plugin:window|is_decorated",{label:this.label})}async isResizable(){return y("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return y("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return y("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return y("plugin:window|is_closable",{label:this.label})}async isVisible(){return y("plugin:window|is_visible",{label:this.label})}async title(){return y("plugin:window|title",{label:this.label})}async theme(){return y("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return y("plugin:window|is_always_on_top",{label:this.label})}async center(){return y("plugin:window|center",{label:this.label})}async requestUserAttention(e){let r=null;return e&&(e===Rs.Critical?r={type:"Critical"}:r={type:"Informational"}),y("plugin:window|request_user_attention",{label:this.label,value:r})}async setResizable(e){return y("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return y("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return y("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return y("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return y("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return y("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return y("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return y("plugin:window|maximize",{label:this.label})}async unmaximize(){return y("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return y("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return y("plugin:window|minimize",{label:this.label})}async unminimize(){return y("plugin:window|unminimize",{label:this.label})}async show(){return y("plugin:window|show",{label:this.label})}async hide(){return y("plugin:window|hide",{label:this.label})}async close(){return y("plugin:window|close",{label:this.label})}async destroy(){return y("plugin:window|destroy",{label:this.label})}async setDecorations(e){return y("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return y("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return y("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return y("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return y("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return y("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return y("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return y("plugin:window|set_size",{label:this.label,value:e instanceof At?e:new At(e)})}async setMinSize(e){return y("plugin:window|set_min_size",{label:this.label,value:e instanceof At?e:e?new At(e):null})}async setMaxSize(e){return y("plugin:window|set_max_size",{label:this.label,value:e instanceof At?e:e?new At(e):null})}async setSizeConstraints(e){function r(n){return n?{Logical:n}:null}return y("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:r(e?.minWidth),minHeight:r(e?.minHeight),maxWidth:r(e?.maxWidth),maxHeight:r(e?.maxHeight)}})}async setPosition(e){return y("plugin:window|set_position",{label:this.label,value:e instanceof Nr?e:new Nr(e)})}async setFullscreen(e){return y("plugin:window|set_fullscreen",{label:this.label,value:e})}async setSimpleFullscreen(e){return y("plugin:window|set_simple_fullscreen",{label:this.label,value:e})}async setFocus(){return y("plugin:window|set_focus",{label:this.label})}async setFocusable(e){return y("plugin:window|set_focusable",{label:this.label,value:e})}async setIcon(e){return y("plugin:window|set_icon",{label:this.label,value:aa(e)})}async setSkipTaskbar(e){return y("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return y("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return y("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return y("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return y("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return y("plugin:window|set_cursor_position",{label:this.label,value:e instanceof Nr?e:new Nr(e)})}async setIgnoreCursorEvents(e){return y("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return y("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return y("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return y("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return y("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return y("plugin:window|set_overlay_icon",{label:this.label,value:e?aa(e):void 0})}async setProgressBar(e){return y("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return y("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return y("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return y("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(pe.WINDOW_RESIZED,r=>{r.payload=new Ye(r.payload),e(r)})}async onMoved(e){return this.listen(pe.WINDOW_MOVED,r=>{r.payload=new he(r.payload),e(r)})}async onCloseRequested(e){return this.listen(pe.WINDOW_CLOSE_REQUESTED,async r=>{let n=new Es(r);await e(n),n.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){let r=await this.listen(pe.DRAG_ENTER,c=>{e({...c,payload:{type:"enter",paths:c.payload.paths,position:new he(c.payload.position)}})}),n=await this.listen(pe.DRAG_OVER,c=>{e({...c,payload:{type:"over",position:new he(c.payload.position)}})}),s=await this.listen(pe.DRAG_DROP,c=>{e({...c,payload:{type:"drop",paths:c.payload.paths,position:new he(c.payload.position)}})}),o=await this.listen(pe.DRAG_LEAVE,c=>{e({...c,payload:{type:"leave"}})});return()=>{r(),s(),n(),o()}}async onFocusChanged(e){let r=await this.listen(pe.WINDOW_FOCUS,s=>{e({...s,payload:!0})}),n=await this.listen(pe.WINDOW_BLUR,s=>{e({...s,payload:!1})});return()=>{r(),n()}}async onScaleChanged(e){return this.listen(pe.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(pe.WINDOW_THEME_CHANGED,e)}};(function(t){t.Disabled="disabled",t.Throttle="throttle",t.Suspend="suspend"})(bd||(bd={}));(function(t){t.Default="default",t.FluentOverlay="fluentOverlay"})(wd||(wd={}));(function(t){t.AppearanceBased="appearanceBased",t.Light="light",t.Dark="dark",t.MediumLight="mediumLight",t.UltraDark="ultraDark",t.Titlebar="titlebar",t.Selection="selection",t.Menu="menu",t.Popover="popover",t.Sidebar="sidebar",t.HeaderView="headerView",t.Sheet="sheet",t.WindowBackground="windowBackground",t.HudWindow="hudWindow",t.FullScreenUI="fullScreenUI",t.Tooltip="tooltip",t.ContentBackground="contentBackground",t.UnderWindowBackground="underWindowBackground",t.UnderPageBackground="underPageBackground",t.Mica="mica",t.Blur="blur",t.Acrylic="acrylic",t.Tabbed="tabbed",t.TabbedDark="tabbedDark",t.TabbedLight="tabbedLight"})($i||($i={}));(function(t){t.FollowsWindowActiveState="followsWindowActiveState",t.Active="active",t.Inactive="inactive"})(Pi||(Pi={}))});var h={};Ie(h,{BRAND:()=>ph,DIRTY:()=>lr,EMPTY_PATH:()=>Hp,INVALID:()=>I,NEVER:()=>Qh,OK:()=>ce,ParseStatus:()=>se,Schema:()=>F,ZodAny:()=>Vt,ZodArray:()=>vt,ZodBigInt:()=>dr,ZodBoolean:()=>fr,ZodBranded:()=>In,ZodCatch:()=>xr,ZodDate:()=>pr,ZodDefault:()=>Sr,ZodDiscriminatedUnion:()=>Ba,ZodEffects:()=>Le,ZodEnum:()=>_r,ZodError:()=>ge,ZodFirstPartyTypeKind:()=>D,ZodFunction:()=>za,ZodIntersection:()=>yr,ZodIssueCode:()=>S,ZodLazy:()=>br,ZodLiteral:()=>wr,ZodMap:()=>sn,ZodNaN:()=>cn,ZodNativeEnum:()=>kr,ZodNever:()=>Ue,ZodNull:()=>mr,ZodNullable:()=>nt,ZodNumber:()=>ur,ZodObject:()=>ye,ZodOptional:()=>De,ZodParsedType:()=>C,ZodPipeline:()=>Dn,ZodPromise:()=>Gt,ZodReadonly:()=>vr,ZodRecord:()=>Ua,ZodSchema:()=>F,ZodSet:()=>on,ZodString:()=>Ht,ZodSymbol:()=>nn,ZodTransformer:()=>Le,ZodTuple:()=>rt,ZodType:()=>F,ZodUndefined:()=>hr,ZodUnion:()=>gr,ZodUnknown:()=>xt,ZodVoid:()=>an,addIssueToContext:()=>v,any:()=>Sh,array:()=>Ch,bigint:()=>yh,boolean:()=>yl,coerce:()=>Yh,custom:()=>hl,date:()=>bh,datetimeRegex:()=>fl,defaultErrorMap:()=>kt,discriminatedUnion:()=>$h,effect:()=>Bh,enum:()=>jh,function:()=>Nh,getErrorMap:()=>en,getParsedType:()=>tt,instanceof:()=>mh,intersection:()=>Ph,isAborted:()=>Wa,isAsync:()=>tn,isDirty:()=>qa,isValid:()=>zt,late:()=>hh,lazy:()=>Mh,literal:()=>Fh,makeIssue:()=>Pn,map:()=>Oh,nan:()=>gh,nativeEnum:()=>Wh,never:()=>vh,null:()=>kh,nullable:()=>zh,number:()=>gl,object:()=>Rh,objectUtil:()=>So,oboolean:()=>Zh,onumber:()=>Jh,optional:()=>Uh,ostring:()=>Gh,pipeline:()=>Vh,preprocess:()=>Hh,promise:()=>qh,quotelessJson:()=>Bp,record:()=>Dh,set:()=>Lh,setErrorMap:()=>zp,strictObject:()=>Eh,string:()=>ml,symbol:()=>wh,transformer:()=>Bh,tuple:()=>Ih,undefined:()=>_h,union:()=>Ah,unknown:()=>xh,util:()=>q,void:()=>Th});var q;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{let o={};for(let c of s)o[c]=c;return o},t.getValidEnumValues=s=>{let o=t.objectKeys(s).filter(u=>typeof s[s[u]]!="number"),c={};for(let u of o)c[u]=s[u];return t.objectValues(c)},t.objectValues=s=>t.objectKeys(s).map(function(o){return s[o]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let o=[];for(let c in s)Object.prototype.hasOwnProperty.call(s,c)&&o.push(c);return o},t.find=(s,o)=>{for(let c of s)if(o(c))return c},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,o=" | "){return s.map(c=>typeof c=="string"?`'${c}'`:c).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(q||(q={}));var So;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(So||(So={}));var C=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),tt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}};var S=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Bp=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),ge=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(o){return o.message},n={_errors:[]},s=o=>{for(let c of o.issues)if(c.code==="invalid_union")c.unionErrors.map(s);else if(c.code==="invalid_return_type")s(c.returnTypeError);else if(c.code==="invalid_arguments")s(c.argumentsError);else if(c.path.length===0)n._errors.push(r(c));else{let u=n,f=0;for(;f<c.path.length;){let d=c.path[f];f===c.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(r(c))):u[d]=u[d]||{_errors:[]},u=u[d],f++}}};return s(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let s of this.issues)if(s.path.length>0){let o=s.path[0];r[o]=r[o]||[],r[o].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};ge.create=t=>new ge(t);var Up=(t,e)=>{let r;switch(t.code){case S.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,q.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:r=`Unrecognized key(s) in object: ${q.joinValues(t.keys,", ")}`;break;case S.invalid_union:r="Invalid input";break;case S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${q.joinValues(t.options)}`;break;case S.invalid_enum_value:r=`Invalid enum value. Expected ${q.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:r="Invalid function arguments";break;case S.invalid_return_type:r="Invalid function return type";break;case S.invalid_date:r="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case S.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case S.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case S.custom:r="Invalid input";break;case S.invalid_intersection_types:r="Intersection results could not be merged";break;case S.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:r="Number must be finite";break;default:r=e.defaultError,q.assertNever(t)}return{message:r}},kt=Up;var il=kt;function zp(t){il=t}function en(){return il}var Pn=t=>{let{data:e,path:r,errorMaps:n,issueData:s}=t,o=[...r,...s.path||[]],c={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let u="",f=n.filter(d=>!!d).slice().reverse();for(let d of f)u=d(c,{data:e,defaultError:u}).message;return{...s,path:o,message:u}},Hp=[];function v(t,e){let r=en(),n=Pn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===kt?void 0:kt].filter(s=>!!s)});t.common.issues.push(n)}var se=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let s of r){if(s.status==="aborted")return I;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let s of r){let o=await s.key,c=await s.value;n.push({key:o,value:c})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let s of r){let{key:o,value:c}=s;if(o.status==="aborted"||c.status==="aborted")return I;o.status==="dirty"&&e.dirty(),c.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof c.value<"u"||s.alwaysSet)&&(n[o.value]=c.value)}return{status:e.value,value:n}}},I=Object.freeze({status:"aborted"}),lr=t=>({status:"dirty",value:t}),ce=t=>({status:"valid",value:t}),Wa=t=>t.status==="aborted",qa=t=>t.status==="dirty",zt=t=>t.status==="valid",tn=t=>typeof Promise<"u"&&t instanceof Promise;var E;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(E||(E={}));var Oe=class{constructor(e,r,n,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},cl=(t,e)=>{if(zt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ge(t.common.issues);return this._error=r,this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:s}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(c,u)=>{let{message:f}=t;return c.code==="invalid_enum_value"?{message:f??u.defaultError}:typeof u.data>"u"?{message:f??n??u.defaultError}:c.code!=="invalid_type"?{message:u.defaultError}:{message:f??r??u.defaultError}},description:s}}var F=class{get description(){return this._def.description}_getType(e){return tt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new se,ctx:{common:e.parent.common,data:e.data,parsedType:tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(tn(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)},s=this._parseSync({data:e,path:n.path,parent:n});return cl(n,s)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return zt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>zt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tt(e)},s=this._parse({data:e,path:n.path,parent:n}),o=await(tn(s)?s:Promise.resolve(s));return cl(n,o)}refine(e,r){let n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,o)=>{let c=e(s),u=()=>o.addIssue({code:S.custom,...n(s)});return typeof Promise<"u"&&c instanceof Promise?c.then(f=>f?!0:(u(),!1)):c?!0:(u(),!1)})}refinement(e,r){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(e){return new Le({schema:this,typeName:D.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return De.create(this,this._def)}nullable(){return nt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vt.create(this)}promise(){return Gt.create(this,this._def)}or(e){return gr.create([this,e],this._def)}and(e){return yr.create(this,e,this._def)}transform(e){return new Le({...M(this._def),schema:this,typeName:D.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Sr({...M(this._def),innerType:this,defaultValue:r,typeName:D.ZodDefault})}brand(){return new In({typeName:D.ZodBranded,type:this,...M(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new xr({...M(this._def),innerType:this,catchValue:r,typeName:D.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Dn.create(this,e)}readonly(){return vr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Vp=/^c[^\s-]{8,}$/i,Gp=/^[0-9a-z]+$/,Jp=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Zp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Yp=/^[a-z0-9_-]{21}$/i,Qp=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Kp=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Xp=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,eh="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",xo,th=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,nh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ah=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,sh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,oh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ul="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ih=new RegExp(`^${ul}$`);function dl(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function ch(t){return new RegExp(`^${dl(t)}$`)}function fl(t){let e=`${ul}T${dl(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function lh(t,e){return!!((e==="v4"||!e)&&th.test(t)||(e==="v6"||!e)&&nh.test(t))}function uh(t,e){if(!Qp.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function dh(t,e){return!!((e==="v4"||!e)&&rh.test(t)||(e==="v6"||!e)&&ah.test(t))}var Ht=class t extends F{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let o=this._getOrReturnCtx(e);return v(o,{code:S.invalid_type,expected:C.string,received:o.parsedType}),I}let n=new se,s;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:S.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:S.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){let c=e.data.length>o.value,u=e.data.length<o.value;(c||u)&&(s=this._getOrReturnCtx(e,s),c?v(s,{code:S.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):u&&v(s,{code:S.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Xp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"email",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")xo||(xo=new RegExp(eh,"u")),xo.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"emoji",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")Zp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"uuid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")Yp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"nanoid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")Vp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")Gp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid2",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")Jp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ulid",code:S.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),v(s,{validation:"url",code:S.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"regex",code:S.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?fl(o).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?ih.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?ch(o).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:S.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?Kp.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"duration",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?lh(e.data,o.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ip",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?uh(e.data,o.alg)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"jwt",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?dh(e.data,o.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cidr",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?sh.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"base64",code:S.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?oh.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"base64url",code:S.invalid_string,message:o.message}),n.dirty()):q.assertNever(o);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(s=>e.test(s),{validation:r,code:S.invalid_string,...E.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...E.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...E.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...E.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...E.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...E.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...E.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...E.errToObj(r)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Ht.create=t=>new Ht({checks:[],typeName:D.ZodString,coerce:t?.coerce??!1,...M(t)});function fh(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,o=Number.parseInt(t.toFixed(s).replace(".","")),c=Number.parseInt(e.toFixed(s).replace(".",""));return o%c/10**s}var ur=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let o=this._getOrReturnCtx(e);return v(o,{code:S.invalid_type,expected:C.number,received:o.parsedType}),I}let n,s=new se;for(let o of this._def.checks)o.kind==="int"?q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),v(n,{code:S.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?fh(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),v(n,{code:S.not_finite,message:o.message}),s.dirty()):q.assertNever(o);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,E.toString(r))}gt(e,r){return this.setLimit("min",e,!1,E.toString(r))}lte(e,r){return this.setLimit("max",e,!0,E.toString(r))}lt(e,r){return this.setLimit("max",e,!1,E.toString(r))}setLimit(e,r,n,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:E.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};ur.create=t=>new ur({checks:[],typeName:D.ZodNumber,coerce:t?.coerce||!1,...M(t)});var dr=class t extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,s=new se;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),v(n,{code:S.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):q.assertNever(o);return{status:s.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return v(r,{code:S.invalid_type,expected:C.bigint,received:r.parsedType}),I}gte(e,r){return this.setLimit("min",e,!0,E.toString(r))}gt(e,r){return this.setLimit("min",e,!1,E.toString(r))}lte(e,r){return this.setLimit("max",e,!0,E.toString(r))}lt(e,r){return this.setLimit("max",e,!1,E.toString(r))}setLimit(e,r,n,s){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:E.toString(s)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};dr.create=t=>new dr({checks:[],typeName:D.ZodBigInt,coerce:t?.coerce??!1,...M(t)});var fr=class extends F{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.boolean,received:n.parsedType}),I}return ce(e.data)}};fr.create=t=>new fr({typeName:D.ZodBoolean,coerce:t?.coerce||!1,...M(t)});var pr=class t extends F{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let o=this._getOrReturnCtx(e);return v(o,{code:S.invalid_type,expected:C.date,received:o.parsedType}),I}if(Number.isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return v(o,{code:S.invalid_date}),I}let n=new se,s;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:S.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:S.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):q.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};pr.create=t=>new pr({checks:[],coerce:t?.coerce||!1,typeName:D.ZodDate,...M(t)});var nn=class extends F{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.symbol,received:n.parsedType}),I}return ce(e.data)}};nn.create=t=>new nn({typeName:D.ZodSymbol,...M(t)});var hr=class extends F{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.undefined,received:n.parsedType}),I}return ce(e.data)}};hr.create=t=>new hr({typeName:D.ZodUndefined,...M(t)});var mr=class extends F{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.null,received:n.parsedType}),I}return ce(e.data)}};mr.create=t=>new mr({typeName:D.ZodNull,...M(t)});var Vt=class extends F{constructor(){super(...arguments),this._any=!0}_parse(e){return ce(e.data)}};Vt.create=t=>new Vt({typeName:D.ZodAny,...M(t)});var xt=class extends F{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ce(e.data)}};xt.create=t=>new xt({typeName:D.ZodUnknown,...M(t)});var Ue=class extends F{_parse(e){let r=this._getOrReturnCtx(e);return v(r,{code:S.invalid_type,expected:C.never,received:r.parsedType}),I}};Ue.create=t=>new Ue({typeName:D.ZodNever,...M(t)});var an=class extends F{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.void,received:n.parsedType}),I}return ce(e.data)}};an.create=t=>new an({typeName:D.ZodVoid,...M(t)});var vt=class t extends F{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),s=this._def;if(r.parsedType!==C.array)return v(r,{code:S.invalid_type,expected:C.array,received:r.parsedType}),I;if(s.exactLength!==null){let c=r.data.length>s.exactLength.value,u=r.data.length<s.exactLength.value;(c||u)&&(v(r,{code:c?S.too_big:S.too_small,minimum:u?s.exactLength.value:void 0,maximum:c?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(v(r,{code:S.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(v(r,{code:S.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((c,u)=>s.type._parseAsync(new Oe(r,c,r.path,u)))).then(c=>se.mergeArray(n,c));let o=[...r.data].map((c,u)=>s.type._parseSync(new Oe(r,c,r.path,u)));return se.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:E.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:E.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:E.toString(r)}})}nonempty(e){return this.min(1,e)}};vt.create=(t,e)=>new vt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:D.ZodArray,...M(e)});function rn(t){if(t instanceof ye){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=De.create(rn(n))}return new ye({...t._def,shape:()=>e})}else return t instanceof vt?new vt({...t._def,type:rn(t.element)}):t instanceof De?De.create(rn(t.unwrap())):t instanceof nt?nt.create(rn(t.unwrap())):t instanceof rt?rt.create(t.items.map(e=>rn(e))):t}var ye=class t extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=q.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==C.object){let d=this._getOrReturnCtx(e);return v(d,{code:S.invalid_type,expected:C.object,received:d.parsedType}),I}let{status:n,ctx:s}=this._processInputParams(e),{shape:o,keys:c}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ue&&this._def.unknownKeys==="strip"))for(let d in s.data)c.includes(d)||u.push(d);let f=[];for(let d of c){let m=o[d],w=s.data[d];f.push({key:{status:"valid",value:d},value:m._parse(new Oe(s,w,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Ue){let d=this._def.unknownKeys;if(d==="passthrough")for(let m of u)f.push({key:{status:"valid",value:m},value:{status:"valid",value:s.data[m]}});else if(d==="strict")u.length>0&&(v(s,{code:S.unrecognized_keys,keys:u}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let m of u){let w=s.data[m];f.push({key:{status:"valid",value:m},value:d._parse(new Oe(s,w,s.path,m)),alwaysSet:m in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let d=[];for(let m of f){let w=await m.key,k=await m.value;d.push({key:w,value:k,alwaysSet:m.alwaysSet})}return d}).then(d=>se.mergeObjectSync(n,d)):se.mergeObjectSync(n,f)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let s=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:D.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of q.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of q.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return rn(this)}partial(e){let r={};for(let n of q.objectKeys(this.shape)){let s=this.shape[n];e&&!e[n]?r[n]=s:r[n]=s.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of q.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof De;)o=o._def.innerType;r[n]=o}return new t({...this._def,shape:()=>r})}keyof(){return pl(q.objectKeys(this.shape))}};ye.create=(t,e)=>new ye({shape:()=>t,unknownKeys:"strip",catchall:Ue.create(),typeName:D.ZodObject,...M(e)});ye.strictCreate=(t,e)=>new ye({shape:()=>t,unknownKeys:"strict",catchall:Ue.create(),typeName:D.ZodObject,...M(e)});ye.lazycreate=(t,e)=>new ye({shape:t,unknownKeys:"strip",catchall:Ue.create(),typeName:D.ZodObject,...M(e)});var gr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function s(o){for(let u of o)if(u.result.status==="valid")return u.result;for(let u of o)if(u.result.status==="dirty")return r.common.issues.push(...u.ctx.common.issues),u.result;let c=o.map(u=>new ge(u.ctx.common.issues));return v(r,{code:S.invalid_union,unionErrors:c}),I}if(r.common.async)return Promise.all(n.map(async o=>{let c={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:c}),ctx:c}})).then(s);{let o,c=[];for(let f of n){let d={...r,common:{...r.common,issues:[]},parent:null},m=f._parseSync({data:r.data,path:r.path,parent:d});if(m.status==="valid")return m;m.status==="dirty"&&!o&&(o={result:m,ctx:d}),d.common.issues.length&&c.push(d.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;let u=c.map(f=>new ge(f));return v(r,{code:S.invalid_union,unionErrors:u}),I}}get options(){return this._def.options}};gr.create=(t,e)=>new gr({options:t,typeName:D.ZodUnion,...M(e)});var St=t=>t instanceof br?St(t.schema):t instanceof Le?St(t.innerType()):t instanceof wr?[t.value]:t instanceof _r?t.options:t instanceof kr?q.objectValues(t.enum):t instanceof Sr?St(t._def.innerType):t instanceof hr?[void 0]:t instanceof mr?[null]:t instanceof De?[void 0,...St(t.unwrap())]:t instanceof nt?[null,...St(t.unwrap())]:t instanceof In||t instanceof vr?St(t.unwrap()):t instanceof xr?St(t._def.innerType):[],Ba=class t extends F{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return v(r,{code:S.invalid_type,expected:C.object,received:r.parsedType}),I;let n=this.discriminator,s=r.data[n],o=this.optionsMap.get(s);return o?r.common.async?o._parseAsync({data:r.data,path:r.path,parent:r}):o._parseSync({data:r.data,path:r.path,parent:r}):(v(r,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),I)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let s=new Map;for(let o of r){let c=St(o.shape[e]);if(!c.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let u of c){if(s.has(u))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(u)}`);s.set(u,o)}}return new t({typeName:D.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:s,...M(n)})}};function vo(t,e){let r=tt(t),n=tt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let s=q.objectKeys(e),o=q.objectKeys(t).filter(u=>s.indexOf(u)!==-1),c={...t,...e};for(let u of o){let f=vo(t[u],e[u]);if(!f.valid)return{valid:!1};c[u]=f.data}return{valid:!0,data:c}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let o=0;o<t.length;o++){let c=t[o],u=e[o],f=vo(c,u);if(!f.valid)return{valid:!1};s.push(f.data)}return{valid:!0,data:s}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var yr=class extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),s=(o,c)=>{if(Wa(o)||Wa(c))return I;let u=vo(o.value,c.value);return u.valid?((qa(o)||qa(c))&&r.dirty(),{status:r.value,value:u.data}):(v(n,{code:S.invalid_intersection_types}),I)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,c])=>s(o,c)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};yr.create=(t,e,r)=>new yr({left:t,right:e,typeName:D.ZodIntersection,...M(r)});var rt=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return v(n,{code:S.invalid_type,expected:C.array,received:n.parsedType}),I;if(n.data.length<this._def.items.length)return v(n,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),I;!this._def.rest&&n.data.length>this._def.items.length&&(v(n,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let o=[...n.data].map((c,u)=>{let f=this._def.items[u]||this._def.rest;return f?f._parse(new Oe(n,c,n.path,u)):null}).filter(c=>!!c);return n.common.async?Promise.all(o).then(c=>se.mergeArray(r,c)):se.mergeArray(r,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};rt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new rt({items:t,typeName:D.ZodTuple,rest:null,...M(e)})};var Ua=class t extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return v(n,{code:S.invalid_type,expected:C.object,received:n.parsedType}),I;let s=[],o=this._def.keyType,c=this._def.valueType;for(let u in n.data)s.push({key:o._parse(new Oe(n,u,n.path,u)),value:c._parse(new Oe(n,n.data[u],n.path,u)),alwaysSet:u in n.data});return n.common.async?se.mergeObjectAsync(r,s):se.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof F?new t({keyType:e,valueType:r,typeName:D.ZodRecord,...M(n)}):new t({keyType:Ht.create(),valueType:e,typeName:D.ZodRecord,...M(r)})}},sn=class extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return v(n,{code:S.invalid_type,expected:C.map,received:n.parsedType}),I;let s=this._def.keyType,o=this._def.valueType,c=[...n.data.entries()].map(([u,f],d)=>({key:s._parse(new Oe(n,u,n.path,[d,"key"])),value:o._parse(new Oe(n,f,n.path,[d,"value"]))}));if(n.common.async){let u=new Map;return Promise.resolve().then(async()=>{for(let f of c){let d=await f.key,m=await f.value;if(d.status==="aborted"||m.status==="aborted")return I;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),u.set(d.value,m.value)}return{status:r.value,value:u}})}else{let u=new Map;for(let f of c){let d=f.key,m=f.value;if(d.status==="aborted"||m.status==="aborted")return I;(d.status==="dirty"||m.status==="dirty")&&r.dirty(),u.set(d.value,m.value)}return{status:r.value,value:u}}}};sn.create=(t,e,r)=>new sn({valueType:e,keyType:t,typeName:D.ZodMap,...M(r)});var on=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return v(n,{code:S.invalid_type,expected:C.set,received:n.parsedType}),I;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(v(n,{code:S.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(v(n,{code:S.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());let o=this._def.valueType;function c(f){let d=new Set;for(let m of f){if(m.status==="aborted")return I;m.status==="dirty"&&r.dirty(),d.add(m.value)}return{status:r.value,value:d}}let u=[...n.data.values()].map((f,d)=>o._parse(new Oe(n,f,n.path,d)));return n.common.async?Promise.all(u).then(f=>c(f)):c(u)}min(e,r){return new t({...this._def,minSize:{value:e,message:E.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:E.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};on.create=(t,e)=>new on({valueType:t,minSize:null,maxSize:null,typeName:D.ZodSet,...M(e)});var za=class t extends F{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return v(r,{code:S.invalid_type,expected:C.function,received:r.parsedType}),I;function n(u,f){return Pn({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,en(),kt].filter(d=>!!d),issueData:{code:S.invalid_arguments,argumentsError:f}})}function s(u,f){return Pn({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,en(),kt].filter(d=>!!d),issueData:{code:S.invalid_return_type,returnTypeError:f}})}let o={errorMap:r.common.contextualErrorMap},c=r.data;if(this._def.returns instanceof Gt){let u=this;return ce(async function(...f){let d=new ge([]),m=await u._def.args.parseAsync(f,o).catch(R=>{throw d.addIssue(n(f,R)),d}),w=await Reflect.apply(c,this,m);return await u._def.returns._def.type.parseAsync(w,o).catch(R=>{throw d.addIssue(s(w,R)),d})})}else{let u=this;return ce(function(...f){let d=u._def.args.safeParse(f,o);if(!d.success)throw new ge([n(f,d.error)]);let m=Reflect.apply(c,this,d.data),w=u._def.returns.safeParse(m,o);if(!w.success)throw new ge([s(m,w.error)]);return w.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:rt.create(e).rest(xt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||rt.create([]).rest(xt.create()),returns:r||xt.create(),typeName:D.ZodFunction,...M(n)})}},br=class extends F{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};br.create=(t,e)=>new br({getter:t,typeName:D.ZodLazy,...M(e)});var wr=class extends F{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return v(r,{received:r.data,code:S.invalid_literal,expected:this._def.value}),I}return{status:"valid",value:e.data}}get value(){return this._def.value}};wr.create=(t,e)=>new wr({value:t,typeName:D.ZodLiteral,...M(e)});function pl(t,e){return new _r({values:t,typeName:D.ZodEnum,...M(e)})}var _r=class t extends F{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return v(r,{expected:q.joinValues(n),received:r.parsedType,code:S.invalid_type}),I}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return v(r,{received:r.data,code:S.invalid_enum_value,options:n}),I}return ce(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};_r.create=pl;var kr=class extends F{_parse(e){let r=q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let s=q.objectValues(r);return v(n,{expected:q.joinValues(s),received:n.parsedType,code:S.invalid_type}),I}if(this._cache||(this._cache=new Set(q.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=q.objectValues(r);return v(n,{received:n.data,code:S.invalid_enum_value,options:s}),I}return ce(e.data)}get enum(){return this._def.values}};kr.create=(t,e)=>new kr({values:t,typeName:D.ZodNativeEnum,...M(e)});var Gt=class extends F{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return v(r,{code:S.invalid_type,expected:C.promise,received:r.parsedType}),I;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return ce(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Gt.create=(t,e)=>new Gt({type:t,typeName:D.ZodPromise,...M(e)});var Le=class extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===D.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),s=this._def.effect||null,o={addIssue:c=>{v(n,c),c.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){let c=s.transform(n.data,o);if(n.common.async)return Promise.resolve(c).then(async u=>{if(r.value==="aborted")return I;let f=await this._def.schema._parseAsync({data:u,path:n.path,parent:n});return f.status==="aborted"?I:f.status==="dirty"?lr(f.value):r.value==="dirty"?lr(f.value):f});{if(r.value==="aborted")return I;let u=this._def.schema._parseSync({data:c,path:n.path,parent:n});return u.status==="aborted"?I:u.status==="dirty"?lr(u.value):r.value==="dirty"?lr(u.value):u}}if(s.type==="refinement"){let c=u=>{let f=s.refinement(u,o);if(n.common.async)return Promise.resolve(f);if(f instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(n.common.async===!1){let u=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return u.status==="aborted"?I:(u.status==="dirty"&&r.dirty(),c(u.value),{status:r.value,value:u.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(u=>u.status==="aborted"?I:(u.status==="dirty"&&r.dirty(),c(u.value).then(()=>({status:r.value,value:u.value}))))}if(s.type==="transform")if(n.common.async===!1){let c=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!zt(c))return I;let u=s.transform(c.value,o);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:u}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(c=>zt(c)?Promise.resolve(s.transform(c.value,o)).then(u=>({status:r.value,value:u})):I);q.assertNever(s)}};Le.create=(t,e,r)=>new Le({schema:t,typeName:D.ZodEffects,effect:e,...M(r)});Le.createWithPreprocess=(t,e,r)=>new Le({schema:e,effect:{type:"preprocess",transform:t},typeName:D.ZodEffects,...M(r)});var De=class extends F{_parse(e){return this._getType(e)===C.undefined?ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};De.create=(t,e)=>new De({innerType:t,typeName:D.ZodOptional,...M(e)});var nt=class extends F{_parse(e){return this._getType(e)===C.null?ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};nt.create=(t,e)=>new nt({innerType:t,typeName:D.ZodNullable,...M(e)});var Sr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Sr.create=(t,e)=>new Sr({innerType:t,typeName:D.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var xr=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return tn(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new ge(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ge(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};xr.create=(t,e)=>new xr({innerType:t,typeName:D.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var cn=class extends F{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return v(n,{code:S.invalid_type,expected:C.nan,received:n.parsedType}),I}return{status:"valid",value:e.data}}};cn.create=t=>new cn({typeName:D.ZodNaN,...M(t)});var ph=Symbol("zod_brand"),In=class extends F{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Dn=class t extends F{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?I:o.status==="dirty"?(r.dirty(),lr(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?I:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:D.ZodPipeline})}},vr=class extends F{_parse(e){let r=this._def.innerType._parse(e),n=s=>(zt(s)&&(s.value=Object.freeze(s.value)),s);return tn(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}};vr.create=(t,e)=>new vr({innerType:t,typeName:D.ZodReadonly,...M(e)});function ll(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function hl(t,e={},r){return t?Vt.create().superRefine((n,s)=>{let o=t(n);if(o instanceof Promise)return o.then(c=>{if(!c){let u=ll(e,n),f=u.fatal??r??!0;s.addIssue({code:"custom",...u,fatal:f})}});if(!o){let c=ll(e,n),u=c.fatal??r??!0;s.addIssue({code:"custom",...c,fatal:u})}}):Vt.create()}var hh={object:ye.lazycreate},D;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(D||(D={}));var mh=(t,e={message:`Input not instance of ${t.name}`})=>hl(r=>r instanceof t,e),ml=Ht.create,gl=ur.create,gh=cn.create,yh=dr.create,yl=fr.create,bh=pr.create,wh=nn.create,_h=hr.create,kh=mr.create,Sh=Vt.create,xh=xt.create,vh=Ue.create,Th=an.create,Ch=vt.create,Rh=ye.create,Eh=ye.strictCreate,Ah=gr.create,$h=Ba.create,Ph=yr.create,Ih=rt.create,Dh=Ua.create,Oh=sn.create,Lh=on.create,Nh=za.create,Mh=br.create,Fh=wr.create,jh=_r.create,Wh=kr.create,qh=Gt.create,Bh=Le.create,Uh=De.create,zh=nt.create,Hh=Le.createWithPreprocess,Vh=Dn.create,Gh=()=>ml().optional(),Jh=()=>gl().optional(),Zh=()=>yl().optional(),Yh={string:(t=>Ht.create({...t,coerce:!0})),number:(t=>ur.create({...t,coerce:!0})),boolean:(t=>fr.create({...t,coerce:!0})),bigint:(t=>dr.create({...t,coerce:!0})),date:(t=>pr.create({...t,coerce:!0}))};var Qh=I;var To="2024-11-05",bl=[To,"2024-10-07"],Ha="2.0",wl=h.union([h.string(),h.number().int()]),_l=h.string(),ze=h.object({_meta:h.optional(h.object({progressToken:h.optional(wl)}).passthrough())}).passthrough(),Se=h.object({method:h.string(),params:h.optional(ze)}),Ln=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),at=h.object({method:h.string(),params:h.optional(Ln)}),He=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),Va=h.union([h.string(),h.number().int()]),Kh=h.object({jsonrpc:h.literal(Ha),id:Va}).merge(Se).strict(),Xh=h.object({jsonrpc:h.literal(Ha)}).merge(at).strict(),em=h.object({jsonrpc:h.literal(Ha),id:Va,result:He}).strict(),ln;(function(t){t[t.ConnectionClosed=-1]="ConnectionClosed",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError"})(ln||(ln={}));var tm=h.object({jsonrpc:h.literal(Ha),id:Va,error:h.object({code:h.number().int(),message:h.string(),data:h.optional(h.unknown())})}).strict(),kl=h.union([Kh,Xh,em,tm]),Ga=He.strict(),Ja=at.extend({method:h.literal("notifications/cancelled"),params:Ln.extend({requestId:Va,reason:h.string().optional()})}),Sl=h.object({name:h.string(),version:h.string()}).passthrough(),rm=h.object({experimental:h.optional(h.object({}).passthrough()),sampling:h.optional(h.object({}).passthrough()),roots:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),Co=Se.extend({method:h.literal("initialize"),params:ze.extend({protocolVersion:h.string(),capabilities:rm,clientInfo:Sl})}),nm=h.object({experimental:h.optional(h.object({}).passthrough()),logging:h.optional(h.object({}).passthrough()),prompts:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough()),resources:h.optional(h.object({subscribe:h.optional(h.boolean()),listChanged:h.optional(h.boolean())}).passthrough()),tools:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),am=He.extend({protocolVersion:h.string(),capabilities:nm,serverInfo:Sl}),Ro=at.extend({method:h.literal("notifications/initialized")}),Za=Se.extend({method:h.literal("ping")}),sm=h.object({progress:h.number(),total:h.optional(h.number())}).passthrough(),Ya=at.extend({method:h.literal("notifications/progress"),params:Ln.merge(sm).extend({progressToken:wl})}),Qa=Se.extend({params:ze.extend({cursor:h.optional(_l)}).optional()}),Ka=He.extend({nextCursor:h.optional(_l)}),xl=h.object({uri:h.string(),mimeType:h.optional(h.string())}).passthrough(),vl=xl.extend({text:h.string()}),Tl=xl.extend({blob:h.string().base64()}),om=h.object({uri:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),im=h.object({uriTemplate:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),Eo=Qa.extend({method:h.literal("resources/list")}),cm=Ka.extend({resources:h.array(om)}),lm=Qa.extend({method:h.literal("resources/templates/list")}),um=Ka.extend({resourceTemplates:h.array(im)}),Ao=Se.extend({method:h.literal("resources/read"),params:ze.extend({uri:h.string()})}),dm=He.extend({contents:h.array(h.union([vl,Tl]))}),fm=at.extend({method:h.literal("notifications/resources/list_changed")}),pm=Se.extend({method:h.literal("resources/subscribe"),params:ze.extend({uri:h.string()})}),hm=Se.extend({method:h.literal("resources/unsubscribe"),params:ze.extend({uri:h.string()})}),mm=at.extend({method:h.literal("notifications/resources/updated"),params:Ln.extend({uri:h.string()})}),gm=h.object({name:h.string(),description:h.optional(h.string()),required:h.optional(h.boolean())}).passthrough(),ym=h.object({name:h.string(),description:h.optional(h.string()),arguments:h.optional(h.array(gm))}).passthrough(),bm=Qa.extend({method:h.literal("prompts/list")}),wm=Ka.extend({prompts:h.array(ym)}),_m=Se.extend({method:h.literal("prompts/get"),params:ze.extend({name:h.string(),arguments:h.optional(h.record(h.string()))})}),Xa=h.object({type:h.literal("text"),text:h.string()}).passthrough(),es=h.object({type:h.literal("image"),data:h.string().base64(),mimeType:h.string()}).passthrough(),Cl=h.object({type:h.literal("resource"),resource:h.union([vl,Tl])}).passthrough(),km=h.object({role:h.enum(["user","assistant"]),content:h.union([Xa,es,Cl])}).passthrough(),Sm=He.extend({description:h.optional(h.string()),messages:h.array(km)}),xm=at.extend({method:h.literal("notifications/prompts/list_changed")}),vm=h.object({name:h.string(),description:h.optional(h.string()),inputSchema:h.object({type:h.literal("object"),properties:h.optional(h.object({}).passthrough())}).passthrough()}).passthrough(),$o=Qa.extend({method:h.literal("tools/list")}),Tm=Ka.extend({tools:h.array(vm)}),Rl=He.extend({content:h.array(h.union([Xa,es,Cl])),isError:h.boolean().default(!1).optional()}),i_=Rl.or(He.extend({toolResult:h.unknown()})),Po=Se.extend({method:h.literal("tools/call"),params:ze.extend({name:h.string(),arguments:h.optional(h.record(h.unknown()))})}),Cm=at.extend({method:h.literal("notifications/tools/list_changed")}),El=h.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),Rm=Se.extend({method:h.literal("logging/setLevel"),params:ze.extend({level:El})}),Em=at.extend({method:h.literal("notifications/message"),params:Ln.extend({level:El,logger:h.optional(h.string()),data:h.unknown()})}),Am=h.object({name:h.string().optional()}).passthrough(),$m=h.object({hints:h.optional(h.array(Am)),costPriority:h.optional(h.number().min(0).max(1)),speedPriority:h.optional(h.number().min(0).max(1)),intelligencePriority:h.optional(h.number().min(0).max(1))}).passthrough(),Pm=h.object({role:h.enum(["user","assistant"]),content:h.union([Xa,es])}).passthrough(),Im=Se.extend({method:h.literal("sampling/createMessage"),params:ze.extend({messages:h.array(Pm),systemPrompt:h.optional(h.string()),includeContext:h.optional(h.enum(["none","thisServer","allServers"])),temperature:h.optional(h.number()),maxTokens:h.number().int(),stopSequences:h.optional(h.array(h.string())),metadata:h.optional(h.object({}).passthrough()),modelPreferences:h.optional($m)})}),Io=He.extend({model:h.string(),stopReason:h.optional(h.enum(["endTurn","stopSequence","maxTokens"]).or(h.string())),role:h.enum(["user","assistant"]),content:h.discriminatedUnion("type",[Xa,es])}),Dm=h.object({type:h.literal("ref/resource"),uri:h.string()}).passthrough(),Om=h.object({type:h.literal("ref/prompt"),name:h.string()}).passthrough(),Lm=Se.extend({method:h.literal("completion/complete"),params:ze.extend({ref:h.union([Om,Dm]),argument:h.object({name:h.string(),value:h.string()}).passthrough()})}),Nm=He.extend({completion:h.object({values:h.array(h.string()).max(100),total:h.optional(h.number().int()),hasMore:h.optional(h.boolean())}).passthrough()}),Mm=h.object({uri:h.string().startsWith("file://"),name:h.optional(h.string())}).passthrough(),Fm=Se.extend({method:h.literal("roots/list")}),Do=He.extend({roots:h.array(Mm)}),jm=at.extend({method:h.literal("notifications/roots/list_changed")}),c_=h.union([Za,Co,Lm,Rm,_m,bm,Eo,lm,Ao,pm,hm,Po,$o]),l_=h.union([Ja,Ya,Ro,jm]),u_=h.union([Ga,Io,Do]),d_=h.union([Za,Im,Fm]),f_=h.union([Ja,Ya,Em,mm,fm,Cm,xm]),p_=h.union([Ga,am,Nm,Sm,wm,cm,um,dm,Rl,Tm]),On=class extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n}};var ts=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this.setNotificationHandler(Ja,r=>{let n=this._requestHandlerAbortControllers.get(r.params.requestId);n?.abort(r.params.reason)}),this.setNotificationHandler(Ya,r=>{this._onprogress(r)}),this.setRequestHandler(Za,r=>({}))}async connect(e){this._transport=e,this._transport.onclose=()=>{this._onclose()},this._transport.onerror=r=>{this._onerror(r)},this._transport.onmessage=r=>{"method"in r?"id"in r?this._onrequest(r):this._onnotification(r):this._onresponse(r)},await this._transport.start()}_onclose(){var e;let r=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);let n=new On(ln.ConnectionClosed,"Connection closed");for(let s of r.values())s(n)}_onerror(e){var r;(r=this.onerror)===null||r===void 0||r.call(this,e)}_onnotification(e){var r;let n=(r=this._notificationHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackNotificationHandler;n!==void 0&&Promise.resolve().then(()=>n(e)).catch(s=>this._onerror(new Error(`Uncaught error in notification handler: ${s}`)))}_onrequest(e){var r,n;let s=(r=this._requestHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackRequestHandler;if(s===void 0){(n=this._transport)===null||n===void 0||n.send({jsonrpc:"2.0",id:e.id,error:{code:ln.MethodNotFound,message:"Method not found"}}).catch(c=>this._onerror(new Error(`Failed to send an error response: ${c}`)));return}let o=new AbortController;this._requestHandlerAbortControllers.set(e.id,o),Promise.resolve().then(()=>s(e,{signal:o.signal})).then(c=>{var u;if(!o.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({result:c,jsonrpc:"2.0",id:e.id})},c=>{var u,f;if(!o.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(c.code)?c.code:ln.InternalError,message:(f=c.message)!==null&&f!==void 0?f:"Internal error"}})}).catch(c=>this._onerror(new Error(`Failed to send response: ${c}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progress:r,total:n,progressToken:s}=e.params,o=this._progressHandlers.get(Number(s));if(o===void 0){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}o({progress:r,total:n})}_onresponse(e){let r=e.id,n=this._responseHandlers.get(Number(r));if(n===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(Number(r)),this._progressHandlers.delete(Number(r)),"result"in e)n(e);else{let s=new On(e.error.code,e.error.message,e.error.data);n(s)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,r,n){return new Promise((s,o)=>{var c,u,f;if(!this._transport){o(new Error("Not connected"));return}((c=this._options)===null||c===void 0?void 0:c.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(u=n?.signal)===null||u===void 0||u.throwIfAborted();let d=this._requestMessageId++,m={...e,jsonrpc:"2.0",id:d};n?.onprogress&&(this._progressHandlers.set(d,n.onprogress),m.params={...e.params,_meta:{progressToken:d}}),this._responseHandlers.set(d,w=>{var k;if(!(!((k=n?.signal)===null||k===void 0)&&k.aborted)){if(w instanceof Error)return o(w);try{let R=r.parse(w.result);s(R)}catch(R){o(R)}}}),(f=n?.signal)===null||f===void 0||f.addEventListener("abort",()=>{var w,k;let R=(w=n?.signal)===null||w===void 0?void 0:w.reason;this._responseHandlers.delete(d),this._progressHandlers.delete(d),(k=this._transport)===null||k===void 0||k.send({jsonrpc:"2.0",method:"cancelled",params:{requestId:d,reason:String(R)}}),o(R)}),this._transport.send(m).catch(o)})}async notification(e){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let r={...e,jsonrpc:"2.0"};await this._transport.send(r)}setRequestHandler(e,r){let n=e.shape.method.value;this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(s,o)=>Promise.resolve(r(e.parse(s),o)))}removeRequestHandler(e){this._requestHandlers.delete(e)}setNotificationHandler(e,r){this._notificationHandlers.set(e.shape.method.value,n=>Promise.resolve(r(e.parse(n))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}};var rs=class extends ts{constructor(e,r){super(r),this._serverInfo=e,this._capabilities=r.capabilities,this.setRequestHandler(Co,n=>this._oninitialize(n)),this.setNotificationHandler(Ro,()=>{var n;return(n=this.oninitialized)===null||n===void 0?void 0:n.call(this)})}assertCapabilityForMethod(e){var r,n;switch(e){case"sampling/createMessage":if(!(!((r=this._clientCapabilities)===null||r===void 0)&&r.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"roots/list":if(!(!((n=this._clientCapabilities)===null||n===void 0)&&n.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Server does not support sampling (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"ping":case"initialize":break}}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:bl.includes(r)?r:To,capabilities:this.getCapabilities(),serverInfo:this._serverInfo}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Ga)}async createMessage(e,r){return this.request({method:"sampling/createMessage",params:e},Io,r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},Do,r)}async sendLoggingMessage(e){return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var Oo=Be(require("node:process"),1);var ns=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e);return this._buffer=this._buffer.subarray(e+1),Wm(r)}clear(){this._buffer=void 0}};function Wm(t){return kl.parse(JSON.parse(t))}function Al(t){return JSON.stringify(t)+`
`}var as=class{constructor(e=Oo.default.stdin,r=Oo.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new ns,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{var s;(s=this.onerror)===null||s===void 0||s.call(this,n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(var e,r;;)try{let n=this._readBuffer.readMessage();if(n===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,n)}catch(n){(r=this.onerror)===null||r===void 0||r.call(this,n)}}async close(){var e;this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._readBuffer.clear(),(e=this.onclose)===null||e===void 0||e.call(this)}send(e){return new Promise(r=>{let n=Al(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var ft=require("fs/promises"),wn=require("path"),Ps=require("os"),Is=require("fs"),IS=require("url");var it=require("fs/promises"),Kt=require("path"),ys=require("os"),bs=require("fs");async function cg(t=process.cwd()){let e=t,r=process.platform==="win32"?e.split(":")[0]+":\\":"/";for(;e!==r&&e!==(0,Kt.dirname)(e);){try{let n=(0,Kt.join)(e,".lokus");if((await(0,it.stat)(n)).isDirectory())return e}catch{}e=(0,Kt.dirname)(e)}return null}async function lg(){let t=process.env.LOKUS_WORKSPACE;if(!t)return null;try{if((await(0,it.stat)(t)).isDirectory())return t}catch{}return null}async function ug(t="http://127.0.0.1:3333"){try{let e=(await Promise.resolve().then(()=>(Hn(),Zo))).default,r=new AbortController,n=setTimeout(()=>r.abort(),2e3),s=await e(`${t}/api/workspace`,{signal:r.signal});if(clearTimeout(n),s.ok){let o=await s.json();if(o.success&&o.data?.workspace)return o.data.workspace}}catch{}return null}async function dg(){let t=(0,Kt.join)((0,ys.homedir)(),".lokus","last-workspace.json");try{let e=await(0,it.readFile)(t,"utf-8"),r=JSON.parse(e);if(r.workspace)return await(0,it.access)(r.workspace,bs.constants.R_OK),r.workspace}catch{}return null}async function fg(){let t=(0,Kt.join)((0,ys.homedir)(),".lokus","mcp-context.json");try{let e=await(0,it.readFile)(t,"utf-8"),r=JSON.parse(e);if(r.currentWorkspace)return await(0,it.access)(r.currentWorkspace,bs.constants.R_OK),r.currentWorkspace}catch{}return null}async function Su(t={}){let{apiUrl:e="http://127.0.0.1:3333",skipCWD:r=!1,skipEnv:n=!1,skipAPI:s=!1}=t;if(!r){let f=await cg();if(f)return{workspace:f,source:"cwd"}}if(!n){let f=await lg();if(f)return{workspace:f,source:"env"}}if(!s){let f=await ug(e);if(f)return{workspace:f,source:"api"}}let o=await fg();if(o)return{workspace:o,source:"context"};let c=await dg();if(c)return{workspace:c,source:"config"};let u=(0,Kt.join)((0,ys.homedir)(),"Documents","Lokus Workspace");try{return await(0,it.access)(u,bs.constants.R_OK),{workspace:u,source:"default"}}catch{}return{workspace:null,source:"none"}}var ee=require("fs/promises"),X=require("path");var fn=require("fs/promises"),Qo=require("path"),Ko=require("os");Hn();function pg(t,e){let r=[];for(let n=0;n<=e.length;n++)r[n]=[n];for(let n=0;n<=t.length;n++)r[0][n]=n;for(let n=1;n<=e.length;n++)for(let s=1;s<=t.length;s++)e.charAt(n-1)===t.charAt(s-1)?r[n][s]=r[n-1][s-1]:r[n][s]=Math.min(r[n-1][s-1]+1,r[n][s-1]+1,r[n-1][s]+1);return r[e.length][t.length]}function xu(t,e){let r=pg(t.toLowerCase(),e.toLowerCase()),n=Math.max(t.length,e.length);return 1-r/n}function Yo(t,e,r=.6){if(!t||!e||e.length===0)return null;let n=t.toLowerCase().trim();for(let c of e)if(c.name.toLowerCase()===n)return{workspace:c,confidence:1,matchType:"exact"};for(let c of e){let u=c.name.toLowerCase();if(u.includes(n)||n.includes(u))return{workspace:c,confidence:.9,matchType:"substring"}}let s=null,o=0;for(let c of e){let u=xu(n,c.name);u>o&&u>=r&&(o=u,s=c)}return s?{workspace:s,confidence:o,matchType:"fuzzy"}:null}function vu(t,e,r=.5,n=3){if(!t||!e||e.length===0)return[];let s=t.toLowerCase().trim(),o=[];for(let c of e){let u=c.name.toLowerCase(),f=0,d="fuzzy";u===s?(f=1,d="exact"):u.includes(s)||s.includes(u)?(f=.9,d="substring"):(f=xu(s,c.name),d="fuzzy"),f>=r&&o.push({workspace:c,confidence:f,matchType:d})}return o.sort((c,u)=>u.confidence-c.confidence).slice(0,n)}function Tu(t){let e=[],r=[/(?:in|from|to|at|on)\s+(?:my\s+)?([a-zA-Z0-9\s-]+?)(?:\s+workspace|\s+notes?|\s+folder)/gi,/(?:workspace|notes?|folder)\s+(?:named|called)\s+["']?([a-zA-Z0-9\s-]+?)["']?/gi,/["']([a-zA-Z0-9\s-]+?)["']\s+(?:workspace|notes?|folder)/gi];for(let n of r){let s;for(;(s=n.exec(t))!==null;)e.push(s[1].trim())}return[...new Set(e)]}var Cu=(0,Qo.join)((0,Ko.homedir)(),".lokus","mcp-context.json"),Xo=[{name:"list_all_workspaces",description:"List all available Lokus workspaces. Use this when you need to see what workspaces are available or when the user mentions a workspace name.",inputSchema:{type:"object",properties:{}}},{name:"set_workspace_context",description:"Set the active workspace context for all subsequent operations. This ensures all tools operate on the correct workspace. Always use this before performing workspace-specific operations.",inputSchema:{type:"object",properties:{workspacePath:{type:"string",description:"Full path to the workspace to set as active"}},required:["workspacePath"]}},{name:"get_current_context",description:"Get the currently active workspace context. Use this to verify which workspace you're operating on.",inputSchema:{type:"object",properties:{}}},{name:"match_workspace_by_name",description:"Smart workspace detection from natural language. Use this when the user refers to a workspace by name (e.g., 'my knowledge base', 'work notes'). Returns the best matching workspace.",inputSchema:{type:"object",properties:{query:{type:"string",description:"Natural language workspace reference (e.g., 'knowledge base', 'work notes', 'personal workspace')"},autoSet:{type:"boolean",description:"Automatically set the matched workspace as active context (default: true)"}},required:["query"]}},{name:"clear_workspace_context",description:"Clear the active workspace context. Use this when you need to reset or when switching between different tasks.",inputSchema:{type:"object",properties:{}}},{name:"detect_workspace_from_text",description:"Analyze text to automatically detect workspace references and provide suggestions. Useful when the user's message contains workspace-related context.",inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to analyze for workspace references"}},required:["text"]}}];async function Ru(t,e,r){switch(t){case"list_all_workspaces":return await hg(r);case"set_workspace_context":return await ei(e.workspacePath);case"get_current_context":return await mg();case"match_workspace_by_name":return await gg(e.query,e.autoSet!==!1,r);case"clear_workspace_context":return await yg();case"detect_workspace_from_text":return await bg(e.text,r);default:throw new Error(`Unknown workspace context tool: ${t}`)}}async function hg(t){if(!t)return{content:[{type:"text",text:`\u274C API server not available. Cannot list workspaces.

Please ensure Lokus is running.`}]};try{let e=await Rt(`${t}/api/workspaces/all`);if(!e.ok)throw new Error(`API request failed: ${e.status}`);let r=await e.json();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch workspaces");let n=r.data;if(n.length===0)return{content:[{type:"text",text:`\u{1F4C2} No workspaces found.

You may need to open a workspace in Lokus first.`}]};let s=await Vn();return{content:[{type:"text",text:`**Available Workspaces:**

${n.map(c=>{let f=s.currentWorkspace===c.path?"\u{1F449} ":"   ",d=c.note_count!==null?` (${c.note_count} notes)`:"";return`${f}\u{1F4C1} **${c.name}**${d}
      Path: ${c.path}`}).join(`

`)}

${s.currentWorkspace?"\u{1F449} = Currently active workspace":"\u{1F4A1} Use `match_workspace_by_name` or `set_workspace_context` to set active workspace"}`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to list workspaces: ${e.message}

Please ensure Lokus is running and the API server is accessible.`}]}}}async function ei(t){try{let e=await Vn();return e.currentWorkspace=t,e.lastUpdated=new Date().toISOString(),await Eu(e),{content:[{type:"text",text:`\u2705 Workspace context set to:
\u{1F4C1} **${t}**

All subsequent operations will use this workspace.`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to set workspace context: ${e.message}`}]}}}async function mg(){try{let t=await Vn();if(!t.currentWorkspace)return{content:[{type:"text",text:"\u26A0\uFE0F No workspace context is currently set.\n\n\u{1F4A1} Use `list_all_workspaces` to see available workspaces, then use `match_workspace_by_name` or `set_workspace_context` to set one."}]};let e=new Date-new Date(t.lastUpdated),r=Math.floor(e/6e4),n=r<1?"just now":`${r} minute${r!==1?"s":""} ago`;return{content:[{type:"text",text:`**Current Workspace Context:**

\u{1F4C1} ${t.currentWorkspace}
\u23F1\uFE0F Last updated: ${n}

\u2705 All operations will use this workspace.`}]}}catch(t){return{content:[{type:"text",text:`\u274C Failed to get context: ${t.message}`}]}}}async function gg(t,e,r){if(!r)return{content:[{type:"text",text:"\u274C API server not available. Cannot match workspaces."}]};try{let n=await Rt(`${r}/api/workspaces/all`);if(!n.ok)throw new Error(`API request failed: ${n.status}`);let s=await n.json();if(!s.success||!s.data)throw new Error(s.error||"Failed to fetch workspaces");let o=s.data;if(o.length===0)return{content:[{type:"text",text:"\u{1F4C2} No workspaces available to match against."}]};let c=Yo(t,o,.6);if(!c){let m=vu(t,o,.4,3);if(m.length>0){let w=m.map(k=>`  - ${k.workspace.name} (${Math.round(k.confidence*100)}% match)`).join(`
`);return{content:[{type:"text",text:`\u274C No strong match found for "${t}".

Did you mean:
${w}

\u{1F4A1} Try being more specific or use \`list_all_workspaces\` to see all available workspaces.`}]}}return{content:[{type:"text",text:`\u274C No workspace matches "${t}".

\u{1F4A1} Use \`list_all_workspaces\` to see all available workspaces.`}]}}let u=Math.round(c.confidence*100),d=`${c.matchType==="exact"?"\u{1F3AF}":c.matchType==="substring"?"\u2705":"\u{1F50D}"} **Match Found** (${u}% confidence)

\u{1F4C1} **${c.workspace.name}**
   Path: ${c.workspace.path}
   Match type: ${c.matchType}`;return e?(await ei(c.workspace.path),d+=`

\u2705 Workspace context has been automatically set.
All subsequent operations will use this workspace.`):d+="\n\n\u{1F4A1} Use `set_workspace_context` to activate this workspace.",{content:[{type:"text",text:d}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to match workspace: ${n.message}`}]}}}async function yg(){try{let t=await Vn(),e=t.currentWorkspace;return t.currentWorkspace=null,t.lastUpdated=new Date().toISOString(),await Eu(t),{content:[{type:"text",text:e?`\u2705 Workspace context cleared.
Previously: ${e}`:"\u2705 Workspace context cleared (no context was set)."}]}}catch(t){return{content:[{type:"text",text:`\u274C Failed to clear context: ${t.message}`}]}}}async function bg(t,e){if(!e)return{content:[{type:"text",text:"\u274C API server not available."}]};try{let r=Tu(t);if(r.length===0)return{content:[{type:"text",text:`\u{1F50D} No workspace references detected in the text.

\u{1F4A1} Try phrases like 'in my knowledge base' or 'from work notes'.`}]};let n=await Rt(`${e}/api/workspaces/all`);if(!n.ok)throw new Error(`API request failed: ${n.status}`);let s=await n.json();if(!s.success||!s.data)throw new Error(s.error||"Failed to fetch workspaces");let o=s.data,c=[];for(let d of r){let m=Yo(d,o,.5);m&&c.push({reference:d,match:m})}if(c.length===0)return{content:[{type:"text",text:`\u{1F50D} Found potential workspace references but couldn't match them:
${r.map(d=>`  - "${d}"`).join(`
`)}

\u{1F4A1} Use \`list_all_workspaces\` to see available workspaces.`}]};let u=c.map(d=>`  - "${d.reference}" \u2192 **${d.match.workspace.name}** (${Math.round(d.match.confidence*100)}% confidence)`).join(`
`),f=c.sort((d,m)=>m.match.confidence-d.match.confidence)[0];return await ei(f.match.workspace.path),{content:[{type:"text",text:`\u{1F50D} **Workspace References Detected:**

${u}

\u2705 Automatically set context to: **${f.match.workspace.name}**`}]}}catch(r){return{content:[{type:"text",text:`\u274C Failed to detect workspace: ${r.message}`}]}}}async function Vn(){try{let t=await(0,fn.readFile)(Cu,"utf-8");return JSON.parse(t)}catch{return{currentWorkspace:null,lastUpdated:null}}}async function Eu(t){let e=(0,Qo.join)((0,Ko.homedir)(),".lokus");try{await(0,fn.mkdir)(e,{recursive:!0})}catch{}await(0,fn.writeFile)(Cu,JSON.stringify(t,null,2),"utf-8")}async function Au(){return(await Vn()).currentWorkspace}function $u(t){return t?`\u{1F3AF} **Operating on:** ${t.split("/").pop()} (${t})`:"\u26A0\uFE0F **No workspace context set** - Using default or last workspace"}var ti=[{name:"list_notes",description:"List all notes in the workspace with metadata",inputSchema:{type:"object",properties:{folder:{type:"string",description:"Folder to list notes from (optional)"},sortBy:{type:"string",enum:["name","modified","created","size"],description:"Sort notes by"},includeContent:{type:"boolean",description:"Include first 200 chars of content"}}}},{name:"read_note",description:"Read the full content of a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note file"}},required:["path"]}},{name:"create_note",description:"Create a new note with optional frontmatter",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path for the new note"},content:{type:"string",description:"Note content"},frontmatter:{type:"object",description:"Optional frontmatter metadata"}},required:["path","content"]}},{name:"update_note",description:"Update an existing note's content",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"},content:{type:"string",description:"New content"},preserveFrontmatter:{type:"boolean",description:"Preserve existing frontmatter"}},required:["path","content"]}},{name:"delete_note",description:"Delete a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note to delete"}},required:["path"]}},{name:"search_notes",description:"Search notes by content or metadata",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},searchIn:{type:"string",enum:["content","title","tags","all"],description:"Where to search"},regex:{type:"boolean",description:"Use regex search"}},required:["query"]}},{name:"get_note_links",description:"Get all wiki links in a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"get_note_backlinks",description:"Find all notes that link to a specific note",inputSchema:{type:"object",properties:{noteName:{type:"string",description:"Name of the note to find backlinks for"}},required:["noteName"]}},{name:"extract_note_metadata",description:"Extract frontmatter and metadata from a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"rename_note",description:"Rename a note and update all references",inputSchema:{type:"object",properties:{oldPath:{type:"string",description:"Current path of the note"},newPath:{type:"string",description:"New path for the note"},updateLinks:{type:"boolean",description:"Update wiki links in other notes"}},required:["oldPath","newPath"]}}];async function Pu(t,e,r,n){let o=await Au()||r;switch(t){case"list_notes":return await wg(o,e);case"read_note":return await _g(o,e.path);case"create_note":return await kg(o,e);case"update_note":return await Sg(o,e);case"delete_note":return await xg(o,e.path);case"search_notes":return await vg(o,e);case"get_note_links":return await Tg(o,e.path);case"get_note_backlinks":return await Cg(o,e.noteName);case"extract_note_metadata":return await Rg(o,e.path);case"rename_note":return await Eg(o,e);default:throw new Error(`Unknown notes tool: ${t}`)}}async function wg(t,e={}){let r=await Gn(t);if(e.sortBy&&r.sort((n,s)=>{switch(e.sortBy){case"modified":return s.modified-n.modified;case"created":return s.created-n.created;case"size":return s.size-n.size;default:return n.name.localeCompare(s.name)}}),e.includeContent)for(let n of r)try{let s=await(0,ee.readFile)(n.path,"utf-8");n.preview=s.substring(0,200).replace(/\n/g," ")}catch{n.preview=null}return{content:[{type:"text",text:`${$u(t)}

Found ${r.length} notes

${r.map(n=>`- ${n.name} (${n.relativePath})${n.preview?`
  `+n.preview+"...":""}`).join(`
`)}`}]}}async function Gn(t,e=t){let r=[],n=await(0,ee.readdir)(t,{withFileTypes:!0});for(let s of n){let o=(0,X.join)(t,s.name);if(!s.name.startsWith(".")){if(s.isDirectory()){let c=await Gn(o,e);r.push(...c)}else if(s.isFile()&&[".md",".txt"].includes((0,X.extname)(s.name))){let c=await(0,ee.stat)(o);r.push({path:o,relativePath:o.replace(e+"/",""),name:(0,X.basename)(s.name,(0,X.extname)(s.name)),size:c.size,created:c.birthtime?.getTime(),modified:c.mtime?.getTime()})}}}return r}async function _g(t,e){let r=e.startsWith("/")?e:(0,X.join)(t,e);return{content:[{type:"text",text:await(0,ee.readFile)(r,"utf-8")}]}}async function kg(t,{path:e,content:r,frontmatter:n}){let s=(0,X.join)(t,e);await(0,ee.mkdir)((0,X.dirname)(s),{recursive:!0});let o=r;return n&&(o=`---
${Object.entries(n).map(([u,f])=>`${u}: ${JSON.stringify(f)}`).join(`
`)}
---

${r}`),await(0,ee.writeFile)(s,o),{content:[{type:"text",text:`\u2705 Note created: ${e}`}]}}async function Sg(t,{path:e,content:r,preserveFrontmatter:n}){let s=(0,X.join)(t,e);if(n){let c=(await(0,ee.readFile)(s,"utf-8")).match(/^---\n([\s\S]*?)\n---\n/);c&&(r=c[0]+r)}return await(0,ee.writeFile)(s,r),{content:[{type:"text",text:`\u2705 Note updated: ${e}`}]}}async function xg(t,e){let r=(0,X.join)(t,e),{unlink:n}=await import("fs/promises");return await n(r),{content:[{type:"text",text:`\u2705 Note deleted: ${e}`}]}}async function vg(t,{query:e,searchIn:r="all",regex:n=!1}){let s=await Gn(t),o=[],c=n?new RegExp(e,"gi"):e.toLowerCase();for(let u of s)try{let f=await(0,ee.readFile)(u.path,"utf-8"),d=!1,m="";if((r==="title"||r==="all")&&(n?c.test(u.name):u.name.toLowerCase().includes(e.toLowerCase()))&&(d=!0,m=`Title match: ${u.name}`),!d&&(r==="content"||r==="all")&&(n?c.test(f):f.toLowerCase().includes(e.toLowerCase()))){d=!0;let w=f.toLowerCase().indexOf(e.toLowerCase()),k=Math.max(0,w-50),R=Math.min(f.length,w+e.length+50);m=f.substring(k,R).replace(/\n/g," ")}d&&o.push({note:u.name,path:u.relativePath,context:m})}catch{}return{content:[{type:"text",text:`Found ${o.length} matches for "${e}":

${o.map(u=>`**${u.note}** (${u.path})
  ${u.context}`).join(`

`)}`}]}}async function Tg(t,e){let r=(0,X.join)(t,e),o=((await(0,ee.readFile)(r,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(c=>c.slice(2,-2));return{content:[{type:"text",text:`Found ${o.length} wiki links in the note:
${o.map(c=>`- [[${c}]]`).join(`
`)}`}]}}async function Cg(t,e){let r=await Gn(t),n=[];for(let s of r)try{(await(0,ee.readFile)(s.path,"utf-8")).includes(`[[${e}]]`)&&n.push({note:s.name,path:s.relativePath})}catch{}return{content:[{type:"text",text:`Found ${n.length} backlinks to "${e}":
${n.map(s=>`- ${s.note} (${s.path})`).join(`
`)}`}]}}async function Rg(t,e){let r=(0,X.join)(t,e),n=await(0,ee.readFile)(r,"utf-8"),s=n.match(/^---\n([\s\S]*?)\n---/),o={};if(s){let m=s[1].split(`
`);for(let w of m){let[k,...R]=w.split(":");k&&R.length&&(o[k.trim()]=R.join(":").trim())}}let c=await(0,ee.stat)(r),u=n.split(/\s+/).length,f=n.split(`
`).length;return{content:[{type:"text",text:JSON.stringify({frontmatter:o,stats:{wordCount:u,lineCount:f,size:c.size,created:c.birthtime,modified:c.mtime}},null,2)}]}}async function Eg(t,{oldPath:e,newPath:r,updateLinks:n=!0}){let s=(0,X.join)(t,e),o=(0,X.join)(t,r);await(0,ee.mkdir)((0,X.dirname)(o),{recursive:!0});let{rename:c}=await import("fs/promises");if(await c(s,o),n){let u=(0,X.basename)(e,(0,X.extname)(e)),f=(0,X.basename)(r,(0,X.extname)(r)),d=await Gn(t),m=0;for(let w of d)try{let k=await(0,ee.readFile)(w.path,"utf-8");if(k.includes(`[[${u}]]`)){let R=k.replace(new RegExp(`\\[\\[${u}\\]\\]`,"g"),`[[${f}]]`);await(0,ee.writeFile)(w.path,R),m++}}catch{}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}
${n?`Updated ${m} references`:""}`}]}}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}`}]}}var Me=require("fs/promises"),Ar=require("path");Hn();var ri=[{name:"get_workspace_info",description:"Get comprehensive information about the current workspace",inputSchema:{type:"object",properties:{}}},{name:"get_workspace_stats",description:"Get statistics about the workspace (note count, size, etc)",inputSchema:{type:"object",properties:{}}},{name:"list_folders",description:"List all folders in the workspace",inputSchema:{type:"object",properties:{maxDepth:{type:"number",description:"Maximum depth to traverse"}}}},{name:"get_workspace_settings",description:"Get workspace-specific settings",inputSchema:{type:"object",properties:{}}},{name:"search_workspace",description:"Global search across all workspace content",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},fileTypes:{type:"array",items:{type:"string"},description:"File types to search (md, txt, json, etc)"},limit:{type:"number",description:"Maximum results to return"}},required:["query"]}},{name:"get_recent_files",description:"Get recently modified files in the workspace",inputSchema:{type:"object",properties:{count:{type:"number",description:"Number of files to return"},fileTypes:{type:"array",items:{type:"string"},description:"Filter by file types"}}}}];async function Iu(t,e,r,n){switch(t){case"get_workspace_info":return await Ag(r,n);case"get_workspace_stats":return await Du(r);case"list_folders":return await $g(r,e.maxDepth||3);case"get_workspace_settings":return await Pg(r);case"search_workspace":return await Ig(r,e);case"get_recent_files":return await Dg(r,e);default:throw new Error(`Unknown workspace tool: ${t}`)}}async function Ag(t,e){if(e)try{let o=await Rt(`${e}/api/workspace`);if(o.ok){let c=await o.json();if(c.success&&c.data)return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${c.data.workspace}
\u{1F4DD} Name: ${c.data.name}
\u{1F4CA} Total Notes: ${c.data.total_notes}
${c.data.has_bases?"\u2705 Bases enabled":"\u274C Bases not configured"}
${c.data.has_canvas?"\u2705 Canvas enabled":"\u274C Canvas not configured"}
${c.data.has_tasks?"\u2705 Tasks enabled":"\u274C Tasks not configured"}`}]}}}catch{}let r=await Du(t),n=(0,Ar.join)(t,".lokus"),s=await Og(n);return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${t}
\u{1F4DD} Notes: ${r.noteCount}
\u{1F4C2} Folders: ${r.folderCount}
\u{1F4BE} Total Size: ${Lg(r.totalSize)}
\u{1F527} Lokus Features: ${s?"Configured":"Not configured"}`}]}}async function Du(t){let e={noteCount:0,folderCount:0,totalSize:0,fileTypes:{}};async function r(n){let s=await(0,Me.readdir)(n,{withFileTypes:!0});for(let o of s){if(o.name.startsWith("."))continue;let c=(0,Ar.join)(n,o.name);if(o.isDirectory())e.folderCount++,await r(c);else if(o.isFile()){let u=await(0,Me.stat)(c);e.totalSize+=u.size;let f=o.name.split(".").pop();e.fileTypes[f]=(e.fileTypes[f]||0)+1,["md","txt"].includes(f)&&e.noteCount++}}}return await r(t),e}async function $g(t,e){let r=[];async function n(o,c=0,u=""){if(c>=e)return;let f=await(0,Me.readdir)(o,{withFileTypes:!0});for(let d of f)if(!d.name.startsWith(".")&&d.isDirectory()){let m=u?`${u}/${d.name}`:d.name;r.push({name:d.name,path:m,depth:c}),await n((0,Ar.join)(o,d.name),c+1,m)}}return await n(t),{content:[{type:"text",text:`**Workspace Folders:**

${r.sort((o,c)=>o.path.localeCompare(c.path)).map(o=>"  ".repeat(o.depth)+"\u{1F4C1} "+o.name).join(`
`)}`}]}}async function Pg(t){let e=(0,Ar.join)(t,".lokus","settings.json");try{let r=await(0,Me.readFile)(e,"utf-8"),n=JSON.parse(r);return{content:[{type:"text",text:`**Workspace Settings:**

${JSON.stringify(n,null,2)}`}]}}catch{return{content:[{type:"text",text:"No workspace settings found. This workspace may not be configured for Lokus."}]}}}async function Ig(t,{query:e,fileTypes:r=["md","txt"],limit:n=20}){let s=[];async function o(c){let u=await(0,Me.readdir)(c,{withFileTypes:!0});for(let f of u){if(f.name.startsWith("."))continue;let d=(0,Ar.join)(c,f.name);if(f.isDirectory())await o(d);else if(f.isFile()){let m=f.name.split(".").pop();if(r.includes(m))try{let w=await(0,Me.readFile)(d,"utf-8");if(w.toLowerCase().includes(e.toLowerCase())){let k=w.toLowerCase().indexOf(e.toLowerCase()),R=Math.max(0,k-50),x=Math.min(w.length,k+e.length+50),N=w.substring(R,x).replace(/\n/g," ");if(s.push({file:d.replace(t+"/",""),context:N}),s.length>=n)return}}catch{}}}}return await o(t),{content:[{type:"text",text:`Found ${s.length} matches for "${e}":

${s.map(c=>`**${c.file}**
  ...${c.context}...`).join(`

`)}`}]}}async function Dg(t,{count:e=10,fileTypes:r=null}){let n=[];async function s(c){let u=await(0,Me.readdir)(c,{withFileTypes:!0});for(let f of u){if(f.name.startsWith("."))continue;let d=(0,Ar.join)(c,f.name);if(f.isDirectory())await s(d);else if(f.isFile()){let m=f.name.split(".").pop();if(!r||r.includes(m)){let w=await(0,Me.stat)(d);n.push({path:d.replace(t+"/",""),name:f.name,modified:w.mtime,size:w.size})}}}}return await s(t),n.sort((c,u)=>u.modified-c.modified),{content:[{type:"text",text:`**Recently Modified Files:**

${n.slice(0,e).map(c=>`- ${c.name} (${c.path})
  Modified: ${c.modified.toISOString()}`).join(`
`)}`}]}}async function Og(t){try{return await(0,Me.stat)(t),!0}catch{return!1}}function Lg(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`}var oe=require("fs/promises"),Je=require("path"),ni=[{name:"list_bases",description:"List all bases (databases) in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_base",description:"Get details of a specific base including schema and records",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}},{name:"create_base",description:"Create a new base with specified schema",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the new base"},schema:{type:"object",description:"Schema definition for the base",properties:{fields:{type:"array",description:"Field definitions"}}},description:{type:"string",description:"Description of the base"}},required:["name","schema"]}},{name:"add_base_record",description:"Add a new record to a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},record:{type:"object",description:"Record data"}},required:["baseName","record"]}},{name:"query_base",description:"Query records from a base with filters",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},filter:{type:"object",description:"Filter criteria"},sort:{type:"object",description:"Sort criteria"},limit:{type:"number",description:"Maximum records to return"}},required:["baseName"]}},{name:"update_base_record",description:"Update a record in a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to update"},updates:{type:"object",description:"Fields to update"}},required:["baseName","recordId","updates"]}},{name:"delete_base_record",description:"Delete a record from a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to delete"}},required:["baseName","recordId"]}},{name:"get_base_stats",description:"Get statistics about a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}}];async function Ou(t,e,r,n){switch(t){case"list_bases":return await Ng(r);case"get_base":return await Mg(r,e.baseName);case"create_base":return await Fg(r,e);case"add_base_record":return await jg(r,e);case"query_base":return await Wg(r,e);case"update_base_record":return await qg(r,e);case"delete_base_record":return await Bg(r,e);case"get_base_stats":return await Ug(r,e.baseName);default:throw new Error(`Unknown bases tool: ${t}`)}}async function Ng(t){let e=(0,Je.join)(t,".lokus","bases");try{let r=await(0,oe.readdir)(e,{withFileTypes:!0}),n=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let o=s.name.replace(".json","");try{let c=await(0,oe.readFile)((0,Je.join)(e,s.name),"utf-8"),u=JSON.parse(c);n.push({name:o,recordCount:u.records?u.records.length:0,fields:u.schema?.fields?.length||0,description:u.description})}catch{}}return{content:[{type:"text",text:`**Bases in Workspace:**

${n.length>0?n.map(s=>`\u{1F4CA} **${s.name}**
  - Records: ${s.recordCount}
  - Fields: ${s.fields}
  - ${s.description||"No description"}`).join(`

`):"No bases found in this workspace"}`}]}}catch{return{content:[{type:"text",text:"Bases feature not configured in this workspace"}]}}}async function Mg(t,e){let r=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let n=await(0,oe.readFile)(r,"utf-8"),s=JSON.parse(n);return{content:[{type:"text",text:`**Base: ${e}**

Description: ${s.description||"No description"}
Created: ${s.created||"Unknown"}
Modified: ${s.modified||"Unknown"}

**Schema:**
${s.schema?.fields?.map(o=>`- ${o.name} (${o.type})`).join(`
`)||"No schema defined"}

**Records (${s.records?.length||0}):**
${s.records?.slice(0,5).map(o=>JSON.stringify(o)).join(`
`)||"No records"}
${s.records?.length>5?`
... and ${s.records.length-5} more records`:""}`}]}}catch{return{content:[{type:"text",text:`Base "${e}" not found`}]}}}async function Fg(t,{name:e,schema:r,description:n}){let s=(0,Je.join)(t,".lokus","bases"),o=(0,Je.join)(s,`${e}.json`);await(0,oe.mkdir)(s,{recursive:!0});let c={name:e,description:n,schema:r,records:[],created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,oe.writeFile)(o,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Base "${e}" created successfully with ${r.fields?.length||0} fields`}]}}async function jg(t,{baseName:e,record:r}){let n=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let s=await(0,oe.readFile)(n,"utf-8"),o=JSON.parse(s);return r.id||(r.id=Date.now().toString(36)+Math.random().toString(36).substr(2)),r.created=new Date().toISOString(),r.modified=new Date().toISOString(),o.records=o.records||[],o.records.push(r),o.modified=new Date().toISOString(),await(0,oe.writeFile)(n,JSON.stringify(o,null,2)),{content:[{type:"text",text:`\u2705 Record added to base "${e}" with ID: ${r.id}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to add record: ${s.message}`}]}}}async function Wg(t,{baseName:e,filter:r={},sort:n=null,limit:s=100}){let o=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let c=await(0,oe.readFile)(o,"utf-8"),f=JSON.parse(c).records||[];if(Object.keys(r).length>0&&(f=f.filter(d=>{for(let[m,w]of Object.entries(r))if(d[m]!==w)return!1;return!0})),n){let d=Object.keys(n)[0],m=n[d];f.sort((w,k)=>m==="asc"?w[d]>k[d]?1:-1:w[d]<k[d]?1:-1)}return f=f.slice(0,s),{content:[{type:"text",text:`**Query Results (${f.length} records):**

${f.map(d=>JSON.stringify(d,null,2)).join(`
---
`)}`}]}}catch(c){return{content:[{type:"text",text:`\u274C Query failed: ${c.message}`}]}}}async function qg(t,{baseName:e,recordId:r,updates:n}){let s=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let o=await(0,oe.readFile)(s,"utf-8"),c=JSON.parse(o),u=c.records?.findIndex(f=>f.id===r);if(u===-1)throw new Error(`Record with ID ${r} not found`);return c.records[u]={...c.records[u],...n,id:r,modified:new Date().toISOString()},c.modified=new Date().toISOString(),await(0,oe.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} updated in base "${e}"`}]}}catch(o){return{content:[{type:"text",text:`\u274C Update failed: ${o.message}`}]}}}async function Bg(t,{baseName:e,recordId:r}){let n=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let s=await(0,oe.readFile)(n,"utf-8"),o=JSON.parse(s),c=o.records?.length||0;if(o.records=o.records?.filter(u=>u.id!==r)||[],o.records.length===c)throw new Error(`Record with ID ${r} not found`);return o.modified=new Date().toISOString(),await(0,oe.writeFile)(n,JSON.stringify(o,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} deleted from base "${e}"`}]}}catch(s){return{content:[{type:"text",text:`\u274C Delete failed: ${s.message}`}]}}}async function Ug(t,e){let r=(0,Je.join)(t,".lokus","bases",`${e}.json`);try{let n=await(0,oe.readFile)(r,"utf-8"),s=JSON.parse(n),o={recordCount:s.records?.length||0,fieldCount:s.schema?.fields?.length||0,created:s.created,modified:s.modified,sizeBytes:Buffer.byteLength(n,"utf8"),fieldTypes:{}};if(s.schema?.fields)for(let c of s.schema.fields)o.fieldTypes[c.type]=(o.fieldTypes[c.type]||0)+1;if(s.records?.length>0){o.fillRates={};for(let c of s.schema?.fields||[]){let u=s.records.filter(f=>f[c.name]!=null).length;o.fillRates[c.name]=`${(u/s.records.length*100).toFixed(1)}%`}}return{content:[{type:"text",text:`**Base Statistics: ${e}**

\u{1F4CA} Records: ${o.recordCount}
\u{1F4CB} Fields: ${o.fieldCount}
\u{1F4C5} Created: ${o.created}
\u{1F504} Modified: ${o.modified}
\u{1F4BE} Size: ${(o.sizeBytes/1024).toFixed(2)} KB

**Field Types:**
${Object.entries(o.fieldTypes).map(([c,u])=>`- ${c}: ${u}`).join(`
`)}

${o.fillRates?`**Field Fill Rates:**
${Object.entries(o.fillRates).map(([c,u])=>`- ${c}: ${u}`).join(`
`)}`:""}`}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to get stats: ${n.message}`}]}}}var Ce=require("fs/promises"),Et=require("path"),ai=[{name:"list_canvases",description:"List all canvases in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_canvas",description:"Get canvas data including shapes and connections",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID or name"}},required:["canvasId"]}},{name:"create_canvas",description:"Create a new canvas",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the canvas"},description:{type:"string",description:"Canvas description"}},required:["name"]}},{name:"add_canvas_shape",description:"Add a shape to canvas (text, rectangle, arrow, etc)",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},shape:{type:"object",description:"Shape data (type, position, content, style)"}},required:["canvasId","shape"]}},{name:"get_canvas_connections",description:"Get all connections/arrows between shapes",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"}},required:["canvasId"]}},{name:"export_canvas",description:"Export canvas as JSON or markdown",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},format:{type:"string",enum:["json","markdown","mermaid"],description:"Export format"}},required:["canvasId"]}}];async function Lu(t,e,r,n){switch(t){case"list_canvases":return await zg(r);case"get_canvas":return await Hg(r,e.canvasId);case"create_canvas":return await Vg(r,e);case"add_canvas_shape":return await Gg(r,e);case"get_canvas_connections":return await Jg(r,e.canvasId);case"export_canvas":return await Zg(r,e);default:throw new Error(`Unknown canvas tool: ${t}`)}}async function zg(t){let e=(0,Et.join)(t,".lokus","canvas");try{let r=await(0,Ce.readdir)(e,{withFileTypes:!0}),n=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let o=s.name.replace(".json","");try{let c=await(0,Ce.readFile)((0,Et.join)(e,s.name),"utf-8"),u=JSON.parse(c);n.push({id:o,name:u.name||o,shapeCount:u.shapes?.length||0,created:u.created,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Canvases in Workspace:**

${n.length>0?n.map(s=>`\u{1F3A8} **${s.name}**
  - ID: ${s.id}
  - Shapes: ${s.shapeCount}
  - Modified: ${s.modified||"Unknown"}`).join(`

`):"No canvases found"}`}]}}catch{return{content:[{type:"text",text:"Canvas feature not configured in this workspace"}]}}}async function Hg(t,e){let r=(0,Et.join)(t,".lokus","canvas",`${e}.json`);try{let n=await(0,Ce.readFile)(r,"utf-8"),s=JSON.parse(n),o=s.shapes||[],c=o.filter(f=>f.type==="arrow"||f.type==="line"),u=o.filter(f=>f.type!=="arrow"&&f.type!=="line");return{content:[{type:"text",text:`**Canvas: ${s.name||e}**

\u{1F4CA} Nodes: ${u.length}
\u{1F517} Connections: ${c.length}
\u{1F4C5} Modified: ${s.modified||"Unknown"}

**Shapes:**
${u.slice(0,10).map(f=>`- ${f.type}: ${f.text||f.label||"No text"}`).join(`
`)}
${u.length>10?`... and ${u.length-10} more shapes`:""}

**Connections:**
${c.slice(0,5).map(f=>`- ${f.from||"unknown"} \u2192 ${f.to||"unknown"}`).join(`
`)}
${c.length>5?`... and ${c.length-5} more connections`:""}`}]}}catch{return{content:[{type:"text",text:`Canvas "${e}" not found`}]}}}async function Vg(t,{name:e,description:r}){let n=(0,Et.join)(t,".lokus","canvas");await(0,Ce.mkdir)(n,{recursive:!0});let s=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),o=(0,Et.join)(n,`${s}.json`),c={id:s,name:e,description:r,shapes:[],viewport:{x:0,y:0,zoom:1},created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,Ce.writeFile)(o,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Canvas "${e}" created with ID: ${s}`}]}}async function Gg(t,{canvasId:e,shape:r}){let n=(0,Et.join)(t,".lokus","canvas",`${e}.json`);try{let s=await(0,Ce.readFile)(n,"utf-8"),o=JSON.parse(s),c={id:r.id||Date.now().toString(36)+Math.random().toString(36).substr(2),type:r.type||"rectangle",x:r.x||100,y:r.y||100,width:r.width||200,height:r.height||100,text:r.text||"",style:r.style||{},...r};return o.shapes=o.shapes||[],o.shapes.push(c),o.modified=new Date().toISOString(),await(0,Ce.writeFile)(n,JSON.stringify(o,null,2)),{content:[{type:"text",text:`\u2705 Shape added to canvas "${e}" with ID: ${c.id}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to add shape: ${s.message}`}]}}}async function Jg(t,e){let r=(0,Et.join)(t,".lokus","canvas",`${e}.json`);try{let n=await(0,Ce.readFile)(r,"utf-8"),o=(JSON.parse(n).shapes||[]).filter(u=>u.type==="arrow"||u.type==="line"||u.type==="connection"),c={};return o.forEach(u=>{let f=u.from||u.startId||"unknown",d=u.to||u.endId||"unknown";c[f]||(c[f]=[]),c[f].push(d)}),{content:[{type:"text",text:`**Canvas Connections:**

${Object.entries(c).map(([u,f])=>`\u{1F4CD} ${u}
${f.map(d=>`  \u2192 ${d}`).join(`
`)}`).join(`

`)}

Total connections: ${o.length}`}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to get connections: ${n.message}`}]}}}async function Zg(t,{canvasId:e,format:r="markdown"}){let n=(0,Et.join)(t,".lokus","canvas",`${e}.json`);try{let s=await(0,Ce.readFile)(n,"utf-8"),o=JSON.parse(s),c="";switch(r){case"markdown":c=`# ${o.name||e}

`,c+=o.description?`${o.description}

`:"",(o.shapes||[]).filter(d=>d.type!=="arrow"&&d.type!=="line").forEach(d=>{c+=`## ${d.text||d.label||"Node"}

`,d.description&&(c+=`${d.description}

`)});break;case"mermaid":c=`graph TD
`,(o.shapes||[]).forEach(d=>{d.type==="arrow"||d.type==="connection"?c+=`  ${d.from||d.startId} --> ${d.to||d.endId}
`:d.text&&(c+=`  ${d.id}["${d.text}"]
`)});break;case"json":default:c=JSON.stringify(o,null,2);break}return{content:[{type:"text",text:c}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to export canvas: ${s.message}`}]}}}var le=require("fs/promises"),ct=require("path"),si=[{name:"list_boards",description:"List all kanban boards in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_board",description:"Get kanban board with columns and cards",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID or name"}},required:["boardId"]}},{name:"create_board",description:"Create a new kanban board. Supports automatic date-based column creation.",inputSchema:{type:"object",properties:{name:{type:"string",description:"Board name"},columns:{type:"array",items:{type:"string"},description:"Column names (e.g., ['To Do', 'In Progress', 'Done'])"},dateType:{type:"string",enum:["monthly","quarterly","yearly","custom"],description:"Type of date-based columns to create (optional)"},startDate:{type:"string",description:"Start date for date-based columns (YYYY-MM-DD format, optional)"},endDate:{type:"string",description:"End date for date-based columns (YYYY-MM-DD format, optional)"},additionalColumns:{type:"array",items:{type:"string"},description:"Additional status columns (e.g., ['Applied', 'Accepted', 'Rejected'])"}},required:["name"]}},{name:"add_card",description:"Add a card to a kanban column",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},column:{type:"string",description:"Column name"},card:{type:"object",description:"Card data (title, description, tags, etc)"}},required:["boardId","column","card"]}},{name:"move_card",description:"Move a card between columns",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},fromColumn:{type:"string",description:"Source column"},toColumn:{type:"string",description:"Target column"}},required:["boardId","cardId","fromColumn","toColumn"]}},{name:"update_card",description:"Update card properties",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},updates:{type:"object",description:"Fields to update"}},required:["boardId","cardId","updates"]}},{name:"get_board_stats",description:"Get statistics for a kanban board",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"}},required:["boardId"]}}];async function Nu(t,e,r,n){switch(t){case"list_boards":return await Yg(r);case"get_board":return await Qg(r,e.boardId);case"create_board":return await Kg(r,e);case"add_card":return await ey(r,e);case"move_card":return await ty(r,e);case"update_card":return await ry(r,e);case"get_board_stats":return await ny(r,e.boardId);default:throw new Error(`Unknown kanban tool: ${t}`)}}async function Yg(t){let e=(0,ct.join)(t,".lokus","kanban");try{let r=await(0,le.readdir)(e,{withFileTypes:!0}),n=[];for(let s of r)if(s.isFile()&&s.name.endsWith(".json")){let o=s.name.replace(".json","");try{let c=await(0,le.readFile)((0,ct.join)(e,s.name),"utf-8"),u=JSON.parse(c),f=Object.values(u.columns||{}).reduce((d,m)=>d+(m.cards?.length||0),0);n.push({id:o,name:u.name||o,columns:Object.keys(u.columns||{}).length,cards:f,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Kanban Boards:**

${n.length>0?n.map(s=>`\u{1F4CB} **${s.name}**
  - ID: ${s.id}
  - Columns: ${s.columns}
  - Cards: ${s.cards}
  - Modified: ${s.modified||"Unknown"}`).join(`

`):"No kanban boards found"}`}]}}catch{return{content:[{type:"text",text:"Kanban feature not configured in this workspace"}]}}}async function Qg(t,e){let r=(0,ct.join)(t,".lokus","kanban",`${e}.json`);try{let n=await(0,le.readFile)(r,"utf-8"),s=JSON.parse(n),o=`**Kanban Board: ${s.name||e}**

`;for(let[c,u]of Object.entries(s.columns||{})){let f=u.cards||[];o+=`**${c}** (${f.length} cards)
`,f.slice(0,5).forEach(d=>{o+=`  \u2022 ${d.title}`,d.tags?.length&&(o+=` [${d.tags.join(", ")}]`),d.assignee&&(o+=` @${d.assignee}`),o+=`
`}),f.length>5&&(o+=`  ... and ${f.length-5} more cards
`),o+=`
`}return{content:[{type:"text",text:o}]}}catch{return{content:[{type:"text",text:`Board "${e}" not found`}]}}}async function Kg(t,{name:e,columns:r,dateType:n,startDate:s,endDate:o,additionalColumns:c=[]}){let u=(0,ct.join)(t,".lokus","kanban");await(0,le.mkdir)(u,{recursive:!0});let f=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),d=(0,ct.join)(u,`${f}.json`),m=new Date().toISOString(),w={version:"1.0.0",name:e,columns:{},settings:{card_template:{},automations:[],custom_fields:[]},metadata:{created:m,modified:m,created_with:"Lokus MCP"}},k=r||["To Do","In Progress","Done"];n&&s&&(k=Xg(n,s,o),c.length>0&&(k=[...k,...c]));for(let R=0;R<k.length;R++){let x=k[R],N=x.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");w.columns[N]={name:x,order:R,cards:[]}}return await(0,le.writeFile)(d,JSON.stringify(w,null,2)),{content:[{type:"text",text:`\u2705 Kanban board "${e}" created with ${Object.keys(w.columns).length} columns:
${k.map(R=>`  - ${R}`).join(`
`)}`}]}}function Xg(t,e,r){let n=[],s=new Date(e),o=r?new Date(r):new Date(s.getFullYear()+1,s.getMonth(),1);if(t==="monthly"){let c=new Date(s);for(;c<=o;){let u=c.toLocaleDateString("en-US",{month:"long",year:"numeric"});n.push(`\u{1F4C5} ${u}`),c.setMonth(c.getMonth()+1)}}else if(t==="quarterly"){let c=new Date(s),u=Math.floor(c.getMonth()/3)+1;for(;c<=o;)n.push(`\u{1F4C5} Q${u} ${c.getFullYear()}`),c.setMonth(c.getMonth()+3),u=Math.floor(c.getMonth()/3)+1}else if(t==="yearly"){let c=s.getFullYear(),u=o.getFullYear();for(;c<=u;)n.push(`\u{1F4C5} ${c}`),c++}return n}async function ey(t,{boardId:e,column:r,card:n}){let s=(0,ct.join)(t,".lokus","kanban",`${e}.json`);try{let o=await(0,le.readFile)(s,"utf-8"),c=JSON.parse(o);if(!c.columns[r])throw new Error(`Column "${r}" not found`);let u=new Date().toISOString(),f={id:n.id||Date.now().toString(36)+Math.random().toString(36).substr(2),title:n.title||"Untitled",description:n.description||"",tags:n.tags||[],assignee:n.assignee||null,priority:n.priority||"normal",due_date:n.due_date||n.dueDate||null,linked_notes:n.linked_notes||[],checklist:n.checklist||[],created:u,modified:u};return c.columns[r].cards=c.columns[r].cards||[],c.columns[r].cards.push(f),c.metadata.modified=u,await(0,le.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Card "${f.title}" added to column "${r}" with ID: ${f.id}`}]}}catch(o){return{content:[{type:"text",text:`\u274C Failed to add card: ${o.message}`}]}}}async function ty(t,{boardId:e,cardId:r,fromColumn:n,toColumn:s}){let o=(0,ct.join)(t,".lokus","kanban",`${e}.json`);try{let c=await(0,le.readFile)(o,"utf-8"),u=JSON.parse(c);if(!u.columns[n]||!u.columns[s])throw new Error("Column not found");let f=u.columns[n].cards?.findIndex(m=>m.id===r);if(f===-1)throw new Error(`Card ${r} not found in column ${n}`);let[d]=u.columns[n].cards.splice(f,1);return d.modified=new Date().toISOString(),u.columns[s].cards=u.columns[s].cards||[],u.columns[s].cards.push(d),u.metadata.modified=new Date().toISOString(),await(0,le.writeFile)(o,JSON.stringify(u,null,2)),{content:[{type:"text",text:`\u2705 Card "${d.title}" moved from "${n}" to "${s}"`}]}}catch(c){return{content:[{type:"text",text:`\u274C Failed to move card: ${c.message}`}]}}}async function ry(t,{boardId:e,cardId:r,updates:n}){let s=(0,ct.join)(t,".lokus","kanban",`${e}.json`);try{let o=await(0,le.readFile)(s,"utf-8"),c=JSON.parse(o),u=!1;for(let f of Object.values(c.columns||{})){let d=f.cards?.findIndex(m=>m.id===r);if(d!==-1){f.cards[d]={...f.cards[d],...n,id:r,modified:new Date().toISOString()},u=!0;break}}if(!u)throw new Error(`Card ${r} not found`);return c.metadata.modified=new Date().toISOString(),await(0,le.writeFile)(s,JSON.stringify(c,null,2)),{content:[{type:"text",text:`\u2705 Card ${r} updated successfully`}]}}catch(o){return{content:[{type:"text",text:`\u274C Failed to update card: ${o.message}`}]}}}async function ny(t,e){let r=(0,ct.join)(t,".lokus","kanban",`${e}.json`);try{let n=await(0,le.readFile)(r,"utf-8"),s=JSON.parse(n),o={columnCount:Object.keys(s.columns||{}).length,totalCards:0,cardsByColumn:{},cardsByPriority:{high:0,normal:0,low:0},cardsByAssignee:{},overdueTasks:0},c=new Date;for(let[u,f]of Object.entries(s.columns||{})){let d=f.cards||[];o.totalCards+=d.length,o.cardsByColumn[u]=d.length;for(let m of d)o.cardsByPriority[m.priority||"normal"]++,m.assignee&&(o.cardsByAssignee[m.assignee]=(o.cardsByAssignee[m.assignee]||0)+1),m.dueDate&&new Date(m.dueDate)<c&&o.overdueTasks++}return{content:[{type:"text",text:`**Board Statistics: ${s.name||e}**

\u{1F4CA} Total Cards: ${o.totalCards}
\u{1F4CB} Columns: ${o.columnCount}
\u26A0\uFE0F Overdue Tasks: ${o.overdueTasks}

**Cards by Column:**
${Object.entries(o.cardsByColumn).map(([u,f])=>`  - ${u}: ${f}`).join(`
`)}

**Cards by Priority:**
  - High: ${o.cardsByPriority.high}
  - Normal: ${o.cardsByPriority.normal}
  - Low: ${o.cardsByPriority.low}

**Cards by Assignee:**
${Object.entries(o.cardsByAssignee).map(([u,f])=>`  - @${u}: ${f}`).join(`
`)||"  No assignments"}`}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to get stats: ${n.message}`}]}}}var ws=require("fs/promises"),$r=require("path"),oi=[{name:"get_graph_overview",description:"Get overview of the knowledge graph",inputSchema:{type:"object",properties:{}}},{name:"get_node_connections",description:"Get all connections for a specific node (note)",inputSchema:{type:"object",properties:{nodeName:{type:"string",description:"Name of the node/note"}},required:["nodeName"]}},{name:"find_path",description:"Find path between two nodes in the graph",inputSchema:{type:"object",properties:{from:{type:"string",description:"Starting node"},to:{type:"string",description:"Target node"}},required:["from","to"]}},{name:"get_orphan_notes",description:"Find notes with no connections (orphans)",inputSchema:{type:"object",properties:{}}},{name:"get_hub_notes",description:"Find most connected notes (hubs)",inputSchema:{type:"object",properties:{limit:{type:"number",description:"Number of top hubs to return"}}}},{name:"get_clusters",description:"Identify clusters of related notes",inputSchema:{type:"object",properties:{}}}];async function Mu(t,e,r,n){switch(t){case"get_graph_overview":return await ay(r);case"get_node_connections":return await sy(r,e.nodeName);case"find_path":return await oy(r,e.from,e.to);case"get_orphan_notes":return await iy(r);case"get_hub_notes":return await cy(r,e.limit||10);case"get_clusters":return await ly(r);default:throw new Error(`Unknown graph tool: ${t}`)}}async function pn(t){let e={nodes:new Set,edges:[],adjacencyList:{}};async function r(n){let s=await(0,ws.readdir)(n,{withFileTypes:!0});for(let o of s){if(o.name.startsWith("."))continue;let c=(0,$r.join)(n,o.name);if(o.isDirectory())await r(c);else if(o.isFile()&&[".md",".txt"].includes((0,$r.extname)(o.name))){let u=(0,$r.basename)(o.name,(0,$r.extname)(o.name));e.nodes.add(u);try{let m=((await(0,ws.readFile)(c,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(w=>w.slice(2,-2));e.adjacencyList[u]=m;for(let w of m)e.edges.push({from:u,to:w})}catch{}}}}return await r(t),e}async function ay(t){let e=await pn(t),r={totalNodes:e.nodes.size,totalEdges:e.edges.length,avgConnections:e.edges.length/Math.max(e.nodes.size,1),orphanCount:0,hubCount:0};for(let n of e.nodes){let s=(e.adjacencyList[n]||[]).length,o=e.edges.filter(u=>u.to===n).length,c=s+o;c===0&&r.orphanCount++,c>5&&r.hubCount++}return{content:[{type:"text",text:`**Knowledge Graph Overview**

\u{1F535} Total Notes: ${r.totalNodes}
\u{1F517} Total Connections: ${r.totalEdges}
\u{1F4CA} Avg Connections: ${r.avgConnections.toFixed(2)}
\u{1F3DD}\uFE0F Orphan Notes: ${r.orphanCount}
\u{1F31F} Hub Notes (>5 connections): ${r.hubCount}

The knowledge graph shows how your notes are interconnected through wiki links.`}]}}async function sy(t,e){let r=await pn(t),n=r.adjacencyList[e]||[],s=r.edges.filter(c=>c.to===e).map(c=>c.from),o=new Set([...n,...s]);return{content:[{type:"text",text:`**Connections for "${e}"**

**Outgoing Links (${n.length}):**
${n.map(c=>`  \u2192 ${c}`).join(`
`)||"  None"}

**Incoming Links (${s.length}):**
${s.map(c=>`  \u2190 ${c}`).join(`
`)||"  None"}

**All Related Notes (${o.size}):**
${Array.from(o).map(c=>`  \u2022 ${c}`).join(`
`)||"  None"}`}]}}async function oy(t,e,r){let n=await pn(t),s=[[e]],o=new Set([e]);for(;s.length>0;){let c=s.shift(),u=c[c.length-1];if(u===r)return{content:[{type:"text",text:`**Path from "${e}" to "${r}":**

${c.map((d,m)=>m===0?`\u{1F7E2} ${d}`:m===c.length-1?`\u{1F534} ${d}`:`\u26AA ${d}`).join(" \u2192 ")}

Path length: ${c.length-1} steps`}]};let f=n.adjacencyList[u]||[];for(let d of f)o.has(d)||(o.add(d),s.push([...c,d]))}return{content:[{type:"text",text:`No path found from "${e}" to "${r}". These notes are not connected in the knowledge graph.`}]}}async function iy(t){let e=await pn(t),r=[];for(let n of e.nodes){let s=(e.adjacencyList[n]||[]).length,o=e.edges.filter(c=>c.to===n).length;s===0&&o===0&&r.push(n)}return{content:[{type:"text",text:`**Orphan Notes (${r.length}):**

These notes have no connections to other notes:

${r.map(n=>`  \u2022 ${n}`).join(`
`)||"No orphan notes found!"}

Consider linking these notes to integrate them into your knowledge graph.`}]}}async function cy(t,e){let r=await pn(t),n={};for(let o of r.nodes){let c=(r.adjacencyList[o]||[]).length,u=r.edges.filter(f=>f.to===o).length;n[o]=c+u}let s=Object.entries(n).sort((o,c)=>c[1]-o[1]).slice(0,e);return{content:[{type:"text",text:`**Top ${e} Hub Notes:**

These notes are most connected in your knowledge graph:

${s.map(([o,c],u)=>`${u+1}. **${o}** - ${c} connections`).join(`
`)}

Hub notes are central to your knowledge structure and often represent key concepts.`}]}}async function ly(t){let e=await pn(t),r=new Set,n=[];function s(o,c){if(r.has(o))return;r.add(o),c.add(o);let u=e.adjacencyList[o]||[];for(let d of u)s(d,c);let f=e.edges.filter(d=>d.to===o).map(d=>d.from);for(let d of f)s(d,c)}for(let o of e.nodes)if(!r.has(o)){let c=new Set;s(o,c),c.size>1&&n.push(Array.from(c))}return n.sort((o,c)=>c.length-o.length),{content:[{type:"text",text:`**Knowledge Clusters (${n.length}):**

${n.slice(0,5).map((o,c)=>`**Cluster ${c+1}** (${o.length} notes):
${o.slice(0,10).map(u=>`  \u2022 ${u}`).join(`
`)}${o.length>10?`
  ... and ${o.length-10} more`:""}`).join(`

`)}${n.length>5?`

... and ${n.length-5} more clusters`:""}

Clusters represent groups of related notes that are interconnected.`}]}}var Re=require("fs/promises"),Pr=require("path"),ii=[{name:"list_templates",description:"List all templates in the workspace",inputSchema:{type:"object",properties:{category:{type:"string",description:"Filter by category (optional)"}}}},{name:"create_template",description:"Create a new template with proper frontmatter. Templates support variables like {{date}}, {{time}}, {{cursor}}, {{title}}, and custom variables.",inputSchema:{type:"object",properties:{id:{type:"string",description:"Unique template ID (lowercase, hyphenated)"},name:{type:"string",description:"Display name for the template"},content:{type:"string",description:"Template content with variables (e.g., {{date}}, {{time}}, {{cursor}})"},category:{type:"string",description:"Category for organization (Personal, Work, Documentation, etc.)",default:"Personal"},tags:{type:"array",items:{type:"string"},description:"Tags for categorization"}},required:["id","name","content"]}},{name:"read_template",description:"Read a template's content and metadata",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID"}},required:["id"]}},{name:"update_template",description:"Update an existing template",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID"},name:{type:"string",description:"New name (optional)"},content:{type:"string",description:"New content (optional)"},category:{type:"string",description:"New category (optional)"},tags:{type:"array",items:{type:"string"},description:"New tags (optional)"}},required:["id"]}},{name:"delete_template",description:"Delete a template",inputSchema:{type:"object",properties:{id:{type:"string",description:"Template ID to delete"}},required:["id"]}}];async function Fu(t,e,r,n){let s=(0,Pr.join)(r,"templates");try{await(0,Re.mkdir)(s,{recursive:!0})}catch{}switch(t){case"list_templates":return await uy(s,e);case"create_template":return await dy(s,e);case"read_template":return await fy(s,e);case"update_template":return await py(s,e);case"delete_template":return await hy(s,e);default:throw new Error(`Unknown template tool: ${t}`)}}async function uy(t,e){try{let r=await(0,Re.readdir)(t),n=[];for(let s of r)if(s.endsWith(".md"))try{let o=(0,Pr.join)(t,s),c=await(0,Re.readFile)(o,"utf-8"),u=ci(c,s);(!e.category||u.category===e.category)&&n.push({id:u.id,name:u.name,category:u.category,tags:u.tags,createdAt:u.createdAt,updatedAt:u.updatedAt})}catch{}return{content:[{type:"text",text:JSON.stringify({templates:n,total:n.length},null,2)}]}}catch(r){return{content:[{type:"text",text:`Error listing templates: ${r.message}`}],isError:!0}}}async function dy(t,e){try{let{id:r,name:n,content:s,category:o="Personal",tags:c=[]}=e;if(!/^[a-z0-9-_]+$/.test(r))throw new Error("Template ID must be lowercase alphanumeric with hyphens/underscores");let u=`${r}.md`,f=(0,Pr.join)(t,u),d=new Date().toISOString(),w=`---
${ju({id:r,name:n,category:o,tags:c,createdAt:d,updatedAt:d})}---

${s}`;return await(0,Re.writeFile)(f,w,"utf-8"),{content:[{type:"text",text:`Template "${n}" created successfully!

ID: ${r}
File: ${f}

**Important**: The template has been created as a file, but to see it in the UI:
1. Open Template Manager in Lokus
2. Click the "Refresh" button
3. The template will now appear in the list

Alternatively, restart the Lokus app to load the new template.`}]}}catch(r){return{content:[{type:"text",text:`Error creating template: ${r.message}`}],isError:!0}}}async function fy(t,e){try{let{id:r}=e,n=(0,Pr.join)(t,`${r}.md`),s=await(0,Re.readFile)(n,"utf-8"),o=ci(s,`${r}.md`);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}catch(r){return{content:[{type:"text",text:`Error reading template: ${r.message}`}],isError:!0}}}async function py(t,e){try{let{id:r,name:n,content:s,category:o,tags:c}=e,u=(0,Pr.join)(t,`${r}.md`),f=await(0,Re.readFile)(u,"utf-8"),d=ci(f,`${r}.md`),m={id:d.id,name:n||d.name,content:s||d.content,category:o||d.category,tags:c||d.tags,createdAt:d.createdAt,updatedAt:new Date().toISOString()},k=`---
${ju(m)}---

${m.content}`;return await(0,Re.writeFile)(u,k,"utf-8"),{content:[{type:"text",text:`Template "${m.name}" updated successfully!

**Remember to refresh the Template Manager** to see the changes.`}]}}catch(r){return{content:[{type:"text",text:`Error updating template: ${r.message}`}],isError:!0}}}async function hy(t,e){try{let{id:r}=e,n=(0,Pr.join)(t,`${r}.md`);return await(0,Re.unlink)(n),{content:[{type:"text",text:`Template "${r}" deleted successfully!

**Remember to refresh the Template Manager** to see the changes.`}]}}catch(r){return{content:[{type:"text",text:`Error deleting template: ${r.message}`}],isError:!0}}}function ju(t){let e="";return e+=`id: ${t.id}
`,e+=`name: "${t.name}"
`,e+=`category: ${t.category}
`,t.tags&&t.tags.length>0?(e+=`tags:
`,t.tags.forEach(r=>{e+=`  - ${r}
`})):e+=`tags: []
`,e+=`createdAt: ${t.createdAt}
`,e+=`updatedAt: ${t.updatedAt}
`,e}function ci(t,e){let r=/^---\n([\s\S]*?)\n---\n([\s\S]*)$/,n=t.match(r);if(!n){let u=e.replace(".md","");return{id:u,name:u,content:t.trim(),category:"Personal",tags:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}let s=n[1],o=n[2].trim(),c=my(s);return{id:c.id||e.replace(".md",""),name:c.name||c.id||e.replace(".md",""),content:o,category:c.category||"Personal",tags:c.tags||[],createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}}function my(t){let e=t.split(`
`),r={},n=null,s=[];for(let o of e){let c=o.trim();if(!c)continue;if(c.startsWith("- ")){n&&s.push(c.substring(2).trim());continue}n&&s.length>0&&(r[n]=s,s=[],n=null);let u=c.indexOf(":");if(u>-1){let f=c.substring(0,u).trim(),d=c.substring(u+1).trim();d.startsWith('"')&&d.endsWith('"')&&(d=d.substring(1,d.length-1)),d==="[]"?r[f]=[]:d?r[f]=d:(n=f,s=[])}}return n&&s.length>0&&(r[n]=s),r}vs();var ut=!1;try{let t=typeof window<"u"?window:void 0;ut=!!(t&&(t.__TAURI_INTERNALS__&&typeof t.__TAURI_INTERNALS__.invoke=="function"||t.__TAURI_METADATA__||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.includes("Tauri")))}catch{}var yi,bi,Gu,Ju,Zu,Yu;async function Kn(){if(ut&&!yi)try{({appDataDir:yi,join:bi}=await Promise.resolve().then(()=>(Yn(),Ts))),{readTextFile:Gu,writeTextFile:Ju,mkdir:Zu,exists:Yu}=await Promise.resolve().then(()=>(gi(),mi))}catch{ut=!1}}var Hu="Lokus",Vu="config.json",Qu="lokus:config";async function wi(t){await Kn(),ut&&(await Yu(t)||await Zu(t,{recursive:!0}))}async function wb(t){if(await Kn(),!ut)try{return JSON.parse(localStorage.getItem(Qu)||"null")}catch{return null}try{let e=await Gu(t);return JSON.parse(e)}catch{return null}}async function _b(t,e){if(await Kn(),!ut){localStorage.setItem(Qu,JSON.stringify(e??{}));return}await Ju(t,JSON.stringify(e,null,2))}async function _i(){if(await Kn(),!ut)return Hu;let t=await bi(await yi(),Hu);return await wi(t),t}async function Ku(){return await Kn(),ut?await bi(await _i(),Vu):Vu}async function ki(){let t=await Ku();if(ut){let r=await _i();await wi(r)}let e=await wb(t);return e===null&&(e={}),e}async function kb(t){let e=await Ku();if(ut){let n=await _i();await wi(n)}return await _b(e,t)}async function Xu(t){let r={...await ki(),...t};return await kb(r),r}ta();var Lr=()=>{if(typeof window>"u")return"unknown";let t=window.navigator.platform?.toLowerCase()||"",e=window.navigator.userAgent?.toLowerCase()||"";return/iphone|ipad|ipod/.test(e)||t==="macintel"&&navigator.maxTouchPoints>1?"ios":e.includes("android")?"android":t.includes("win")||e.includes("windows")?"windows":t.includes("mac")||e.includes("mac")?"macos":t.includes("linux")||e.includes("linux")?"linux":"unknown"},Ze=()=>Lr()==="windows",Ee=()=>Lr()==="macos",fd=()=>Lr()==="linux";var pd=()=>Ee()?"Cmd":"Ctrl";var hd=()=>Ze()?"\\":"/";var Nb={windows:{shellIntegration:!0,jumpList:!0,snapLayouts:!0,contextMenus:!0,registryAccess:!0,windowsNotifications:!0,darkModeSync:!0,fileDialog:!0,multiWindow:!0},macos:{quickLook:!0,touchBar:!0,continuity:!0,spotlight:!0,finderIntegration:!0,darkModeSync:!0,fileDialog:!0,multiWindow:!0},linux:{desktopIntegration:!0,contextMenus:!0,darkModeSync:!1,fileDialog:!0,multiWindow:!0},ios:{touchSupport:!0,darkModeSync:!0,fileDialog:!1,multiWindow:!1,hapticFeedback:!0},android:{touchSupport:!0,darkModeSync:!0,fileDialog:!1,multiWindow:!1,hapticFeedback:!0}},md=t=>{let e=Lr();return Nb[e]?.[t]||!1},Mb=async()=>{switch(Lr()){case"windows":return Promise.resolve().then(()=>(ld(),cd));case"macos":return Promise.resolve().then(()=>(dd(),ud));default:return Promise.resolve().then(()=>(ta(),ed))}},vi=null,gd=async()=>(vi||(vi=await Mb()),vi);var Ti=class{constructor(){this.platform=Lr(),this.platformModule=null,this.initialized=!1}async initialize(){if(!this.initialized)try{this.platformModule=await gd(),this.initialized=!0}catch(e){console.error("PlatformService: Failed to load platform module",e)}}getPlatform(){return this.platform}isWindows(){return Ze()}isMacOS(){return Ee()}isLinux(){return fd()}hasCapability(e){return md(e)}async getShortcuts(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsShortcuts||{}:Ee()?this.platformModule.macosShortcuts||{}:this.platformModule.windowsShortcuts||{}:{}}async getShortcut(e){return(await this.getShortcuts())[e]||null}formatShortcut(e){if(!e)return"";let r=e;return Ee()&&(r=r.replace(/Cmd/g,"\u2318"),r=r.replace(/Option/g,"\u2325"),r=r.replace(/Shift/g,"\u21E7"),r=r.replace(/Control/g,"\u2303")),r}async getPathUtils(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsPathUtils||{}:Ee()?this.platformModule.macosPathUtils||{}:this.platformModule||{}:{}}async normalizePath(e){let r=await this.getPathUtils();return Ze()&&r.normalizePath?r.normalizePath(e):e}getPathSeparator(){return hd()}async getValidation(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsValidation||{isValidFilename:()=>!0}:Ee()?this.platformModule.macosValidation||{isValidFilename:()=>!0}:this.platformModule.validationUtils||{isValidFilename:()=>!0}:{isValidFilename:()=>!0}}async isValidFilename(e){return(await this.getValidation()).isValidFilename(e)}async getUIUtils(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsUI||{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:Ee()?this.platformModule.macosUI||{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}:{isDarkModeEnabled:()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}}async getPlatformStyles(){let e=await this.getUIUtils();return Ze()&&e.getWindowsStyles?e.getWindowsStyles():Ee()&&e.getMacStyles?e.getMacStyles():{}}async getShellIntegration(){return await this.initialize(),this.platformModule?Ze()?this.platformModule.windowsShell||null:Ee()&&this.platformModule.finderIntegration||null:null}async getContextMenuItems(){return(await this.getShellIntegration())?.getContextMenuItems?.()||[]}async getPlatformFeatures(){return await this.initialize(),Ze()?this.platformModule.windowsFeatureHelpers||this.platformModule.windowsFeaturesFromModule:Ee()?this.platformModule.macosFeatures:{}}getModifierKey(){return pd()}getModifierSymbol(){return Ee()?"\u2318":"Ctrl"}convertShortcut(e){let r=e;return Ee()?(r=r.replace(/Ctrl/g,"Cmd"),r=r.replace(/Alt/g,"Option")):(r=r.replace(/Cmd/g,"Ctrl"),r=r.replace(/Option/g,"Alt")),r}matchesShortcut(e,r){if(!this.platformModule)return!1;let n=this.platformModule?.keyboardUtils?.getNormalizedKey?.(e);if(!n)return!1;let s=this.convertShortcut(r);return n===s.replace(/\+/g,"+")}},aS=new Ti;var Ub=["--bg","--text","--panel","--border","--muted","--accent","--accent-fg","--tab-active","--task-todo","--task-progress","--task-urgent","--task-question","--task-completed","--task-cancelled","--task-delegated","--danger","--success","--warning","--info","--editor-placeholder","--app-bg","--app-text","--app-panel","--app-border","--app-muted","--app-accent","--app-accent-fg"],xd={"--bg":"15 23 42","--text":"241 245 249","--panel":"30 41 59","--border":"51 65 85","--muted":"148 163 184","--accent":"139 92 246","--accent-fg":"255 255 255","--tab-active":"30 41 59","--task-todo":"107 114 128","--task-progress":"59 130 246","--task-urgent":"239 68 68","--task-question":"245 158 11","--task-completed":"16 185 129","--task-cancelled":"107 114 128","--task-delegated":"139 92 246","--danger":"239 68 68","--success":"16 185 129","--warning":"245 158 11","--info":"59 130 246","--editor-placeholder":"148 163 184"},zb=["lokus-dark","dracula","nord","one-dark-pro","minimal-light","neon-dark"],Ii={"lokus-dark":'{"name": "Lokus Dark", "tokens": {"--bg": "#0f172a", "--text": "#f1f5f9", "--panel": "#1e293b", "--border": "#334155", "--muted": "#94a3b8", "--accent": "#8b5cf6", "--accent-fg": "#ffffff", "--task-todo": "#64748b", "--task-progress": "#3b82f6", "--task-urgent": "#ef4444", "--task-question": "#f59e0b", "--task-completed": "#10b981", "--task-cancelled": "#64748b", "--task-delegated": "#8b5cf6", "--danger": "#ef4444", "--success": "#10b981", "--warning": "#f59e0b", "--info": "#3b82f6", "--editor-placeholder": "#64748b"}}',dracula:'{"name": "Dracula", "tokens": {"--bg": "#282a36", "--text": "#f8f8f2", "--panel": "#21222c", "--border": "#44475a", "--muted": "#6272a4", "--accent": "#bd93f9", "--accent-fg": "#ffffff", "--task-todo": "#6272a4", "--task-progress": "#8be9fd", "--task-urgent": "#ff5555", "--task-question": "#f1fa8c", "--task-completed": "#50fa7b", "--task-cancelled": "#6272a4", "--task-delegated": "#bd93f9", "--danger": "#ff5555", "--success": "#50fa7b", "--warning": "#f1fa8c", "--info": "#8be9fd", "--editor-placeholder": "#6272a4"}}',nord:'{"name": "Nord", "tokens": {"--bg": "#2E3440", "--text": "#ECEFF4", "--panel": "#3B4252", "--border": "#4C566A", "--muted": "#D8DEE9", "--accent": "#88C0D0", "--accent-fg": "#2E3440", "--task-todo": "#4C566A", "--task-progress": "#5E81AC", "--task-urgent": "#BF616A", "--task-question": "#EBCB8B", "--task-completed": "#A3BE8C", "--task-cancelled": "#4C566A", "--task-delegated": "#B48EAD", "--danger": "#BF616A", "--success": "#A3BE8C", "--warning": "#EBCB8B", "--info": "#5E81AC", "--editor-placeholder": "#4C566A"}}',"one-dark-pro":'{"name": "One Dark Pro", "tokens": {"--bg": "#282c34", "--text": "#abb2bf", "--panel": "#21252b", "--border": "#3a3f4b", "--muted": "#5c6370", "--accent": "#61afef", "--accent-fg": "#ffffff", "--task-todo": "#5c6370", "--task-progress": "#61afef", "--task-urgent": "#e06c75", "--task-question": "#d19a66", "--task-completed": "#98c379", "--task-cancelled": "#5c6370", "--task-delegated": "#c678dd", "--danger": "#e06c75", "--success": "#98c379", "--warning": "#d19a66", "--info": "#61afef", "--editor-placeholder": "#5c6370"}}',"minimal-light":'{"name": "Minimal Light", "tokens": {"--bg": "#ffffff", "--text": "#1a1a1a", "--panel": "#f8f9fa", "--border": "#e5e7eb", "--muted": "#6b7280", "--accent": "#3b82f6", "--accent-fg": "#ffffff", "--task-todo": "#9ca3af", "--task-progress": "#3b82f6", "--task-urgent": "#ef4444", "--task-question": "#f59e0b", "--task-completed": "#10b981", "--task-cancelled": "#9ca3af", "--task-delegated": "#8b5cf6", "--danger": "#ef4444", "--success": "#10b981", "--warning": "#f59e0b", "--info": "#3b82f6", "--editor-placeholder": "#9ca3af"}}',"neon-dark":'{"name": "Neon Dark", "tokens": {"--bg": "#0a0a0f", "--text": "#e2e8f0", "--panel": "#1a1a2e", "--border": "#16213e", "--muted": "#64748b", "--accent": "#00d4ff", "--accent-fg": "#0a0a0f", "--task-todo": "#64748b", "--task-progress": "#00d4ff", "--task-urgent": "#ff0080", "--task-question": "#ffea00", "--task-completed": "#00ff88", "--task-cancelled": "#64748b", "--task-delegated": "#8000ff", "--danger": "#ff0080", "--success": "#00ff88", "--warning": "#ffea00", "--info": "#00d4ff", "--editor-placeholder": "#64748b"}}'},_e=!1;try{let t=typeof window<"u"?window:void 0;_e=!!(t&&(t.__TAURI_INTERNALS__&&typeof t.__TAURI_INTERNALS__.invoke=="function"||t.__TAURI_METADATA__||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.includes("Tauri")))}catch{}var Hb,Vb,Gb,Jb,Zb,Yb,Qb,vd=!1;async function Mr(){if(vd)return;let t=typeof process<"u"&&process.env.NODE_ENV==="test";if(_e||t)try{({join:Hb,appDataDir:Yb}=await Promise.resolve().then(()=>(Yn(),Ts))),{exists:Vb,readDir:Gb,readTextFile:Jb,writeTextFile:Zb,mkdir:Qb}=await Promise.resolve().then(()=>(gi(),mi)),vd=!0,t&&(_e=!0)}catch{t||(_e=!1)}}function Kb(t){if(typeof t!="string")return t;if(t=t.trim(),t.startsWith("#")){let e=t.replace("#","");if(!/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$/.test(e))return t;let r=e.length===3?e.split("").map(s=>s+s).join(""):e,n=parseInt(r,16);return`${n>>16&255} ${n>>8&255} ${n&255}`}return t}async function Xb(t){if(!t||typeof t!="object")return;let e=document.documentElement,r={};for(let[n,s]of Object.entries(t)){if(n.startsWith("--app-")){let o=n.replace("--app-","--");r[o]=s}r[n]=s}for(let n of Ub){let s=r[n];if(s){let o=Kb(s);e.style.setProperty(n,o)}else e.style.removeProperty(n)}if(_e)try{let{invoke:n}=await Promise.resolve().then(()=>(lt(),li)),{getCurrentWindow:s}=await Promise.resolve().then(()=>(Sd(),kd)),o=r["--bg"]||"15 23 42",c=document.documentElement.classList.contains("dark")||window.matchMedia("(prefers-color-scheme: dark)").matches;await n("sync_window_theme",{isDark:c,bgColor:o})}catch{}}async function ew(t){try{await Zn("theme:apply",t)}catch{try{window.dispatchEvent(new CustomEvent("theme:apply",{detail:t}))}catch{}}}async function oa(t){if(!t)return null;if(await Mr(),Ii[t])try{return JSON.parse(Ii[t])}catch{}if(_e)try{return await Fr(),{tokens:await $t("get_theme_tokens",{themeId:t})}}catch{}return null}async function Td(){let t=new Map;for(let e of zb)try{let r=JSON.parse(Ii[e]);t.set(e,{id:e,name:r.name})}catch{t.set(e,{id:e,name:e})}if(_e)try{let e=await tw();for(let r of e){let n=r.name.toLowerCase().replace(/[^a-z0-9_-]/g,"_");t.set(n,{id:n,name:r.name})}}catch{}return Array.from(t.values())}async function Cd(){return{theme:(await ki()).theme||null}}async function Rd(t){try{await Xu({theme:t})}catch{return}let r=(await oa(t))?.tokens||xd;r={...xd,...r},await Xb(r),await ew({tokens:r,visuals:{theme:t}})}var $t;async function Fr(){$t||_e&&($t=(await Promise.resolve().then(()=>(lt(),li))).invoke)}async function Ed(t,e=!1){if(await Mr(),await Fr(),!_e)throw new Error("Theme import only available in desktop app");return await $t("import_theme_file",{filePath:t,overwrite:e})}async function Ad(t){if(await Mr(),await Fr(),!_e)throw new Error("Theme validation only available in desktop app");return await $t("validate_theme_file",{filePath:t})}async function $d(t,e){if(await Mr(),await Fr(),!_e)throw new Error("Theme export only available in desktop app");await $t("export_theme",{themeId:t,exportPath:e})}async function Pd(t){if(await Mr(),await Fr(),!_e)throw new Error("Theme deletion only available in desktop app");await $t("delete_custom_theme",{themeId:t})}async function tw(){return await Mr(),await Fr(),_e?await $t("list_custom_themes"):[]}async function Di(t,e){if(await Mr(),await Fr(),!_e)throw new Error("Theme saving only available in desktop app");await $t("save_theme_tokens",{themeId:t,tokens:e})}var nw={"--bg":"Background color (hex or RGB)","--text":"Primary text color","--panel":"Panel/sidebar background","--border":"Border color","--muted":"Muted/secondary text","--accent":"Accent/highlight color","--accent-fg":"Foreground color for accent (text on accent background)","--tab-active":"Active tab background","--task-todo":"Todo task color","--task-progress":"In-progress task color","--task-urgent":"Urgent task color","--task-question":"Question task color","--task-completed":"Completed task color","--task-cancelled":"Cancelled task color","--task-delegated":"Delegated task color","--danger":"Danger/error color","--success":"Success color","--warning":"Warning color","--info":"Info color","--editor-placeholder":"Editor placeholder text color"};async function aw(){try{let t=await Td();return{themes:t,count:t.length,builtIn:["dracula","nord","one-dark-pro","minimal-light","neon-dark"]}}catch(t){throw new Error(`Failed to list themes: ${t.message}`)}}async function sw(t){try{let e=await oa(t);if(!e)throw new Error(`Theme "${t}" not found`);return{id:t,name:e.name||t,tokens:e.tokens,tokenDescriptions:nw}}catch(e){throw new Error(`Failed to get theme: ${e.message}`)}}async function ow(t,e){if(!t||typeof t!="string")throw new Error("Theme name is required");if(!e||typeof e!="object")throw new Error("Theme tokens object is required");let n=["--bg","--text","--panel","--border","--muted","--accent","--accent-fg"].filter(o=>!e[o]);if(n.length>0)throw new Error(`Missing required tokens: ${n.join(", ")}`);for(let[o,c]of Object.entries(e)){if(typeof c!="string")throw new Error(`Invalid token value for ${o}: must be a string`);let u=/^#[0-9A-Fa-f]{3}$|^#[0-9A-Fa-f]{6}$/.test(c.trim()),f=/^\d+\s+\d+\s+\d+$/.test(c.trim());if(!u&&!f)throw new Error(`Invalid color format for ${o}: "${c}". Use hex (#282a36) or RGB (40 42 54)`)}let s=t.toLowerCase().replace(/[^a-z0-9_-]/g,"_");try{return await Di(s,e),{id:s,name:t,tokens:e,message:`Theme "${t}" created successfully`}}catch(o){throw new Error(`Failed to create theme: ${o.message}`)}}async function iw(t,e){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(!e||typeof e!="object")throw new Error("Theme tokens object is required");let r=await oa(t);if(!r)throw new Error(`Theme "${t}" not found`);let n={...r.tokens,...e};try{return await Di(t,n),{id:t,tokens:n,message:`Theme "${t}" updated successfully`}}catch(s){throw new Error(`Failed to update theme: ${s.message}`)}}async function cw(t){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(["dracula","nord","one-dark-pro","minimal-light","neon-dark"].includes(t))throw new Error(`Cannot delete built-in theme "${t}"`);try{return await Pd(t),{id:t,message:`Theme "${t}" deleted successfully`}}catch(r){throw new Error(`Failed to delete theme: ${r.message}`)}}async function lw(t){if(!t||typeof t!="string")throw new Error("Theme ID is required");try{return await Rd(t),{id:t,message:`Theme "${t}" applied successfully`}}catch(e){throw new Error(`Failed to apply theme: ${e.message}`)}}async function uw(t,e){if(!t||typeof t!="string")throw new Error("Theme ID is required");if(!e||typeof e!="string")throw new Error("Export path is required");try{return await $d(t,e),{id:t,path:e,message:`Theme "${t}" exported to ${e}`}}catch(r){throw new Error(`Failed to export theme: ${r.message}`)}}async function dw(t,e=!1){if(!t||typeof t!="string")throw new Error("File path is required");try{let r=await Ad(t);if(!r.valid)throw new Error(`Invalid theme file: ${r.error}`);let n=await Ed(t,e);return{id:n,path:t,message:`Theme imported successfully as "${n}"`}}catch(r){throw new Error(`Failed to import theme: ${r.message}`)}}async function fw(){try{let e=(await Cd()).theme;if(!e)return{id:null,message:"No theme currently active"};let r=await oa(e);return{id:e,name:r?.name||e,tokens:r?.tokens||{}}}catch(t){throw new Error(`Failed to get current theme: ${t.message}`)}}var Oi=[{name:"list_themes",description:"List all available themes (built-in and custom)",inputSchema:{type:"object",properties:{},required:[]}},{name:"get_theme",description:"Get details of a specific theme including all token values",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID (e.g., 'dracula', 'nord', 'my-custom-theme')"}},required:["themeId"]}},{name:"create_theme",description:"Create a new custom theme with specified colors. Supports hex (#282a36) or RGB (40 42 54) format.",inputSchema:{type:"object",properties:{name:{type:"string",description:"Theme name (will be converted to safe ID)"},tokens:{type:"object",description:"Theme color tokens. Required: --bg, --text, --panel, --border, --muted, --accent, --accent-fg. Optional: --tab-active, --task-*, --danger, --success, --warning, --info, --editor-placeholder",properties:{"--bg":{type:"string",description:"Background color"},"--text":{type:"string",description:"Primary text color"},"--panel":{type:"string",description:"Panel background"},"--border":{type:"string",description:"Border color"},"--muted":{type:"string",description:"Muted text"},"--accent":{type:"string",description:"Accent color"},"--accent-fg":{type:"string",description:"Accent foreground"},"--tab-active":{type:"string",description:"Active tab background"},"--task-todo":{type:"string",description:"Todo task color"},"--task-progress":{type:"string",description:"In-progress task color"},"--task-urgent":{type:"string",description:"Urgent task color"},"--task-question":{type:"string",description:"Question task color"},"--task-completed":{type:"string",description:"Completed task color"},"--task-cancelled":{type:"string",description:"Cancelled task color"},"--task-delegated":{type:"string",description:"Delegated task color"},"--danger":{type:"string",description:"Danger/error color"},"--success":{type:"string",description:"Success color"},"--warning":{type:"string",description:"Warning color"},"--info":{type:"string",description:"Info color"},"--editor-placeholder":{type:"string",description:"Editor placeholder color"}},required:["--bg","--text","--panel","--border","--muted","--accent","--accent-fg"]}},required:["name","tokens"]}},{name:"update_theme",description:"Update an existing theme's tokens (partial updates allowed)",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to update"},tokens:{type:"object",description:"Token values to update (only changed tokens needed)"}},required:["themeId","tokens"]}},{name:"delete_theme",description:"Delete a custom theme (cannot delete built-in themes)",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to delete"}},required:["themeId"]}},{name:"apply_theme",description:"Apply a theme to the application",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to apply"}},required:["themeId"]}},{name:"get_current_theme",description:"Get the currently active theme",inputSchema:{type:"object",properties:{},required:[]}},{name:"export_theme",description:"Export a theme to a JSON file",inputSchema:{type:"object",properties:{themeId:{type:"string",description:"Theme ID to export"},exportPath:{type:"string",description:"Full path where to save the theme file"}},required:["themeId","exportPath"]}},{name:"import_theme",description:"Import a theme from a JSON file",inputSchema:{type:"object",properties:{filePath:{type:"string",description:"Path to theme JSON file"},overwrite:{type:"boolean",description:"Overwrite existing theme if it exists",default:!1}},required:["filePath"]}}];async function Id(t,e){switch(t){case"list_themes":return await aw();case"get_theme":return await sw(e.themeId);case"create_theme":return await ow(e.name,e.tokens);case"update_theme":return await iw(e.themeId,e.tokens);case"delete_theme":return await cw(e.themeId);case"apply_theme":return await lw(e.themeId);case"get_current_theme":return await fw();case"export_theme":return await uw(e.themeId,e.exportPath);case"import_theme":return await dw(e.filePath,e.overwrite);default:throw new Error(`Unknown theme tool: ${t}`)}}var dt=require("fs/promises"),ia=require("path"),jr=(t,e="yyyy-MM-dd")=>{let r=new Date(t),n=c=>c.toString().padStart(2,"0"),s={yyyy:r.getFullYear(),MM:n(r.getMonth()+1),dd:n(r.getDate()),EEEE:r.toLocaleDateString("en-US",{weekday:"long"}),EEE:r.toLocaleDateString("en-US",{weekday:"short"}),MMMM:r.toLocaleDateString("en-US",{month:"long"}),MMM:r.toLocaleDateString("en-US",{month:"short"}),HH:n(r.getHours()),mm:n(r.getMinutes()),ss:n(r.getSeconds())},o=e;for(let[c,u]of Object.entries(s))o=o.replace(new RegExp(c,"g"),u);return o},Od=(t,e="yyyy-MM-dd")=>{let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let[,n,s,o]=r,c=new Date(parseInt(n),parseInt(s)-1,parseInt(o));if(!isNaN(c.getTime()))return c}return null},Dd=(t,e)=>{let r=new Date(t);return r.setDate(r.getDate()+e),r},Li={format:"yyyy-MM-dd",folder:"Daily Notes"};async function $s(t,e,r=Li){let n=(0,ia.join)(t,r.folder),s=`${jr(e,r.format)}.md`,o=(0,ia.join)(n,s);try{await(0,dt.mkdir)(n,{recursive:!0})}catch{}let c=null,u=!1;try{c=await(0,dt.readFile)(o,"utf-8")}catch{let d=jr(e,"EEEE");c=`# ${jr(e,r.format)} - ${d}

`,await(0,dt.writeFile)(o,c,"utf-8"),u=!0}return{path:o,date:jr(e,r.format),dayName:jr(e,"EEEE"),content:c,created:u}}async function pw(t,e=Li,r=30){let n=(0,ia.join)(t,e.folder);try{let s=await(0,dt.readdir)(n),o=[];for(let c of s){if(!c.endsWith(".md"))continue;let u=c.replace(/\.md$/,""),f=Od(u,e.format);if(f){let d=(0,ia.join)(n,c),m=await(0,dt.stat)(d);o.push({path:d,name:c,date:jr(f,e.format),dayName:jr(f,"EEEE"),modified:m.mtime.toISOString()})}}return o.sort((c,u)=>u.date.localeCompare(c.date)),o.slice(0,r)}catch{return[]}}var Ni=[{name:"daily_note",description:"Manage daily notes - open today, yesterday, tomorrow, or a specific date. Daily notes are automatically created if they don't exist.",inputSchema:{type:"object",properties:{action:{type:"string",enum:["today","yesterday","tomorrow","date","list"],description:"Action to perform: today (get/create today's note), yesterday, tomorrow, date (specific date), list (list all daily notes)"},date:{type:"string",description:'Date in YYYY-MM-DD format (required for "date" action)'},limit:{type:"number",description:'Maximum number of notes to return for "list" action (default: 30)'}},required:["action"]}}];async function Ld(t,e,r){if(t!=="daily_note")throw new Error(`Unknown tool: ${t}`);let{action:n,date:s,limit:o=30}=e,c;switch(n){case"today":{let u=await $s(r,new Date);c={success:!0,action:"today",...u,message:u.created?`Created today's daily note: ${u.path}`:`Opened today's daily note: ${u.path}`};break}case"yesterday":{let u=await $s(r,Dd(new Date,-1));c={success:!0,action:"yesterday",...u,message:u.created?`Created yesterday's daily note: ${u.path}`:`Opened yesterday's daily note: ${u.path}`};break}case"tomorrow":{let u=await $s(r,Dd(new Date,1));c={success:!0,action:"tomorrow",...u,message:u.created?`Created tomorrow's daily note: ${u.path}`:`Opened tomorrow's daily note: ${u.path}`};break}case"date":{if(!s)throw new Error('Date parameter required for "date" action (format: YYYY-MM-DD)');let u=Od(s);if(!u)throw new Error(`Invalid date format: ${s}. Use YYYY-MM-DD format.`);let f=await $s(r,u);c={success:!0,action:"date",...f,message:f.created?`Created daily note for ${s}: ${f.path}`:`Opened daily note for ${s}: ${f.path}`};break}case"list":{let u=await pw(r,Li,o);c={success:!0,action:"list",count:u.length,notes:u,message:u.length>0?`Found ${u.length} daily notes`:'No daily notes found. Use action "today" to create one.'};break}default:throw new Error(`Unknown action: ${n}. Use: today, yesterday, tomorrow, date, or list`)}return{content:[{type:"text",text:JSON.stringify(c,null,2)}]}}var Pt=require("fs/promises"),Wr=require("path"),Z={TODO:"todo",IN_PROGRESS:"in-progress",URGENT:"urgent",QUESTION:"question",COMPLETED:"completed",CANCELLED:"cancelled",DELEGATED:"delegated"},hw={" ":Z.TODO,x:Z.COMPLETED,X:Z.COMPLETED,"/":Z.IN_PROGRESS,"!":Z.URGENT,"?":Z.QUESTION,"-":Z.CANCELLED,">":Z.DELEGATED},Nd={[Z.TODO]:" ",[Z.COMPLETED]:"x",[Z.IN_PROGRESS]:"/",[Z.URGENT]:"!",[Z.QUESTION]:"?",[Z.CANCELLED]:"-",[Z.DELEGATED]:">"},mw=/^(\s*)-\s*\[([x X/!?\->]|\s)\]\s*(.+)$/;function Fd(t,e){let r=t.match(mw);if(!r)return null;let[,n,s,o]=r,c=hw[s]||Z.TODO,u=[],f=o.matchAll(/#(\w+)/g);for(let k of f)u.push(k[1]);let d=[],m=o.matchAll(/@(\w+)/g);for(let k of m)d.push(k[1]);let w="normal";return/\b(urgent|asap|critical)\b/i.test(o)?w="urgent":/\b(high priority|important)\b/i.test(o)?w="high":/\b(low priority)\b/i.test(o)&&(w="low"),{title:o.trim(),status:c,symbol:s,priority:w,tags:u,mentions:d,lineNumber:e+1,indent:n.length,originalLine:t}}async function jd(t,e){try{let n=(await(0,Pt.readFile)(t,"utf-8")).split(`
`),s=[];return n.forEach((o,c)=>{let u=Fd(o,c);u&&(u.notePath=(0,Wr.relative)(e,t),u.id=`${u.notePath}:${u.lineNumber}`,s.push(u))}),s}catch{return[]}}async function Mi(t,e=[]){try{let r=await(0,Pt.readdir)(t);for(let n of r){if(n.startsWith(".")||n==="node_modules")continue;let s=(0,Wr.join)(t,n);(await(0,Pt.stat)(s)).isDirectory()?await Mi(s,e):(0,Wr.extname)(n)===".md"&&e.push(s)}return e}catch{return e}}async function Md(t,e={}){let{status:r,tag:n,limit:s=100,includeCompleted:o=!1}=e,c=await Mi(t),u=[];for(let d of c){let m=await jd(d,t);u.push(...m)}r?u=u.filter(d=>d.status===r):o||(u=u.filter(d=>d.status!==Z.COMPLETED&&d.status!==Z.CANCELLED)),n&&(u=u.filter(d=>d.tags.includes(n)));let f={[Z.URGENT]:0,[Z.IN_PROGRESS]:1,[Z.QUESTION]:2,[Z.TODO]:3,[Z.DELEGATED]:4,[Z.COMPLETED]:5,[Z.CANCELLED]:6};return u.sort((d,m)=>{let w=(f[d.status]||99)-(f[m.status]||99);return w!==0?w:d.notePath.localeCompare(m.notePath)}),u.slice(0,s)}async function gw(t,e,r){let[n,s]=e.split(":"),o=parseInt(s);if(!n||isNaN(o))throw new Error(`Invalid task ID format: ${e}`);let c=(0,Wr.join)(t,n),f=(await(0,Pt.readFile)(c,"utf-8")).split(`
`),d=o-1;if(d<0||d>=f.length)throw new Error(`Line ${o} not found in file`);let m=f[d],w=Fd(m,d);if(!w)throw new Error(`Line ${o} is not a task`);let k=Nd[r];if(!k&&k!==" ")throw new Error(`Invalid status: ${r}. Valid: ${Object.keys(Nd).join(", ")}`);let R=m.replace(/\[([x X/!?\->]|\s)\]/,`[${k}]`);return f[d]=R,await(0,Pt.writeFile)(c,f.join(`
`),"utf-8"),{id:e,title:w.title,oldStatus:w.status,newStatus:r,notePath:n,lineNumber:o}}async function yw(t){let e=await Mi(t),r=[];for(let u of e){let f=await jd(u,t);r.push(...f)}let n={total:r.length,byStatus:{},byPriority:{},byTag:{},filesWithTasks:new Set};for(let u of r){n.byStatus[u.status]=(n.byStatus[u.status]||0)+1,n.byPriority[u.priority]=(n.byPriority[u.priority]||0)+1;for(let f of u.tags)n.byTag[f]=(n.byTag[f]||0)+1;n.filesWithTasks.add(u.notePath)}n.filesWithTasks=n.filesWithTasks.size;let s=n.byStatus[Z.COMPLETED]||0,o=n.byStatus[Z.CANCELLED]||0,c=n.total-s-o;return n.completionRate=n.total>0?Math.round(s/n.total*100):0,n.activeTasks=c,n}var Fi=[{name:"manage_tasks",description:"Manage tasks extracted from markdown notes. Tasks use checkbox syntax: - [ ] todo, - [x] done, - [/] in progress, - [!] urgent, - [?] question, - [-] cancelled, - [>] delegated",inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","search","update","stats"],description:"Action: list (all tasks), search (filter by query/tag/status), update (change status), stats (statistics)"},taskId:{type:"string",description:"Task ID for update action (format: path/to/note.md:lineNumber)"},status:{type:"string",enum:["todo","in-progress","urgent","question","completed","cancelled","delegated"],description:"Filter by status (list/search) or new status (update)"},tag:{type:"string",description:"Filter tasks by tag (without #)"},query:{type:"string",description:"Search query to filter task titles"},includeCompleted:{type:"boolean",description:"Include completed tasks in list (default: false)"},limit:{type:"number",description:"Maximum tasks to return (default: 100)"}},required:["action"]}}];async function Wd(t,e,r){if(t!=="manage_tasks")throw new Error(`Unknown tool: ${t}`);let{action:n,taskId:s,status:o,tag:c,query:u,includeCompleted:f=!1,limit:d=100}=e,m;switch(n){case"list":{let w=await Md(r,{status:o,tag:c,limit:d,includeCompleted:f});m={success:!0,action:"list",count:w.length,tasks:w,message:w.length>0?`Found ${w.length} tasks`:"No tasks found"};break}case"search":{let w=await Md(r,{status:o,tag:c,limit:500,includeCompleted:f});if(u){let k=u.toLowerCase();w=w.filter(R=>R.title.toLowerCase().includes(k)||R.notePath.toLowerCase().includes(k))}w=w.slice(0,d),m={success:!0,action:"search",query:u||null,status:o||null,tag:c||null,count:w.length,tasks:w,message:`Found ${w.length} matching tasks`};break}case"update":{if(!s)throw new Error("taskId required for update action");if(!o)throw new Error("status required for update action");let w=await gw(r,s,o);m={success:!0,action:"update",...w,message:`Task updated: ${w.oldStatus} -> ${w.newStatus}`};break}case"stats":{let w=await yw(r);m={success:!0,action:"stats",...w,message:`${w.total} tasks across ${w.filesWithTasks} files (${w.completionRate}% complete)`};break}default:throw new Error(`Unknown action: ${n}. Use: list, search, update, or stats`)}return{content:[{type:"text",text:JSON.stringify(m,null,2)}]}}var qr=require("fs/promises"),Ke=require("path");var It=require("fs/promises"),Qe=require("path"),bw=/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,Wi=class{constructor(e){this.workspacePath=e,this.indexPath=(0,Qe.join)(e,".lokus","mcp-graph-index.json"),this.graph=null,this.lastBuilt=null}async load(e=!1){if(!e&&!this.graph)try{let r=await this.loadFromCache();if(r&&this.isCacheFresh(r))return this.graph=r.graph,this.lastBuilt=r.lastBuilt,this.graph}catch{}return await this.build(),this.graph}isCacheFresh(e){return e.lastBuilt?Date.now()-new Date(e.lastBuilt).getTime()<300*1e3:!1}async loadFromCache(){let e=await(0,It.readFile)(this.indexPath,"utf-8");return JSON.parse(e)}async saveToCache(){let e={graph:this.graph,lastBuilt:this.lastBuilt,version:"1.0"};await(0,It.writeFile)(this.indexPath,JSON.stringify(e,null,2),"utf-8")}async build(){this.graph={nodes:{},edges:[],stats:{}};let e=await this.scanDirectory(this.workspacePath);for(let r of e){let n=(0,Qe.relative)(this.workspacePath,r),s=(0,Qe.basename)(r,".md"),o=this.normalizeNodeId(s);this.graph.nodes[o]={id:o,path:n,name:s,outgoingLinks:[],incomingLinks:[],metadata:{}}}for(let r of e)await this.processFile(r);this.graph.stats=this.calculateStats(),this.lastBuilt=new Date().toISOString();try{await this.saveToCache()}catch{}return this.graph}normalizeNodeId(e){return e.trim().toLowerCase().replace(/\.md$/,"")}async processFile(e){let r=await(0,It.readFile)(e,"utf-8"),n=(0,Qe.relative)(this.workspacePath,e),s=(0,Qe.basename)(e,".md"),o=this.normalizeNodeId(s),c=r.matchAll(bw);for(let u of c){let[,f,d]=u,m=this.normalizeNodeId(f);o!==m&&(this.graph.nodes[o]&&(this.graph.nodes[o].outgoingLinks.includes(m)||this.graph.nodes[o].outgoingLinks.push(m)),this.graph.nodes[m]&&(this.graph.nodes[m].incomingLinks.includes(o)||this.graph.nodes[m].incomingLinks.push(o)),this.graph.edges.push({from:o,to:m,label:d||f}))}this.graph.nodes[o]&&(this.graph.nodes[o].metadata={linkCount:this.graph.nodes[o].outgoingLinks.length,wordCount:r.split(/\s+/).length})}async scanDirectory(e,r=[]){try{let n=await(0,It.readdir)(e);for(let s of n){if(s.startsWith(".")||s==="node_modules")continue;let o=(0,Qe.join)(e,s);(await(0,It.stat)(o)).isDirectory()?await this.scanDirectory(o,r):(0,Qe.extname)(s)===".md"&&r.push(o)}return r}catch{return r}}calculateStats(){let e=Object.values(this.graph.nodes),r=this.graph.edges.length,n=e.filter(o=>o.outgoingLinks.length===0&&o.incomingLinks.length===0).length,s=e.map(o=>o.outgoingLinks.length+o.incomingLinks.length);return{nodeCount:e.length,edgeCount:r,orphanCount:n,averageConnections:e.length>0?(s.reduce((o,c)=>o+c,0)/e.length).toFixed(2):0,maxConnections:Math.max(...s,0)}}getRelatedNotes(e,r={}){let{depth:n=1,direction:s="both",limit:o=20}=r,c=this.normalizeNodeId(e);if(!this.graph?.nodes[c])return{found:!1,related:[]};let u=new Set([c]),f=[],d=(m,w)=>{if(w>n)return;let k=this.graph.nodes[m];if(!k)return;let R=[];(s==="outgoing"||s==="both")&&R.push(...k.outgoingLinks.map(x=>({id:x,type:"outgoing"}))),(s==="incoming"||s==="both")&&R.push(...k.incomingLinks.map(x=>({id:x,type:"incoming"})));for(let x of R)if(!u.has(x.id)){u.add(x.id);let N=this.graph.nodes[x.id];N&&(f.push({id:x.id,name:N.name,path:N.path,depth:w,direction:x.type,connections:N.outgoingLinks.length+N.incomingLinks.length}),d(x.id,w+1))}};return d(c,1),f.sort((m,w)=>m.depth!==w.depth?m.depth-w.depth:w.connections-m.connections),{found:!0,source:this.graph.nodes[c],related:f.slice(0,o)}}findPath(e,r){let n=this.normalizeNodeId(e),s=this.normalizeNodeId(r);if(!this.graph?.nodes[n]||!this.graph?.nodes[s])return{found:!1,path:[],message:"One or both notes not found"};if(n===s)return{found:!0,path:[this.graph.nodes[n]],distance:0};let o=[[n]],c=new Set([n]);for(;o.length>0;){let u=o.shift(),f=u[u.length-1],d=this.graph.nodes[f];if(!d)continue;let m=[...new Set([...d.outgoingLinks,...d.incomingLinks])];for(let w of m){if(w===s){let k=[...u,s].map(R=>this.graph.nodes[R]);return{found:!0,path:k,distance:k.length-1}}c.has(w)||(c.add(w),o.push([...u,w]))}}return{found:!1,path:[],message:"No path exists between these notes"}}getOrphans(){return this.graph?Object.values(this.graph.nodes).filter(e=>e.outgoingLinks.length===0&&e.incomingLinks.length===0).map(e=>({id:e.id,name:e.name,path:e.path})):[]}getHubs(e=10){return this.graph?Object.values(this.graph.nodes).map(r=>({id:r.id,name:r.name,path:r.path,outgoing:r.outgoingLinks.length,incoming:r.incomingLinks.length,total:r.outgoingLinks.length+r.incomingLinks.length})).filter(r=>r.total>0).sort((r,n)=>n.total-r.total).slice(0,e):[]}getClusters(){if(!this.graph)return[];let e=new Set,r=[],n=(s,o)=>{if(e.has(s))return;e.add(s);let c=this.graph.nodes[s];if(c){o.push({id:s,name:c.name,path:c.path});for(let u of[...c.outgoingLinks,...c.incomingLinks])n(u,o)}};for(let s of Object.keys(this.graph.nodes))if(!e.has(s)){let o=[];n(s,o),o.length>0&&r.push(o)}return r.sort((s,o)=>o.length-s.length),r.map((s,o)=>({id:o+1,size:s.length,nodes:s}))}searchByName(e,r=20){if(!this.graph)return[];let n=e.toLowerCase();return Object.values(this.graph.nodes).filter(s=>s.name.toLowerCase().includes(n)).map(s=>({id:s.id,name:s.name,path:s.path,connections:s.outgoingLinks.length+s.incomingLinks.length})).sort((s,o)=>{let c=s.name.toLowerCase()===n?0:1,u=o.name.toLowerCase()===n?0:1;return c!==u?c-u:o.connections-s.connections}).slice(0,r)}getOverview(){return this.graph?{stats:this.graph.stats,hubs:this.getHubs(5),orphanCount:this.graph.stats.orphanCount,clusterCount:this.getClusters().length,lastBuilt:this.lastBuilt}:null}},ji=new Map;function qi(t){return ji.has(t)||ji.set(t,new Wi(t)),ji.get(t)}async function ww(t,e,r){try{let n=await(0,qr.readFile)(t,"utf-8"),s=n.toLowerCase(),o=e.toLowerCase();if(!s.includes(o))return null;let c=n.split(`
`),u=[];c.forEach((m,w)=>{m.toLowerCase().includes(o)&&u.push({lineNumber:w+1,text:m.trim().substring(0,200)})});let f=(s.match(new RegExp(o,"gi"))||[]).length,d=(0,Ke.basename)(t,".md").toLowerCase().includes(o);return{path:(0,Ke.relative)(r,t),name:(0,Ke.basename)(t,".md"),matches:u,occurrences:f,titleMatch:d,score:f+(d?10:0)+(u.length>0?5:0)}}catch{return null}}async function qd(t,e=[]){try{let r=await(0,qr.readdir)(t);for(let n of r){if(n.startsWith(".")||n==="node_modules")continue;let s=(0,Ke.join)(t,n);(await(0,qr.stat)(s)).isDirectory()?await qd(s,e):(0,Ke.extname)(n)===".md"&&e.push(s)}return e}catch{return e}}async function _w(t,e,r={}){let{depth:n=1,limit:s=20,folder:o=null,includeRelated:c=!0}=r,u=qi(t);await u.load();let f=await qd(t);if(o){let k=(0,Ke.join)(t,o);f=f.filter(R=>R.startsWith(k))}let d=f.map(k=>ww(k,e,t)),m=(await Promise.all(d)).filter(k=>k!==null);m.sort((k,R)=>R.score-k.score);let w=[];for(let k of m.slice(0,s)){let R={...k};if(c){let x=u.getRelatedNotes(k.name,{depth:n,limit:5});x.found&&(R.relatedNotes=x.related.map(N=>({name:N.name,path:N.path,depth:N.depth,direction:N.direction})),R.connectionCount=x.source.outgoingLinks.length+x.source.incomingLinks.length)}w.push(R)}return{query:e,totalMatches:m.length,results:w,graphEnabled:c}}async function kw(t,e,r={}){let{depth:n=2,direction:s="both",includeContent:o=!1,limit:c=30}=r,u=qi(t);await u.load();let f=u.searchByName(e,5);if(f.length===0)return{found:!1,topic:e,message:`No note found matching "${e}". Try a different search term.`,suggestions:u.getHubs(5).map(P=>P.name)};let d=f[0],m=u.getRelatedNotes(d.name,{depth:n,direction:s,limit:c}),w=m.related.filter(P=>P.depth===1),k=m.related.filter(P=>P.depth===2),R=m.related.filter(P=>P.depth>=3),x=null;if(o)try{let P=(0,Ke.join)(t,d.path),U=await(0,qr.readFile)(P,"utf-8");x=U.substring(0,500).trim(),U.length>500&&(x+="...")}catch{}let N=u.getHubs(3).filter(P=>P.id!==d.id),W=[];for(let P of N.slice(0,2)){let U=u.findPath(d.name,P.name);U.found&&U.distance<=3&&W.push({to:P.name,distance:U.distance,path:U.path.map(re=>re.name)})}return{found:!0,topic:{name:d.name,path:d.path,connections:d.connections,content:x},exploration:{direction:s,depth:n,totalRelated:m.related.length},directlyLinked:w,secondDegree:k.slice(0,10),thirdDegree:R.slice(0,5),pathsToHubs:W,graphStats:u.getOverview().stats}}var Bi=[{name:"smart_search",description:"Search notes using content AND knowledge graph. Returns matching notes plus their connected notes via wiki links. Much smarter than just text search.",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query (searches note content and titles)"},depth:{type:"number",description:"How many wiki link hops to follow for related notes (1-3, default: 1)"},folder:{type:"string",description:'Filter to specific folder (e.g., "Projects" or "Daily Notes")'},limit:{type:"number",description:"Maximum results to return (default: 20)"},includeRelated:{type:"boolean",description:"Include graph-related notes in results (default: true)"}},required:["query"]}},{name:"explore_topic",description:"Explore a topic through the knowledge graph. Finds a note and all its connections via wiki links. Great for understanding how ideas connect.",inputSchema:{type:"object",properties:{topic:{type:"string",description:"Topic or note name to explore"},depth:{type:"number",description:"How deep to traverse links (1-3, default: 2)"},direction:{type:"string",enum:["outgoing","incoming","both"],description:"Link direction: outgoing (notes this links to), incoming (notes linking here), both"},includeContent:{type:"boolean",description:"Include content snippet of the topic note (default: false)"},limit:{type:"number",description:"Max related notes to return (default: 30)"}},required:["topic"]}}];async function Bd(t,e,r){let n;switch(t){case"smart_search":{let{query:s,depth:o=1,folder:c,limit:u=20,includeRelated:f=!0}=e;if(!s)throw new Error("Query is required for smart_search");let d=await _w(r,s,{depth:Math.min(o,3),folder:c,limit:u,includeRelated:f});n={success:!0,...d,message:d.totalMatches>0?`Found ${d.totalMatches} notes matching "${s}"${d.graphEnabled?" (with graph connections)":""}`:`No notes found matching "${s}"`};break}case"explore_topic":{let{topic:s,depth:o=2,direction:c="both",includeContent:u=!1,limit:f=30}=e;if(!s)throw new Error("Topic is required for explore_topic");let d=await kw(r,s,{depth:Math.min(o,3),direction:c,includeContent:u,limit:f});d.found?n={success:!0,...d,message:`Explored "${d.topic.name}" with ${d.exploration.totalRelated} connected notes`}:n={success:!1,...d};break}default:throw new Error(`Unknown tool: ${t}`)}return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}var Ui=[{uri:"lokus://markdown-syntax/overview",name:"Lokus Markdown Syntax Overview",description:"Complete guide to all supported markdown syntax in Lokus",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/callouts",name:"Callout Syntax",description:"How to create callouts/admonitions in Lokus",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/images",name:"Image Embedding Syntax",description:"How to embed images in Lokus notes",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/wiki-links",name:"Wiki Link Syntax",description:"How to create wiki-style links and embeds",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/math",name:"Math Equations (LaTeX/KaTeX)",description:"How to write inline and block math equations using LaTeX syntax",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/tables",name:"Tables",description:"How to create and format markdown tables",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/code",name:"Code Blocks",description:"How to add inline code and code blocks with syntax highlighting",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/lists",name:"Lists and Tasks",description:"How to create ordered lists, unordered lists, and task lists",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/formatting",name:"Text Formatting",description:"Bold, italic, strikethrough, highlights, superscript, subscript",mimeType:"text/markdown"},{uri:"lokus://markdown-syntax/diagrams",name:"Mermaid Diagrams",description:"How to create flowcharts, sequence diagrams, and more with Mermaid",mimeType:"text/markdown"}];async function Ud(t){switch(t){case"lokus://markdown-syntax/overview":return Sw();case"lokus://markdown-syntax/callouts":return xw();case"lokus://markdown-syntax/images":return vw();case"lokus://markdown-syntax/wiki-links":return Tw();case"lokus://markdown-syntax/math":return Cw();case"lokus://markdown-syntax/tables":return Rw();case"lokus://markdown-syntax/code":return Ew();case"lokus://markdown-syntax/lists":return Aw();case"lokus://markdown-syntax/formatting":return $w();case"lokus://markdown-syntax/diagrams":return Pw();default:throw new Error(`Unknown markdown syntax resource: ${t}`)}}function Sw(){return{contents:[{uri:"lokus://markdown-syntax/overview",mimeType:"text/markdown",text:`# Lokus Markdown Syntax Guide

Lokus supports extended markdown with special features for note-taking and knowledge management.

## Basic Markdown

All standard markdown is supported:
- **Bold** with \`**text**\` or \`__text__\`
- *Italic* with \`*text*\` or \`_text_\`
- \`inline code\` with backticks
- Links: \`[text](url)\`
- Images: \`![alt](url)\`
- Headings: \`# H1\`, \`## H2\`, etc.
- Lists (ordered and unordered)
- Tables
- Blockquotes: \`> quote\`
- Code blocks with \`\`\`language\`\`\`

## Extended Features

### 1. Callouts/Admonitions
Create colored, collapsible callouts:
\`\`\`
>[!note] Optional Title
Content goes here

>[!warning] Be Careful
Important warning message

>[!tip]- Collapsed by default
This callout starts collapsed (note the dash)
\`\`\`

**Available types:** note, tip, warning, danger, info, success, question, example

### 2. Wiki Links
Link to other notes:
\`\`\`
[[Note Name]]
[[Note Name|Display Text]]
[[Note Name#Heading]]
[[Note Name^blockid]]
\`\`\`

### 3. Image Embeds
Embed images using wiki-style syntax:
\`\`\`
![[image.png]]
![[folder/image.jpg]]
![[image.png|Custom Alt Text]]
\`\`\`

Also supports standard markdown:
\`\`\`
![alt text](path/to/image.png)
![alt text](https://example.com/image.jpg)
\`\`\`

### 4. Block Embeds
Embed content from other notes:
\`\`\`
![[Note Name^blockid]]
\`\`\`

### 5. Math Equations
Inline: \`$E = mc^2$\`
Block:
\`\`\`
$$
\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}
$$
\`\`\`

### 6. Task Lists
\`\`\`
- [ ] Incomplete task
- [x] Completed task
\`\`\`

### 7. Highlights
\`==highlighted text==\`

### 8. Strikethrough
\`~~strikethrough text~~\`

### 9. Superscript & Subscript
- Superscript: \`H^2^O\` renders as H\xB2O
- Subscript: \`H~2~O\` renders as H\u2082O

### 10. Mermaid Diagrams
\`\`\`mermaid
graph TD
    A[Start] --> B[Process]
    B --> C[End]
\`\`\`

## Best Practices

1. **Always use proper syntax** - Don't mix formats
2. **For images**, prefer wiki-style \`![[image.png]]\` for local files
3. **For callouts**, always include the type: \`>[!type]\`
4. **For wiki links**, use \`[[Note Name]]\` not \`[Note Name]\`
5. **For math**, use \`$inline$\` or \`$$block$$\` delimiters

## Common Mistakes

\u274C **Wrong:**
- \`> [!note]\` (space after >)
- \`[[!image.png]]\` (using [[ for images without !)
- \`[!note]\` (missing >)
- Standard link syntax for local files: \`[text](file.md)\`

\u2705 **Correct:**
- \`>[!note]\` (no space)
- \`![[image.png]]\` (! before [[)
- \`>[!note]\` (> before [)
- Wiki link syntax: \`[[Note Name]]\`
`}]}}function xw(){return{contents:[{uri:"lokus://markdown-syntax/callouts",mimeType:"text/markdown",text:`# Callout/Admonition Syntax

## Basic Syntax

\`\`\`
>[!type] Optional Title
Content goes here on the next lines.
Can be multiple paragraphs.
\`\`\`

**IMPORTANT:** No space between \`>\` and \`[!\`

## Available Types

- \`>[!note]\` - Blue, informational (default)
- \`>[!tip]\` - Green, helpful tips
- \`>[!warning]\` - Orange, caution/warnings
- \`>[!danger]\` - Red, critical warnings
- \`>[!info]\` - Cyan, general information
- \`>[!success]\` - Green, success messages
- \`>[!question]\` - Purple, questions/help
- \`>[!example]\` - Gray, examples

## Collapsible Callouts

Add a dash \`-\` after the type to make it collapsible and start collapsed:

\`\`\`
>[!tip]- Click to expand
This content starts hidden
\`\`\`

Without dash, callouts are expanded by default:

\`\`\`
>[!tip] Always visible
This is always shown
\`\`\`

## Custom Titles

\`\`\`
>[!warning] Custom Warning Title
Your content here
\`\`\`

If no title is provided, the type name is used:

\`\`\`
>[!warning]
This will show "Warning" as the title
\`\`\`

## Nested Content

Callouts can contain any markdown:

\`\`\`
>[!note] Advanced Example
This callout contains:

- Bullet points
- **Bold text**
- \`code\`

\`\`\`code
Code blocks
\`\`\`

And even [[Wiki Links]]
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`> [!note]\` - Space after >
- \`[!note]\` - Missing >
- \`> [! note]\` - Spaces in tag
- \`>[note]\` - Missing !

\u2705 **Correct:**
- \`>[!note]\` - Proper syntax
`}]}}function vw(){return{contents:[{uri:"lokus://markdown-syntax/images",mimeType:"text/markdown",text:`# Image Embedding Syntax

## Wiki-Style Images (Recommended for Local Files)

\`\`\`
![[image.png]]
![[folder/subfolder/image.jpg]]
![[image.png|Custom Alt Text]]
\`\`\`

**Supported formats:** PNG, JPG, JPEG, GIF, SVG, WebP

## Standard Markdown Images

\`\`\`
![alt text](image.png)
![alt text](folder/image.jpg)
![alt text](https://example.com/image.jpg)
\`\`\`

## Syntax Comparison

| Style | Syntax | Use Case |
|-------|--------|----------|
| Wiki | \`![[image.png]]\` | Local workspace images |
| Wiki with alt | \`![[image.png\\|Alt Text]]\` | Local with custom alt |
| Markdown | \`![alt](image.png)\` | Standard markdown |
| Markdown URL | \`![alt](https://...)\` | External images |

## Path Resolution

Images are resolved relative to:
1. Current note's directory
2. Workspace root
3. Attachments folder (if configured)

## Best Practices

\u2705 **Do:**
- Use \`![[image.png]]\` for local workspace images
- Place images in descriptive folders: \`assets/\`, \`images/\`, etc.
- Use descriptive filenames: \`diagram-architecture.png\`
- Provide alt text for accessibility

\u274C **Don't:**
- Use \`[[!image.png]]\` - Wrong! The \`!\` goes BEFORE \`[[\`
- Use absolute system paths: \`/Users/name/image.png\`
- Use spaces in filenames (use hyphens: \`my-image.png\`)

## Examples

**Basic image:**
\`\`\`
![[screenshot.png]]
\`\`\`

**Image in folder:**
\`\`\`
![[diagrams/architecture.png]]
\`\`\`

**With alt text:**
\`\`\`
![[diagram.png|System Architecture Diagram]]
\`\`\`

**External image:**
\`\`\`
![Logo](https://example.com/logo.png)
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`[[!image.png]]\` - ! is in wrong position
- \`[!image.png]\` - Missing one bracket
- \`![[image]]\` - Missing file extension
- \`![[image .png]]\` - Space in filename

\u2705 **Correct:**
- \`![[image.png]]\` - Proper wiki-style
- \`![alt](image.png)\` - Standard markdown
`}]}}function Tw(){return{contents:[{uri:"lokus://markdown-syntax/wiki-links",mimeType:"text/markdown",text:`# Wiki Link Syntax

Wiki-style links connect notes and enable bidirectional linking in your knowledge base.

## Basic Links

Link to another note:

\`\`\`
[[Note Name]]
[[Note Name|Custom Display Text]]
\`\`\`

Examples:
\`\`\`
[[Project Ideas]]
[[Meeting Notes 2024-01-15]]
[[JavaScript Guide|JS Guide]]
\`\`\`

## Heading Links

Link to specific sections within notes using \`#\`:

\`\`\`
[[Note Name#Heading]]
[[Note Name#Heading|Custom Text]]
\`\`\`

Examples:
\`\`\`
[[Documentation#Installation]]
[[API Reference#Authentication|Auth docs]]
[[Project Plan#Phase 2]]
\`\`\`

**How it works:**
- \`#\` links to a heading (# Heading, ## Heading, etc.)
- Case-insensitive heading matching
- Spaces in heading names work automatically

## Block References (Block IDs)

Link to specific blocks/paragraphs within notes using \`^\`:

\`\`\`
[[Note Name^blockid]]
[[Note Name^blockid|Custom Text]]
\`\`\`

### What are Block IDs?

Block IDs let you reference specific paragraphs, list items, or blocks of content. Each block can have a unique identifier.

### Creating Block IDs

Add \`^blockid\` at the END of any block:

\`\`\`
This is a paragraph with a block ID. ^intro-para

- This is a list item ^list-item-1
- Another list item ^list-item-2

> This is a quote block ^important-quote
\`\`\`

**Block ID Rules:**
- Use lowercase letters, numbers, hyphens, underscores
- No spaces allowed
- Must be unique within the note
- Format: \`^block-id-name\`

### Linking to Blocks

Reference the block from another note:

\`\`\`
See the introduction: [[Project Notes^intro-para]]
Check out [[Meeting Notes^action-items]]
Reference [[Research^key-finding-1|this finding]]
\`\`\`

### Examples

**In source note (Research.md):**
\`\`\`
# Research Findings

Our study found significant results. ^key-finding

## Methodology
We used a double-blind approach. ^methodology

- Sample size: 1000 participants ^sample-size
- Duration: 6 months ^duration
\`\`\`

**In another note:**
\`\`\`
According to [[Research^key-finding]], the results were significant.
The [[Research^methodology|study methodology]] was rigorous.
With [[Research^sample-size|1000 participants]], the data is reliable.
\`\`\`

## Block Embeds

Embed actual content from blocks using \`!\`:

\`\`\`
![[Note Name^blockid]]
\`\`\`

**Difference:**
- \`[[Note^block]]\` - Creates a LINK to the block
- \`![[Note^block]]\` - EMBEDS the block content inline

### Embed Examples

**Source note (Quotes.md):**
\`\`\`
> "The only way to do great work is to love what you do." - Steve Jobs ^jobs-quote

The key to success is persistence. ^success-key
\`\`\`

**In another note:**
\`\`\`
# Daily Inspiration

![[Quotes^jobs-quote]]

Remember: ![[Quotes^success-key]]
\`\`\`

Result: The actual content will be displayed inline, not just a link.

## Image Embeds

Embed images from your workspace:

\`\`\`
![[image.png]]
![[folder/subfolder/diagram.jpg]]
![[screenshot.png|Custom Alt Text]]
\`\`\`

**Supported formats:** PNG, JPG, JPEG, GIF, SVG, WebP

Examples:
\`\`\`
![[architecture-diagram.png]]
![[Screenshots/bug-report.png]]
![[logo.svg|Company Logo]]
\`\`\`

## Syntax Summary

| Syntax | Purpose | Example |
|--------|---------|---------|
| \`[[Note]]\` | Link to note | \`[[Meeting Notes]]\` |
| \`[[Note\\|Text]]\` | Link with custom text | \`[[API Docs\\|Documentation]]\` |
| \`[[Note#Heading]]\` | Link to section | \`[[Guide#Installation]]\` |
| \`[[Note^block]]\` | Link to block | \`[[Research^finding-1]]\` |
| \`![[Note^block]]\` | Embed block content | \`![[Quotes^quote-1]]\` |
| \`![[image.png]]\` | Embed image | \`![[diagram.png]]\` |

## Path Resolution

Lokus resolves links intelligently:

1. **By filename** - \`[[Note]]\` finds \`Note.md\`
2. **By path** - \`[[folder/Note]]\` finds specific location
3. **Same folder** - Prefers notes in current folder
4. **Workspace root** - Falls back to workspace search
5. **Case-insensitive** - \`[[note]]\` matches \`Note.md\`

## Best Practices

\u2705 **Do:**
- Use \`[[Note Name]]\` for internal note links
- Use \`|alt text\` for descriptive link text
- Use \`#heading\` to link to specific sections
- Use \`^blockid\` for paragraph-level references
- Use \`![[Note^block]]\` to embed reusable content
- Keep block IDs descriptive: \`^key-finding\` not \`^1\`

\u274C **Don't:**
- Use \`[Note Name]\` - Need TWO brackets
- Use \`[[Note.md]]\` - Omit file extension
- Use spaces in block IDs: \`^my block\` (wrong)
- Use special characters in block IDs: \`^block!@#\` (wrong)
- Mix wiki and markdown link syntax

## Common Use Cases

**Research notes:**
\`\`\`
Key findings: [[Study 2024^results]]
See methodology: [[Study 2024#Methods]]
Full report: [[Study 2024]]
\`\`\`

**Meeting notes:**
\`\`\`
Action items from last meeting: ![[Meeting 2024-01-15^action-items]]
Decision made: [[Meeting 2024-01-15^decision-architecture]]
\`\`\`

**Documentation:**
\`\`\`
Setup guide: [[Installation#Prerequisites]]
API endpoint: [[API Reference#Authentication]]
Example: ![[Examples^basic-usage]]
\`\`\`

**Knowledge base:**
\`\`\`
Related concept: [[Machine Learning]]
See definition: [[Glossary^neural-network]]
Visual diagram: ![[diagrams/architecture.png]]
\`\`\`

## Heading vs Block Reference

**When to use \`#heading\`:**
- Link to entire sections
- Section has a heading
- Content under heading may change
- Example: \`[[Guide#Installation]]\`

**When to use \`^blockid\`:**
- Link to specific paragraph/quote
- Need stable reference to exact content
- Want to embed specific block
- Example: \`[[Research^key-finding]]\`
`}]}}function Cw(){return{contents:[{uri:"lokus://markdown-syntax/math",mimeType:"text/markdown",text:`# Math Equations (LaTeX/KaTeX)

Lokus supports LaTeX math equations using KaTeX renderer.

## Inline Math

Use single dollar signs \`$\` for inline equations:

\`\`\`
The equation $E = mc^2$ represents energy-mass equivalence.
The quadratic formula is $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$.
\`\`\`

**IMPORTANT:** No spaces after opening \`$\` or before closing \`$\`

## Block Math

Use double dollar signs \`$$\` for block equations:

\`\`\`
$$
E = mc^2
$$

$$
\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}
$$

$$
\\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}
$$
\`\`\`

## Common Syntax

### Fractions
\`\`\`
$\\frac{a}{b}$ - Simple fraction
$\\frac{\\partial f}{\\partial x}$ - Partial derivative
\`\`\`

### Superscripts & Subscripts
\`\`\`
$x^2$ - Superscript
$x_i$ - Subscript
$x^{2y}$ - Multiple characters (use braces)
$x_{i,j}$ - Multiple subscript characters
\`\`\`

### Square Roots
\`\`\`
$\\sqrt{x}$ - Square root
$\\sqrt[3]{x}$ - Cube root
$\\sqrt{x^2 + y^2}$ - Complex expression
\`\`\`

### Sums & Products
\`\`\`
$\\sum_{i=1}^{n} x_i$ - Summation
$\\prod_{i=1}^{n} x_i$ - Product
$\\int_{a}^{b} f(x) dx$ - Integral
\`\`\`

### Greek Letters
\`\`\`
$\\alpha, \\beta, \\gamma, \\delta$ - Lowercase
$\\Alpha, \\Beta, \\Gamma, \\Delta$ - Uppercase
$\\pi, \\theta, \\lambda, \\omega$ - Common symbols
\`\`\`

### Matrices
\`\`\`
$$
\\begin{bmatrix}
a & b \\\\
c & d
\\end{bmatrix}
$$

$$
\\begin{pmatrix}
1 & 2 & 3 \\\\
4 & 5 & 6
\\end{pmatrix}
$$
\`\`\`

### Special Symbols
\`\`\`
$\\infty$ - Infinity
$\\pm$ - Plus-minus
$\\times$ - Multiplication
$\\div$ - Division
$\\neq$ - Not equal
$\\leq, \\geq$ - Less/greater than or equal
$\\approx$ - Approximately
$\\in$ - Element of
$\\subset$ - Subset
$\\cup, \\cap$ - Union, intersection
\`\`\`

### Calculus
\`\`\`
$\\frac{d}{dx}$ - Derivative
$\\frac{\\partial}{\\partial x}$ - Partial derivative
$\\int$ - Integral
$\\oint$ - Contour integral
$\\lim_{x \\to \\infty}$ - Limit
\`\`\`

### Logic & Sets
\`\`\`
$\\forall$ - For all
$\\exists$ - There exists
$\\in$ - Element of
$\\emptyset$ - Empty set
$\\mathbb{R}$ - Real numbers
$\\mathbb{N}$ - Natural numbers
$\\mathbb{Z}$ - Integers
\`\`\`

## Common Equations Examples

**Physics:**
\`\`\`
$E = mc^2$
$F = ma$
$v = v_0 + at$
$s = ut + \\frac{1}{2}at^2$
\`\`\`

**Chemistry:**
\`\`\`
$H_2O$
$CO_2$
$C_6H_{12}O_6$
\`\`\`

**Statistics:**
\`\`\`
$\\mu = \\frac{1}{n}\\sum_{i=1}^{n} x_i$ - Mean
$\\sigma = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}(x_i - \\mu)^2}$ - Standard deviation
\`\`\`

**Calculus:**
\`\`\`
$$
\\frac{d}{dx}(x^n) = nx^{n-1}
$$

$$
\\int x^n dx = \\frac{x^{n+1}}{n+1} + C
$$
\`\`\`

## Common Mistakes

\u274C **Wrong:**
- \`$ E=mc^2$\` - Space before closing $
- \`$E=mc^2 $\` - Space before closing $
- \`$E = mc^2\` - Missing closing $
- \`E = mc^2$\` - Missing opening $
- \`$$E = mc^2\` - Missing closing $$

\u2705 **Correct:**
- \`$E = mc^2$\` - Proper inline
- \`$$E = mc^2$$\` - Proper block (can be on separate lines)

## Block Math Formatting

Block math can be written on multiple lines:

\`\`\`
$$
\\begin{aligned}
E &= mc^2 \\\\
p &= mv \\\\
F &= ma
\\end{aligned}
$$
\`\`\`

## Best Practices

\u2705 **Do:**
- Use \`$\` for inline math (within text)
- Use \`$$\` for block math (standalone equations)
- Use \`{}\` braces to group multiple characters
- Use \`\\\\\\\\\` for line breaks in aligned equations
- Escape special characters with backslash

\u274C **Don't:**
- Add spaces after \`$\` or before \`$\`
- Forget closing delimiters
- Use \`\` for math (that's for code)
- Mix inline and block delimiters
`}]}}function Rw(){return{contents:[{uri:"lokus://markdown-syntax/tables",mimeType:"text/markdown",text:`# Markdown Tables

## Basic Table

\`\`\`
| Header 1 | Header 2 | Header 3 |
| -------- | -------- | -------- |
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |
\`\`\`

Renders as:

| Header 1 | Header 2 | Header 3 |
| -------- | -------- | -------- |
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |

## Alignment

Use colons to align columns:

\`\`\`
| Left Aligned | Center Aligned | Right Aligned |
| :----------- | :------------: | ------------: |
| Left         | Center         | Right         |
| Text         | Text           | Text          |
\`\`\`

- \`:---\` Left aligned
- \`:---:\` Center aligned
- \`---:\` Right aligned

## Formatting in Cells

Tables support inline formatting:

\`\`\`
| **Bold** | *Italic* | \`Code\` |
| -------- | -------- | -------- |
| **Text** | *Text*   | \`text\` |
\`\`\`

## Tips

\u2705 **Do:**
- Keep separator row (| --- | --- |)
- Align pipes for readability (optional)
- Use at least 3 hyphens in separator

\u274C **Don't:**
- Forget separator row
- Put spaces inside cells at edges (optional)
- Use newlines inside cells

## Examples

**Simple 2-column table:**
\`\`\`
| Name | Age |
| ---- | --- |
| John | 25  |
| Jane | 30  |
\`\`\`

**With alignment:**
\`\`\`
| Item     | Price   | Quantity |
| :------- | ------: | :------: |
| Apple    | $1.50   | 10       |
| Banana   | $0.75   | 20       |
\`\`\`
`}]}}function Ew(){return{contents:[{uri:"lokus://markdown-syntax/code",mimeType:"text/markdown",text:'# Code Syntax\n\n## Inline Code\n\nUse single backticks for inline code:\n\n```\nUse the `console.log()` function to print.\nThe `Array.map()` method is useful.\n```\n\nResult: Use the `console.log()` function to print.\n\n## Code Blocks\n\nUse triple backticks for code blocks:\n\n\\`\\`\\`\nfunction hello() {\n}\n\\`\\`\\`\n\n## Syntax Highlighting\n\nAdd language identifier after opening backticks:\n\n\\`\\`\\`javascript\nfunction greet(name) {\n  return `Hello, ${name}!`;\n}\n\\`\\`\\`\n\n\\`\\`\\`python\ndef greet(name):\n    return f"Hello, {name}!"\n\\`\\`\\`\n\n\\`\\`\\`rust\nfn greet(name: &str) -> String {\n    format!("Hello, {}!", name)\n}\n\\`\\`\\`\n\n## Supported Languages\n\nCommon languages with syntax highlighting:\n- **JavaScript/TypeScript**: `javascript`, `typescript`, `js`, `ts`\n- **Python**: `python`, `py`\n- **Rust**: `rust`, `rs`\n- **Java**: `java`\n- **C/C++**: `c`, `cpp`, `c++`\n- **Go**: `go`\n- **Ruby**: `ruby`, `rb`\n- **PHP**: `php`\n- **Shell**: `bash`, `sh`, `shell`\n- **HTML**: `html`\n- **CSS**: `css`, `scss`, `sass`\n- **SQL**: `sql`\n- **JSON**: `json`\n- **YAML**: `yaml`, `yml`\n- **Markdown**: `markdown`, `md`\n\n## Examples\n\n**JavaScript:**\n\\`\\`\\`javascript\nconst users = [\'Alice\', \'Bob\', \'Charlie\'];\nusers.map(name => `Hello, ${name}!`);\n\\`\\`\\`\n\n**Python:**\n\\`\\`\\`python\nusers = [\'Alice\', \'Bob\', \'Charlie\']\ngreetings = [f"Hello, {name}!" for name in users]\n\\`\\`\\`\n\n**JSON:**\n\\`\\`\\`json\n{\n  "name": "John Doe",\n  "age": 30,\n  "email": "john@example.com"\n}\n\\`\\`\\`\n\n## Tips\n\n\u2705 **Do:**\n- Use specific language identifier for syntax highlighting\n- Keep code properly indented\n- Close code blocks with triple backticks\n\n\u274C **Don\'t:**\n- Forget closing backticks\n- Use 4-space indentation (use triple backticks instead)\n- Nest backticks incorrectly\n'}]}}function Aw(){return{contents:[{uri:"lokus://markdown-syntax/lists",mimeType:"text/markdown",text:`# Lists and Tasks

## Unordered Lists

Use \`-\`, \`*\`, or \`+\` for bullet points:

\`\`\`
- Item 1
- Item 2
- Item 3
\`\`\`

Result:
- Item 1
- Item 2
- Item 3

## Ordered Lists

Use numbers followed by period:

\`\`\`
1. First item
2. Second item
3. Third item
\`\`\`

Result:
1. First item
2. Second item
3. Third item

## Nested Lists

Indent with 2-4 spaces:

\`\`\`
- Main item 1
  - Sub item 1.1
  - Sub item 1.2
    - Sub sub item 1.2.1
- Main item 2
  - Sub item 2.1
\`\`\`

Result:
- Main item 1
  - Sub item 1.1
  - Sub item 1.2
    - Sub sub item 1.2.1
- Main item 2
  - Sub item 2.1

## Task Lists (Checkboxes)

Use \`- [ ]\` for unchecked, \`- [x]\` for checked:

\`\`\`
- [ ] Incomplete task
- [x] Completed task
- [ ] Another incomplete task
- [x] Another completed task
\`\`\`

Result:
- [ ] Incomplete task
- [x] Completed task
- [ ] Another incomplete task
- [x] Another completed task

**IMPORTANT:** Space required after \`-\` and inside brackets!

## Mixed Lists

Combine ordered and unordered:

\`\`\`
1. First step
   - Sub-point A
   - Sub-point B
2. Second step
   - Sub-point A
   - Sub-point B
\`\`\`

## Task Lists with Nesting

\`\`\`
- [x] Project setup
  - [x] Initialize repository
  - [x] Install dependencies
- [ ] Development
  - [x] Create components
  - [ ] Write tests
  - [ ] Documentation
\`\`\`

## Tips

\u2705 **Do:**
- Use consistent markers (\`-\` or \`*\` or \`+\`)
- Add space after marker
- Indent nested items consistently
- For tasks: \`[ ]\` or \`[x]\` only

\u274C **Don't:**
- Mix markers in same list
- Forget space: \`-item\` (wrong), \`- item\` (correct)
- Use \`[X]\` (capital X) - use lowercase \`[x]\`
- Use other characters in brackets

## Examples

**Shopping list:**
\`\`\`
- [ ] Groceries
  - [x] Milk
  - [x] Bread
  - [ ] Eggs
- [ ] Hardware store
  - [ ] Screws
  - [ ] Paint
\`\`\`

**Project tasks:**
\`\`\`
1. [x] Planning phase
2. [x] Design phase
3. [ ] Development phase
   - [x] Backend API
   - [ ] Frontend UI
   - [ ] Testing
4. [ ] Deployment
\`\`\`
`}]}}function $w(){return{contents:[{uri:"lokus://markdown-syntax/formatting",mimeType:"text/markdown",text:`# Text Formatting

## Bold

Use double asterisks or double underscores:

\`\`\`
**This is bold text**
__This is also bold__
\`\`\`

Result: **This is bold text**

## Italic

Use single asterisk or single underscore:

\`\`\`
*This is italic text*
_This is also italic_
\`\`\`

Result: *This is italic text*

## Bold + Italic

Combine both:

\`\`\`
***Bold and italic***
___Bold and italic___
**_Bold and italic_**
*__Bold and italic__*
\`\`\`

Result: ***Bold and italic***

## Strikethrough

Use double tildes:

\`\`\`
~~This text is crossed out~~
\`\`\`

Result: ~~This text is crossed out~~

## Highlight

Use double equals signs:

\`\`\`
==This text is highlighted==
\`\`\`

Result: ==This text is highlighted==

## Superscript

Use \`^\` with content between them:

\`\`\`
H^2^O
E = mc^2^
x^2^
\`\`\`

Result: H\xB2O, E = mc\xB2, x\xB2

## Subscript

Use \`~\` with content between them:

\`\`\`
H~2~O
CO~2~
x~i~
\`\`\`

Result: H\u2082O, CO\u2082, x\u1D62

## Combining Formats

You can combine multiple formats:

\`\`\`
**Bold with _italic inside_**
*Italic with **bold inside***
~~Strikethrough with **bold**~~
==Highlight with *italic*==
\`\`\`

## Blockquotes

Use \`>\` for quotes:

\`\`\`
> This is a quote
> It can span multiple lines
\`\`\`

Result:
> This is a quote
> It can span multiple lines

**Nested quotes:**
\`\`\`
> Level 1 quote
>> Level 2 quote
>>> Level 3 quote
\`\`\`

## Horizontal Rules

Use three or more hyphens, asterisks, or underscores:

\`\`\`
---
***
___
\`\`\`

Result:

---

## Line Breaks

Two spaces at end of line or backslash:

\`\`\`
Line 1  
Line 2

OR

Line 1\\
Line 2
\`\`\`

## Escape Characters

Use backslash to escape special characters:

\`\`\`
\\* Not a bullet point
\\** Not bold **
\\# Not a heading
\`\`\`

## Common Combinations

**Chemistry formulas:**
\`\`\`
H~2~O (water)
CO~2~ (carbon dioxide)
C~6~H~12~O~6~ (glucose)
\`\`\`

**Math expressions:**
\`\`\`
x^2^ + y^2^ = z^2^
a~n~ = a~1~ + (n-1)d
\`\`\`

**Emphasized text:**
\`\`\`
**Important:** This is ==critical== information!
*Note:* ~~Old info~~ Updated: **New info**
\`\`\`

## Tips

\u2705 **Do:**
- Use \`**bold**\` for strong emphasis
- Use \`*italic*\` for subtle emphasis
- Use \`==highlight==\` for important points
- Use \`~~strikethrough~~\` for deleted/outdated info

\u274C **Don't:**
- Use spaces: \`** bold **\` (wrong)
- Mix markers: \`*bold**\` (wrong)
- Forget closing markers
- Use \`<u>\` for underline (not supported)
`}]}}function Pw(){return{contents:[{uri:"lokus://markdown-syntax/diagrams",mimeType:"text/markdown",text:`# Mermaid Diagrams

Lokus supports Mermaid for creating diagrams using text.

## Flowcharts

\\\`\\\`\\\`mermaid
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Action 1]
    B -->|No| D[Action 2]
    C --> E[End]
    D --> E
\\\`\\\`\\\`

**Direction options:**
- \`graph TD\` - Top to Down
- \`graph LR\` - Left to Right
- \`graph BT\` - Bottom to Top
- \`graph RL\` - Right to Left

## Sequence Diagrams

\\\`\\\`\\\`mermaid
sequenceDiagram
    participant User
    participant App
    participant Server
    
    User->>App: Click button
    App->>Server: Send request
    Server-->>App: Return data
    App-->>User: Display result
\\\`\\\`\\\`

## Class Diagrams

\\\`\\\`\\\`mermaid
classDiagram
    class Animal {
        +String name
        +int age
        +makeSound()
    }
    class Dog {
        +bark()
    }
    class Cat {
        +meow()
    }
    Animal <|-- Dog
    Animal <|-- Cat
\\\`\\\`\\\`

## State Diagrams

\\\`\\\`\\\`mermaid
stateDiagram-v2
    [*] --> Idle
    Idle --> Processing
    Processing --> Success
    Processing --> Error
    Success --> [*]
    Error --> Idle
\\\`\\\`\\\`

## Gantt Charts

\\\`\\\`\\\`mermaid
gantt
    title Project Timeline
    dateFormat  YYYY-MM-DD
    section Planning
    Task 1           :2024-01-01, 30d
    Task 2           :2024-02-01, 20d
    section Development
    Task 3           :2024-02-15, 45d
    Task 4           :2024-03-01, 30d
\\\`\\\`\\\`

## Pie Charts

\\\`\\\`\\\`mermaid
pie
    title Distribution
    "Category A" : 45
    "Category B" : 30
    "Category C" : 25
\\\`\\\`\\\`

## Entity Relationship Diagrams

\\\`\\\`\\\`mermaid
erDiagram
    USER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_ITEM : contains
    PRODUCT ||--o{ ORDER_ITEM : "ordered in"
    
    USER {
        int id
        string name
        string email
    }
    ORDER {
        int id
        date order_date
    }
\\\`\\\`\\\`

## Node Shapes

Different shapes for flowchart nodes:

\\\`\\\`\\\`mermaid
graph LR
    A[Rectangle]
    B(Rounded)
    C([Stadium])
    D[[Subroutine]]
    E[(Database)]
    F((Circle))
    G>Flag]
    H{Diamond}
    I{{Hexagon}}
\\\`\\\`\\\`

## Arrow Types

Different connection styles:

\\\`\\\`\\\`mermaid
graph LR
    A --> B
    C --- D
    E -.-> F
    G ==> H
    I --text--> J
\\\`\\\`\\\`

- \`-->\` Solid arrow
- \`---\` Solid line
- \`-.->

\` Dotted arrow
- \`==>\` Thick arrow
- \`--text-->\` Labeled arrow

## Tips

\u2705 **Do:**
- Use \`\`\`mermaid\`\`\` code block
- Follow Mermaid syntax exactly
- Use meaningful labels
- Keep diagrams simple

\u274C **Don't:**
- Forget closing \`\`\`
- Use invalid Mermaid syntax
- Make diagrams too complex
- Mix diagram types in one block

## Common Use Cases

**Project workflow:**
\\\`\\\`\\\`mermaid
graph TD
    A[Start] --> B[Planning]
    B --> C[Design]
    C --> D[Development]
    D --> E[Testing]
    E --> F{Pass?}
    F -->|Yes| G[Deploy]
    F -->|No| D
    G --> H[End]
\\\`\\\`\\\`

**API interaction:**
\\\`\\\`\\\`mermaid
sequenceDiagram
    Client->>API: POST /login
    API->>Database: Verify credentials
    Database-->>API: User data
    API-->>Client: JWT token
\\\`\\\`\\\`
`}]}}var bn={defaultWorkspace:(0,wn.join)((0,Ps.homedir)(),"Documents","Lokus Workspace"),lokusConfigDir:(0,wn.join)((0,Ps.homedir)(),".lokus"),lastWorkspaceFile:(0,wn.join)((0,Ps.homedir)(),".lokus","last-workspace.json"),apiUrl:"http://127.0.0.1:3333"},te={info:(...t)=>console.error("[MCP]",...t),error:(...t)=>console.error("[MCP ERROR]",...t),warn:(...t)=>console.error("[MCP WARN]",...t)},zi=class{constructor(){this.currentWorkspace=null,this.workspaceSource=null,this.apiAvailable=!1}async getWorkspace(){if(this.currentWorkspace)return this.currentWorkspace;let{workspace:e,source:r}=await Su({apiUrl:bn.apiUrl});if(e){this.currentWorkspace=e,this.workspaceSource=r,this.apiAvailable=r==="api";let n={cwd:"current directory",env:"LOKUS_WORKSPACE env var",api:"Lokus app API",context:"MCP context",config:"last used config",default:"default location"};return te.info(`Workspace auto-detected from ${n[r]||r}:`,e),this.currentWorkspace}return this.currentWorkspace=await this.createDefaultWorkspace(),this.workspaceSource="created",te.info("Created default workspace:",this.currentWorkspace),this.currentWorkspace}async createDefaultWorkspace(){let e=bn.defaultWorkspace;try{await(0,ft.access)(e,Is.constants.F_OK)}catch{try{await(0,ft.mkdir)(e,{recursive:!0}),await(0,ft.mkdir)((0,wn.join)(e,".lokus"),{recursive:!0}),await(0,ft.writeFile)((0,wn.join)(e,"Welcome.md"),`# Welcome to Lokus!

This is your knowledge workspace. You can:
- Create notes with [[WikiLinks]]
- Organize with Bases (databases)
- Visualize with Canvas
- Manage tasks with Kanban boards
- Explore connections with Graph view

Happy knowledge building!
`),te.info("Created default workspace at:",e)}catch(r){te.error("Failed to create default workspace:",r)}}return e}async validateWorkspace(e){try{return await(0,ft.access)(e,Is.constants.R_OK|Is.constants.W_OK),!0}catch{return!1}}async saveLastWorkspace(e){try{await(0,ft.mkdir)(bn.lokusConfigDir,{recursive:!0}),await(0,ft.writeFile)(bn.lastWorkspaceFile,JSON.stringify({workspace:e,lastUsed:new Date().toISOString(),source:this.workspaceSource,apiAvailable:this.apiAvailable}))}catch(r){te.error("Failed to save last workspace:",r)}}async checkAPIStatus(){try{let e=(await Promise.resolve().then(()=>(Hn(),Zo))).default,r=new AbortController,n=setTimeout(()=>r.abort(),1e3),s=await e(`${bn.apiUrl}/api/health`,{signal:r.signal});return clearTimeout(n),s.ok}catch{return!1}}getDetectionInfo(){return{workspace:this.currentWorkspace,source:this.workspaceSource,apiAvailable:this.apiAvailable}}},ca=new zi,la=new rs({name:"lokus-mcp-enhanced",version:"2.0.0"},{capabilities:{tools:{},resources:{}}}),zd=()=>[...Xo,...ti,...ri,...ni,...ai,...si,...oi,...ii,...Oi,...Ni,...Fi,...Bi];la.setRequestHandler($o,async()=>{let t=zd();return te.info(`Providing ${t.length} tools to AI assistant`),{tools:t}});la.setRequestHandler(Po,async t=>{let{name:e,arguments:r}=t.params,n=await ca.getWorkspace(),s=ca.apiAvailable?bn.apiUrl:null;te.info(`Executing tool: ${e}`);try{if(Xo.some(o=>o.name===e))return await Ru(e,r,s);if(ti.some(o=>o.name===e))return await Pu(e,r,n,s);if(ri.some(o=>o.name===e))return await Iu(e,r,n,s);if(ni.some(o=>o.name===e))return await Ou(e,r,n,s);if(ai.some(o=>o.name===e))return await Lu(e,r,n,s);if(si.some(o=>o.name===e))return await Nu(e,r,n,s);if(oi.some(o=>o.name===e))return await Mu(e,r,n,s);if(ii.some(o=>o.name===e))return await Fu(e,r,n,s);if(Oi.some(o=>o.name===e)){let o=await Id(e,r);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}if(Ni.some(o=>o.name===e))return await Ld(e,r,n);if(Fi.some(o=>o.name===e))return await Wd(e,r,n);if(Bi.some(o=>o.name===e))return await Bd(e,r,n);throw new Error(`Unknown tool: ${e}`)}catch(o){return te.error(`Tool execution failed for ${e}:`,o.message),{content:[{type:"text",text:`\u274C Error: ${o.message}`}],isError:!0}}});la.setRequestHandler(Eo,async()=>(te.info(`Providing ${Ui.length} documentation resources`),{resources:Ui}));la.setRequestHandler(Ao,async t=>{let{uri:e}=t.params;te.info(`Reading resource: ${e}`);try{return await Ud(e)}catch(r){return te.error(`Resource read failed for ${e}:`,r.message),{contents:[{uri:e,mimeType:"text/plain",text:`Error: ${r.message}`}]}}});async function Iw(){let t=new as;await la.connect(t),te.info("==========================================="),te.info("Lokus MCP Server v2.0 started successfully"),te.info(`Offering ${zd().length} tools`),await ca.checkAPIStatus()?te.info("\u2705 Connected to Lokus app API"):te.info("\u26A0\uFE0F  Lokus app not running (basic features only)");let r=await ca.getWorkspace(),{source:n}=ca.getDetectionInfo();te.info(`Workspace: ${r}`),te.info(`Detection: ${n} (CWD > ENV > API > context > config > default)`),te.info("===========================================")}Iw().catch(t=>{te.error("Fatal error:",t),process.exit(1)});
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)
*/
