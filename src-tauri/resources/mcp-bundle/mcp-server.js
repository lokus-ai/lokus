#!/usr/bin/env node
var Pu=Object.create;var na=Object.defineProperty;var Au=Object.getOwnPropertyDescriptor;var $u=Object.getOwnPropertyNames;var Ou=Object.getPrototypeOf,ju=Object.prototype.hasOwnProperty;var Q=(n,e)=>()=>(n&&(e=n(n=0)),e);var sa=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),aa=(n,e)=>{for(var r in e)na(n,r,{get:e[r],enumerable:!0})},Iu=(n,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of $u(e))!ju.call(n,o)&&o!==r&&na(n,o,{get:()=>e[o],enumerable:!(s=Au(e,o))||s.enumerable});return n};var $e=(n,e,r)=>(r=n!=null?Pu(Ou(n)):{},Iu(e||!n||!n.__esModule?na(r,"default",{value:n,enumerable:!0}):r,n));function Wf(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let e=n.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let r=n.substring(5,e).split(";"),s="",o=!1,i=r[0]||"text/plain",l=i;for(let y=1;y<r.length;y++)r[y]==="base64"?o=!0:r[y]&&(l+=`;${r[y]}`,r[y].indexOf("charset=")===0&&(s=r[y].substring(8)));!r[0]&&!s.length&&(l+=";charset=US-ASCII",s="US-ASCII");let u=o?"base64":"ascii",p=unescape(n.substring(e+1)),d=Buffer.from(p,u);return d.type=i,d.typeFull=l,d.charset=s,d}var $i,Oi=Q(()=>{$i=Wf});var Ii=sa((ts,ji)=>{(function(n,e){typeof ts=="object"&&typeof ji<"u"?e(ts):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.WebStreamsPolyfill={}))})(ts,(function(n){"use strict";function e(){}function r(t){return typeof t=="object"&&t!==null||typeof t=="function"}let s=e;function o(t,a){try{Object.defineProperty(t,"name",{value:a,configurable:!0})}catch{}}let i=Promise,l=Promise.prototype.then,u=Promise.reject.bind(i);function p(t){return new i(t)}function d(t){return p(a=>a(t))}function y(t){return u(t)}function S(t,a,c){return l.call(t,a,c)}function R(t,a,c){S(S(t,a,c),void 0,s)}function j(t,a){R(t,a)}function k(t,a){R(t,void 0,a)}function z(t,a,c){return S(t,a,c)}function q(t){S(t,void 0,s)}let F=t=>{if(typeof queueMicrotask=="function")F=queueMicrotask;else{let a=d(void 0);F=c=>S(a,c)}return F(t)};function Z(t,a,c){if(typeof t!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(t,a,c)}function X(t,a,c){try{return d(Z(t,a,c))}catch(f){return y(f)}}let L=16384;class M{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(a){let c=this._back,f=c;c._elements.length===L-1&&(f={_elements:[],_next:void 0}),c._elements.push(a),f!==c&&(this._back=f,c._next=f),++this._size}shift(){let a=this._front,c=a,f=this._cursor,m=f+1,g=a._elements,b=g[f];return m===L&&(c=a._next,m=0),--this._size,this._cursor=m,a!==c&&(this._front=c),g[f]=void 0,b}forEach(a){let c=this._cursor,f=this._front,m=f._elements;for(;(c!==m.length||f._next!==void 0)&&!(c===m.length&&(f=f._next,m=f._elements,c=0,m.length===0));)a(m[c]),++c}peek(){let a=this._front,c=this._cursor;return a._elements[c]}}let J=Symbol("[[AbortSteps]]"),lt=Symbol("[[ErrorSteps]]"),$r=Symbol("[[CancelSteps]]"),gs=Symbol("[[PullSteps]]"),bs=Symbol("[[ReleaseSteps]]");function Ha(t,a){t._ownerReadableStream=a,a._reader=t,a._state==="readable"?ws(t):a._state==="closed"?Fc(t):Va(t,a._storedError)}function _s(t,a){let c=t._ownerReadableStream;return Pe(c,a)}function Ze(t){let a=t._ownerReadableStream;a._state==="readable"?Ss(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):qc(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),a._readableStreamController[bs](),a._reader=void 0,t._ownerReadableStream=void 0}function an(t){return new TypeError("Cannot "+t+" a stream using a released reader")}function ws(t){t._closedPromise=p((a,c)=>{t._closedPromise_resolve=a,t._closedPromise_reject=c})}function Va(t,a){ws(t),Ss(t,a)}function Fc(t){ws(t),Za(t)}function Ss(t,a){t._closedPromise_reject!==void 0&&(q(t._closedPromise),t._closedPromise_reject(a),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}function qc(t,a){Va(t,a)}function Za(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}let Ja=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},Lc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};function Mc(t){return typeof t=="object"||typeof t=="function"}function De(t,a){if(t!==void 0&&!Mc(t))throw new TypeError(`${a} is not an object.`)}function _e(t,a){if(typeof t!="function")throw new TypeError(`${a} is not a function.`)}function zc(t){return typeof t=="object"&&t!==null||typeof t=="function"}function Ya(t,a){if(!zc(t))throw new TypeError(`${a} is not an object.`)}function Je(t,a,c){if(t===void 0)throw new TypeError(`Parameter ${a} is required in '${c}'.`)}function vs(t,a,c){if(t===void 0)throw new TypeError(`${a} is required in '${c}'.`)}function xs(t){return Number(t)}function Ga(t){return t===0?0:t}function Uc(t){return Ga(Lc(t))}function ks(t,a){let f=Number.MAX_SAFE_INTEGER,m=Number(t);if(m=Ga(m),!Ja(m))throw new TypeError(`${a} is not a finite number`);if(m=Uc(m),m<0||m>f)throw new TypeError(`${a} is outside the accepted range of 0 to ${f}, inclusive`);return!Ja(m)||m===0?0:m}function Rs(t,a){if(!yt(t))throw new TypeError(`${a} is not a ReadableStream.`)}function ar(t){return new ut(t)}function Qa(t,a){t._reader._readRequests.push(a)}function Ts(t,a,c){let m=t._reader._readRequests.shift();c?m._closeSteps():m._chunkSteps(a)}function on(t){return t._reader._readRequests.length}function Ka(t){let a=t._reader;return!(a===void 0||!dt(a))}class ut{constructor(a){if(Je(a,1,"ReadableStreamDefaultReader"),Rs(a,"First parameter"),gt(a))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Ha(this,a),this._readRequests=new M}get closed(){return dt(this)?this._closedPromise:y(cn("closed"))}cancel(a=void 0){return dt(this)?this._ownerReadableStream===void 0?y(an("cancel")):_s(this,a):y(cn("cancel"))}read(){if(!dt(this))return y(cn("read"));if(this._ownerReadableStream===void 0)return y(an("read from"));let a,c,f=p((g,b)=>{a=g,c=b});return Or(this,{_chunkSteps:g=>a({value:g,done:!1}),_closeSteps:()=>a({value:void 0,done:!0}),_errorSteps:g=>c(g)}),f}releaseLock(){if(!dt(this))throw cn("releaseLock");this._ownerReadableStream!==void 0&&Hc(this)}}Object.defineProperties(ut.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(ut.prototype.cancel,"cancel"),o(ut.prototype.read,"read"),o(ut.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ut.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function dt(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_readRequests")?!1:t instanceof ut}function Or(t,a){let c=t._ownerReadableStream;c._disturbed=!0,c._state==="closed"?a._closeSteps():c._state==="errored"?a._errorSteps(c._storedError):c._readableStreamController[gs](a)}function Hc(t){Ze(t);let a=new TypeError("Reader was released");Xa(t,a)}function Xa(t,a){let c=t._readRequests;t._readRequests=new M,c.forEach(f=>{f._errorSteps(a)})}function cn(t){return new TypeError(`ReadableStreamDefaultReader.prototype.${t} can only be used on a ReadableStreamDefaultReader`)}let Vc=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class eo{constructor(a,c){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=a,this._preventCancel=c}next(){let a=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?z(this._ongoingPromise,a,a):a(),this._ongoingPromise}return(a){let c=()=>this._returnSteps(a);return this._ongoingPromise?z(this._ongoingPromise,c,c):c()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let a=this._reader,c,f,m=p((b,v)=>{c=b,f=v});return Or(a,{_chunkSteps:b=>{this._ongoingPromise=void 0,F(()=>c({value:b,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Ze(a),c({value:void 0,done:!0})},_errorSteps:b=>{this._ongoingPromise=void 0,this._isFinished=!0,Ze(a),f(b)}}),m}_returnSteps(a){if(this._isFinished)return Promise.resolve({value:a,done:!0});this._isFinished=!0;let c=this._reader;if(!this._preventCancel){let f=_s(c,a);return Ze(c),z(f,()=>({value:a,done:!0}))}return Ze(c),d({value:a,done:!0})}}let to={next(){return ro(this)?this._asyncIteratorImpl.next():y(no("next"))},return(t){return ro(this)?this._asyncIteratorImpl.return(t):y(no("return"))}};Object.setPrototypeOf(to,Vc);function Zc(t,a){let c=ar(t),f=new eo(c,a),m=Object.create(to);return m._asyncIteratorImpl=f,m}function ro(t){if(!r(t)||!Object.prototype.hasOwnProperty.call(t,"_asyncIteratorImpl"))return!1;try{return t._asyncIteratorImpl instanceof eo}catch{return!1}}function no(t){return new TypeError(`ReadableStreamAsyncIterator.${t} can only be used on a ReadableSteamAsyncIterator`)}let so=Number.isNaN||function(t){return t!==t};var Cs,Es,Ps;function jr(t){return t.slice()}function ao(t,a,c,f,m){new Uint8Array(t).set(new Uint8Array(c,f,m),a)}let Ye=t=>(typeof t.transfer=="function"?Ye=a=>a.transfer():typeof structuredClone=="function"?Ye=a=>structuredClone(a,{transfer:[a]}):Ye=a=>a,Ye(t)),ft=t=>(typeof t.detached=="boolean"?ft=a=>a.detached:ft=a=>a.byteLength===0,ft(t));function oo(t,a,c){if(t.slice)return t.slice(a,c);let f=c-a,m=new ArrayBuffer(f);return ao(m,0,t,a,f),m}function ln(t,a){let c=t[a];if(c!=null){if(typeof c!="function")throw new TypeError(`${String(a)} is not a function`);return c}}function Jc(t){let a={[Symbol.iterator]:()=>t.iterator},c=(async function*(){return yield*a})(),f=c.next;return{iterator:c,nextMethod:f,done:!1}}let As=(Ps=(Cs=Symbol.asyncIterator)!==null&&Cs!==void 0?Cs:(Es=Symbol.for)===null||Es===void 0?void 0:Es.call(Symbol,"Symbol.asyncIterator"))!==null&&Ps!==void 0?Ps:"@@asyncIterator";function io(t,a="sync",c){if(c===void 0)if(a==="async"){if(c=ln(t,As),c===void 0){let g=ln(t,Symbol.iterator),b=io(t,"sync",g);return Jc(b)}}else c=ln(t,Symbol.iterator);if(c===void 0)throw new TypeError("The object is not iterable");let f=Z(c,t,[]);if(!r(f))throw new TypeError("The iterator method must return an object");let m=f.next;return{iterator:f,nextMethod:m,done:!1}}function Yc(t){let a=Z(t.nextMethod,t.iterator,[]);if(!r(a))throw new TypeError("The iterator.next() method must return an object");return a}function Gc(t){return!!t.done}function Qc(t){return t.value}function Kc(t){return!(typeof t!="number"||so(t)||t<0)}function co(t){let a=oo(t.buffer,t.byteOffset,t.byteOffset+t.byteLength);return new Uint8Array(a)}function $s(t){let a=t._queue.shift();return t._queueTotalSize-=a.size,t._queueTotalSize<0&&(t._queueTotalSize=0),a.value}function Os(t,a,c){if(!Kc(c)||c===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");t._queue.push({value:a,size:c}),t._queueTotalSize+=c}function Xc(t){return t._queue.peek().value}function pt(t){t._queue=new M,t._queueTotalSize=0}function lo(t){return t===DataView}function el(t){return lo(t.constructor)}function tl(t){return lo(t)?1:t.BYTES_PER_ELEMENT}class Et{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!js(this))throw Ds("view");return this._view}respond(a){if(!js(this))throw Ds("respond");if(Je(a,1,"respond"),a=ks(a,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ft(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");pn(this._associatedReadableByteStreamController,a)}respondWithNewView(a){if(!js(this))throw Ds("respondWithNewView");if(Je(a,1,"respondWithNewView"),!ArrayBuffer.isView(a))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ft(a.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");hn(this._associatedReadableByteStreamController,a)}}Object.defineProperties(Et.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),o(Et.prototype.respond,"respond"),o(Et.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Et.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ge{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Pt(this))throw Nr("byobRequest");return Ws(this)}get desiredSize(){if(!Pt(this))throw Nr("desiredSize");return wo(this)}close(){if(!Pt(this))throw Nr("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let a=this._controlledReadableByteStream._state;if(a!=="readable")throw new TypeError(`The stream (in ${a} state) is not in the readable state and cannot be closed`);Ir(this)}enqueue(a){if(!Pt(this))throw Nr("enqueue");if(Je(a,1,"enqueue"),!ArrayBuffer.isView(a))throw new TypeError("chunk must be an array buffer view");if(a.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(a.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let c=this._controlledReadableByteStream._state;if(c!=="readable")throw new TypeError(`The stream (in ${c} state) is not in the readable state and cannot be enqueued to`);fn(this,a)}error(a=void 0){if(!Pt(this))throw Nr("error");we(this,a)}[$r](a){uo(this),pt(this);let c=this._cancelAlgorithm(a);return dn(this),c}[gs](a){let c=this._controlledReadableByteStream;if(this._queueTotalSize>0){_o(this,a);return}let f=this._autoAllocateChunkSize;if(f!==void 0){let m;try{m=new ArrayBuffer(f)}catch(b){a._errorSteps(b);return}let g={buffer:m,bufferByteLength:f,byteOffset:0,byteLength:f,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(g)}Qa(c,a),At(this)}[bs](){if(this._pendingPullIntos.length>0){let a=this._pendingPullIntos.peek();a.readerType="none",this._pendingPullIntos=new M,this._pendingPullIntos.push(a)}}}Object.defineProperties(Ge.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Ge.prototype.close,"close"),o(Ge.prototype.enqueue,"enqueue"),o(Ge.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ge.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Pt(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledReadableByteStream")?!1:t instanceof Ge}function js(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_associatedReadableByteStreamController")?!1:t instanceof Et}function At(t){if(!ol(t))return;if(t._pulling){t._pullAgain=!0;return}t._pulling=!0;let c=t._pullAlgorithm();R(c,()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,At(t)),null),f=>(we(t,f),null))}function uo(t){Ns(t),t._pendingPullIntos=new M}function Is(t,a){let c=!1;t._state==="closed"&&(c=!0);let f=fo(a);a.readerType==="default"?Ts(t,f,c):fl(t,f,c)}function fo(t){let a=t.bytesFilled,c=t.elementSize;return new t.viewConstructor(t.buffer,t.byteOffset,a/c)}function un(t,a,c,f){t._queue.push({buffer:a,byteOffset:c,byteLength:f}),t._queueTotalSize+=f}function po(t,a,c,f){let m;try{m=oo(a,c,c+f)}catch(g){throw we(t,g),g}un(t,m,0,f)}function ho(t,a){a.bytesFilled>0&&po(t,a.buffer,a.byteOffset,a.bytesFilled),or(t)}function mo(t,a){let c=Math.min(t._queueTotalSize,a.byteLength-a.bytesFilled),f=a.bytesFilled+c,m=c,g=!1,b=f%a.elementSize,v=f-b;v>=a.minimumFill&&(m=v-a.bytesFilled,g=!0);let $=t._queue;for(;m>0;){let C=$.peek(),O=Math.min(m,C.byteLength),B=a.byteOffset+a.bytesFilled;ao(a.buffer,B,C.buffer,C.byteOffset,O),C.byteLength===O?$.shift():(C.byteOffset+=O,C.byteLength-=O),t._queueTotalSize-=O,yo(t,O,a),m-=O}return g}function yo(t,a,c){c.bytesFilled+=a}function go(t){t._queueTotalSize===0&&t._closeRequested?(dn(t),Lr(t._controlledReadableByteStream)):At(t)}function Ns(t){t._byobRequest!==null&&(t._byobRequest._associatedReadableByteStreamController=void 0,t._byobRequest._view=null,t._byobRequest=null)}function Bs(t){for(;t._pendingPullIntos.length>0;){if(t._queueTotalSize===0)return;let a=t._pendingPullIntos.peek();mo(t,a)&&(or(t),Is(t._controlledReadableByteStream,a))}}function rl(t){let a=t._controlledReadableByteStream._reader;for(;a._readRequests.length>0;){if(t._queueTotalSize===0)return;let c=a._readRequests.shift();_o(t,c)}}function nl(t,a,c,f){let m=t._controlledReadableByteStream,g=a.constructor,b=tl(g),{byteOffset:v,byteLength:$}=a,C=c*b,O;try{O=Ye(a.buffer)}catch(U){f._errorSteps(U);return}let B={buffer:O,bufferByteLength:O.byteLength,byteOffset:v,byteLength:$,bytesFilled:0,minimumFill:C,elementSize:b,viewConstructor:g,readerType:"byob"};if(t._pendingPullIntos.length>0){t._pendingPullIntos.push(B),xo(m,f);return}if(m._state==="closed"){let U=new g(B.buffer,B.byteOffset,0);f._closeSteps(U);return}if(t._queueTotalSize>0){if(mo(t,B)){let U=fo(B);go(t),f._chunkSteps(U);return}if(t._closeRequested){let U=new TypeError("Insufficient bytes to fill elements in the given buffer");we(t,U),f._errorSteps(U);return}}t._pendingPullIntos.push(B),xo(m,f),At(t)}function sl(t,a){a.readerType==="none"&&or(t);let c=t._controlledReadableByteStream;if(Fs(c))for(;ko(c)>0;){let f=or(t);Is(c,f)}}function al(t,a,c){if(yo(t,a,c),c.readerType==="none"){ho(t,c),Bs(t);return}if(c.bytesFilled<c.minimumFill)return;or(t);let f=c.bytesFilled%c.elementSize;if(f>0){let m=c.byteOffset+c.bytesFilled;po(t,c.buffer,m-f,f)}c.bytesFilled-=f,Is(t._controlledReadableByteStream,c),Bs(t)}function bo(t,a){let c=t._pendingPullIntos.peek();Ns(t),t._controlledReadableByteStream._state==="closed"?sl(t,c):al(t,a,c),At(t)}function or(t){return t._pendingPullIntos.shift()}function ol(t){let a=t._controlledReadableByteStream;return a._state!=="readable"||t._closeRequested||!t._started?!1:!!(Ka(a)&&on(a)>0||Fs(a)&&ko(a)>0||wo(t)>0)}function dn(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0}function Ir(t){let a=t._controlledReadableByteStream;if(!(t._closeRequested||a._state!=="readable")){if(t._queueTotalSize>0){t._closeRequested=!0;return}if(t._pendingPullIntos.length>0){let c=t._pendingPullIntos.peek();if(c.bytesFilled%c.elementSize!==0){let f=new TypeError("Insufficient bytes to fill elements in the given buffer");throw we(t,f),f}}dn(t),Lr(a)}}function fn(t,a){let c=t._controlledReadableByteStream;if(t._closeRequested||c._state!=="readable")return;let{buffer:f,byteOffset:m,byteLength:g}=a;if(ft(f))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let b=Ye(f);if(t._pendingPullIntos.length>0){let v=t._pendingPullIntos.peek();if(ft(v.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Ns(t),v.buffer=Ye(v.buffer),v.readerType==="none"&&ho(t,v)}if(Ka(c))if(rl(t),on(c)===0)un(t,b,m,g);else{t._pendingPullIntos.length>0&&or(t);let v=new Uint8Array(b,m,g);Ts(c,v,!1)}else Fs(c)?(un(t,b,m,g),Bs(t)):un(t,b,m,g);At(t)}function we(t,a){let c=t._controlledReadableByteStream;c._state==="readable"&&(uo(t),pt(t),dn(t),Jo(c,a))}function _o(t,a){let c=t._queue.shift();t._queueTotalSize-=c.byteLength,go(t);let f=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);a._chunkSteps(f)}function Ws(t){if(t._byobRequest===null&&t._pendingPullIntos.length>0){let a=t._pendingPullIntos.peek(),c=new Uint8Array(a.buffer,a.byteOffset+a.bytesFilled,a.byteLength-a.bytesFilled),f=Object.create(Et.prototype);cl(f,t,c),t._byobRequest=f}return t._byobRequest}function wo(t){let a=t._controlledReadableByteStream._state;return a==="errored"?null:a==="closed"?0:t._strategyHWM-t._queueTotalSize}function pn(t,a){let c=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(a!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(a===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(c.bytesFilled+a>c.byteLength)throw new RangeError("bytesWritten out of range")}c.buffer=Ye(c.buffer),bo(t,a)}function hn(t,a){let c=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(a.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(a.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(c.byteOffset+c.bytesFilled!==a.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(c.bufferByteLength!==a.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(c.bytesFilled+a.byteLength>c.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let m=a.byteLength;c.buffer=Ye(a.buffer),bo(t,m)}function So(t,a,c,f,m,g,b){a._controlledReadableByteStream=t,a._pullAgain=!1,a._pulling=!1,a._byobRequest=null,a._queue=a._queueTotalSize=void 0,pt(a),a._closeRequested=!1,a._started=!1,a._strategyHWM=g,a._pullAlgorithm=f,a._cancelAlgorithm=m,a._autoAllocateChunkSize=b,a._pendingPullIntos=new M,t._readableStreamController=a;let v=c();R(d(v),()=>(a._started=!0,At(a),null),$=>(we(a,$),null))}function il(t,a,c){let f=Object.create(Ge.prototype),m,g,b;a.start!==void 0?m=()=>a.start(f):m=()=>{},a.pull!==void 0?g=()=>a.pull(f):g=()=>d(void 0),a.cancel!==void 0?b=$=>a.cancel($):b=()=>d(void 0);let v=a.autoAllocateChunkSize;if(v===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");So(t,f,m,g,b,c,v)}function cl(t,a,c){t._associatedReadableByteStreamController=a,t._view=c}function Ds(t){return new TypeError(`ReadableStreamBYOBRequest.prototype.${t} can only be used on a ReadableStreamBYOBRequest`)}function Nr(t){return new TypeError(`ReadableByteStreamController.prototype.${t} can only be used on a ReadableByteStreamController`)}function ll(t,a){De(t,a);let c=t?.mode;return{mode:c===void 0?void 0:ul(c,`${a} has member 'mode' that`)}}function ul(t,a){if(t=`${t}`,t!=="byob")throw new TypeError(`${a} '${t}' is not a valid enumeration value for ReadableStreamReaderMode`);return t}function dl(t,a){var c;De(t,a);let f=(c=t?.min)!==null&&c!==void 0?c:1;return{min:ks(f,`${a} has member 'min' that`)}}function vo(t){return new ht(t)}function xo(t,a){t._reader._readIntoRequests.push(a)}function fl(t,a,c){let m=t._reader._readIntoRequests.shift();c?m._closeSteps(a):m._chunkSteps(a)}function ko(t){return t._reader._readIntoRequests.length}function Fs(t){let a=t._reader;return!(a===void 0||!$t(a))}class ht{constructor(a){if(Je(a,1,"ReadableStreamBYOBReader"),Rs(a,"First parameter"),gt(a))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Pt(a._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Ha(this,a),this._readIntoRequests=new M}get closed(){return $t(this)?this._closedPromise:y(mn("closed"))}cancel(a=void 0){return $t(this)?this._ownerReadableStream===void 0?y(an("cancel")):_s(this,a):y(mn("cancel"))}read(a,c={}){if(!$t(this))return y(mn("read"));if(!ArrayBuffer.isView(a))return y(new TypeError("view must be an array buffer view"));if(a.byteLength===0)return y(new TypeError("view must have non-zero byteLength"));if(a.buffer.byteLength===0)return y(new TypeError("view's buffer must have non-zero byteLength"));if(ft(a.buffer))return y(new TypeError("view's buffer has been detached"));let f;try{f=dl(c,"options")}catch(C){return y(C)}let m=f.min;if(m===0)return y(new TypeError("options.min must be greater than 0"));if(el(a)){if(m>a.byteLength)return y(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(m>a.length)return y(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return y(an("read from"));let g,b,v=p((C,O)=>{g=C,b=O});return Ro(this,a,m,{_chunkSteps:C=>g({value:C,done:!1}),_closeSteps:C=>g({value:C,done:!0}),_errorSteps:C=>b(C)}),v}releaseLock(){if(!$t(this))throw mn("releaseLock");this._ownerReadableStream!==void 0&&pl(this)}}Object.defineProperties(ht.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(ht.prototype.cancel,"cancel"),o(ht.prototype.read,"read"),o(ht.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function $t(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_readIntoRequests")?!1:t instanceof ht}function Ro(t,a,c,f){let m=t._ownerReadableStream;m._disturbed=!0,m._state==="errored"?f._errorSteps(m._storedError):nl(m._readableStreamController,a,c,f)}function pl(t){Ze(t);let a=new TypeError("Reader was released");To(t,a)}function To(t,a){let c=t._readIntoRequests;t._readIntoRequests=new M,c.forEach(f=>{f._errorSteps(a)})}function mn(t){return new TypeError(`ReadableStreamBYOBReader.prototype.${t} can only be used on a ReadableStreamBYOBReader`)}function Br(t,a){let{highWaterMark:c}=t;if(c===void 0)return a;if(so(c)||c<0)throw new RangeError("Invalid highWaterMark");return c}function yn(t){let{size:a}=t;return a||(()=>1)}function gn(t,a){De(t,a);let c=t?.highWaterMark,f=t?.size;return{highWaterMark:c===void 0?void 0:xs(c),size:f===void 0?void 0:hl(f,`${a} has member 'size' that`)}}function hl(t,a){return _e(t,a),c=>xs(t(c))}function ml(t,a){De(t,a);let c=t?.abort,f=t?.close,m=t?.start,g=t?.type,b=t?.write;return{abort:c===void 0?void 0:yl(c,t,`${a} has member 'abort' that`),close:f===void 0?void 0:gl(f,t,`${a} has member 'close' that`),start:m===void 0?void 0:bl(m,t,`${a} has member 'start' that`),write:b===void 0?void 0:_l(b,t,`${a} has member 'write' that`),type:g}}function yl(t,a,c){return _e(t,c),f=>X(t,a,[f])}function gl(t,a,c){return _e(t,c),()=>X(t,a,[])}function bl(t,a,c){return _e(t,c),f=>Z(t,a,[f])}function _l(t,a,c){return _e(t,c),(f,m)=>X(t,a,[f,m])}function Co(t,a){if(!ir(t))throw new TypeError(`${a} is not a WritableStream.`)}function wl(t){if(typeof t!="object"||t===null)return!1;try{return typeof t.aborted=="boolean"}catch{return!1}}let Sl=typeof AbortController=="function";function vl(){if(Sl)return new AbortController}class mt{constructor(a={},c={}){a===void 0?a=null:Ya(a,"First parameter");let f=gn(c,"Second parameter"),m=ml(a,"First parameter");if(Po(this),m.type!==void 0)throw new RangeError("Invalid type is specified");let b=yn(f),v=Br(f,1);Bl(this,m,v,b)}get locked(){if(!ir(this))throw vn("locked");return cr(this)}abort(a=void 0){return ir(this)?cr(this)?y(new TypeError("Cannot abort a stream that already has a writer")):bn(this,a):y(vn("abort"))}close(){return ir(this)?cr(this)?y(new TypeError("Cannot close a stream that already has a writer")):Fe(this)?y(new TypeError("Cannot close an already-closing stream")):Ao(this):y(vn("close"))}getWriter(){if(!ir(this))throw vn("getWriter");return Eo(this)}}Object.defineProperties(mt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),o(mt.prototype.abort,"abort"),o(mt.prototype.close,"close"),o(mt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Eo(t){return new Qe(t)}function xl(t,a,c,f,m=1,g=()=>1){let b=Object.create(mt.prototype);Po(b);let v=Object.create(lr.prototype);return Bo(b,v,t,a,c,f,m,g),b}function Po(t){t._state="writable",t._storedError=void 0,t._writer=void 0,t._writableStreamController=void 0,t._writeRequests=new M,t._inFlightWriteRequest=void 0,t._closeRequest=void 0,t._inFlightCloseRequest=void 0,t._pendingAbortRequest=void 0,t._backpressure=!1}function ir(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_writableStreamController")?!1:t instanceof mt}function cr(t){return t._writer!==void 0}function bn(t,a){var c;if(t._state==="closed"||t._state==="errored")return d(void 0);t._writableStreamController._abortReason=a,(c=t._writableStreamController._abortController)===null||c===void 0||c.abort(a);let f=t._state;if(f==="closed"||f==="errored")return d(void 0);if(t._pendingAbortRequest!==void 0)return t._pendingAbortRequest._promise;let m=!1;f==="erroring"&&(m=!0,a=void 0);let g=p((b,v)=>{t._pendingAbortRequest={_promise:void 0,_resolve:b,_reject:v,_reason:a,_wasAlreadyErroring:m}});return t._pendingAbortRequest._promise=g,m||Ls(t,a),g}function Ao(t){let a=t._state;if(a==="closed"||a==="errored")return y(new TypeError(`The stream (in ${a} state) is not in the writable state and cannot be closed`));let c=p((m,g)=>{let b={_resolve:m,_reject:g};t._closeRequest=b}),f=t._writer;return f!==void 0&&t._backpressure&&a==="writable"&&Ys(f),Wl(t._writableStreamController),c}function kl(t){return p((c,f)=>{let m={_resolve:c,_reject:f};t._writeRequests.push(m)})}function qs(t,a){if(t._state==="writable"){Ls(t,a);return}Ms(t)}function Ls(t,a){let c=t._writableStreamController;t._state="erroring",t._storedError=a;let f=t._writer;f!==void 0&&Oo(f,a),!Pl(t)&&c._started&&Ms(t)}function Ms(t){t._state="errored",t._writableStreamController[lt]();let a=t._storedError;if(t._writeRequests.forEach(m=>{m._reject(a)}),t._writeRequests=new M,t._pendingAbortRequest===void 0){_n(t);return}let c=t._pendingAbortRequest;if(t._pendingAbortRequest=void 0,c._wasAlreadyErroring){c._reject(a),_n(t);return}let f=t._writableStreamController[J](c._reason);R(f,()=>(c._resolve(),_n(t),null),m=>(c._reject(m),_n(t),null))}function Rl(t){t._inFlightWriteRequest._resolve(void 0),t._inFlightWriteRequest=void 0}function Tl(t,a){t._inFlightWriteRequest._reject(a),t._inFlightWriteRequest=void 0,qs(t,a)}function Cl(t){t._inFlightCloseRequest._resolve(void 0),t._inFlightCloseRequest=void 0,t._state==="erroring"&&(t._storedError=void 0,t._pendingAbortRequest!==void 0&&(t._pendingAbortRequest._resolve(),t._pendingAbortRequest=void 0)),t._state="closed";let c=t._writer;c!==void 0&&qo(c)}function El(t,a){t._inFlightCloseRequest._reject(a),t._inFlightCloseRequest=void 0,t._pendingAbortRequest!==void 0&&(t._pendingAbortRequest._reject(a),t._pendingAbortRequest=void 0),qs(t,a)}function Fe(t){return!(t._closeRequest===void 0&&t._inFlightCloseRequest===void 0)}function Pl(t){return!(t._inFlightWriteRequest===void 0&&t._inFlightCloseRequest===void 0)}function Al(t){t._inFlightCloseRequest=t._closeRequest,t._closeRequest=void 0}function $l(t){t._inFlightWriteRequest=t._writeRequests.shift()}function _n(t){t._closeRequest!==void 0&&(t._closeRequest._reject(t._storedError),t._closeRequest=void 0);let a=t._writer;a!==void 0&&Zs(a,t._storedError)}function zs(t,a){let c=t._writer;c!==void 0&&a!==t._backpressure&&(a?Ul(c):Ys(c)),t._backpressure=a}class Qe{constructor(a){if(Je(a,1,"WritableStreamDefaultWriter"),Co(a,"First parameter"),cr(a))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=a,a._writer=this;let c=a._state;if(c==="writable")!Fe(a)&&a._backpressure?kn(this):Lo(this),xn(this);else if(c==="erroring")Js(this,a._storedError),xn(this);else if(c==="closed")Lo(this),Ml(this);else{let f=a._storedError;Js(this,f),Fo(this,f)}}get closed(){return Ot(this)?this._closedPromise:y(jt("closed"))}get desiredSize(){if(!Ot(this))throw jt("desiredSize");if(this._ownerWritableStream===void 0)throw Dr("desiredSize");return Nl(this)}get ready(){return Ot(this)?this._readyPromise:y(jt("ready"))}abort(a=void 0){return Ot(this)?this._ownerWritableStream===void 0?y(Dr("abort")):Ol(this,a):y(jt("abort"))}close(){if(!Ot(this))return y(jt("close"));let a=this._ownerWritableStream;return a===void 0?y(Dr("close")):Fe(a)?y(new TypeError("Cannot close an already-closing stream")):$o(this)}releaseLock(){if(!Ot(this))throw jt("releaseLock");this._ownerWritableStream!==void 0&&jo(this)}write(a=void 0){return Ot(this)?this._ownerWritableStream===void 0?y(Dr("write to")):Io(this,a):y(jt("write"))}}Object.defineProperties(Qe.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),o(Qe.prototype.abort,"abort"),o(Qe.prototype.close,"close"),o(Qe.prototype.releaseLock,"releaseLock"),o(Qe.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Qe.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Ot(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_ownerWritableStream")?!1:t instanceof Qe}function Ol(t,a){let c=t._ownerWritableStream;return bn(c,a)}function $o(t){let a=t._ownerWritableStream;return Ao(a)}function jl(t){let a=t._ownerWritableStream,c=a._state;return Fe(a)||c==="closed"?d(void 0):c==="errored"?y(a._storedError):$o(t)}function Il(t,a){t._closedPromiseState==="pending"?Zs(t,a):zl(t,a)}function Oo(t,a){t._readyPromiseState==="pending"?Mo(t,a):Hl(t,a)}function Nl(t){let a=t._ownerWritableStream,c=a._state;return c==="errored"||c==="erroring"?null:c==="closed"?0:Wo(a._writableStreamController)}function jo(t){let a=t._ownerWritableStream,c=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Oo(t,c),Il(t,c),a._writer=void 0,t._ownerWritableStream=void 0}function Io(t,a){let c=t._ownerWritableStream,f=c._writableStreamController,m=Dl(f,a);if(c!==t._ownerWritableStream)return y(Dr("write to"));let g=c._state;if(g==="errored")return y(c._storedError);if(Fe(c)||g==="closed")return y(new TypeError("The stream is closing or closed and cannot be written to"));if(g==="erroring")return y(c._storedError);let b=kl(c);return Fl(f,a,m),b}let No={};class lr{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Us(this))throw Vs("abortReason");return this._abortReason}get signal(){if(!Us(this))throw Vs("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(a=void 0){if(!Us(this))throw Vs("error");this._controlledWritableStream._state==="writable"&&Do(this,a)}[J](a){let c=this._abortAlgorithm(a);return wn(this),c}[lt](){pt(this)}}Object.defineProperties(lr.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(lr.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Us(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledWritableStream")?!1:t instanceof lr}function Bo(t,a,c,f,m,g,b,v){a._controlledWritableStream=t,t._writableStreamController=a,a._queue=void 0,a._queueTotalSize=void 0,pt(a),a._abortReason=void 0,a._abortController=vl(),a._started=!1,a._strategySizeAlgorithm=v,a._strategyHWM=b,a._writeAlgorithm=f,a._closeAlgorithm=m,a._abortAlgorithm=g;let $=Hs(a);zs(t,$);let C=c(),O=d(C);R(O,()=>(a._started=!0,Sn(a),null),B=>(a._started=!0,qs(t,B),null))}function Bl(t,a,c,f){let m=Object.create(lr.prototype),g,b,v,$;a.start!==void 0?g=()=>a.start(m):g=()=>{},a.write!==void 0?b=C=>a.write(C,m):b=()=>d(void 0),a.close!==void 0?v=()=>a.close():v=()=>d(void 0),a.abort!==void 0?$=C=>a.abort(C):$=()=>d(void 0),Bo(t,m,g,b,v,$,c,f)}function wn(t){t._writeAlgorithm=void 0,t._closeAlgorithm=void 0,t._abortAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function Wl(t){Os(t,No,0),Sn(t)}function Dl(t,a){try{return t._strategySizeAlgorithm(a)}catch(c){return Wr(t,c),1}}function Wo(t){return t._strategyHWM-t._queueTotalSize}function Fl(t,a,c){try{Os(t,a,c)}catch(m){Wr(t,m);return}let f=t._controlledWritableStream;if(!Fe(f)&&f._state==="writable"){let m=Hs(t);zs(f,m)}Sn(t)}function Sn(t){let a=t._controlledWritableStream;if(!t._started||a._inFlightWriteRequest!==void 0)return;if(a._state==="erroring"){Ms(a);return}if(t._queue.length===0)return;let f=Xc(t);f===No?ql(t):Ll(t,f)}function Wr(t,a){t._controlledWritableStream._state==="writable"&&Do(t,a)}function ql(t){let a=t._controlledWritableStream;Al(a),$s(t);let c=t._closeAlgorithm();wn(t),R(c,()=>(Cl(a),null),f=>(El(a,f),null))}function Ll(t,a){let c=t._controlledWritableStream;$l(c);let f=t._writeAlgorithm(a);R(f,()=>{Rl(c);let m=c._state;if($s(t),!Fe(c)&&m==="writable"){let g=Hs(t);zs(c,g)}return Sn(t),null},m=>(c._state==="writable"&&wn(t),Tl(c,m),null))}function Hs(t){return Wo(t)<=0}function Do(t,a){let c=t._controlledWritableStream;wn(t),Ls(c,a)}function vn(t){return new TypeError(`WritableStream.prototype.${t} can only be used on a WritableStream`)}function Vs(t){return new TypeError(`WritableStreamDefaultController.prototype.${t} can only be used on a WritableStreamDefaultController`)}function jt(t){return new TypeError(`WritableStreamDefaultWriter.prototype.${t} can only be used on a WritableStreamDefaultWriter`)}function Dr(t){return new TypeError("Cannot "+t+" a stream using a released writer")}function xn(t){t._closedPromise=p((a,c)=>{t._closedPromise_resolve=a,t._closedPromise_reject=c,t._closedPromiseState="pending"})}function Fo(t,a){xn(t),Zs(t,a)}function Ml(t){xn(t),qo(t)}function Zs(t,a){t._closedPromise_reject!==void 0&&(q(t._closedPromise),t._closedPromise_reject(a),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="rejected")}function zl(t,a){Fo(t,a)}function qo(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="resolved")}function kn(t){t._readyPromise=p((a,c)=>{t._readyPromise_resolve=a,t._readyPromise_reject=c}),t._readyPromiseState="pending"}function Js(t,a){kn(t),Mo(t,a)}function Lo(t){kn(t),Ys(t)}function Mo(t,a){t._readyPromise_reject!==void 0&&(q(t._readyPromise),t._readyPromise_reject(a),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="rejected")}function Ul(t){kn(t)}function Hl(t,a){Js(t,a)}function Ys(t){t._readyPromise_resolve!==void 0&&(t._readyPromise_resolve(void 0),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="fulfilled")}function Vl(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Gs=Vl();function Zl(t){if(!(typeof t=="function"||typeof t=="object")||t.name!=="DOMException")return!1;try{return new t,!0}catch{return!1}}function Jl(){let t=Gs?.DOMException;return Zl(t)?t:void 0}function Yl(){let t=function(c,f){this.message=c||"",this.name=f||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o(t,"DOMException"),t.prototype=Object.create(Error.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,configurable:!0}),t}let Gl=Jl()||Yl();function zo(t,a,c,f,m,g){let b=ar(t),v=Eo(a);t._disturbed=!0;let $=!1,C=d(void 0);return p((O,B)=>{let U;if(g!==void 0){if(U=()=>{let E=g.reason!==void 0?g.reason:new Gl("Aborted","AbortError"),D=[];f||D.push(()=>a._state==="writable"?bn(a,E):d(void 0)),m||D.push(()=>t._state==="readable"?Pe(t,E):d(void 0)),ce(()=>Promise.all(D.map(H=>H())),!0,E)},g.aborted){U();return}g.addEventListener("abort",U)}function Ae(){return p((E,D)=>{function H(pe){pe?E():S(pr(),H,D)}H(!1)})}function pr(){return $?d(!0):S(v._readyPromise,()=>p((E,D)=>{Or(b,{_chunkSteps:H=>{C=S(Io(v,H),void 0,e),E(!1)},_closeSteps:()=>E(!0),_errorSteps:D})}))}if(Xe(t,b._closedPromise,E=>(f?Se(!0,E):ce(()=>bn(a,E),!0,E),null)),Xe(a,v._closedPromise,E=>(m?Se(!0,E):ce(()=>Pe(t,E),!0,E),null)),oe(t,b._closedPromise,()=>(c?Se():ce(()=>jl(v)),null)),Fe(a)||a._state==="closed"){let E=new TypeError("the destination writable stream closed before all data could be piped to it");m?Se(!0,E):ce(()=>Pe(t,E),!0,E)}q(Ae());function _t(){let E=C;return S(C,()=>E!==C?_t():void 0)}function Xe(E,D,H){E._state==="errored"?H(E._storedError):k(D,H)}function oe(E,D,H){E._state==="closed"?H():j(D,H)}function ce(E,D,H){if($)return;$=!0,a._state==="writable"&&!Fe(a)?j(_t(),pe):pe();function pe(){return R(E(),()=>et(D,H),hr=>et(!0,hr)),null}}function Se(E,D){$||($=!0,a._state==="writable"&&!Fe(a)?j(_t(),()=>et(E,D)):et(E,D))}function et(E,D){return jo(v),Ze(b),g!==void 0&&g.removeEventListener("abort",U),E?B(D):O(void 0),null}})}class Ke{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Rn(this))throw Cn("desiredSize");return Qs(this)}close(){if(!Rn(this))throw Cn("close");if(!dr(this))throw new TypeError("The stream is not in a state that permits close");It(this)}enqueue(a=void 0){if(!Rn(this))throw Cn("enqueue");if(!dr(this))throw new TypeError("The stream is not in a state that permits enqueue");return ur(this,a)}error(a=void 0){if(!Rn(this))throw Cn("error");Ee(this,a)}[$r](a){pt(this);let c=this._cancelAlgorithm(a);return Tn(this),c}[gs](a){let c=this._controlledReadableStream;if(this._queue.length>0){let f=$s(this);this._closeRequested&&this._queue.length===0?(Tn(this),Lr(c)):Fr(this),a._chunkSteps(f)}else Qa(c,a),Fr(this)}[bs](){}}Object.defineProperties(Ke.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Ke.prototype.close,"close"),o(Ke.prototype.enqueue,"enqueue"),o(Ke.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ke.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Rn(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledReadableStream")?!1:t instanceof Ke}function Fr(t){if(!Uo(t))return;if(t._pulling){t._pullAgain=!0;return}t._pulling=!0;let c=t._pullAlgorithm();R(c,()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,Fr(t)),null),f=>(Ee(t,f),null))}function Uo(t){let a=t._controlledReadableStream;return!dr(t)||!t._started?!1:!!(gt(a)&&on(a)>0||Qs(t)>0)}function Tn(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function It(t){if(!dr(t))return;let a=t._controlledReadableStream;t._closeRequested=!0,t._queue.length===0&&(Tn(t),Lr(a))}function ur(t,a){if(!dr(t))return;let c=t._controlledReadableStream;if(gt(c)&&on(c)>0)Ts(c,a,!1);else{let f;try{f=t._strategySizeAlgorithm(a)}catch(m){throw Ee(t,m),m}try{Os(t,a,f)}catch(m){throw Ee(t,m),m}}Fr(t)}function Ee(t,a){let c=t._controlledReadableStream;c._state==="readable"&&(pt(t),Tn(t),Jo(c,a))}function Qs(t){let a=t._controlledReadableStream._state;return a==="errored"?null:a==="closed"?0:t._strategyHWM-t._queueTotalSize}function Ql(t){return!Uo(t)}function dr(t){let a=t._controlledReadableStream._state;return!t._closeRequested&&a==="readable"}function Ho(t,a,c,f,m,g,b){a._controlledReadableStream=t,a._queue=void 0,a._queueTotalSize=void 0,pt(a),a._started=!1,a._closeRequested=!1,a._pullAgain=!1,a._pulling=!1,a._strategySizeAlgorithm=b,a._strategyHWM=g,a._pullAlgorithm=f,a._cancelAlgorithm=m,t._readableStreamController=a;let v=c();R(d(v),()=>(a._started=!0,Fr(a),null),$=>(Ee(a,$),null))}function Kl(t,a,c,f){let m=Object.create(Ke.prototype),g,b,v;a.start!==void 0?g=()=>a.start(m):g=()=>{},a.pull!==void 0?b=()=>a.pull(m):b=()=>d(void 0),a.cancel!==void 0?v=$=>a.cancel($):v=()=>d(void 0),Ho(t,m,g,b,v,c,f)}function Cn(t){return new TypeError(`ReadableStreamDefaultController.prototype.${t} can only be used on a ReadableStreamDefaultController`)}function Xl(t,a){return Pt(t._readableStreamController)?tu(t):eu(t)}function eu(t,a){let c=ar(t),f=!1,m=!1,g=!1,b=!1,v,$,C,O,B,U=p(oe=>{B=oe});function Ae(){return f?(m=!0,d(void 0)):(f=!0,Or(c,{_chunkSteps:ce=>{F(()=>{m=!1;let Se=ce,et=ce;g||ur(C._readableStreamController,Se),b||ur(O._readableStreamController,et),f=!1,m&&Ae()})},_closeSteps:()=>{f=!1,g||It(C._readableStreamController),b||It(O._readableStreamController),(!g||!b)&&B(void 0)},_errorSteps:()=>{f=!1}}),d(void 0))}function pr(oe){if(g=!0,v=oe,b){let ce=jr([v,$]),Se=Pe(t,ce);B(Se)}return U}function _t(oe){if(b=!0,$=oe,g){let ce=jr([v,$]),Se=Pe(t,ce);B(Se)}return U}function Xe(){}return C=qr(Xe,Ae,pr),O=qr(Xe,Ae,_t),k(c._closedPromise,oe=>(Ee(C._readableStreamController,oe),Ee(O._readableStreamController,oe),(!g||!b)&&B(void 0),null)),[C,O]}function tu(t){let a=ar(t),c=!1,f=!1,m=!1,g=!1,b=!1,v,$,C,O,B,U=p(E=>{B=E});function Ae(E){k(E._closedPromise,D=>(E!==a||(we(C._readableStreamController,D),we(O._readableStreamController,D),(!g||!b)&&B(void 0)),null))}function pr(){$t(a)&&(Ze(a),a=ar(t),Ae(a)),Or(a,{_chunkSteps:D=>{F(()=>{f=!1,m=!1;let H=D,pe=D;if(!g&&!b)try{pe=co(D)}catch(hr){we(C._readableStreamController,hr),we(O._readableStreamController,hr),B(Pe(t,hr));return}g||fn(C._readableStreamController,H),b||fn(O._readableStreamController,pe),c=!1,f?Xe():m&&oe()})},_closeSteps:()=>{c=!1,g||Ir(C._readableStreamController),b||Ir(O._readableStreamController),C._readableStreamController._pendingPullIntos.length>0&&pn(C._readableStreamController,0),O._readableStreamController._pendingPullIntos.length>0&&pn(O._readableStreamController,0),(!g||!b)&&B(void 0)},_errorSteps:()=>{c=!1}})}function _t(E,D){dt(a)&&(Ze(a),a=vo(t),Ae(a));let H=D?O:C,pe=D?C:O;Ro(a,E,1,{_chunkSteps:mr=>{F(()=>{f=!1,m=!1;let yr=D?b:g;if(D?g:b)yr||hn(H._readableStreamController,mr);else{let ii;try{ii=co(mr)}catch(ra){we(H._readableStreamController,ra),we(pe._readableStreamController,ra),B(Pe(t,ra));return}yr||hn(H._readableStreamController,mr),fn(pe._readableStreamController,ii)}c=!1,f?Xe():m&&oe()})},_closeSteps:mr=>{c=!1;let yr=D?b:g,Nn=D?g:b;yr||Ir(H._readableStreamController),Nn||Ir(pe._readableStreamController),mr!==void 0&&(yr||hn(H._readableStreamController,mr),!Nn&&pe._readableStreamController._pendingPullIntos.length>0&&pn(pe._readableStreamController,0)),(!yr||!Nn)&&B(void 0)},_errorSteps:()=>{c=!1}})}function Xe(){if(c)return f=!0,d(void 0);c=!0;let E=Ws(C._readableStreamController);return E===null?pr():_t(E._view,!1),d(void 0)}function oe(){if(c)return m=!0,d(void 0);c=!0;let E=Ws(O._readableStreamController);return E===null?pr():_t(E._view,!0),d(void 0)}function ce(E){if(g=!0,v=E,b){let D=jr([v,$]),H=Pe(t,D);B(H)}return U}function Se(E){if(b=!0,$=E,g){let D=jr([v,$]),H=Pe(t,D);B(H)}return U}function et(){}return C=Zo(et,Xe,ce),O=Zo(et,oe,Se),Ae(a),[C,O]}function ru(t){return r(t)&&typeof t.getReader<"u"}function nu(t){return ru(t)?au(t.getReader()):su(t)}function su(t){let a,c=io(t,"async"),f=e;function m(){let b;try{b=Yc(c)}catch($){return y($)}let v=d(b);return z(v,$=>{if(!r($))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Gc($))It(a._readableStreamController);else{let O=Qc($);ur(a._readableStreamController,O)}})}function g(b){let v=c.iterator,$;try{$=ln(v,"return")}catch(B){return y(B)}if($===void 0)return d(void 0);let C;try{C=Z($,v,[b])}catch(B){return y(B)}let O=d(C);return z(O,B=>{if(!r(B))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return a=qr(f,m,g,0),a}function au(t){let a,c=e;function f(){let g;try{g=t.read()}catch(b){return y(b)}return z(g,b=>{if(!r(b))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(b.done)It(a._readableStreamController);else{let v=b.value;ur(a._readableStreamController,v)}})}function m(g){try{return d(t.cancel(g))}catch(b){return y(b)}}return a=qr(c,f,m,0),a}function ou(t,a){De(t,a);let c=t,f=c?.autoAllocateChunkSize,m=c?.cancel,g=c?.pull,b=c?.start,v=c?.type;return{autoAllocateChunkSize:f===void 0?void 0:ks(f,`${a} has member 'autoAllocateChunkSize' that`),cancel:m===void 0?void 0:iu(m,c,`${a} has member 'cancel' that`),pull:g===void 0?void 0:cu(g,c,`${a} has member 'pull' that`),start:b===void 0?void 0:lu(b,c,`${a} has member 'start' that`),type:v===void 0?void 0:uu(v,`${a} has member 'type' that`)}}function iu(t,a,c){return _e(t,c),f=>X(t,a,[f])}function cu(t,a,c){return _e(t,c),f=>X(t,a,[f])}function lu(t,a,c){return _e(t,c),f=>Z(t,a,[f])}function uu(t,a){if(t=`${t}`,t!=="bytes")throw new TypeError(`${a} '${t}' is not a valid enumeration value for ReadableStreamType`);return t}function du(t,a){return De(t,a),{preventCancel:!!t?.preventCancel}}function Vo(t,a){De(t,a);let c=t?.preventAbort,f=t?.preventCancel,m=t?.preventClose,g=t?.signal;return g!==void 0&&fu(g,`${a} has member 'signal' that`),{preventAbort:!!c,preventCancel:!!f,preventClose:!!m,signal:g}}function fu(t,a){if(!wl(t))throw new TypeError(`${a} is not an AbortSignal.`)}function pu(t,a){De(t,a);let c=t?.readable;vs(c,"readable","ReadableWritablePair"),Rs(c,`${a} has member 'readable' that`);let f=t?.writable;return vs(f,"writable","ReadableWritablePair"),Co(f,`${a} has member 'writable' that`),{readable:c,writable:f}}class ne{constructor(a={},c={}){a===void 0?a=null:Ya(a,"First parameter");let f=gn(c,"Second parameter"),m=ou(a,"First parameter");if(Ks(this),m.type==="bytes"){if(f.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let g=Br(f,0);il(this,m,g)}else{let g=yn(f),b=Br(f,1);Kl(this,m,b,g)}}get locked(){if(!yt(this))throw Nt("locked");return gt(this)}cancel(a=void 0){return yt(this)?gt(this)?y(new TypeError("Cannot cancel a stream that already has a reader")):Pe(this,a):y(Nt("cancel"))}getReader(a=void 0){if(!yt(this))throw Nt("getReader");return ll(a,"First parameter").mode===void 0?ar(this):vo(this)}pipeThrough(a,c={}){if(!yt(this))throw Nt("pipeThrough");Je(a,1,"pipeThrough");let f=pu(a,"First parameter"),m=Vo(c,"Second parameter");if(gt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(cr(f.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let g=zo(this,f.writable,m.preventClose,m.preventAbort,m.preventCancel,m.signal);return q(g),f.readable}pipeTo(a,c={}){if(!yt(this))return y(Nt("pipeTo"));if(a===void 0)return y("Parameter 1 is required in 'pipeTo'.");if(!ir(a))return y(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let f;try{f=Vo(c,"Second parameter")}catch(m){return y(m)}return gt(this)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):cr(a)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):zo(this,a,f.preventClose,f.preventAbort,f.preventCancel,f.signal)}tee(){if(!yt(this))throw Nt("tee");let a=Xl(this);return jr(a)}values(a=void 0){if(!yt(this))throw Nt("values");let c=du(a,"First parameter");return Zc(this,c.preventCancel)}[As](a){return this.values(a)}static from(a){return nu(a)}}Object.defineProperties(ne,{from:{enumerable:!0}}),Object.defineProperties(ne.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),o(ne.from,"from"),o(ne.prototype.cancel,"cancel"),o(ne.prototype.getReader,"getReader"),o(ne.prototype.pipeThrough,"pipeThrough"),o(ne.prototype.pipeTo,"pipeTo"),o(ne.prototype.tee,"tee"),o(ne.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ne.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ne.prototype,As,{value:ne.prototype.values,writable:!0,configurable:!0});function qr(t,a,c,f=1,m=()=>1){let g=Object.create(ne.prototype);Ks(g);let b=Object.create(Ke.prototype);return Ho(g,b,t,a,c,f,m),g}function Zo(t,a,c){let f=Object.create(ne.prototype);Ks(f);let m=Object.create(Ge.prototype);return So(f,m,t,a,c,0,void 0),f}function Ks(t){t._state="readable",t._reader=void 0,t._storedError=void 0,t._disturbed=!1}function yt(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_readableStreamController")?!1:t instanceof ne}function gt(t){return t._reader!==void 0}function Pe(t,a){if(t._disturbed=!0,t._state==="closed")return d(void 0);if(t._state==="errored")return y(t._storedError);Lr(t);let c=t._reader;if(c!==void 0&&$t(c)){let m=c._readIntoRequests;c._readIntoRequests=new M,m.forEach(g=>{g._closeSteps(void 0)})}let f=t._readableStreamController[$r](a);return z(f,e)}function Lr(t){t._state="closed";let a=t._reader;if(a!==void 0&&(Za(a),dt(a))){let c=a._readRequests;a._readRequests=new M,c.forEach(f=>{f._closeSteps()})}}function Jo(t,a){t._state="errored",t._storedError=a;let c=t._reader;c!==void 0&&(Ss(c,a),dt(c)?Xa(c,a):To(c,a))}function Nt(t){return new TypeError(`ReadableStream.prototype.${t} can only be used on a ReadableStream`)}function Yo(t,a){De(t,a);let c=t?.highWaterMark;return vs(c,"highWaterMark","QueuingStrategyInit"),{highWaterMark:xs(c)}}let Go=t=>t.byteLength;o(Go,"size");class En{constructor(a){Je(a,1,"ByteLengthQueuingStrategy"),a=Yo(a,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!Ko(this))throw Qo("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Ko(this))throw Qo("size");return Go}}Object.defineProperties(En.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(En.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Qo(t){return new TypeError(`ByteLengthQueuingStrategy.prototype.${t} can only be used on a ByteLengthQueuingStrategy`)}function Ko(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_byteLengthQueuingStrategyHighWaterMark")?!1:t instanceof En}let Xo=()=>1;o(Xo,"size");class Pn{constructor(a){Je(a,1,"CountQueuingStrategy"),a=Yo(a,"First parameter"),this._countQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!ti(this))throw ei("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!ti(this))throw ei("size");return Xo}}Object.defineProperties(Pn.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Pn.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function ei(t){return new TypeError(`CountQueuingStrategy.prototype.${t} can only be used on a CountQueuingStrategy`)}function ti(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_countQueuingStrategyHighWaterMark")?!1:t instanceof Pn}function hu(t,a){De(t,a);let c=t?.cancel,f=t?.flush,m=t?.readableType,g=t?.start,b=t?.transform,v=t?.writableType;return{cancel:c===void 0?void 0:bu(c,t,`${a} has member 'cancel' that`),flush:f===void 0?void 0:mu(f,t,`${a} has member 'flush' that`),readableType:m,start:g===void 0?void 0:yu(g,t,`${a} has member 'start' that`),transform:b===void 0?void 0:gu(b,t,`${a} has member 'transform' that`),writableType:v}}function mu(t,a,c){return _e(t,c),f=>X(t,a,[f])}function yu(t,a,c){return _e(t,c),f=>Z(t,a,[f])}function gu(t,a,c){return _e(t,c),(f,m)=>X(t,a,[f,m])}function bu(t,a,c){return _e(t,c),f=>X(t,a,[f])}class An{constructor(a={},c={},f={}){a===void 0&&(a=null);let m=gn(c,"Second parameter"),g=gn(f,"Third parameter"),b=hu(a,"First parameter");if(b.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(b.writableType!==void 0)throw new RangeError("Invalid writableType specified");let v=Br(g,0),$=yn(g),C=Br(m,1),O=yn(m),B,U=p(Ae=>{B=Ae});_u(this,U,C,O,v,$),Su(this,b),b.start!==void 0?B(b.start(this._transformStreamController)):B(void 0)}get readable(){if(!ri(this))throw oi("readable");return this._readable}get writable(){if(!ri(this))throw oi("writable");return this._writable}}Object.defineProperties(An.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(An.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function _u(t,a,c,f,m,g){function b(){return a}function v(U){return ku(t,U)}function $(U){return Ru(t,U)}function C(){return Tu(t)}t._writable=xl(b,v,C,$,c,f);function O(){return Cu(t)}function B(U){return Eu(t,U)}t._readable=qr(b,O,B,m,g),t._backpressure=void 0,t._backpressureChangePromise=void 0,t._backpressureChangePromise_resolve=void 0,$n(t,!0),t._transformStreamController=void 0}function ri(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_transformStreamController")?!1:t instanceof An}function ni(t,a){Ee(t._readable._readableStreamController,a),Xs(t,a)}function Xs(t,a){jn(t._transformStreamController),Wr(t._writable._writableStreamController,a),ea(t)}function ea(t){t._backpressure&&$n(t,!1)}function $n(t,a){t._backpressureChangePromise!==void 0&&t._backpressureChangePromise_resolve(),t._backpressureChangePromise=p(c=>{t._backpressureChangePromise_resolve=c}),t._backpressure=a}class bt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!On(this))throw In("desiredSize");let a=this._controlledTransformStream._readable._readableStreamController;return Qs(a)}enqueue(a=void 0){if(!On(this))throw In("enqueue");si(this,a)}error(a=void 0){if(!On(this))throw In("error");vu(this,a)}terminate(){if(!On(this))throw In("terminate");xu(this)}}Object.defineProperties(bt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),o(bt.prototype.enqueue,"enqueue"),o(bt.prototype.error,"error"),o(bt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(bt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function On(t){return!r(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledTransformStream")?!1:t instanceof bt}function wu(t,a,c,f,m){a._controlledTransformStream=t,t._transformStreamController=a,a._transformAlgorithm=c,a._flushAlgorithm=f,a._cancelAlgorithm=m,a._finishPromise=void 0,a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0}function Su(t,a){let c=Object.create(bt.prototype),f,m,g;a.transform!==void 0?f=b=>a.transform(b,c):f=b=>{try{return si(c,b),d(void 0)}catch(v){return y(v)}},a.flush!==void 0?m=()=>a.flush(c):m=()=>d(void 0),a.cancel!==void 0?g=b=>a.cancel(b):g=()=>d(void 0),wu(t,c,f,m,g)}function jn(t){t._transformAlgorithm=void 0,t._flushAlgorithm=void 0,t._cancelAlgorithm=void 0}function si(t,a){let c=t._controlledTransformStream,f=c._readable._readableStreamController;if(!dr(f))throw new TypeError("Readable side is not in a state that permits enqueue");try{ur(f,a)}catch(g){throw Xs(c,g),c._readable._storedError}Ql(f)!==c._backpressure&&$n(c,!0)}function vu(t,a){ni(t._controlledTransformStream,a)}function ai(t,a){let c=t._transformAlgorithm(a);return z(c,void 0,f=>{throw ni(t._controlledTransformStream,f),f})}function xu(t){let a=t._controlledTransformStream,c=a._readable._readableStreamController;It(c);let f=new TypeError("TransformStream terminated");Xs(a,f)}function ku(t,a){let c=t._transformStreamController;if(t._backpressure){let f=t._backpressureChangePromise;return z(f,()=>{let m=t._writable;if(m._state==="erroring")throw m._storedError;return ai(c,a)})}return ai(c,a)}function Ru(t,a){let c=t._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let f=t._readable;c._finishPromise=p((g,b)=>{c._finishPromise_resolve=g,c._finishPromise_reject=b});let m=c._cancelAlgorithm(a);return jn(c),R(m,()=>(f._state==="errored"?fr(c,f._storedError):(Ee(f._readableStreamController,a),ta(c)),null),g=>(Ee(f._readableStreamController,g),fr(c,g),null)),c._finishPromise}function Tu(t){let a=t._transformStreamController;if(a._finishPromise!==void 0)return a._finishPromise;let c=t._readable;a._finishPromise=p((m,g)=>{a._finishPromise_resolve=m,a._finishPromise_reject=g});let f=a._flushAlgorithm();return jn(a),R(f,()=>(c._state==="errored"?fr(a,c._storedError):(It(c._readableStreamController),ta(a)),null),m=>(Ee(c._readableStreamController,m),fr(a,m),null)),a._finishPromise}function Cu(t){return $n(t,!1),t._backpressureChangePromise}function Eu(t,a){let c=t._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let f=t._writable;c._finishPromise=p((g,b)=>{c._finishPromise_resolve=g,c._finishPromise_reject=b});let m=c._cancelAlgorithm(a);return jn(c),R(m,()=>(f._state==="errored"?fr(c,f._storedError):(Wr(f._writableStreamController,a),ea(t),ta(c)),null),g=>(Wr(f._writableStreamController,g),ea(t),fr(c,g),null)),c._finishPromise}function In(t){return new TypeError(`TransformStreamDefaultController.prototype.${t} can only be used on a TransformStreamDefaultController`)}function ta(t){t._finishPromise_resolve!==void 0&&(t._finishPromise_resolve(),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function fr(t,a){t._finishPromise_reject!==void 0&&(q(t._finishPromise),t._finishPromise_reject(a),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function oi(t){return new TypeError(`TransformStream.prototype.${t} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=En,n.CountQueuingStrategy=Pn,n.ReadableByteStreamController=Ge,n.ReadableStream=ne,n.ReadableStreamBYOBReader=ht,n.ReadableStreamBYOBRequest=Et,n.ReadableStreamDefaultController=Ke,n.ReadableStreamDefaultReader=ut,n.TransformStream=An,n.TransformStreamDefaultController=bt,n.WritableStream=mt,n.WritableStreamDefaultController=lr,n.WritableStreamDefaultWriter=Qe}))});var Ni=sa(()=>{if(!globalThis.ReadableStream)try{let n=require("node:process"),{emitWarning:e}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),n.emitWarning=e}catch(r){throw n.emitWarning=e,r}}catch{Object.assign(globalThis,Ii())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(r){let s=0,o=this;return new ReadableStream({type:"bytes",async pull(i){let u=await o.slice(s,Math.min(o.size,s+65536)).arrayBuffer();s+=u.byteLength,i.enqueue(new Uint8Array(u)),s===o.size&&i.close()}})})}catch{}});async function*ga(n,e=!0){for(let r of n)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(e){let s=r.byteOffset,o=r.byteOffset+r.byteLength;for(;s!==o;){let i=Math.min(o-s,Bi),l=r.buffer.slice(s,s+i);s+=l.byteLength,yield new Uint8Array(l)}}else yield r;else{let s=0,o=r;for(;s!==o.size;){let l=await o.slice(s,Math.min(o.size,s+Bi)).arrayBuffer();s+=l.byteLength,yield new Uint8Array(l)}}}var Yh,Bi,Wi,Df,Ne,Zr=Q(()=>{Yh=$e(Ni(),1);Bi=65536;Wi=class ba{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],r={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof r!="object"&&typeof r!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");r===null&&(r={});let s=new TextEncoder;for(let i of e){let l;ArrayBuffer.isView(i)?l=new Uint8Array(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)):i instanceof ArrayBuffer?l=new Uint8Array(i.slice(0)):i instanceof ba?l=i:l=s.encode(`${i}`),this.#r+=ArrayBuffer.isView(l)?l.byteLength:l.size,this.#e.push(l)}this.#n=`${r.endings===void 0?"transparent":r.endings}`;let o=r.type===void 0?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,r="";for await(let s of ga(this.#e,!1))r+=e.decode(s,{stream:!0});return r+=e.decode(),r}async arrayBuffer(){let e=new Uint8Array(this.size),r=0;for await(let s of ga(this.#e,!1))e.set(s,r),r+=s.length;return e.buffer}stream(){let e=ga(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(r){let s=await e.next();s.done?r.close():r.enqueue(s.value)},async cancel(){await e.return()}})}slice(e=0,r=this.size,s=""){let{size:o}=this,i=e<0?Math.max(o+e,0):Math.min(e,o),l=r<0?Math.max(o+r,0):Math.min(r,o),u=Math.max(l-i,0),p=this.#e,d=[],y=0;for(let R of p){if(y>=u)break;let j=ArrayBuffer.isView(R)?R.byteLength:R.size;if(i&&j<=i)i-=j,l-=j;else{let k;ArrayBuffer.isView(R)?(k=R.subarray(i,Math.min(j,l)),y+=k.byteLength):(k=R.slice(i,Math.min(j,l)),y+=k.size),l-=j,d.push(k),i=0}}let S=new ba([],{type:String(s).toLowerCase()});return S.#r=u,S.#e=d,S}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Wi.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Df=Wi,Ne=Df});var Ff,qf,kt,_a=Q(()=>{Zr();Ff=class extends Ne{#e=0;#t="";constructor(e,r,s={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,s),s===null&&(s={});let o=s.lastModified===void 0?Date.now():Number(s.lastModified);Number.isNaN(o)||(this.#e=o),this.#t=String(r)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Ne&&/^(File)$/.test(e[Symbol.toStringTag])}},qf=Ff,kt=qf});function qi(n,e=Ne){var r=`${Di()}${Di()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],o=`--${r}\r
Content-Disposition: form-data; name="`;return n.forEach((i,l)=>typeof i=="string"?s.push(o+wa(l)+`"\r
\r
${i.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):s.push(o+wa(l)+`"; filename="${wa(i.name,1)}"\r
Content-Type: ${i.type||"application/octet-stream"}\r
\r
`,i,`\r
`)),s.push(`--${r}--`),new e(s,{type:"multipart/form-data; boundary="+r})}var Jr,Lf,Mf,Di,zf,Fi,wa,Kt,Rt,rs=Q(()=>{Zr();_a();({toStringTag:Jr,iterator:Lf,hasInstance:Mf}=Symbol),Di=Math.random,zf="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Fi=(n,e,r)=>(n+="",/^(Blob|File)$/.test(e&&e[Jr])?[(r=r!==void 0?r+"":e[Jr]=="File"?e.name:"blob",n),e.name!==r||e[Jr]=="blob"?new kt([e],r,e):e]:[n,e+""]),wa=(n,e)=>(e?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Kt=(n,e,r)=>{if(e.length<r)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${r} arguments required, but only ${e.length} present.`)},Rt=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Jr](){return"FormData"}[Lf](){return this.entries()}static[Mf](e){return e&&typeof e=="object"&&e[Jr]==="FormData"&&!zf.some(r=>typeof e[r]!="function")}append(...e){Kt("append",arguments,2),this.#e.push(Fi(...e))}delete(e){Kt("delete",arguments,1),e+="",this.#e=this.#e.filter(([r])=>r!==e)}get(e){Kt("get",arguments,1),e+="";for(var r=this.#e,s=r.length,o=0;o<s;o++)if(r[o][0]===e)return r[o][1];return null}getAll(e,r){return Kt("getAll",arguments,1),r=[],e+="",this.#e.forEach(s=>s[0]===e&&r.push(s[1])),r}has(e){return Kt("has",arguments,1),e+="",this.#e.some(r=>r[0]===e)}forEach(e,r){Kt("forEach",arguments,1);for(var[s,o]of this)e.call(r,o,s,this)}set(...e){Kt("set",arguments,2);var r=[],s=!0;e=Fi(...e),this.#e.forEach(o=>{o[0]===e[0]?s&&(s=!r.push(e)):r.push(o)}),s&&r.push(e),this.#e=r}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var at,ns=Q(()=>{at=class extends Error{constructor(e,r){super(e),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var ie,Sa=Q(()=>{ns();ie=class extends at{constructor(e,r,s){super(e,r),s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}}});var ss,va,Yr,Li,Mi,zi,as=Q(()=>{ss=Symbol.toStringTag,va=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[ss]==="URLSearchParams",Yr=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[ss]),Li=n=>typeof n=="object"&&(n[ss]==="AbortSignal"||n[ss]==="EventTarget"),Mi=(n,e)=>{let r=new URL(e).hostname,s=new URL(n).hostname;return r===s||r.endsWith(`.${s}`)},zi=(n,e)=>{let r=new URL(e).protocol,s=new URL(n).protocol;return r===s}});var Hi=sa((cm,Ui)=>{if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),e=new n().port1,r=new ArrayBuffer;e.postMessage(r,[r,r])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}Ui.exports=globalThis.DOMException});var Xt,Vi,Zi,xa,Ji,Yi,Gi,Qi,Ki,Xi,os,ka=Q(()=>{Xt=require("node:fs"),Vi=require("node:path"),Zi=$e(Hi(),1);_a();Zr();({stat:xa}=Xt.promises),Ji=(n,e)=>Ki((0,Xt.statSync)(n),n,e),Yi=(n,e)=>xa(n).then(r=>Ki(r,n,e)),Gi=(n,e)=>xa(n).then(r=>Xi(r,n,e)),Qi=(n,e)=>Xi((0,Xt.statSync)(n),n,e),Ki=(n,e,r="")=>new Ne([new os({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],{type:r}),Xi=(n,e,r="")=>new kt([new os({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],(0,Vi.basename)(e),{type:r,lastModified:n.mtimeMs}),os=class n{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,r){return new n({path:this.#e,lastModified:this.lastModified,size:r-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await xa(this.#e);if(e>this.lastModified)throw new Zi.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Xt.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var tc={};aa(tc,{toFormData:()=>Gf});function Yf(n){let e=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let r=e[2]||e[3]||"",s=r.slice(r.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,(o,i)=>String.fromCharCode(i)),s}async function Gf(n,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let r=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");let s=new Ra(r[1]||r[2]),o,i,l,u,p,d,y=[],S=new Rt,R=F=>{l+=q.decode(F,{stream:!0})},j=F=>{y.push(F)},k=()=>{let F=new kt(y,d,{type:p});S.append(u,F)},z=()=>{S.append(u,l)},q=new TextDecoder("utf-8");q.decode(),s.onPartBegin=function(){s.onPartData=R,s.onPartEnd=z,o="",i="",l="",u="",p="",d=null,y.length=0},s.onHeaderField=function(F){o+=q.decode(F,{stream:!0})},s.onHeaderValue=function(F){i+=q.decode(F,{stream:!0})},s.onHeaderEnd=function(){if(i+=q.decode(),o=o.toLowerCase(),o==="content-disposition"){let F=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);F&&(u=F[2]||F[3]||""),d=Yf(i),d&&(s.onPartData=j,s.onPartEnd=k)}else o==="content-type"&&(p=i);i="",o=""};for await(let F of n)s.write(F);return s.end(),S}var Ue,V,ec,Tt,is,cs,Uf,Gr,Hf,Vf,Zf,Jf,er,Ra,rc=Q(()=>{ka();rs();Ue=0,V={START_BOUNDARY:Ue++,HEADER_FIELD_START:Ue++,HEADER_FIELD:Ue++,HEADER_VALUE_START:Ue++,HEADER_VALUE:Ue++,HEADER_VALUE_ALMOST_DONE:Ue++,HEADERS_ALMOST_DONE:Ue++,PART_DATA_START:Ue++,PART_DATA:Ue++,END:Ue++},ec=1,Tt={PART_BOUNDARY:ec,LAST_BOUNDARY:ec*=2},is=10,cs=13,Uf=32,Gr=45,Hf=58,Vf=97,Zf=122,Jf=n=>n|32,er=()=>{},Ra=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=er,this.onHeaderField=er,this.onHeadersEnd=er,this.onHeaderValue=er,this.onPartBegin=er,this.onPartData=er,this.onPartEnd=er,this.boundaryChars={},e=`\r
--`+e;let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s),this.boundaryChars[r[s]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=V.START_BOUNDARY}write(e){let r=0,s=e.length,o=this.index,{lookbehind:i,boundary:l,boundaryChars:u,index:p,state:d,flags:y}=this,S=this.boundary.length,R=S-1,j=e.length,k,z,q=L=>{this[L+"Mark"]=r},F=L=>{delete this[L+"Mark"]},Z=(L,M,J,lt)=>{(M===void 0||M!==J)&&this[L](lt&&lt.subarray(M,J))},X=(L,M)=>{let J=L+"Mark";J in this&&(M?(Z(L,this[J],r,e),delete this[J]):(Z(L,this[J],e.length,e),this[J]=0))};for(r=0;r<s;r++)switch(k=e[r],d){case V.START_BOUNDARY:if(p===l.length-2){if(k===Gr)y|=Tt.LAST_BOUNDARY;else if(k!==cs)return;p++;break}else if(p-1===l.length-2){if(y&Tt.LAST_BOUNDARY&&k===Gr)d=V.END,y=0;else if(!(y&Tt.LAST_BOUNDARY)&&k===is)p=0,Z("onPartBegin"),d=V.HEADER_FIELD_START;else return;break}k!==l[p+2]&&(p=-2),k===l[p+2]&&p++;break;case V.HEADER_FIELD_START:d=V.HEADER_FIELD,q("onHeaderField"),p=0;case V.HEADER_FIELD:if(k===cs){F("onHeaderField"),d=V.HEADERS_ALMOST_DONE;break}if(p++,k===Gr)break;if(k===Hf){if(p===1)return;X("onHeaderField",!0),d=V.HEADER_VALUE_START;break}if(z=Jf(k),z<Vf||z>Zf)return;break;case V.HEADER_VALUE_START:if(k===Uf)break;q("onHeaderValue"),d=V.HEADER_VALUE;case V.HEADER_VALUE:k===cs&&(X("onHeaderValue",!0),Z("onHeaderEnd"),d=V.HEADER_VALUE_ALMOST_DONE);break;case V.HEADER_VALUE_ALMOST_DONE:if(k!==is)return;d=V.HEADER_FIELD_START;break;case V.HEADERS_ALMOST_DONE:if(k!==is)return;Z("onHeadersEnd"),d=V.PART_DATA_START;break;case V.PART_DATA_START:d=V.PART_DATA,q("onPartData");case V.PART_DATA:if(o=p,p===0){for(r+=R;r<j&&!(e[r]in u);)r+=S;r-=R,k=e[r]}if(p<l.length)l[p]===k?(p===0&&X("onPartData",!0),p++):p=0;else if(p===l.length)p++,k===cs?y|=Tt.PART_BOUNDARY:k===Gr?y|=Tt.LAST_BOUNDARY:p=0;else if(p-1===l.length)if(y&Tt.PART_BOUNDARY){if(p=0,k===is){y&=~Tt.PART_BOUNDARY,Z("onPartEnd"),Z("onPartBegin"),d=V.HEADER_FIELD_START;break}}else y&Tt.LAST_BOUNDARY&&k===Gr?(Z("onPartEnd"),d=V.END,y=0):p=0;if(p>0)i[p-1]=k;else if(o>0){let L=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);Z("onPartData",0,o,L),o=0,q("onPartData"),r--}break;case V.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}X("onHeaderField"),X("onHeaderValue"),X("onPartData"),this.index=p,this.state=d,this.flags=y}end(){if(this.state===V.HEADER_FIELD_START&&this.index===0||this.state===V.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==V.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function Ta(n){if(n[de].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[de].disturbed=!0,n[de].error)throw n[de].error;let{body:e}=n;if(e===null)return me.Buffer.alloc(0);if(!(e instanceof Re.default))return me.Buffer.alloc(0);let r=[],s=0;try{for await(let o of e){if(n.size>0&&s+o.length>n.size){let i=new ie(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw e.destroy(i),i}s+=o.length,r.push(o)}}catch(o){throw o instanceof at?o:new ie(`Invalid response body while trying to fetch ${n.url}: ${o.message}`,"system",o)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return r.every(o=>typeof o=="string")?me.Buffer.from(r.join("")):me.Buffer.concat(r,s)}catch(o){throw new ie(`Could not create Buffer from response body for ${n.url}: ${o.message}`,"system",o)}else throw new ie(`Premature close of server response while trying to fetch ${n.url}`)}var Re,ot,me,Qf,de,He,Tr,Kf,ls,nc,sc,us=Q(()=>{Re=$e(require("node:stream"),1),ot=require("node:util"),me=require("node:buffer");Zr();rs();Sa();ns();as();Qf=(0,ot.promisify)(Re.default.pipeline),de=Symbol("Body internals"),He=class{constructor(e,{size:r=0}={}){let s=null;e===null?e=null:va(e)?e=me.Buffer.from(e.toString()):Yr(e)||me.Buffer.isBuffer(e)||(ot.types.isAnyArrayBuffer(e)?e=me.Buffer.from(e):ArrayBuffer.isView(e)?e=me.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Re.default||(e instanceof Rt?(e=qi(e),s=e.type.split("=")[1]):e=me.Buffer.from(String(e))));let o=e;me.Buffer.isBuffer(e)?o=Re.default.Readable.from(e):Yr(e)&&(o=Re.default.Readable.from(e.stream())),this[de]={body:e,stream:o,boundary:s,disturbed:!1,error:null},this.size=r,e instanceof Re.default&&e.on("error",i=>{let l=i instanceof at?i:new ie(`Invalid response body while trying to fetch ${this.url}: ${i.message}`,"system",i);this[de].error=l})}get body(){return this[de].stream}get bodyUsed(){return this[de].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:r,byteLength:s}=await Ta(this);return e.slice(r,r+s)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let s=new Rt,o=new URLSearchParams(await this.text());for(let[i,l]of o)s.append(i,l);return s}let{toFormData:r}=await Promise.resolve().then(()=>(rc(),tc));return r(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[de].body&&this[de].body.type||"",r=await this.arrayBuffer();return new Ne([r],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await Ta(this);return new TextDecoder().decode(e)}buffer(){return Ta(this)}};He.prototype.buffer=(0,ot.deprecate)(He.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(He.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,ot.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Tr=(n,e)=>{let r,s,{body:o}=n[de];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof Re.default&&typeof o.getBoundary!="function"&&(r=new Re.PassThrough({highWaterMark:e}),s=new Re.PassThrough({highWaterMark:e}),o.pipe(r),o.pipe(s),n[de].stream=r,o=s),o},Kf=(0,ot.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),ls=(n,e)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":va(n)?"application/x-www-form-urlencoded;charset=UTF-8":Yr(n)?n.type||null:me.Buffer.isBuffer(n)||ot.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof Rt?`multipart/form-data; boundary=${e[de].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${Kf(n)}`:n instanceof Re.default?null:"text/plain;charset=UTF-8",nc=n=>{let{body:e}=n[de];return e===null?0:Yr(e)?e.size:me.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},sc=async(n,{body:e})=>{e===null?n.end():await Qf(e,n)}});function ac(n=[]){return new fe(n.reduce((e,r,s,o)=>(s%2===0&&e.push(o.slice(s,s+2)),e),[]).filter(([e,r])=>{try{return ds(e),Ea(e,String(r)),!0}catch{return!1}}))}var Ca,Qr,ds,Ea,fe,fs=Q(()=>{Ca=require("node:util"),Qr=$e(require("node:http"),1),ds=typeof Qr.default.validateHeaderName=="function"?Qr.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let e=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},Ea=typeof Qr.default.validateHeaderValue=="function"?Qr.default.validateHeaderValue:(n,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let r=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},fe=class n extends URLSearchParams{constructor(e){let r=[];if(e instanceof n){let s=e.raw();for(let[o,i]of Object.entries(s))r.push(...i.map(l=>[o,l]))}else if(e!=null)if(typeof e=="object"&&!Ca.types.isBoxedPrimitive(e)){let s=e[Symbol.iterator];if(s==null)r.push(...Object.entries(e));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");r=[...e].map(o=>{if(typeof o!="object"||Ca.types.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([s,o])=>(ds(s),Ea(s,String(o)),[String(s).toLowerCase(),String(o)])):void 0,super(r),new Proxy(this,{get(s,o,i){switch(o){case"append":case"set":return(l,u)=>(ds(l),Ea(l,String(u)),URLSearchParams.prototype[o].call(s,String(l).toLowerCase(),String(u)));case"delete":case"has":case"getAll":return l=>(ds(l),URLSearchParams.prototype[o].call(s,String(l).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,o,i)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let r=this.getAll(e);if(r.length===0)return null;let s=r.join(", ");return/^content-encoding$/i.test(e)&&(s=s.toLowerCase()),s}forEach(e,r=void 0){for(let s of this.keys())Reflect.apply(e,r,[this.get(s),s,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,r)=>(e[r]=this.getAll(r),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,r)=>{let s=this.getAll(r);return r==="host"?e[r]=s[0]:e[r]=s.length>1?s:s[0],e},{})}};Object.defineProperties(fe.prototype,["get","entries","forEach","values"].reduce((n,e)=>(n[e]={enumerable:!0},n),{}))});var Xf,Kr,Pa=Q(()=>{Xf=new Set([301,302,303,307,308]),Kr=n=>Xf.has(n)});var Be,ye,oc=Q(()=>{fs();us();Pa();Be=Symbol("Response internals"),ye=class n extends He{constructor(e=null,r={}){super(e,r);let s=r.status!=null?r.status:200,o=new fe(r.headers);if(e!==null&&!o.has("Content-Type")){let i=ls(e,this);i&&o.append("Content-Type",i)}this[Be]={type:"default",url:r.url,status:s,statusText:r.statusText||"",headers:o,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[Be].type}get url(){return this[Be].url||""}get status(){return this[Be].status}get ok(){return this[Be].status>=200&&this[Be].status<300}get redirected(){return this[Be].counter>0}get statusText(){return this[Be].statusText}get headers(){return this[Be].headers}get highWaterMark(){return this[Be].highWaterMark}clone(){return new n(Tr(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,r=302){if(!Kr(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(e).toString()},status:r})}static error(){let e=new n(null,{status:0,statusText:""});return e[Be].type="error",e}static json(e=void 0,r={}){let s=JSON.stringify(e);if(s===void 0)throw new TypeError("data is not JSON serializable");let o=new fe(r&&r.headers);return o.has("content-type")||o.set("content-type","application/json"),new n(s,{...r,headers:o})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(ye.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var ic,cc=Q(()=>{ic=n=>{if(n.search)return n.search;let e=n.href.length-1,r=n.hash||(n.href[e]==="#"?"#":"");return n.href[e-r.length]==="?"?"?":""}});function lc(n,e=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",e&&(n.pathname="",n.search=""),n)}function pc(n){if(!dc.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function ep(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let e=n.host.replace(/(^\[)|(]$)/g,""),r=(0,uc.isIP)(e);return r===4&&/^127\./.test(e)||r===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function Cr(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:ep(n)}function hc(n,{referrerURLCallback:e,referrerOriginCallback:r}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let s=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let o=n.referrer,i=lc(o),l=lc(o,!0);i.toString().length>4096&&(i=l),e&&(i=e(i)),r&&(l=r(l));let u=new URL(n.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return l;case"unsafe-url":return i;case"strict-origin":return Cr(i)&&!Cr(u)?"no-referrer":l.toString();case"strict-origin-when-cross-origin":return i.origin===u.origin?i:Cr(i)&&!Cr(u)?"no-referrer":l;case"same-origin":return i.origin===u.origin?i:"no-referrer";case"origin-when-cross-origin":return i.origin===u.origin?i:l;case"no-referrer-when-downgrade":return Cr(i)&&!Cr(u)?"no-referrer":i;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}function mc(n){let e=(n.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let s of e)s&&dc.has(s)&&(r=s);return r}var uc,dc,fc,Aa=Q(()=>{uc=require("node:net");dc=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),fc="strict-origin-when-cross-origin"});var yc,gc,K,Xr,tp,Ct,bc,_c=Q(()=>{yc=require("node:url"),gc=require("node:util");fs();us();as();cc();Aa();K=Symbol("Request internals"),Xr=n=>typeof n=="object"&&typeof n[K]=="object",tp=(0,gc.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Ct=class n extends He{constructor(e,r={}){let s;if(Xr(e)?s=new URL(e.url):(s=new URL(e),e={}),s.username!==""||s.password!=="")throw new TypeError(`${s} is an url with embedded credentials.`);let o=r.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(o)&&(o=o.toUpperCase()),!Xr(r)&&"data"in r&&tp(),(r.body!=null||Xr(e)&&e.body!==null)&&(o==="GET"||o==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let i=r.body?r.body:Xr(e)&&e.body!==null?Tr(e):null;super(i,{size:r.size||e.size||0});let l=new fe(r.headers||e.headers||{});if(i!==null&&!l.has("Content-Type")){let d=ls(i,this);d&&l.set("Content-Type",d)}let u=Xr(e)?e.signal:null;if("signal"in r&&(u=r.signal),u!=null&&!Li(u))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let p=r.referrer==null?e.referrer:r.referrer;if(p==="")p="no-referrer";else if(p){let d=new URL(p);p=/^about:(\/\/)?client$/.test(d)?"client":d}else p=void 0;this[K]={method:o,redirect:r.redirect||e.redirect||"follow",headers:l,parsedURL:s,signal:u,referrer:p},this.follow=r.follow===void 0?e.follow===void 0?20:e.follow:r.follow,this.compress=r.compress===void 0?e.compress===void 0?!0:e.compress:r.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent,this.highWaterMark=r.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=r.referrerPolicy||e.referrerPolicy||""}get method(){return this[K].method}get url(){return(0,yc.format)(this[K].parsedURL)}get headers(){return this[K].headers}get redirect(){return this[K].redirect}get signal(){return this[K].signal}get referrer(){if(this[K].referrer==="no-referrer")return"";if(this[K].referrer==="client")return"about:client";if(this[K].referrer)return this[K].referrer.toString()}get referrerPolicy(){return this[K].referrerPolicy}set referrerPolicy(e){this[K].referrerPolicy=pc(e)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Ct.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});bc=n=>{let{parsedURL:e}=n[K],r=new fe(n[K].headers);r.has("Accept")||r.set("Accept","*/*");let s=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(s="0"),n.body!==null){let u=nc(n);typeof u=="number"&&!Number.isNaN(u)&&(s=String(u))}s&&r.set("Content-Length",s),n.referrerPolicy===""&&(n.referrerPolicy=fc),n.referrer&&n.referrer!=="no-referrer"?n[K].referrer=hc(n):n[K].referrer="no-referrer",n[K].referrer instanceof URL&&r.set("Referer",n.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),n.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=n;typeof o=="function"&&(o=o(e));let i=ic(e),l={path:e.pathname+i,method:n.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:o};return{parsedURL:e,options:l}}});var en,wc=Q(()=>{ns();en=class extends at{constructor(e,r="aborted"){super(e,r)}}});var $a={};aa($a,{AbortError:()=>en,Blob:()=>Ne,FetchError:()=>ie,File:()=>kt,FormData:()=>Rt,Headers:()=>fe,Request:()=>Ct,Response:()=>ye,blobFrom:()=>Yi,blobFromSync:()=>Ji,default:()=>it,fileFrom:()=>Gi,fileFromSync:()=>Qi,isRedirect:()=>Kr});async function it(n,e){return new Promise((r,s)=>{let o=new Ct(n,e),{parsedURL:i,options:l}=bc(o);if(!rp.has(i.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if(i.protocol==="data:"){let k=$i(o.url),z=new ye(k,{headers:{"Content-Type":k.typeFull}});r(z);return}let u=(i.protocol==="https:"?vc.default:Sc.default).request,{signal:p}=o,d=null,y=()=>{let k=new en("The operation was aborted.");s(k),o.body&&o.body instanceof ge.default.Readable&&o.body.destroy(k),!(!d||!d.body)&&d.body.emit("error",k)};if(p&&p.aborted){y();return}let S=()=>{y(),j()},R=u(i.toString(),l);p&&p.addEventListener("abort",S);let j=()=>{R.abort(),p&&p.removeEventListener("abort",S)};R.on("error",k=>{s(new ie(`request to ${o.url} failed, reason: ${k.message}`,"system",k)),j()}),np(R,k=>{d&&d.body&&d.body.destroy(k)}),process.version<"v14"&&R.on("socket",k=>{let z;k.prependListener("end",()=>{z=k._eventsCount}),k.prependListener("close",q=>{if(d&&z<k._eventsCount&&!q){let F=new Error("Premature close");F.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",F)}})}),R.on("response",k=>{R.setTimeout(0);let z=ac(k.rawHeaders);if(Kr(k.statusCode)){let L=z.get("Location"),M=null;try{M=L===null?null:new URL(L,o.url)}catch{if(o.redirect!=="manual"){s(new ie(`uri requested responds with an invalid redirect URL: ${L}`,"invalid-redirect")),j();return}}switch(o.redirect){case"error":s(new ie(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),j();return;case"manual":break;case"follow":{if(M===null)break;if(o.counter>=o.follow){s(new ie(`maximum redirect reached at: ${o.url}`,"max-redirect")),j();return}let J={headers:new fe(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:Tr(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!Mi(o.url,M)||!zi(o.url,M))for(let $r of["authorization","www-authenticate","cookie","cookie2"])J.headers.delete($r);if(k.statusCode!==303&&o.body&&e.body instanceof ge.default.Readable){s(new ie("Cannot follow redirect with body being a readable stream","unsupported-redirect")),j();return}(k.statusCode===303||(k.statusCode===301||k.statusCode===302)&&o.method==="POST")&&(J.method="GET",J.body=void 0,J.headers.delete("content-length"));let lt=mc(z);lt&&(J.referrerPolicy=lt),r(it(new Ct(M,J))),j();return}default:return s(new TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}p&&k.once("end",()=>{p.removeEventListener("abort",S)});let q=(0,ge.pipeline)(k,new ge.PassThrough,L=>{L&&s(L)});process.version<"v12.10"&&k.on("aborted",S);let F={url:o.url,status:k.statusCode,statusText:k.statusMessage,headers:z,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},Z=z.get("Content-Encoding");if(!o.compress||o.method==="HEAD"||Z===null||k.statusCode===204||k.statusCode===304){d=new ye(q,F),r(d);return}let X={flush:tr.default.Z_SYNC_FLUSH,finishFlush:tr.default.Z_SYNC_FLUSH};if(Z==="gzip"||Z==="x-gzip"){q=(0,ge.pipeline)(q,tr.default.createGunzip(X),L=>{L&&s(L)}),d=new ye(q,F),r(d);return}if(Z==="deflate"||Z==="x-deflate"){let L=(0,ge.pipeline)(k,new ge.PassThrough,M=>{M&&s(M)});L.once("data",M=>{(M[0]&15)===8?q=(0,ge.pipeline)(q,tr.default.createInflate(),J=>{J&&s(J)}):q=(0,ge.pipeline)(q,tr.default.createInflateRaw(),J=>{J&&s(J)}),d=new ye(q,F),r(d)}),L.once("end",()=>{d||(d=new ye(q,F),r(d))});return}if(Z==="br"){q=(0,ge.pipeline)(q,tr.default.createBrotliDecompress(),L=>{L&&s(L)}),d=new ye(q,F),r(d);return}d=new ye(q,F),r(d)}),sc(R,o).catch(s)})}function np(n,e){let r=tn.Buffer.from(`0\r
\r
`),s=!1,o=!1,i;n.on("response",l=>{let{headers:u}=l;s=u["transfer-encoding"]==="chunked"&&!u["content-length"]}),n.on("socket",l=>{let u=()=>{if(s&&!o){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},p=d=>{o=tn.Buffer.compare(d.slice(-5),r)===0,!o&&i&&(o=tn.Buffer.compare(i.slice(-3),r.slice(0,3))===0&&tn.Buffer.compare(d.slice(-2),r.slice(3))===0),i=d};l.prependListener("close",u),l.on("data",p),n.on("close",()=>{l.removeListener("close",u),l.removeListener("data",p)})})}var Sc,vc,tr,ge,tn,rp,rn=Q(()=>{Sc=$e(require("node:http"),1),vc=$e(require("node:https"),1),tr=$e(require("node:zlib"),1),ge=$e(require("node:stream"),1),tn=require("node:buffer");Oi();us();oc();fs();_c();Sa();wc();Pa();rs();as();Aa();ka();rp=new Set(["data:","http:","https:"])});var h={};aa(h,{BRAND:()=>od,DIRTY:()=>Bt,EMPTY_PATH:()=>Du,INVALID:()=>P,NEVER:()=>Ud,OK:()=>se,ParseStatus:()=>ee,Schema:()=>N,ZodAny:()=>vt,ZodArray:()=>st,ZodBigInt:()=>Dt,ZodBoolean:()=>Ft,ZodBranded:()=>zr,ZodCatch:()=>Gt,ZodDate:()=>qt,ZodDefault:()=>Yt,ZodDiscriminatedUnion:()=>Dn,ZodEffects:()=>ke,ZodEnum:()=>Zt,ZodError:()=>le,ZodFirstPartyTypeKind:()=>A,ZodFunction:()=>qn,ZodIntersection:()=>Ut,ZodIssueCode:()=>_,ZodLazy:()=>Ht,ZodLiteral:()=>Vt,ZodMap:()=>vr,ZodNaN:()=>kr,ZodNativeEnum:()=>Jt,ZodNever:()=>Oe,ZodNull:()=>Mt,ZodNullable:()=>Me,ZodNumber:()=>Wt,ZodObject:()=>ue,ZodOptional:()=>ve,ZodParsedType:()=>x,ZodPipeline:()=>Ur,ZodPromise:()=>xt,ZodReadonly:()=>Qt,ZodRecord:()=>Fn,ZodSchema:()=>N,ZodSet:()=>xr,ZodString:()=>St,ZodSymbol:()=>wr,ZodTransformer:()=>ke,ZodTuple:()=>Le,ZodType:()=>N,ZodUndefined:()=>Lt,ZodUnion:()=>zt,ZodUnknown:()=>nt,ZodVoid:()=>Sr,addIssueToContext:()=>w,any:()=>md,array:()=>_d,bigint:()=>ud,boolean:()=>bi,coerce:()=>zd,custom:()=>mi,date:()=>dd,datetimeRegex:()=>pi,defaultErrorMap:()=>tt,discriminatedUnion:()=>xd,effect:()=>Nd,enum:()=>Od,function:()=>Pd,getErrorMap:()=>gr,getParsedType:()=>qe,instanceof:()=>cd,intersection:()=>kd,isAborted:()=>Bn,isAsync:()=>br,isDirty:()=>Wn,isValid:()=>wt,late:()=>id,lazy:()=>Ad,literal:()=>$d,makeIssue:()=>Mr,map:()=>Cd,nan:()=>ld,nativeEnum:()=>jd,never:()=>gd,null:()=>hd,nullable:()=>Wd,number:()=>gi,object:()=>wd,objectUtil:()=>oa,oboolean:()=>Md,onumber:()=>Ld,optional:()=>Bd,ostring:()=>qd,pipeline:()=>Fd,preprocess:()=>Dd,promise:()=>Id,quotelessJson:()=>Nu,record:()=>Td,set:()=>Ed,setErrorMap:()=>Wu,strictObject:()=>Sd,string:()=>yi,symbol:()=>fd,transformer:()=>Nd,tuple:()=>Rd,undefined:()=>pd,union:()=>vd,unknown:()=>yd,util:()=>W,void:()=>bd});var W;(function(n){n.assertEqual=o=>{};function e(o){}n.assertIs=e;function r(o){throw new Error}n.assertNever=r,n.arrayToEnum=o=>{let i={};for(let l of o)i[l]=l;return i},n.getValidEnumValues=o=>{let i=n.objectKeys(o).filter(u=>typeof o[o[u]]!="number"),l={};for(let u of i)l[u]=o[u];return n.objectValues(l)},n.objectValues=o=>n.objectKeys(o).map(function(i){return o[i]}),n.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let i=[];for(let l in o)Object.prototype.hasOwnProperty.call(o,l)&&i.push(l);return i},n.find=(o,i)=>{for(let l of o)if(i(l))return l},n.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function s(o,i=" | "){return o.map(l=>typeof l=="string"?`'${l}'`:l).join(i)}n.joinValues=s,n.jsonStringifyReplacer=(o,i)=>typeof i=="bigint"?i.toString():i})(W||(W={}));var oa;(function(n){n.mergeShapes=(e,r)=>({...e,...r})})(oa||(oa={}));var x=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),qe=n=>{switch(typeof n){case"undefined":return x.undefined;case"string":return x.string;case"number":return Number.isNaN(n)?x.nan:x.number;case"boolean":return x.boolean;case"function":return x.function;case"bigint":return x.bigint;case"symbol":return x.symbol;case"object":return Array.isArray(n)?x.array:n===null?x.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?x.promise:typeof Map<"u"&&n instanceof Map?x.map:typeof Set<"u"&&n instanceof Set?x.set:typeof Date<"u"&&n instanceof Date?x.date:x.object;default:return x.unknown}};var _=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Nu=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),le=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},s={_errors:[]},o=i=>{for(let l of i.issues)if(l.code==="invalid_union")l.unionErrors.map(o);else if(l.code==="invalid_return_type")o(l.returnTypeError);else if(l.code==="invalid_arguments")o(l.argumentsError);else if(l.path.length===0)s._errors.push(r(l));else{let u=s,p=0;for(;p<l.path.length;){let d=l.path[p];p===l.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(r(l))):u[d]=u[d]||{_errors:[]},u=u[d],p++}}};return o(this),s}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},s=[];for(let o of this.issues)if(o.path.length>0){let i=o.path[0];r[i]=r[i]||[],r[i].push(e(o))}else s.push(e(o));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}};le.create=n=>new le(n);var Bu=(n,e)=>{let r;switch(n.code){case _.invalid_type:n.received===x.undefined?r="Required":r=`Expected ${n.expected}, received ${n.received}`;break;case _.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(n.expected,W.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:r=`Unrecognized key(s) in object: ${W.joinValues(n.keys,", ")}`;break;case _.invalid_union:r="Invalid input";break;case _.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${W.joinValues(n.options)}`;break;case _.invalid_enum_value:r=`Invalid enum value. Expected ${W.joinValues(n.options)}, received '${n.received}'`;break;case _.invalid_arguments:r="Invalid function arguments";break;case _.invalid_return_type:r="Invalid function return type";break;case _.invalid_date:r="Invalid date";break;case _.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(r=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?r=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?r=`Invalid input: must end with "${n.validation.endsWith}"`:W.assertNever(n.validation):n.validation!=="regex"?r=`Invalid ${n.validation}`:r="Invalid";break;case _.too_small:n.type==="array"?r=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?r=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?r=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?r=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?r=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:r="Invalid input";break;case _.too_big:n.type==="array"?r=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?r=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?r=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?r=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?r=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:r="Invalid input";break;case _.custom:r="Invalid input";break;case _.invalid_intersection_types:r="Intersection results could not be merged";break;case _.not_multiple_of:r=`Number must be a multiple of ${n.multipleOf}`;break;case _.not_finite:r="Number must be finite";break;default:r=e.defaultError,W.assertNever(n)}return{message:r}},tt=Bu;var ci=tt;function Wu(n){ci=n}function gr(){return ci}var Mr=n=>{let{data:e,path:r,errorMaps:s,issueData:o}=n,i=[...r,...o.path||[]],l={...o,path:i};if(o.message!==void 0)return{...o,path:i,message:o.message};let u="",p=s.filter(d=>!!d).slice().reverse();for(let d of p)u=d(l,{data:e,defaultError:u}).message;return{...o,path:i,message:u}},Du=[];function w(n,e){let r=gr(),s=Mr({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,r,r===tt?void 0:tt].filter(o=>!!o)});n.common.issues.push(s)}var ee=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let s=[];for(let o of r){if(o.status==="aborted")return P;o.status==="dirty"&&e.dirty(),s.push(o.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,r){let s=[];for(let o of r){let i=await o.key,l=await o.value;s.push({key:i,value:l})}return n.mergeObjectSync(e,s)}static mergeObjectSync(e,r){let s={};for(let o of r){let{key:i,value:l}=o;if(i.status==="aborted"||l.status==="aborted")return P;i.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof l.value<"u"||o.alwaysSet)&&(s[i.value]=l.value)}return{status:e.value,value:s}}},P=Object.freeze({status:"aborted"}),Bt=n=>({status:"dirty",value:n}),se=n=>({status:"valid",value:n}),Bn=n=>n.status==="aborted",Wn=n=>n.status==="dirty",wt=n=>n.status==="valid",br=n=>typeof Promise<"u"&&n instanceof Promise;var T;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(T||(T={}));var xe=class{constructor(e,r,s,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=s,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},li=(n,e)=>{if(wt(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new le(n.common.issues);return this._error=r,this._error}}};function I(n){if(!n)return{};let{errorMap:e,invalid_type_error:r,required_error:s,description:o}=n;if(e&&(r||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(l,u)=>{let{message:p}=n;return l.code==="invalid_enum_value"?{message:p??u.defaultError}:typeof u.data>"u"?{message:p??s??u.defaultError}:l.code!=="invalid_type"?{message:u.defaultError}:{message:p??r??u.defaultError}},description:o}}var N=class{get description(){return this._def.description}_getType(e){return qe(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:qe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ee,ctx:{common:e.parent.common,data:e.data,parsedType:qe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(br(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let s=this.safeParse(e,r);if(s.success)return s.data;throw s.error}safeParse(e,r){let s={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qe(e)},o=this._parseSync({data:e,path:s.path,parent:s});return li(s,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qe(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:r});return wt(s)?{value:s.value}:{issues:r.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(s=>wt(s)?{value:s.value}:{issues:r.common.issues})}async parseAsync(e,r){let s=await this.safeParseAsync(e,r);if(s.success)return s.data;throw s.error}async safeParseAsync(e,r){let s={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qe(e)},o=this._parse({data:e,path:s.path,parent:s}),i=await(br(o)?o:Promise.resolve(o));return li(s,i)}refine(e,r){let s=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,i)=>{let l=e(o),u=()=>i.addIssue({code:_.custom,...s(o)});return typeof Promise<"u"&&l instanceof Promise?l.then(p=>p?!0:(u(),!1)):l?!0:(u(),!1)})}refinement(e,r){return this._refinement((s,o)=>e(s)?!0:(o.addIssue(typeof r=="function"?r(s,o):r),!1))}_refinement(e){return new ke({schema:this,typeName:A.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ve.create(this,this._def)}nullable(){return Me.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return st.create(this)}promise(){return xt.create(this,this._def)}or(e){return zt.create([this,e],this._def)}and(e){return Ut.create(this,e,this._def)}transform(e){return new ke({...I(this._def),schema:this,typeName:A.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Yt({...I(this._def),innerType:this,defaultValue:r,typeName:A.ZodDefault})}brand(){return new zr({typeName:A.ZodBranded,type:this,...I(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Gt({...I(this._def),innerType:this,catchValue:r,typeName:A.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ur.create(this,e)}readonly(){return Qt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Fu=/^c[^\s-]{8,}$/i,qu=/^[0-9a-z]+$/,Lu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Mu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,zu=/^[a-z0-9_-]{21}$/i,Uu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Hu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Vu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Zu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ia,Ju=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Yu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Qu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ku=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,di="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ed=new RegExp(`^${di}$`);function fi(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let r=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function td(n){return new RegExp(`^${fi(n)}$`)}function pi(n){let e=`${di}T${fi(n)}`,r=[];return r.push(n.local?"Z?":"Z"),n.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function rd(n,e){return!!((e==="v4"||!e)&&Ju.test(n)||(e==="v6"||!e)&&Gu.test(n))}function nd(n,e){if(!Uu.test(n))return!1;try{let[r]=n.split(".");if(!r)return!1;let s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(s));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function sd(n,e){return!!((e==="v4"||!e)&&Yu.test(n)||(e==="v6"||!e)&&Qu.test(n))}var St=class n extends N{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==x.string){let i=this._getOrReturnCtx(e);return w(i,{code:_.invalid_type,expected:x.string,received:i.parsedType}),P}let s=new ee,o;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(o=this._getOrReturnCtx(e,o),w(o,{code:_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(o=this._getOrReturnCtx(e,o),w(o,{code:_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let l=e.data.length>i.value,u=e.data.length<i.value;(l||u)&&(o=this._getOrReturnCtx(e,o),l?w(o,{code:_.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):u&&w(o,{code:_.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Vu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"email",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")ia||(ia=new RegExp(Zu,"u")),ia.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"emoji",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Mu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"uuid",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")zu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"nanoid",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Fu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"cuid",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")qu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"cuid2",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Lu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"ulid",code:_.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),w(o,{validation:"url",code:_.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"regex",code:_.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?pi(i).test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?ed.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?td(i).test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{code:_.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Hu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"duration",code:_.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?rd(e.data,i.version)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"ip",code:_.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?nd(e.data,i.alg)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"jwt",code:_.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?sd(e.data,i.version)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"cidr",code:_.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Ku.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"base64",code:_.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Xu.test(e.data)||(o=this._getOrReturnCtx(e,o),w(o,{validation:"base64url",code:_.invalid_string,message:i.message}),s.dirty()):W.assertNever(i);return{status:s.value,value:e.data}}_regex(e,r,s){return this.refinement(o=>e.test(o),{validation:r,code:_.invalid_string,...T.errToObj(s)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...T.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...T.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...T.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...T.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...T.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...T.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...T.errToObj(r)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};St.create=n=>new St({checks:[],typeName:A.ZodString,coerce:n?.coerce??!1,...I(n)});function ad(n,e){let r=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,o=r>s?r:s,i=Number.parseInt(n.toFixed(o).replace(".","")),l=Number.parseInt(e.toFixed(o).replace(".",""));return i%l/10**o}var Wt=class n extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==x.number){let i=this._getOrReturnCtx(e);return w(i,{code:_.invalid_type,expected:x.number,received:i.parsedType}),P}let s,o=new ee;for(let i of this._def.checks)i.kind==="int"?W.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),w(s,{code:_.invalid_type,expected:"integer",received:"float",message:i.message}),o.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="multipleOf"?ad(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),w(s,{code:_.not_finite,message:i.message}),o.dirty()):W.assertNever(i);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,T.toString(r))}gt(e,r){return this.setLimit("min",e,!1,T.toString(r))}lte(e,r){return this.setLimit("max",e,!0,T.toString(r))}lt(e,r){return this.setLimit("max",e,!1,T.toString(r))}setLimit(e,r,s,o){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:T.toString(o)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:T.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(r===null||s.value>r)&&(r=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Wt.create=n=>new Wt({checks:[],typeName:A.ZodNumber,coerce:n?.coerce||!1,...I(n)});var Dt=class n extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==x.bigint)return this._getInvalidInput(e);let s,o=new ee;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),w(s,{code:_.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):W.assertNever(i);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return w(r,{code:_.invalid_type,expected:x.bigint,received:r.parsedType}),P}gte(e,r){return this.setLimit("min",e,!0,T.toString(r))}gt(e,r){return this.setLimit("min",e,!1,T.toString(r))}lte(e,r){return this.setLimit("max",e,!0,T.toString(r))}lt(e,r){return this.setLimit("max",e,!1,T.toString(r))}setLimit(e,r,s,o){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:T.toString(o)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Dt.create=n=>new Dt({checks:[],typeName:A.ZodBigInt,coerce:n?.coerce??!1,...I(n)});var Ft=class extends N{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==x.boolean){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.boolean,received:s.parsedType}),P}return se(e.data)}};Ft.create=n=>new Ft({typeName:A.ZodBoolean,coerce:n?.coerce||!1,...I(n)});var qt=class n extends N{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==x.date){let i=this._getOrReturnCtx(e);return w(i,{code:_.invalid_type,expected:x.date,received:i.parsedType}),P}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return w(i,{code:_.invalid_date}),P}let s=new ee,o;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(o=this._getOrReturnCtx(e,o),w(o,{code:_.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(o=this._getOrReturnCtx(e,o),w(o,{code:_.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):W.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};qt.create=n=>new qt({checks:[],coerce:n?.coerce||!1,typeName:A.ZodDate,...I(n)});var wr=class extends N{_parse(e){if(this._getType(e)!==x.symbol){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.symbol,received:s.parsedType}),P}return se(e.data)}};wr.create=n=>new wr({typeName:A.ZodSymbol,...I(n)});var Lt=class extends N{_parse(e){if(this._getType(e)!==x.undefined){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.undefined,received:s.parsedType}),P}return se(e.data)}};Lt.create=n=>new Lt({typeName:A.ZodUndefined,...I(n)});var Mt=class extends N{_parse(e){if(this._getType(e)!==x.null){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.null,received:s.parsedType}),P}return se(e.data)}};Mt.create=n=>new Mt({typeName:A.ZodNull,...I(n)});var vt=class extends N{constructor(){super(...arguments),this._any=!0}_parse(e){return se(e.data)}};vt.create=n=>new vt({typeName:A.ZodAny,...I(n)});var nt=class extends N{constructor(){super(...arguments),this._unknown=!0}_parse(e){return se(e.data)}};nt.create=n=>new nt({typeName:A.ZodUnknown,...I(n)});var Oe=class extends N{_parse(e){let r=this._getOrReturnCtx(e);return w(r,{code:_.invalid_type,expected:x.never,received:r.parsedType}),P}};Oe.create=n=>new Oe({typeName:A.ZodNever,...I(n)});var Sr=class extends N{_parse(e){if(this._getType(e)!==x.undefined){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.void,received:s.parsedType}),P}return se(e.data)}};Sr.create=n=>new Sr({typeName:A.ZodVoid,...I(n)});var st=class n extends N{_parse(e){let{ctx:r,status:s}=this._processInputParams(e),o=this._def;if(r.parsedType!==x.array)return w(r,{code:_.invalid_type,expected:x.array,received:r.parsedType}),P;if(o.exactLength!==null){let l=r.data.length>o.exactLength.value,u=r.data.length<o.exactLength.value;(l||u)&&(w(r,{code:l?_.too_big:_.too_small,minimum:u?o.exactLength.value:void 0,maximum:l?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),s.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(w(r,{code:_.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),s.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(w(r,{code:_.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),s.dirty()),r.common.async)return Promise.all([...r.data].map((l,u)=>o.type._parseAsync(new xe(r,l,r.path,u)))).then(l=>ee.mergeArray(s,l));let i=[...r.data].map((l,u)=>o.type._parseSync(new xe(r,l,r.path,u)));return ee.mergeArray(s,i)}get element(){return this._def.type}min(e,r){return new n({...this._def,minLength:{value:e,message:T.toString(r)}})}max(e,r){return new n({...this._def,maxLength:{value:e,message:T.toString(r)}})}length(e,r){return new n({...this._def,exactLength:{value:e,message:T.toString(r)}})}nonempty(e){return this.min(1,e)}};st.create=(n,e)=>new st({type:n,minLength:null,maxLength:null,exactLength:null,typeName:A.ZodArray,...I(e)});function _r(n){if(n instanceof ue){let e={};for(let r in n.shape){let s=n.shape[r];e[r]=ve.create(_r(s))}return new ue({...n._def,shape:()=>e})}else return n instanceof st?new st({...n._def,type:_r(n.element)}):n instanceof ve?ve.create(_r(n.unwrap())):n instanceof Me?Me.create(_r(n.unwrap())):n instanceof Le?Le.create(n.items.map(e=>_r(e))):n}var ue=class n extends N{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=W.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==x.object){let d=this._getOrReturnCtx(e);return w(d,{code:_.invalid_type,expected:x.object,received:d.parsedType}),P}let{status:s,ctx:o}=this._processInputParams(e),{shape:i,keys:l}=this._getCached(),u=[];if(!(this._def.catchall instanceof Oe&&this._def.unknownKeys==="strip"))for(let d in o.data)l.includes(d)||u.push(d);let p=[];for(let d of l){let y=i[d],S=o.data[d];p.push({key:{status:"valid",value:d},value:y._parse(new xe(o,S,o.path,d)),alwaysSet:d in o.data})}if(this._def.catchall instanceof Oe){let d=this._def.unknownKeys;if(d==="passthrough")for(let y of u)p.push({key:{status:"valid",value:y},value:{status:"valid",value:o.data[y]}});else if(d==="strict")u.length>0&&(w(o,{code:_.unrecognized_keys,keys:u}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let y of u){let S=o.data[y];p.push({key:{status:"valid",value:y},value:d._parse(new xe(o,S,o.path,y)),alwaysSet:y in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let d=[];for(let y of p){let S=await y.key,R=await y.value;d.push({key:S,value:R,alwaysSet:y.alwaysSet})}return d}).then(d=>ee.mergeObjectSync(s,d)):ee.mergeObjectSync(s,p)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,s)=>{let o=this._def.errorMap?.(r,s).message??s.defaultError;return r.code==="unrecognized_keys"?{message:T.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:A.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let r={};for(let s of W.objectKeys(e))e[s]&&this.shape[s]&&(r[s]=this.shape[s]);return new n({...this._def,shape:()=>r})}omit(e){let r={};for(let s of W.objectKeys(this.shape))e[s]||(r[s]=this.shape[s]);return new n({...this._def,shape:()=>r})}deepPartial(){return _r(this)}partial(e){let r={};for(let s of W.objectKeys(this.shape)){let o=this.shape[s];e&&!e[s]?r[s]=o:r[s]=o.optional()}return new n({...this._def,shape:()=>r})}required(e){let r={};for(let s of W.objectKeys(this.shape))if(e&&!e[s])r[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof ve;)i=i._def.innerType;r[s]=i}return new n({...this._def,shape:()=>r})}keyof(){return hi(W.objectKeys(this.shape))}};ue.create=(n,e)=>new ue({shape:()=>n,unknownKeys:"strip",catchall:Oe.create(),typeName:A.ZodObject,...I(e)});ue.strictCreate=(n,e)=>new ue({shape:()=>n,unknownKeys:"strict",catchall:Oe.create(),typeName:A.ZodObject,...I(e)});ue.lazycreate=(n,e)=>new ue({shape:n,unknownKeys:"strip",catchall:Oe.create(),typeName:A.ZodObject,...I(e)});var zt=class extends N{_parse(e){let{ctx:r}=this._processInputParams(e),s=this._def.options;function o(i){for(let u of i)if(u.result.status==="valid")return u.result;for(let u of i)if(u.result.status==="dirty")return r.common.issues.push(...u.ctx.common.issues),u.result;let l=i.map(u=>new le(u.ctx.common.issues));return w(r,{code:_.invalid_union,unionErrors:l}),P}if(r.common.async)return Promise.all(s.map(async i=>{let l={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:l}),ctx:l}})).then(o);{let i,l=[];for(let p of s){let d={...r,common:{...r.common,issues:[]},parent:null},y=p._parseSync({data:r.data,path:r.path,parent:d});if(y.status==="valid")return y;y.status==="dirty"&&!i&&(i={result:y,ctx:d}),d.common.issues.length&&l.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let u=l.map(p=>new le(p));return w(r,{code:_.invalid_union,unionErrors:u}),P}}get options(){return this._def.options}};zt.create=(n,e)=>new zt({options:n,typeName:A.ZodUnion,...I(e)});var rt=n=>n instanceof Ht?rt(n.schema):n instanceof ke?rt(n.innerType()):n instanceof Vt?[n.value]:n instanceof Zt?n.options:n instanceof Jt?W.objectValues(n.enum):n instanceof Yt?rt(n._def.innerType):n instanceof Lt?[void 0]:n instanceof Mt?[null]:n instanceof ve?[void 0,...rt(n.unwrap())]:n instanceof Me?[null,...rt(n.unwrap())]:n instanceof zr||n instanceof Qt?rt(n.unwrap()):n instanceof Gt?rt(n._def.innerType):[],Dn=class n extends N{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==x.object)return w(r,{code:_.invalid_type,expected:x.object,received:r.parsedType}),P;let s=this.discriminator,o=r.data[s],i=this.optionsMap.get(o);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(w(r,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),P)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,s){let o=new Map;for(let i of r){let l=rt(i.shape[e]);if(!l.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let u of l){if(o.has(u))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(u)}`);o.set(u,i)}}return new n({typeName:A.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...I(s)})}};function ca(n,e){let r=qe(n),s=qe(e);if(n===e)return{valid:!0,data:n};if(r===x.object&&s===x.object){let o=W.objectKeys(e),i=W.objectKeys(n).filter(u=>o.indexOf(u)!==-1),l={...n,...e};for(let u of i){let p=ca(n[u],e[u]);if(!p.valid)return{valid:!1};l[u]=p.data}return{valid:!0,data:l}}else if(r===x.array&&s===x.array){if(n.length!==e.length)return{valid:!1};let o=[];for(let i=0;i<n.length;i++){let l=n[i],u=e[i],p=ca(l,u);if(!p.valid)return{valid:!1};o.push(p.data)}return{valid:!0,data:o}}else return r===x.date&&s===x.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var Ut=class extends N{_parse(e){let{status:r,ctx:s}=this._processInputParams(e),o=(i,l)=>{if(Bn(i)||Bn(l))return P;let u=ca(i.value,l.value);return u.valid?((Wn(i)||Wn(l))&&r.dirty(),{status:r.value,value:u.data}):(w(s,{code:_.invalid_intersection_types}),P)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,l])=>o(i,l)):o(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Ut.create=(n,e,r)=>new Ut({left:n,right:e,typeName:A.ZodIntersection,...I(r)});var Le=class n extends N{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.array)return w(s,{code:_.invalid_type,expected:x.array,received:s.parsedType}),P;if(s.data.length<this._def.items.length)return w(s,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),P;!this._def.rest&&s.data.length>this._def.items.length&&(w(s,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...s.data].map((l,u)=>{let p=this._def.items[u]||this._def.rest;return p?p._parse(new xe(s,l,s.path,u)):null}).filter(l=>!!l);return s.common.async?Promise.all(i).then(l=>ee.mergeArray(r,l)):ee.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};Le.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Le({items:n,typeName:A.ZodTuple,rest:null,...I(e)})};var Fn=class n extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.object)return w(s,{code:_.invalid_type,expected:x.object,received:s.parsedType}),P;let o=[],i=this._def.keyType,l=this._def.valueType;for(let u in s.data)o.push({key:i._parse(new xe(s,u,s.path,u)),value:l._parse(new xe(s,s.data[u],s.path,u)),alwaysSet:u in s.data});return s.common.async?ee.mergeObjectAsync(r,o):ee.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,s){return r instanceof N?new n({keyType:e,valueType:r,typeName:A.ZodRecord,...I(s)}):new n({keyType:St.create(),valueType:e,typeName:A.ZodRecord,...I(r)})}},vr=class extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.map)return w(s,{code:_.invalid_type,expected:x.map,received:s.parsedType}),P;let o=this._def.keyType,i=this._def.valueType,l=[...s.data.entries()].map(([u,p],d)=>({key:o._parse(new xe(s,u,s.path,[d,"key"])),value:i._parse(new xe(s,p,s.path,[d,"value"]))}));if(s.common.async){let u=new Map;return Promise.resolve().then(async()=>{for(let p of l){let d=await p.key,y=await p.value;if(d.status==="aborted"||y.status==="aborted")return P;(d.status==="dirty"||y.status==="dirty")&&r.dirty(),u.set(d.value,y.value)}return{status:r.value,value:u}})}else{let u=new Map;for(let p of l){let d=p.key,y=p.value;if(d.status==="aborted"||y.status==="aborted")return P;(d.status==="dirty"||y.status==="dirty")&&r.dirty(),u.set(d.value,y.value)}return{status:r.value,value:u}}}};vr.create=(n,e,r)=>new vr({valueType:e,keyType:n,typeName:A.ZodMap,...I(r)});var xr=class n extends N{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.set)return w(s,{code:_.invalid_type,expected:x.set,received:s.parsedType}),P;let o=this._def;o.minSize!==null&&s.data.size<o.minSize.value&&(w(s,{code:_.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&s.data.size>o.maxSize.value&&(w(s,{code:_.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let i=this._def.valueType;function l(p){let d=new Set;for(let y of p){if(y.status==="aborted")return P;y.status==="dirty"&&r.dirty(),d.add(y.value)}return{status:r.value,value:d}}let u=[...s.data.values()].map((p,d)=>i._parse(new xe(s,p,s.path,d)));return s.common.async?Promise.all(u).then(p=>l(p)):l(u)}min(e,r){return new n({...this._def,minSize:{value:e,message:T.toString(r)}})}max(e,r){return new n({...this._def,maxSize:{value:e,message:T.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};xr.create=(n,e)=>new xr({valueType:n,minSize:null,maxSize:null,typeName:A.ZodSet,...I(e)});var qn=class n extends N{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==x.function)return w(r,{code:_.invalid_type,expected:x.function,received:r.parsedType}),P;function s(u,p){return Mr({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,gr(),tt].filter(d=>!!d),issueData:{code:_.invalid_arguments,argumentsError:p}})}function o(u,p){return Mr({data:u,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,gr(),tt].filter(d=>!!d),issueData:{code:_.invalid_return_type,returnTypeError:p}})}let i={errorMap:r.common.contextualErrorMap},l=r.data;if(this._def.returns instanceof xt){let u=this;return se(async function(...p){let d=new le([]),y=await u._def.args.parseAsync(p,i).catch(j=>{throw d.addIssue(s(p,j)),d}),S=await Reflect.apply(l,this,y);return await u._def.returns._def.type.parseAsync(S,i).catch(j=>{throw d.addIssue(o(S,j)),d})})}else{let u=this;return se(function(...p){let d=u._def.args.safeParse(p,i);if(!d.success)throw new le([s(p,d.error)]);let y=Reflect.apply(l,this,d.data),S=u._def.returns.safeParse(y,i);if(!S.success)throw new le([o(y,S.error)]);return S.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:Le.create(e).rest(nt.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,s){return new n({args:e||Le.create([]).rest(nt.create()),returns:r||nt.create(),typeName:A.ZodFunction,...I(s)})}},Ht=class extends N{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Ht.create=(n,e)=>new Ht({getter:n,typeName:A.ZodLazy,...I(e)});var Vt=class extends N{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return w(r,{received:r.data,code:_.invalid_literal,expected:this._def.value}),P}return{status:"valid",value:e.data}}get value(){return this._def.value}};Vt.create=(n,e)=>new Vt({value:n,typeName:A.ZodLiteral,...I(e)});function hi(n,e){return new Zt({values:n,typeName:A.ZodEnum,...I(e)})}var Zt=class n extends N{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),s=this._def.values;return w(r,{expected:W.joinValues(s),received:r.parsedType,code:_.invalid_type}),P}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),s=this._def.values;return w(r,{received:r.data,code:_.invalid_enum_value,options:s}),P}return se(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return n.create(e,{...this._def,...r})}exclude(e,r=this._def){return n.create(this.options.filter(s=>!e.includes(s)),{...this._def,...r})}};Zt.create=hi;var Jt=class extends N{_parse(e){let r=W.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==x.string&&s.parsedType!==x.number){let o=W.objectValues(r);return w(s,{expected:W.joinValues(o),received:s.parsedType,code:_.invalid_type}),P}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=W.objectValues(r);return w(s,{received:s.data,code:_.invalid_enum_value,options:o}),P}return se(e.data)}get enum(){return this._def.values}};Jt.create=(n,e)=>new Jt({values:n,typeName:A.ZodNativeEnum,...I(e)});var xt=class extends N{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==x.promise&&r.common.async===!1)return w(r,{code:_.invalid_type,expected:x.promise,received:r.parsedType}),P;let s=r.parsedType===x.promise?r.data:Promise.resolve(r.data);return se(s.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};xt.create=(n,e)=>new xt({type:n,typeName:A.ZodPromise,...I(e)});var ke=class extends N{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===A.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:s}=this._processInputParams(e),o=this._def.effect||null,i={addIssue:l=>{w(s,l),l.fatal?r.abort():r.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),o.type==="preprocess"){let l=o.transform(s.data,i);if(s.common.async)return Promise.resolve(l).then(async u=>{if(r.value==="aborted")return P;let p=await this._def.schema._parseAsync({data:u,path:s.path,parent:s});return p.status==="aborted"?P:p.status==="dirty"?Bt(p.value):r.value==="dirty"?Bt(p.value):p});{if(r.value==="aborted")return P;let u=this._def.schema._parseSync({data:l,path:s.path,parent:s});return u.status==="aborted"?P:u.status==="dirty"?Bt(u.value):r.value==="dirty"?Bt(u.value):u}}if(o.type==="refinement"){let l=u=>{let p=o.refinement(u,i);if(s.common.async)return Promise.resolve(p);if(p instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(s.common.async===!1){let u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?P:(u.status==="dirty"&&r.dirty(),l(u.value),{status:r.value,value:u.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>u.status==="aborted"?P:(u.status==="dirty"&&r.dirty(),l(u.value).then(()=>({status:r.value,value:u.value}))))}if(o.type==="transform")if(s.common.async===!1){let l=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!wt(l))return P;let u=o.transform(l.value,i);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:u}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(l=>wt(l)?Promise.resolve(o.transform(l.value,i)).then(u=>({status:r.value,value:u})):P);W.assertNever(o)}};ke.create=(n,e,r)=>new ke({schema:n,typeName:A.ZodEffects,effect:e,...I(r)});ke.createWithPreprocess=(n,e,r)=>new ke({schema:e,effect:{type:"preprocess",transform:n},typeName:A.ZodEffects,...I(r)});var ve=class extends N{_parse(e){return this._getType(e)===x.undefined?se(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ve.create=(n,e)=>new ve({innerType:n,typeName:A.ZodOptional,...I(e)});var Me=class extends N{_parse(e){return this._getType(e)===x.null?se(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Me.create=(n,e)=>new Me({innerType:n,typeName:A.ZodNullable,...I(e)});var Yt=class extends N{_parse(e){let{ctx:r}=this._processInputParams(e),s=r.data;return r.parsedType===x.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Yt.create=(n,e)=>new Yt({innerType:n,typeName:A.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...I(e)});var Gt=class extends N{_parse(e){let{ctx:r}=this._processInputParams(e),s={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return br(o)?o.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new le(s.common.issues)},input:s.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new le(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Gt.create=(n,e)=>new Gt({innerType:n,typeName:A.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...I(e)});var kr=class extends N{_parse(e){if(this._getType(e)!==x.nan){let s=this._getOrReturnCtx(e);return w(s,{code:_.invalid_type,expected:x.nan,received:s.parsedType}),P}return{status:"valid",value:e.data}}};kr.create=n=>new kr({typeName:A.ZodNaN,...I(n)});var od=Symbol("zod_brand"),zr=class extends N{_parse(e){let{ctx:r}=this._processInputParams(e),s=r.data;return this._def.type._parse({data:s,path:r.path,parent:r})}unwrap(){return this._def.type}},Ur=class n extends N{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?P:i.status==="dirty"?(r.dirty(),Bt(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let o=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?P:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:s.path,parent:s})}}static create(e,r){return new n({in:e,out:r,typeName:A.ZodPipeline})}},Qt=class extends N{_parse(e){let r=this._def.innerType._parse(e),s=o=>(wt(o)&&(o.value=Object.freeze(o.value)),o);return br(r)?r.then(o=>s(o)):s(r)}unwrap(){return this._def.innerType}};Qt.create=(n,e)=>new Qt({innerType:n,typeName:A.ZodReadonly,...I(e)});function ui(n,e){let r=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof r=="string"?{message:r}:r}function mi(n,e={},r){return n?vt.create().superRefine((s,o)=>{let i=n(s);if(i instanceof Promise)return i.then(l=>{if(!l){let u=ui(e,s),p=u.fatal??r??!0;o.addIssue({code:"custom",...u,fatal:p})}});if(!i){let l=ui(e,s),u=l.fatal??r??!0;o.addIssue({code:"custom",...l,fatal:u})}}):vt.create()}var id={object:ue.lazycreate},A;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(A||(A={}));var cd=(n,e={message:`Input not instance of ${n.name}`})=>mi(r=>r instanceof n,e),yi=St.create,gi=Wt.create,ld=kr.create,ud=Dt.create,bi=Ft.create,dd=qt.create,fd=wr.create,pd=Lt.create,hd=Mt.create,md=vt.create,yd=nt.create,gd=Oe.create,bd=Sr.create,_d=st.create,wd=ue.create,Sd=ue.strictCreate,vd=zt.create,xd=Dn.create,kd=Ut.create,Rd=Le.create,Td=Fn.create,Cd=vr.create,Ed=xr.create,Pd=qn.create,Ad=Ht.create,$d=Vt.create,Od=Zt.create,jd=Jt.create,Id=xt.create,Nd=ke.create,Bd=ve.create,Wd=Me.create,Dd=ke.createWithPreprocess,Fd=Ur.create,qd=()=>yi().optional(),Ld=()=>gi().optional(),Md=()=>bi().optional(),zd={string:(n=>St.create({...n,coerce:!0})),number:(n=>Wt.create({...n,coerce:!0})),boolean:(n=>Ft.create({...n,coerce:!0})),bigint:(n=>Dt.create({...n,coerce:!0})),date:(n=>qt.create({...n,coerce:!0}))};var Ud=P;var la="2024-11-05",_i=[la,"2024-10-07"],Ln="2.0",wi=h.union([h.string(),h.number().int()]),Si=h.string(),je=h.object({_meta:h.optional(h.object({progressToken:h.optional(wi)}).passthrough())}).passthrough(),he=h.object({method:h.string(),params:h.optional(je)}),Vr=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),ze=h.object({method:h.string(),params:h.optional(Vr)}),Ie=h.object({_meta:h.optional(h.object({}).passthrough())}).passthrough(),Mn=h.union([h.string(),h.number().int()]),Hd=h.object({jsonrpc:h.literal(Ln),id:Mn}).merge(he).strict(),Vd=h.object({jsonrpc:h.literal(Ln)}).merge(ze).strict(),Zd=h.object({jsonrpc:h.literal(Ln),id:Mn,result:Ie}).strict(),Rr;(function(n){n[n.ConnectionClosed=-1]="ConnectionClosed",n[n.ParseError=-32700]="ParseError",n[n.InvalidRequest=-32600]="InvalidRequest",n[n.MethodNotFound=-32601]="MethodNotFound",n[n.InvalidParams=-32602]="InvalidParams",n[n.InternalError=-32603]="InternalError"})(Rr||(Rr={}));var Jd=h.object({jsonrpc:h.literal(Ln),id:Mn,error:h.object({code:h.number().int(),message:h.string(),data:h.optional(h.unknown())})}).strict(),vi=h.union([Hd,Vd,Zd,Jd]),zn=Ie.strict(),Un=ze.extend({method:h.literal("notifications/cancelled"),params:Vr.extend({requestId:Mn,reason:h.string().optional()})}),xi=h.object({name:h.string(),version:h.string()}).passthrough(),Yd=h.object({experimental:h.optional(h.object({}).passthrough()),sampling:h.optional(h.object({}).passthrough()),roots:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),ua=he.extend({method:h.literal("initialize"),params:je.extend({protocolVersion:h.string(),capabilities:Yd,clientInfo:xi})}),Gd=h.object({experimental:h.optional(h.object({}).passthrough()),logging:h.optional(h.object({}).passthrough()),prompts:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough()),resources:h.optional(h.object({subscribe:h.optional(h.boolean()),listChanged:h.optional(h.boolean())}).passthrough()),tools:h.optional(h.object({listChanged:h.optional(h.boolean())}).passthrough())}).passthrough(),Qd=Ie.extend({protocolVersion:h.string(),capabilities:Gd,serverInfo:xi}),da=ze.extend({method:h.literal("notifications/initialized")}),Hn=he.extend({method:h.literal("ping")}),Kd=h.object({progress:h.number(),total:h.optional(h.number())}).passthrough(),Vn=ze.extend({method:h.literal("notifications/progress"),params:Vr.merge(Kd).extend({progressToken:wi})}),Zn=he.extend({params:je.extend({cursor:h.optional(Si)}).optional()}),Jn=Ie.extend({nextCursor:h.optional(Si)}),ki=h.object({uri:h.string(),mimeType:h.optional(h.string())}).passthrough(),Ri=ki.extend({text:h.string()}),Ti=ki.extend({blob:h.string().base64()}),Xd=h.object({uri:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),ef=h.object({uriTemplate:h.string(),name:h.string(),description:h.optional(h.string()),mimeType:h.optional(h.string())}).passthrough(),tf=Zn.extend({method:h.literal("resources/list")}),rf=Jn.extend({resources:h.array(Xd)}),nf=Zn.extend({method:h.literal("resources/templates/list")}),sf=Jn.extend({resourceTemplates:h.array(ef)}),af=he.extend({method:h.literal("resources/read"),params:je.extend({uri:h.string()})}),of=Ie.extend({contents:h.array(h.union([Ri,Ti]))}),cf=ze.extend({method:h.literal("notifications/resources/list_changed")}),lf=he.extend({method:h.literal("resources/subscribe"),params:je.extend({uri:h.string()})}),uf=he.extend({method:h.literal("resources/unsubscribe"),params:je.extend({uri:h.string()})}),df=ze.extend({method:h.literal("notifications/resources/updated"),params:Vr.extend({uri:h.string()})}),ff=h.object({name:h.string(),description:h.optional(h.string()),required:h.optional(h.boolean())}).passthrough(),pf=h.object({name:h.string(),description:h.optional(h.string()),arguments:h.optional(h.array(ff))}).passthrough(),hf=Zn.extend({method:h.literal("prompts/list")}),mf=Jn.extend({prompts:h.array(pf)}),yf=he.extend({method:h.literal("prompts/get"),params:je.extend({name:h.string(),arguments:h.optional(h.record(h.string()))})}),Yn=h.object({type:h.literal("text"),text:h.string()}).passthrough(),Gn=h.object({type:h.literal("image"),data:h.string().base64(),mimeType:h.string()}).passthrough(),Ci=h.object({type:h.literal("resource"),resource:h.union([Ri,Ti])}).passthrough(),gf=h.object({role:h.enum(["user","assistant"]),content:h.union([Yn,Gn,Ci])}).passthrough(),bf=Ie.extend({description:h.optional(h.string()),messages:h.array(gf)}),_f=ze.extend({method:h.literal("notifications/prompts/list_changed")}),wf=h.object({name:h.string(),description:h.optional(h.string()),inputSchema:h.object({type:h.literal("object"),properties:h.optional(h.object({}).passthrough())}).passthrough()}).passthrough(),fa=Zn.extend({method:h.literal("tools/list")}),Sf=Jn.extend({tools:h.array(wf)}),Ei=Ie.extend({content:h.array(h.union([Yn,Gn,Ci])),isError:h.boolean().default(!1).optional()}),Ph=Ei.or(Ie.extend({toolResult:h.unknown()})),pa=he.extend({method:h.literal("tools/call"),params:je.extend({name:h.string(),arguments:h.optional(h.record(h.unknown()))})}),vf=ze.extend({method:h.literal("notifications/tools/list_changed")}),Pi=h.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),xf=he.extend({method:h.literal("logging/setLevel"),params:je.extend({level:Pi})}),kf=ze.extend({method:h.literal("notifications/message"),params:Vr.extend({level:Pi,logger:h.optional(h.string()),data:h.unknown()})}),Rf=h.object({name:h.string().optional()}).passthrough(),Tf=h.object({hints:h.optional(h.array(Rf)),costPriority:h.optional(h.number().min(0).max(1)),speedPriority:h.optional(h.number().min(0).max(1)),intelligencePriority:h.optional(h.number().min(0).max(1))}).passthrough(),Cf=h.object({role:h.enum(["user","assistant"]),content:h.union([Yn,Gn])}).passthrough(),Ef=he.extend({method:h.literal("sampling/createMessage"),params:je.extend({messages:h.array(Cf),systemPrompt:h.optional(h.string()),includeContext:h.optional(h.enum(["none","thisServer","allServers"])),temperature:h.optional(h.number()),maxTokens:h.number().int(),stopSequences:h.optional(h.array(h.string())),metadata:h.optional(h.object({}).passthrough()),modelPreferences:h.optional(Tf)})}),ha=Ie.extend({model:h.string(),stopReason:h.optional(h.enum(["endTurn","stopSequence","maxTokens"]).or(h.string())),role:h.enum(["user","assistant"]),content:h.discriminatedUnion("type",[Yn,Gn])}),Pf=h.object({type:h.literal("ref/resource"),uri:h.string()}).passthrough(),Af=h.object({type:h.literal("ref/prompt"),name:h.string()}).passthrough(),$f=he.extend({method:h.literal("completion/complete"),params:je.extend({ref:h.union([Af,Pf]),argument:h.object({name:h.string(),value:h.string()}).passthrough()})}),Of=Ie.extend({completion:h.object({values:h.array(h.string()).max(100),total:h.optional(h.number().int()),hasMore:h.optional(h.boolean())}).passthrough()}),jf=h.object({uri:h.string().startsWith("file://"),name:h.optional(h.string())}).passthrough(),If=he.extend({method:h.literal("roots/list")}),ma=Ie.extend({roots:h.array(jf)}),Nf=ze.extend({method:h.literal("notifications/roots/list_changed")}),Ah=h.union([Hn,ua,$f,xf,yf,hf,tf,nf,af,lf,uf,pa,fa]),$h=h.union([Un,Vn,da,Nf]),Oh=h.union([zn,ha,ma]),jh=h.union([Hn,Ef,If]),Ih=h.union([Un,Vn,kf,df,cf,vf,_f]),Nh=h.union([zn,Qd,Of,bf,mf,rf,sf,of,Ei,Sf]),Hr=class extends Error{constructor(e,r,s){super(`MCP error ${e}: ${r}`),this.code=e,this.data=s}};var Qn=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this.setNotificationHandler(Un,r=>{let s=this._requestHandlerAbortControllers.get(r.params.requestId);s?.abort(r.params.reason)}),this.setNotificationHandler(Vn,r=>{this._onprogress(r)}),this.setRequestHandler(Hn,r=>({}))}async connect(e){this._transport=e,this._transport.onclose=()=>{this._onclose()},this._transport.onerror=r=>{this._onerror(r)},this._transport.onmessage=r=>{"method"in r?"id"in r?this._onrequest(r):this._onnotification(r):this._onresponse(r)},await this._transport.start()}_onclose(){var e;let r=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);let s=new Hr(Rr.ConnectionClosed,"Connection closed");for(let o of r.values())o(s)}_onerror(e){var r;(r=this.onerror)===null||r===void 0||r.call(this,e)}_onnotification(e){var r;let s=(r=this._notificationHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackNotificationHandler;s!==void 0&&Promise.resolve().then(()=>s(e)).catch(o=>this._onerror(new Error(`Uncaught error in notification handler: ${o}`)))}_onrequest(e){var r,s;let o=(r=this._requestHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackRequestHandler;if(o===void 0){(s=this._transport)===null||s===void 0||s.send({jsonrpc:"2.0",id:e.id,error:{code:Rr.MethodNotFound,message:"Method not found"}}).catch(l=>this._onerror(new Error(`Failed to send an error response: ${l}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i),Promise.resolve().then(()=>o(e,{signal:i.signal})).then(l=>{var u;if(!i.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({result:l,jsonrpc:"2.0",id:e.id})},l=>{var u,p;if(!i.signal.aborted)return(u=this._transport)===null||u===void 0?void 0:u.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:Rr.InternalError,message:(p=l.message)!==null&&p!==void 0?p:"Internal error"}})}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progress:r,total:s,progressToken:o}=e.params,i=this._progressHandlers.get(Number(o));if(i===void 0){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}i({progress:r,total:s})}_onresponse(e){let r=e.id,s=this._responseHandlers.get(Number(r));if(s===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(Number(r)),this._progressHandlers.delete(Number(r)),"result"in e)s(e);else{let o=new Hr(e.error.code,e.error.message,e.error.data);s(o)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,r,s){return new Promise((o,i)=>{var l,u,p;if(!this._transport){i(new Error("Not connected"));return}((l=this._options)===null||l===void 0?void 0:l.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(u=s?.signal)===null||u===void 0||u.throwIfAborted();let d=this._requestMessageId++,y={...e,jsonrpc:"2.0",id:d};s?.onprogress&&(this._progressHandlers.set(d,s.onprogress),y.params={...e.params,_meta:{progressToken:d}}),this._responseHandlers.set(d,S=>{var R;if(!(!((R=s?.signal)===null||R===void 0)&&R.aborted)){if(S instanceof Error)return i(S);try{let j=r.parse(S.result);o(j)}catch(j){i(j)}}}),(p=s?.signal)===null||p===void 0||p.addEventListener("abort",()=>{var S,R;let j=(S=s?.signal)===null||S===void 0?void 0:S.reason;this._responseHandlers.delete(d),this._progressHandlers.delete(d),(R=this._transport)===null||R===void 0||R.send({jsonrpc:"2.0",method:"cancelled",params:{requestId:d,reason:String(j)}}),i(j)}),this._transport.send(y).catch(i)})}async notification(e){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let r={...e,jsonrpc:"2.0"};await this._transport.send(r)}setRequestHandler(e,r){let s=e.shape.method.value;this.assertRequestHandlerCapability(s),this._requestHandlers.set(s,(o,i)=>Promise.resolve(r(e.parse(o),i)))}removeRequestHandler(e){this._requestHandlers.delete(e)}setNotificationHandler(e,r){this._notificationHandlers.set(e.shape.method.value,s=>Promise.resolve(r(e.parse(s))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}};var Kn=class extends Qn{constructor(e,r){super(r),this._serverInfo=e,this._capabilities=r.capabilities,this.setRequestHandler(ua,s=>this._oninitialize(s)),this.setNotificationHandler(da,()=>{var s;return(s=this.oninitialized)===null||s===void 0?void 0:s.call(this)})}assertCapabilityForMethod(e){var r,s;switch(e){case"sampling/createMessage":if(!(!((r=this._clientCapabilities)===null||r===void 0)&&r.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"roots/list":if(!(!((s=this._clientCapabilities)===null||s===void 0)&&s.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Server does not support sampling (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"ping":case"initialize":break}}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:_i.includes(r)?r:la,capabilities:this.getCapabilities(),serverInfo:this._serverInfo}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},zn)}async createMessage(e,r){return this.request({method:"sampling/createMessage",params:e},ha,r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},ma,r)}async sendLoggingMessage(e){return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var ya=$e(require("node:process"),1);var Xn=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e);return this._buffer=this._buffer.subarray(e+1),Bf(r)}clear(){this._buffer=void 0}};function Bf(n){return vi.parse(JSON.parse(n))}function Ai(n){return JSON.stringify(n)+`
`}var es=class{constructor(e=ya.default.stdin,r=ya.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new Xn,this._started=!1,this._ondata=s=>{this._readBuffer.append(s),this.processReadBuffer()},this._onerror=s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,s)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(var e,r;;)try{let s=this._readBuffer.readMessage();if(s===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,s)}catch(s){(r=this.onerror)===null||r===void 0||r.call(this,s)}}async close(){var e;this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._readBuffer.clear(),(e=this.onclose)===null||e===void 0||e.call(this)}send(e){return new Promise(r=>{let s=Ai(e);this._stdout.write(s)?r():this._stdout.once("drain",r)})}};var Ce=require("fs/promises"),Ar=require("path"),hs=require("os"),ms=require("fs"),uy=require("url");var G=require("fs/promises"),Y=require("path");var Er=require("fs/promises"),ja=require("path"),Ia=require("os");rn();function sp(n,e){let r=[];for(let s=0;s<=e.length;s++)r[s]=[s];for(let s=0;s<=n.length;s++)r[0][s]=s;for(let s=1;s<=e.length;s++)for(let o=1;o<=n.length;o++)e.charAt(s-1)===n.charAt(o-1)?r[s][o]=r[s-1][o-1]:r[s][o]=Math.min(r[s-1][o-1]+1,r[s][o-1]+1,r[s-1][o]+1);return r[e.length][n.length]}function xc(n,e){let r=sp(n.toLowerCase(),e.toLowerCase()),s=Math.max(n.length,e.length);return 1-r/s}function Oa(n,e,r=.6){if(!n||!e||e.length===0)return null;let s=n.toLowerCase().trim();for(let l of e)if(l.name.toLowerCase()===s)return{workspace:l,confidence:1,matchType:"exact"};for(let l of e){let u=l.name.toLowerCase();if(u.includes(s)||s.includes(u))return{workspace:l,confidence:.9,matchType:"substring"}}let o=null,i=0;for(let l of e){let u=xc(s,l.name);u>i&&u>=r&&(i=u,o=l)}return o?{workspace:o,confidence:i,matchType:"fuzzy"}:null}function kc(n,e,r=.5,s=3){if(!n||!e||e.length===0)return[];let o=n.toLowerCase().trim(),i=[];for(let l of e){let u=l.name.toLowerCase(),p=0,d="fuzzy";u===o?(p=1,d="exact"):u.includes(o)||o.includes(u)?(p=.9,d="substring"):(p=xc(o,l.name),d="fuzzy"),p>=r&&i.push({workspace:l,confidence:p,matchType:d})}return i.sort((l,u)=>u.confidence-l.confidence).slice(0,s)}function Rc(n){let e=[],r=[/(?:in|from|to|at|on)\s+(?:my\s+)?([a-zA-Z0-9\s-]+?)(?:\s+workspace|\s+notes?|\s+folder)/gi,/(?:workspace|notes?|folder)\s+(?:named|called)\s+["']?([a-zA-Z0-9\s-]+?)["']?/gi,/["']([a-zA-Z0-9\s-]+?)["']\s+(?:workspace|notes?|folder)/gi];for(let s of r){let o;for(;(o=s.exec(n))!==null;)e.push(o[1].trim())}return[...new Set(e)]}var Tc=(0,ja.join)((0,Ia.homedir)(),".lokus","mcp-context.json"),Na=[{name:"list_all_workspaces",description:"List all available Lokus workspaces. Use this when you need to see what workspaces are available or when the user mentions a workspace name.",inputSchema:{type:"object",properties:{}}},{name:"set_workspace_context",description:"Set the active workspace context for all subsequent operations. This ensures all tools operate on the correct workspace. Always use this before performing workspace-specific operations.",inputSchema:{type:"object",properties:{workspacePath:{type:"string",description:"Full path to the workspace to set as active"}},required:["workspacePath"]}},{name:"get_current_context",description:"Get the currently active workspace context. Use this to verify which workspace you're operating on.",inputSchema:{type:"object",properties:{}}},{name:"match_workspace_by_name",description:"Smart workspace detection from natural language. Use this when the user refers to a workspace by name (e.g., 'my knowledge base', 'work notes'). Returns the best matching workspace.",inputSchema:{type:"object",properties:{query:{type:"string",description:"Natural language workspace reference (e.g., 'knowledge base', 'work notes', 'personal workspace')"},autoSet:{type:"boolean",description:"Automatically set the matched workspace as active context (default: true)"}},required:["query"]}},{name:"clear_workspace_context",description:"Clear the active workspace context. Use this when you need to reset or when switching between different tasks.",inputSchema:{type:"object",properties:{}}},{name:"detect_workspace_from_text",description:"Analyze text to automatically detect workspace references and provide suggestions. Useful when the user's message contains workspace-related context.",inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to analyze for workspace references"}},required:["text"]}}];async function Cc(n,e,r){switch(n){case"list_all_workspaces":return await ap(r);case"set_workspace_context":return await Ba(e.workspacePath);case"get_current_context":return await op();case"match_workspace_by_name":return await ip(e.query,e.autoSet!==!1,r);case"clear_workspace_context":return await cp();case"detect_workspace_from_text":return await lp(e.text,r);default:throw new Error(`Unknown workspace context tool: ${n}`)}}async function ap(n){if(!n)return{content:[{type:"text",text:`\u274C API server not available. Cannot list workspaces.

Please ensure Lokus is running.`}]};try{let e=await it(`${n}/api/workspaces/all`);if(!e.ok)throw new Error(`API request failed: ${e.status}`);let r=await e.json();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch workspaces");let s=r.data;if(s.length===0)return{content:[{type:"text",text:`\u{1F4C2} No workspaces found.

You may need to open a workspace in Lokus first.`}]};let o=await nn();return{content:[{type:"text",text:`**Available Workspaces:**

${s.map(l=>{let p=o.currentWorkspace===l.path?"\u{1F449} ":"   ",d=l.note_count!==null?` (${l.note_count} notes)`:"";return`${p}\u{1F4C1} **${l.name}**${d}
      Path: ${l.path}`}).join(`

`)}

${o.currentWorkspace?"\u{1F449} = Currently active workspace":"\u{1F4A1} Use `match_workspace_by_name` or `set_workspace_context` to set active workspace"}`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to list workspaces: ${e.message}

Please ensure Lokus is running and the API server is accessible.`}]}}}async function Ba(n){try{let e=await nn();return e.currentWorkspace=n,e.lastUpdated=new Date().toISOString(),await Ec(e),{content:[{type:"text",text:`\u2705 Workspace context set to:
\u{1F4C1} **${n}**

All subsequent operations will use this workspace.`}]}}catch(e){return{content:[{type:"text",text:`\u274C Failed to set workspace context: ${e.message}`}]}}}async function op(){try{let n=await nn();if(!n.currentWorkspace)return{content:[{type:"text",text:"\u26A0\uFE0F No workspace context is currently set.\n\n\u{1F4A1} Use `list_all_workspaces` to see available workspaces, then use `match_workspace_by_name` or `set_workspace_context` to set one."}]};let e=new Date-new Date(n.lastUpdated),r=Math.floor(e/6e4),s=r<1?"just now":`${r} minute${r!==1?"s":""} ago`;return{content:[{type:"text",text:`**Current Workspace Context:**

\u{1F4C1} ${n.currentWorkspace}
\u23F1\uFE0F Last updated: ${s}

\u2705 All operations will use this workspace.`}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to get context: ${n.message}`}]}}}async function ip(n,e,r){if(!r)return{content:[{type:"text",text:"\u274C API server not available. Cannot match workspaces."}]};try{let s=await it(`${r}/api/workspaces/all`);if(!s.ok)throw new Error(`API request failed: ${s.status}`);let o=await s.json();if(!o.success||!o.data)throw new Error(o.error||"Failed to fetch workspaces");let i=o.data;if(i.length===0)return{content:[{type:"text",text:"\u{1F4C2} No workspaces available to match against."}]};let l=Oa(n,i,.6);if(!l){let y=kc(n,i,.4,3);if(y.length>0){let S=y.map(R=>`  - ${R.workspace.name} (${Math.round(R.confidence*100)}% match)`).join(`
`);return{content:[{type:"text",text:`\u274C No strong match found for "${n}".

Did you mean:
${S}

\u{1F4A1} Try being more specific or use \`list_all_workspaces\` to see all available workspaces.`}]}}return{content:[{type:"text",text:`\u274C No workspace matches "${n}".

\u{1F4A1} Use \`list_all_workspaces\` to see all available workspaces.`}]}}let u=Math.round(l.confidence*100),d=`${l.matchType==="exact"?"\u{1F3AF}":l.matchType==="substring"?"\u2705":"\u{1F50D}"} **Match Found** (${u}% confidence)

\u{1F4C1} **${l.workspace.name}**
   Path: ${l.workspace.path}
   Match type: ${l.matchType}`;return e?(await Ba(l.workspace.path),d+=`

\u2705 Workspace context has been automatically set.
All subsequent operations will use this workspace.`):d+="\n\n\u{1F4A1} Use `set_workspace_context` to activate this workspace.",{content:[{type:"text",text:d}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to match workspace: ${s.message}`}]}}}async function cp(){try{let n=await nn(),e=n.currentWorkspace;return n.currentWorkspace=null,n.lastUpdated=new Date().toISOString(),await Ec(n),{content:[{type:"text",text:e?`\u2705 Workspace context cleared.
Previously: ${e}`:"\u2705 Workspace context cleared (no context was set)."}]}}catch(n){return{content:[{type:"text",text:`\u274C Failed to clear context: ${n.message}`}]}}}async function lp(n,e){if(!e)return{content:[{type:"text",text:"\u274C API server not available."}]};try{let r=Rc(n);if(r.length===0)return{content:[{type:"text",text:`\u{1F50D} No workspace references detected in the text.

\u{1F4A1} Try phrases like 'in my knowledge base' or 'from work notes'.`}]};let s=await it(`${e}/api/workspaces/all`);if(!s.ok)throw new Error(`API request failed: ${s.status}`);let o=await s.json();if(!o.success||!o.data)throw new Error(o.error||"Failed to fetch workspaces");let i=o.data,l=[];for(let d of r){let y=Oa(d,i,.5);y&&l.push({reference:d,match:y})}if(l.length===0)return{content:[{type:"text",text:`\u{1F50D} Found potential workspace references but couldn't match them:
${r.map(d=>`  - "${d}"`).join(`
`)}

\u{1F4A1} Use \`list_all_workspaces\` to see available workspaces.`}]};let u=l.map(d=>`  - "${d.reference}" \u2192 **${d.match.workspace.name}** (${Math.round(d.match.confidence*100)}% confidence)`).join(`
`),p=l.sort((d,y)=>y.match.confidence-d.match.confidence)[0];return await Ba(p.match.workspace.path),{content:[{type:"text",text:`\u{1F50D} **Workspace References Detected:**

${u}

\u2705 Automatically set context to: **${p.match.workspace.name}**`}]}}catch(r){return{content:[{type:"text",text:`\u274C Failed to detect workspace: ${r.message}`}]}}}async function nn(){try{let n=await(0,Er.readFile)(Tc,"utf-8");return JSON.parse(n)}catch{return{currentWorkspace:null,lastUpdated:null}}}async function Ec(n){let e=(0,ja.join)((0,Ia.homedir)(),".lokus");try{await(0,Er.mkdir)(e,{recursive:!0})}catch{}await(0,Er.writeFile)(Tc,JSON.stringify(n,null,2),"utf-8")}async function Pc(){return(await nn()).currentWorkspace}function Ac(n){return n?`\u{1F3AF} **Operating on:** ${n.split("/").pop()} (${n})`:"\u26A0\uFE0F **No workspace context set** - Using default or last workspace"}var Wa=[{name:"list_notes",description:"List all notes in the workspace with metadata",inputSchema:{type:"object",properties:{folder:{type:"string",description:"Folder to list notes from (optional)"},sortBy:{type:"string",enum:["name","modified","created","size"],description:"Sort notes by"},includeContent:{type:"boolean",description:"Include first 200 chars of content"}}}},{name:"read_note",description:"Read the full content of a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note file"}},required:["path"]}},{name:"create_note",description:"Create a new note with optional frontmatter",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path for the new note"},content:{type:"string",description:"Note content"},frontmatter:{type:"object",description:"Optional frontmatter metadata"}},required:["path","content"]}},{name:"update_note",description:"Update an existing note's content",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"},content:{type:"string",description:"New content"},preserveFrontmatter:{type:"boolean",description:"Preserve existing frontmatter"}},required:["path","content"]}},{name:"delete_note",description:"Delete a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note to delete"}},required:["path"]}},{name:"search_notes",description:"Search notes by content or metadata",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},searchIn:{type:"string",enum:["content","title","tags","all"],description:"Where to search"},regex:{type:"boolean",description:"Use regex search"}},required:["query"]}},{name:"get_note_links",description:"Get all wiki links in a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"get_note_backlinks",description:"Find all notes that link to a specific note",inputSchema:{type:"object",properties:{noteName:{type:"string",description:"Name of the note to find backlinks for"}},required:["noteName"]}},{name:"extract_note_metadata",description:"Extract frontmatter and metadata from a note",inputSchema:{type:"object",properties:{path:{type:"string",description:"Path to the note"}},required:["path"]}},{name:"rename_note",description:"Rename a note and update all references",inputSchema:{type:"object",properties:{oldPath:{type:"string",description:"Current path of the note"},newPath:{type:"string",description:"New path for the note"},updateLinks:{type:"boolean",description:"Update wiki links in other notes"}},required:["oldPath","newPath"]}}];async function $c(n,e,r,s){let i=await Pc()||r;switch(n){case"list_notes":return await up(i,e);case"read_note":return await dp(i,e.path);case"create_note":return await fp(i,e);case"update_note":return await pp(i,e);case"delete_note":return await hp(i,e.path);case"search_notes":return await mp(i,e);case"get_note_links":return await yp(i,e.path);case"get_note_backlinks":return await gp(i,e.noteName);case"extract_note_metadata":return await bp(i,e.path);case"rename_note":return await _p(i,e);default:throw new Error(`Unknown notes tool: ${n}`)}}async function up(n,e={}){let r=await sn(n);if(e.sortBy&&r.sort((s,o)=>{switch(e.sortBy){case"modified":return o.modified-s.modified;case"created":return o.created-s.created;case"size":return o.size-s.size;default:return s.name.localeCompare(o.name)}}),e.includeContent)for(let s of r)try{let o=await(0,G.readFile)(s.path,"utf-8");s.preview=o.substring(0,200).replace(/\n/g," ")}catch{s.preview=null}return{content:[{type:"text",text:`${Ac(n)}

Found ${r.length} notes

${r.map(s=>`- ${s.name} (${s.relativePath})${s.preview?`
  `+s.preview+"...":""}`).join(`
`)}`}]}}async function sn(n,e=n){let r=[],s=await(0,G.readdir)(n,{withFileTypes:!0});for(let o of s){let i=(0,Y.join)(n,o.name);if(!o.name.startsWith(".")){if(o.isDirectory()){let l=await sn(i,e);r.push(...l)}else if(o.isFile()&&[".md",".txt"].includes((0,Y.extname)(o.name))){let l=await(0,G.stat)(i);r.push({path:i,relativePath:i.replace(e+"/",""),name:(0,Y.basename)(o.name,(0,Y.extname)(o.name)),size:l.size,created:l.birthtime?.getTime(),modified:l.mtime?.getTime()})}}}return r}async function dp(n,e){let r=e.startsWith("/")?e:(0,Y.join)(n,e);return{content:[{type:"text",text:await(0,G.readFile)(r,"utf-8")}]}}async function fp(n,{path:e,content:r,frontmatter:s}){let o=(0,Y.join)(n,e);await(0,G.mkdir)((0,Y.dirname)(o),{recursive:!0});let i=r;return s&&(i=`---
${Object.entries(s).map(([u,p])=>`${u}: ${JSON.stringify(p)}`).join(`
`)}
---

${r}`),await(0,G.writeFile)(o,i),{content:[{type:"text",text:`\u2705 Note created: ${e}`}]}}async function pp(n,{path:e,content:r,preserveFrontmatter:s}){let o=(0,Y.join)(n,e);if(s){let l=(await(0,G.readFile)(o,"utf-8")).match(/^---\n([\s\S]*?)\n---\n/);l&&(r=l[0]+r)}return await(0,G.writeFile)(o,r),{content:[{type:"text",text:`\u2705 Note updated: ${e}`}]}}async function hp(n,e){let r=(0,Y.join)(n,e),{unlink:s}=await import("fs/promises");return await s(r),{content:[{type:"text",text:`\u2705 Note deleted: ${e}`}]}}async function mp(n,{query:e,searchIn:r="all",regex:s=!1}){let o=await sn(n),i=[],l=s?new RegExp(e,"gi"):e.toLowerCase();for(let u of o)try{let p=await(0,G.readFile)(u.path,"utf-8"),d=!1,y="";if((r==="title"||r==="all")&&(s?l.test(u.name):u.name.toLowerCase().includes(e.toLowerCase()))&&(d=!0,y=`Title match: ${u.name}`),!d&&(r==="content"||r==="all")&&(s?l.test(p):p.toLowerCase().includes(e.toLowerCase()))){d=!0;let S=p.toLowerCase().indexOf(e.toLowerCase()),R=Math.max(0,S-50),j=Math.min(p.length,S+e.length+50);y=p.substring(R,j).replace(/\n/g," ")}d&&i.push({note:u.name,path:u.relativePath,context:y})}catch{}return{content:[{type:"text",text:`Found ${i.length} matches for "${e}":

${i.map(u=>`**${u.note}** (${u.path})
  ${u.context}`).join(`

`)}`}]}}async function yp(n,e){let r=(0,Y.join)(n,e),i=((await(0,G.readFile)(r,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(l=>l.slice(2,-2));return{content:[{type:"text",text:`Found ${i.length} wiki links in the note:
${i.map(l=>`- [[${l}]]`).join(`
`)}`}]}}async function gp(n,e){let r=await sn(n),s=[];for(let o of r)try{(await(0,G.readFile)(o.path,"utf-8")).includes(`[[${e}]]`)&&s.push({note:o.name,path:o.relativePath})}catch{}return{content:[{type:"text",text:`Found ${s.length} backlinks to "${e}":
${s.map(o=>`- ${o.note} (${o.path})`).join(`
`)}`}]}}async function bp(n,e){let r=(0,Y.join)(n,e),s=await(0,G.readFile)(r,"utf-8"),o=s.match(/^---\n([\s\S]*?)\n---/),i={};if(o){let y=o[1].split(`
`);for(let S of y){let[R,...j]=S.split(":");R&&j.length&&(i[R.trim()]=j.join(":").trim())}}let l=await(0,G.stat)(r),u=s.split(/\s+/).length,p=s.split(`
`).length;return{content:[{type:"text",text:JSON.stringify({frontmatter:i,stats:{wordCount:u,lineCount:p,size:l.size,created:l.birthtime,modified:l.mtime}},null,2)}]}}async function _p(n,{oldPath:e,newPath:r,updateLinks:s=!0}){let o=(0,Y.join)(n,e),i=(0,Y.join)(n,r);await(0,G.mkdir)((0,Y.dirname)(i),{recursive:!0});let{rename:l}=await import("fs/promises");if(await l(o,i),s){let u=(0,Y.basename)(e,(0,Y.extname)(e)),p=(0,Y.basename)(r,(0,Y.extname)(r)),d=await sn(n),y=0;for(let S of d)try{let R=await(0,G.readFile)(S.path,"utf-8");if(R.includes(`[[${u}]]`)){let j=R.replace(new RegExp(`\\[\\[${u}\\]\\]`,"g"),`[[${p}]]`);await(0,G.writeFile)(S.path,j),y++}}catch{}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}
${s?`Updated ${y} references`:""}`}]}}return{content:[{type:"text",text:`\u2705 Note renamed from ${e} to ${r}`}]}}var Te=require("fs/promises"),rr=require("path");rn();var Da=[{name:"get_workspace_info",description:"Get comprehensive information about the current workspace",inputSchema:{type:"object",properties:{}}},{name:"get_workspace_stats",description:"Get statistics about the workspace (note count, size, etc)",inputSchema:{type:"object",properties:{}}},{name:"list_folders",description:"List all folders in the workspace",inputSchema:{type:"object",properties:{maxDepth:{type:"number",description:"Maximum depth to traverse"}}}},{name:"get_workspace_settings",description:"Get workspace-specific settings",inputSchema:{type:"object",properties:{}}},{name:"search_workspace",description:"Global search across all workspace content",inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},fileTypes:{type:"array",items:{type:"string"},description:"File types to search (md, txt, json, etc)"},limit:{type:"number",description:"Maximum results to return"}},required:["query"]}},{name:"get_recent_files",description:"Get recently modified files in the workspace",inputSchema:{type:"object",properties:{count:{type:"number",description:"Number of files to return"},fileTypes:{type:"array",items:{type:"string"},description:"Filter by file types"}}}}];async function Oc(n,e,r,s){switch(n){case"get_workspace_info":return await wp(r,s);case"get_workspace_stats":return await jc(r);case"list_folders":return await Sp(r,e.maxDepth||3);case"get_workspace_settings":return await vp(r);case"search_workspace":return await xp(r,e);case"get_recent_files":return await kp(r,e);default:throw new Error(`Unknown workspace tool: ${n}`)}}async function wp(n,e){if(e)try{let i=await it(`${e}/api/workspace`);if(i.ok){let l=await i.json();if(l.success&&l.data)return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${l.data.workspace}
\u{1F4DD} Name: ${l.data.name}
\u{1F4CA} Total Notes: ${l.data.total_notes}
${l.data.has_bases?"\u2705 Bases enabled":"\u274C Bases not configured"}
${l.data.has_canvas?"\u2705 Canvas enabled":"\u274C Canvas not configured"}
${l.data.has_tasks?"\u2705 Tasks enabled":"\u274C Tasks not configured"}`}]}}}catch{}let r=await jc(n),s=(0,rr.join)(n,".lokus"),o=await Rp(s);return{content:[{type:"text",text:`**Workspace Information**

\u{1F4C1} Path: ${n}
\u{1F4DD} Notes: ${r.noteCount}
\u{1F4C2} Folders: ${r.folderCount}
\u{1F4BE} Total Size: ${Tp(r.totalSize)}
\u{1F527} Lokus Features: ${o?"Configured":"Not configured"}`}]}}async function jc(n){let e={noteCount:0,folderCount:0,totalSize:0,fileTypes:{}};async function r(s){let o=await(0,Te.readdir)(s,{withFileTypes:!0});for(let i of o){if(i.name.startsWith("."))continue;let l=(0,rr.join)(s,i.name);if(i.isDirectory())e.folderCount++,await r(l);else if(i.isFile()){let u=await(0,Te.stat)(l);e.totalSize+=u.size;let p=i.name.split(".").pop();e.fileTypes[p]=(e.fileTypes[p]||0)+1,["md","txt"].includes(p)&&e.noteCount++}}}return await r(n),e}async function Sp(n,e){let r=[];async function s(i,l=0,u=""){if(l>=e)return;let p=await(0,Te.readdir)(i,{withFileTypes:!0});for(let d of p)if(!d.name.startsWith(".")&&d.isDirectory()){let y=u?`${u}/${d.name}`:d.name;r.push({name:d.name,path:y,depth:l}),await s((0,rr.join)(i,d.name),l+1,y)}}return await s(n),{content:[{type:"text",text:`**Workspace Folders:**

${r.sort((i,l)=>i.path.localeCompare(l.path)).map(i=>"  ".repeat(i.depth)+"\u{1F4C1} "+i.name).join(`
`)}`}]}}async function vp(n){let e=(0,rr.join)(n,".lokus","settings.json");try{let r=await(0,Te.readFile)(e,"utf-8"),s=JSON.parse(r);return{content:[{type:"text",text:`**Workspace Settings:**

${JSON.stringify(s,null,2)}`}]}}catch{return{content:[{type:"text",text:"No workspace settings found. This workspace may not be configured for Lokus."}]}}}async function xp(n,{query:e,fileTypes:r=["md","txt"],limit:s=20}){let o=[];async function i(l){let u=await(0,Te.readdir)(l,{withFileTypes:!0});for(let p of u){if(p.name.startsWith("."))continue;let d=(0,rr.join)(l,p.name);if(p.isDirectory())await i(d);else if(p.isFile()){let y=p.name.split(".").pop();if(r.includes(y))try{let S=await(0,Te.readFile)(d,"utf-8");if(S.toLowerCase().includes(e.toLowerCase())){let R=S.toLowerCase().indexOf(e.toLowerCase()),j=Math.max(0,R-50),k=Math.min(S.length,R+e.length+50),z=S.substring(j,k).replace(/\n/g," ");if(o.push({file:d.replace(n+"/",""),context:z}),o.length>=s)return}}catch{}}}}return await i(n),{content:[{type:"text",text:`Found ${o.length} matches for "${e}":

${o.map(l=>`**${l.file}**
  ...${l.context}...`).join(`

`)}`}]}}async function kp(n,{count:e=10,fileTypes:r=null}){let s=[];async function o(l){let u=await(0,Te.readdir)(l,{withFileTypes:!0});for(let p of u){if(p.name.startsWith("."))continue;let d=(0,rr.join)(l,p.name);if(p.isDirectory())await o(d);else if(p.isFile()){let y=p.name.split(".").pop();if(!r||r.includes(y)){let S=await(0,Te.stat)(d);s.push({path:d.replace(n+"/",""),name:p.name,modified:S.mtime,size:S.size})}}}}return await o(n),s.sort((l,u)=>u.modified-l.modified),{content:[{type:"text",text:`**Recently Modified Files:**

${s.slice(0,e).map(l=>`- ${l.name} (${l.path})
  Modified: ${l.modified.toISOString()}`).join(`
`)}`}]}}async function Rp(n){try{return await(0,Te.stat)(n),!0}catch{return!1}}function Tp(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(2)} KB`:n<1024*1024*1024?`${(n/(1024*1024)).toFixed(2)} MB`:`${(n/(1024*1024*1024)).toFixed(2)} GB`}var te=require("fs/promises"),We=require("path"),Fa=[{name:"list_bases",description:"List all bases (databases) in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_base",description:"Get details of a specific base including schema and records",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}},{name:"create_base",description:"Create a new base with specified schema",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the new base"},schema:{type:"object",description:"Schema definition for the base",properties:{fields:{type:"array",description:"Field definitions"}}},description:{type:"string",description:"Description of the base"}},required:["name","schema"]}},{name:"add_base_record",description:"Add a new record to a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},record:{type:"object",description:"Record data"}},required:["baseName","record"]}},{name:"query_base",description:"Query records from a base with filters",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},filter:{type:"object",description:"Filter criteria"},sort:{type:"object",description:"Sort criteria"},limit:{type:"number",description:"Maximum records to return"}},required:["baseName"]}},{name:"update_base_record",description:"Update a record in a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to update"},updates:{type:"object",description:"Fields to update"}},required:["baseName","recordId","updates"]}},{name:"delete_base_record",description:"Delete a record from a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"},recordId:{type:"string",description:"ID of the record to delete"}},required:["baseName","recordId"]}},{name:"get_base_stats",description:"Get statistics about a base",inputSchema:{type:"object",properties:{baseName:{type:"string",description:"Name of the base"}},required:["baseName"]}}];async function Ic(n,e,r,s){switch(n){case"list_bases":return await Cp(r);case"get_base":return await Ep(r,e.baseName);case"create_base":return await Pp(r,e);case"add_base_record":return await Ap(r,e);case"query_base":return await $p(r,e);case"update_base_record":return await Op(r,e);case"delete_base_record":return await jp(r,e);case"get_base_stats":return await Ip(r,e.baseName);default:throw new Error(`Unknown bases tool: ${n}`)}}async function Cp(n){let e=(0,We.join)(n,".lokus","bases");try{let r=await(0,te.readdir)(e,{withFileTypes:!0}),s=[];for(let o of r)if(o.isFile()&&o.name.endsWith(".json")){let i=o.name.replace(".json","");try{let l=await(0,te.readFile)((0,We.join)(e,o.name),"utf-8"),u=JSON.parse(l);s.push({name:i,recordCount:u.records?u.records.length:0,fields:u.schema?.fields?.length||0,description:u.description})}catch{}}return{content:[{type:"text",text:`**Bases in Workspace:**

${s.length>0?s.map(o=>`\u{1F4CA} **${o.name}**
  - Records: ${o.recordCount}
  - Fields: ${o.fields}
  - ${o.description||"No description"}`).join(`

`):"No bases found in this workspace"}`}]}}catch{return{content:[{type:"text",text:"Bases feature not configured in this workspace"}]}}}async function Ep(n,e){let r=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let s=await(0,te.readFile)(r,"utf-8"),o=JSON.parse(s);return{content:[{type:"text",text:`**Base: ${e}**

Description: ${o.description||"No description"}
Created: ${o.created||"Unknown"}
Modified: ${o.modified||"Unknown"}

**Schema:**
${o.schema?.fields?.map(i=>`- ${i.name} (${i.type})`).join(`
`)||"No schema defined"}

**Records (${o.records?.length||0}):**
${o.records?.slice(0,5).map(i=>JSON.stringify(i)).join(`
`)||"No records"}
${o.records?.length>5?`
... and ${o.records.length-5} more records`:""}`}]}}catch{return{content:[{type:"text",text:`Base "${e}" not found`}]}}}async function Pp(n,{name:e,schema:r,description:s}){let o=(0,We.join)(n,".lokus","bases"),i=(0,We.join)(o,`${e}.json`);await(0,te.mkdir)(o,{recursive:!0});let l={name:e,description:s,schema:r,records:[],created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,te.writeFile)(i,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Base "${e}" created successfully with ${r.fields?.length||0} fields`}]}}async function Ap(n,{baseName:e,record:r}){let s=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let o=await(0,te.readFile)(s,"utf-8"),i=JSON.parse(o);return r.id||(r.id=Date.now().toString(36)+Math.random().toString(36).substr(2)),r.created=new Date().toISOString(),r.modified=new Date().toISOString(),i.records=i.records||[],i.records.push(r),i.modified=new Date().toISOString(),await(0,te.writeFile)(s,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Record added to base "${e}" with ID: ${r.id}`}]}}catch(o){return{content:[{type:"text",text:`\u274C Failed to add record: ${o.message}`}]}}}async function $p(n,{baseName:e,filter:r={},sort:s=null,limit:o=100}){let i=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let l=await(0,te.readFile)(i,"utf-8"),p=JSON.parse(l).records||[];if(Object.keys(r).length>0&&(p=p.filter(d=>{for(let[y,S]of Object.entries(r))if(d[y]!==S)return!1;return!0})),s){let d=Object.keys(s)[0],y=s[d];p.sort((S,R)=>y==="asc"?S[d]>R[d]?1:-1:S[d]<R[d]?1:-1)}return p=p.slice(0,o),{content:[{type:"text",text:`**Query Results (${p.length} records):**

${p.map(d=>JSON.stringify(d,null,2)).join(`
---
`)}`}]}}catch(l){return{content:[{type:"text",text:`\u274C Query failed: ${l.message}`}]}}}async function Op(n,{baseName:e,recordId:r,updates:s}){let o=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let i=await(0,te.readFile)(o,"utf-8"),l=JSON.parse(i),u=l.records?.findIndex(p=>p.id===r);if(u===-1)throw new Error(`Record with ID ${r} not found`);return l.records[u]={...l.records[u],...s,id:r,modified:new Date().toISOString()},l.modified=new Date().toISOString(),await(0,te.writeFile)(o,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} updated in base "${e}"`}]}}catch(i){return{content:[{type:"text",text:`\u274C Update failed: ${i.message}`}]}}}async function jp(n,{baseName:e,recordId:r}){let s=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let o=await(0,te.readFile)(s,"utf-8"),i=JSON.parse(o),l=i.records?.length||0;if(i.records=i.records?.filter(u=>u.id!==r)||[],i.records.length===l)throw new Error(`Record with ID ${r} not found`);return i.modified=new Date().toISOString(),await(0,te.writeFile)(s,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Record ${r} deleted from base "${e}"`}]}}catch(o){return{content:[{type:"text",text:`\u274C Delete failed: ${o.message}`}]}}}async function Ip(n,e){let r=(0,We.join)(n,".lokus","bases",`${e}.json`);try{let s=await(0,te.readFile)(r,"utf-8"),o=JSON.parse(s),i={recordCount:o.records?.length||0,fieldCount:o.schema?.fields?.length||0,created:o.created,modified:o.modified,sizeBytes:Buffer.byteLength(s,"utf8"),fieldTypes:{}};if(o.schema?.fields)for(let l of o.schema.fields)i.fieldTypes[l.type]=(i.fieldTypes[l.type]||0)+1;if(o.records?.length>0){i.fillRates={};for(let l of o.schema?.fields||[]){let u=o.records.filter(p=>p[l.name]!=null).length;i.fillRates[l.name]=`${(u/o.records.length*100).toFixed(1)}%`}}return{content:[{type:"text",text:`**Base Statistics: ${e}**

\u{1F4CA} Records: ${i.recordCount}
\u{1F4CB} Fields: ${i.fieldCount}
\u{1F4C5} Created: ${i.created}
\u{1F504} Modified: ${i.modified}
\u{1F4BE} Size: ${(i.sizeBytes/1024).toFixed(2)} KB

**Field Types:**
${Object.entries(i.fieldTypes).map(([l,u])=>`- ${l}: ${u}`).join(`
`)}

${i.fillRates?`**Field Fill Rates:**
${Object.entries(i.fillRates).map(([l,u])=>`- ${l}: ${u}`).join(`
`)}`:""}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to get stats: ${s.message}`}]}}}var be=require("fs/promises"),ct=require("path"),qa=[{name:"list_canvases",description:"List all canvases in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_canvas",description:"Get canvas data including shapes and connections",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID or name"}},required:["canvasId"]}},{name:"create_canvas",description:"Create a new canvas",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name for the canvas"},description:{type:"string",description:"Canvas description"}},required:["name"]}},{name:"add_canvas_shape",description:"Add a shape to canvas (text, rectangle, arrow, etc)",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},shape:{type:"object",description:"Shape data (type, position, content, style)"}},required:["canvasId","shape"]}},{name:"get_canvas_connections",description:"Get all connections/arrows between shapes",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"}},required:["canvasId"]}},{name:"export_canvas",description:"Export canvas as JSON or markdown",inputSchema:{type:"object",properties:{canvasId:{type:"string",description:"Canvas ID"},format:{type:"string",enum:["json","markdown","mermaid"],description:"Export format"}},required:["canvasId"]}}];async function Nc(n,e,r,s){switch(n){case"list_canvases":return await Np(r);case"get_canvas":return await Bp(r,e.canvasId);case"create_canvas":return await Wp(r,e);case"add_canvas_shape":return await Dp(r,e);case"get_canvas_connections":return await Fp(r,e.canvasId);case"export_canvas":return await qp(r,e);default:throw new Error(`Unknown canvas tool: ${n}`)}}async function Np(n){let e=(0,ct.join)(n,".lokus","canvas");try{let r=await(0,be.readdir)(e,{withFileTypes:!0}),s=[];for(let o of r)if(o.isFile()&&o.name.endsWith(".json")){let i=o.name.replace(".json","");try{let l=await(0,be.readFile)((0,ct.join)(e,o.name),"utf-8"),u=JSON.parse(l);s.push({id:i,name:u.name||i,shapeCount:u.shapes?.length||0,created:u.created,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Canvases in Workspace:**

${s.length>0?s.map(o=>`\u{1F3A8} **${o.name}**
  - ID: ${o.id}
  - Shapes: ${o.shapeCount}
  - Modified: ${o.modified||"Unknown"}`).join(`

`):"No canvases found"}`}]}}catch{return{content:[{type:"text",text:"Canvas feature not configured in this workspace"}]}}}async function Bp(n,e){let r=(0,ct.join)(n,".lokus","canvas",`${e}.json`);try{let s=await(0,be.readFile)(r,"utf-8"),o=JSON.parse(s),i=o.shapes||[],l=i.filter(p=>p.type==="arrow"||p.type==="line"),u=i.filter(p=>p.type!=="arrow"&&p.type!=="line");return{content:[{type:"text",text:`**Canvas: ${o.name||e}**

\u{1F4CA} Nodes: ${u.length}
\u{1F517} Connections: ${l.length}
\u{1F4C5} Modified: ${o.modified||"Unknown"}

**Shapes:**
${u.slice(0,10).map(p=>`- ${p.type}: ${p.text||p.label||"No text"}`).join(`
`)}
${u.length>10?`... and ${u.length-10} more shapes`:""}

**Connections:**
${l.slice(0,5).map(p=>`- ${p.from||"unknown"} \u2192 ${p.to||"unknown"}`).join(`
`)}
${l.length>5?`... and ${l.length-5} more connections`:""}`}]}}catch{return{content:[{type:"text",text:`Canvas "${e}" not found`}]}}}async function Wp(n,{name:e,description:r}){let s=(0,ct.join)(n,".lokus","canvas");await(0,be.mkdir)(s,{recursive:!0});let o=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),i=(0,ct.join)(s,`${o}.json`),l={id:o,name:e,description:r,shapes:[],viewport:{x:0,y:0,zoom:1},created:new Date().toISOString(),modified:new Date().toISOString()};return await(0,be.writeFile)(i,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Canvas "${e}" created with ID: ${o}`}]}}async function Dp(n,{canvasId:e,shape:r}){let s=(0,ct.join)(n,".lokus","canvas",`${e}.json`);try{let o=await(0,be.readFile)(s,"utf-8"),i=JSON.parse(o),l={id:r.id||Date.now().toString(36)+Math.random().toString(36).substr(2),type:r.type||"rectangle",x:r.x||100,y:r.y||100,width:r.width||200,height:r.height||100,text:r.text||"",style:r.style||{},...r};return i.shapes=i.shapes||[],i.shapes.push(l),i.modified=new Date().toISOString(),await(0,be.writeFile)(s,JSON.stringify(i,null,2)),{content:[{type:"text",text:`\u2705 Shape added to canvas "${e}" with ID: ${l.id}`}]}}catch(o){return{content:[{type:"text",text:`\u274C Failed to add shape: ${o.message}`}]}}}async function Fp(n,e){let r=(0,ct.join)(n,".lokus","canvas",`${e}.json`);try{let s=await(0,be.readFile)(r,"utf-8"),i=(JSON.parse(s).shapes||[]).filter(u=>u.type==="arrow"||u.type==="line"||u.type==="connection"),l={};return i.forEach(u=>{let p=u.from||u.startId||"unknown",d=u.to||u.endId||"unknown";l[p]||(l[p]=[]),l[p].push(d)}),{content:[{type:"text",text:`**Canvas Connections:**

${Object.entries(l).map(([u,p])=>`\u{1F4CD} ${u}
${p.map(d=>`  \u2192 ${d}`).join(`
`)}`).join(`

`)}

Total connections: ${i.length}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to get connections: ${s.message}`}]}}}async function qp(n,{canvasId:e,format:r="markdown"}){let s=(0,ct.join)(n,".lokus","canvas",`${e}.json`);try{let o=await(0,be.readFile)(s,"utf-8"),i=JSON.parse(o),l="";switch(r){case"markdown":l=`# ${i.name||e}

`,l+=i.description?`${i.description}

`:"",(i.shapes||[]).filter(d=>d.type!=="arrow"&&d.type!=="line").forEach(d=>{l+=`## ${d.text||d.label||"Node"}

`,d.description&&(l+=`${d.description}

`)});break;case"mermaid":l=`graph TD
`,(i.shapes||[]).forEach(d=>{d.type==="arrow"||d.type==="connection"?l+=`  ${d.from||d.startId} --> ${d.to||d.endId}
`:d.text&&(l+=`  ${d.id}["${d.text}"]
`)});break;case"json":default:l=JSON.stringify(i,null,2);break}return{content:[{type:"text",text:l}]}}catch(o){return{content:[{type:"text",text:`\u274C Failed to export canvas: ${o.message}`}]}}}var ae=require("fs/promises"),Ve=require("path"),La=[{name:"list_boards",description:"List all kanban boards in the workspace",inputSchema:{type:"object",properties:{}}},{name:"get_board",description:"Get kanban board with columns and cards",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID or name"}},required:["boardId"]}},{name:"create_board",description:"Create a new kanban board",inputSchema:{type:"object",properties:{name:{type:"string",description:"Board name"},columns:{type:"array",items:{type:"string"},description:"Column names (e.g., ['To Do', 'In Progress', 'Done'])"}},required:["name"]}},{name:"add_card",description:"Add a card to a kanban column",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},column:{type:"string",description:"Column name"},card:{type:"object",description:"Card data (title, description, tags, etc)"}},required:["boardId","column","card"]}},{name:"move_card",description:"Move a card between columns",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},fromColumn:{type:"string",description:"Source column"},toColumn:{type:"string",description:"Target column"}},required:["boardId","cardId","fromColumn","toColumn"]}},{name:"update_card",description:"Update card properties",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"},cardId:{type:"string",description:"Card ID"},updates:{type:"object",description:"Fields to update"}},required:["boardId","cardId","updates"]}},{name:"get_board_stats",description:"Get statistics for a kanban board",inputSchema:{type:"object",properties:{boardId:{type:"string",description:"Board ID"}},required:["boardId"]}}];async function Bc(n,e,r,s){switch(n){case"list_boards":return await Lp(r);case"get_board":return await Mp(r,e.boardId);case"create_board":return await zp(r,e);case"add_card":return await Up(r,e);case"move_card":return await Hp(r,e);case"update_card":return await Vp(r,e);case"get_board_stats":return await Zp(r,e.boardId);default:throw new Error(`Unknown kanban tool: ${n}`)}}async function Lp(n){let e=(0,Ve.join)(n,".lokus","kanban");try{let r=await(0,ae.readdir)(e,{withFileTypes:!0}),s=[];for(let o of r)if(o.isFile()&&o.name.endsWith(".json")){let i=o.name.replace(".json","");try{let l=await(0,ae.readFile)((0,Ve.join)(e,o.name),"utf-8"),u=JSON.parse(l),p=Object.values(u.columns||{}).reduce((d,y)=>d+(y.cards?.length||0),0);s.push({id:i,name:u.name||i,columns:Object.keys(u.columns||{}).length,cards:p,modified:u.modified})}catch{}}return{content:[{type:"text",text:`**Kanban Boards:**

${s.length>0?s.map(o=>`\u{1F4CB} **${o.name}**
  - ID: ${o.id}
  - Columns: ${o.columns}
  - Cards: ${o.cards}
  - Modified: ${o.modified||"Unknown"}`).join(`

`):"No kanban boards found"}`}]}}catch{return{content:[{type:"text",text:"Kanban feature not configured in this workspace"}]}}}async function Mp(n,e){let r=(0,Ve.join)(n,".lokus","kanban",`${e}.json`);try{let s=await(0,ae.readFile)(r,"utf-8"),o=JSON.parse(s),i=`**Kanban Board: ${o.name||e}**

`;for(let[l,u]of Object.entries(o.columns||{})){let p=u.cards||[];i+=`**${l}** (${p.length} cards)
`,p.slice(0,5).forEach(d=>{i+=`  \u2022 ${d.title}`,d.tags?.length&&(i+=` [${d.tags.join(", ")}]`),d.assignee&&(i+=` @${d.assignee}`),i+=`
`}),p.length>5&&(i+=`  ... and ${p.length-5} more cards
`),i+=`
`}return{content:[{type:"text",text:i}]}}catch{return{content:[{type:"text",text:`Board "${e}" not found`}]}}}async function zp(n,{name:e,columns:r=["To Do","In Progress","Done"]}){let s=(0,Ve.join)(n,".lokus","kanban");await(0,ae.mkdir)(s,{recursive:!0});let o=e.toLowerCase().replace(/[^a-z0-9]/g,"-"),i=(0,Ve.join)(s,`${o}.json`),l={id:o,name:e,columns:{},created:new Date().toISOString(),modified:new Date().toISOString()};for(let u of r)l.columns[u]={name:u,cards:[],order:r.indexOf(u)};return await(0,ae.writeFile)(i,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Kanban board "${e}" created with ${r.length} columns:
${r.map(u=>`  - ${u}`).join(`
`)}`}]}}async function Up(n,{boardId:e,column:r,card:s}){let o=(0,Ve.join)(n,".lokus","kanban",`${e}.json`);try{let i=await(0,ae.readFile)(o,"utf-8"),l=JSON.parse(i);if(!l.columns[r])throw new Error(`Column "${r}" not found`);let u={id:s.id||Date.now().toString(36)+Math.random().toString(36).substr(2),title:s.title||"Untitled",description:s.description||"",tags:s.tags||[],assignee:s.assignee||null,priority:s.priority||"normal",dueDate:s.dueDate||null,created:new Date().toISOString(),modified:new Date().toISOString(),...s};return l.columns[r].cards=l.columns[r].cards||[],l.columns[r].cards.push(u),l.modified=new Date().toISOString(),await(0,ae.writeFile)(o,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Card "${u.title}" added to column "${r}" with ID: ${u.id}`}]}}catch(i){return{content:[{type:"text",text:`\u274C Failed to add card: ${i.message}`}]}}}async function Hp(n,{boardId:e,cardId:r,fromColumn:s,toColumn:o}){let i=(0,Ve.join)(n,".lokus","kanban",`${e}.json`);try{let l=await(0,ae.readFile)(i,"utf-8"),u=JSON.parse(l);if(!u.columns[s]||!u.columns[o])throw new Error("Column not found");let p=u.columns[s].cards?.findIndex(y=>y.id===r);if(p===-1)throw new Error(`Card ${r} not found in column ${s}`);let[d]=u.columns[s].cards.splice(p,1);return d.modified=new Date().toISOString(),u.columns[o].cards=u.columns[o].cards||[],u.columns[o].cards.push(d),u.modified=new Date().toISOString(),await(0,ae.writeFile)(i,JSON.stringify(u,null,2)),{content:[{type:"text",text:`\u2705 Card "${d.title}" moved from "${s}" to "${o}"`}]}}catch(l){return{content:[{type:"text",text:`\u274C Failed to move card: ${l.message}`}]}}}async function Vp(n,{boardId:e,cardId:r,updates:s}){let o=(0,Ve.join)(n,".lokus","kanban",`${e}.json`);try{let i=await(0,ae.readFile)(o,"utf-8"),l=JSON.parse(i),u=!1;for(let p of Object.values(l.columns||{})){let d=p.cards?.findIndex(y=>y.id===r);if(d!==-1){p.cards[d]={...p.cards[d],...s,id:r,modified:new Date().toISOString()},u=!0;break}}if(!u)throw new Error(`Card ${r} not found`);return l.modified=new Date().toISOString(),await(0,ae.writeFile)(o,JSON.stringify(l,null,2)),{content:[{type:"text",text:`\u2705 Card ${r} updated successfully`}]}}catch(i){return{content:[{type:"text",text:`\u274C Failed to update card: ${i.message}`}]}}}async function Zp(n,e){let r=(0,Ve.join)(n,".lokus","kanban",`${e}.json`);try{let s=await(0,ae.readFile)(r,"utf-8"),o=JSON.parse(s),i={columnCount:Object.keys(o.columns||{}).length,totalCards:0,cardsByColumn:{},cardsByPriority:{high:0,normal:0,low:0},cardsByAssignee:{},overdueTasks:0},l=new Date;for(let[u,p]of Object.entries(o.columns||{})){let d=p.cards||[];i.totalCards+=d.length,i.cardsByColumn[u]=d.length;for(let y of d)i.cardsByPriority[y.priority||"normal"]++,y.assignee&&(i.cardsByAssignee[y.assignee]=(i.cardsByAssignee[y.assignee]||0)+1),y.dueDate&&new Date(y.dueDate)<l&&i.overdueTasks++}return{content:[{type:"text",text:`**Board Statistics: ${o.name||e}**

\u{1F4CA} Total Cards: ${i.totalCards}
\u{1F4CB} Columns: ${i.columnCount}
\u26A0\uFE0F Overdue Tasks: ${i.overdueTasks}

**Cards by Column:**
${Object.entries(i.cardsByColumn).map(([u,p])=>`  - ${u}: ${p}`).join(`
`)}

**Cards by Priority:**
  - High: ${i.cardsByPriority.high}
  - Normal: ${i.cardsByPriority.normal}
  - Low: ${i.cardsByPriority.low}

**Cards by Assignee:**
${Object.entries(i.cardsByAssignee).map(([u,p])=>`  - @${u}: ${p}`).join(`
`)||"  No assignments"}`}]}}catch(s){return{content:[{type:"text",text:`\u274C Failed to get stats: ${s.message}`}]}}}var ps=require("fs/promises"),nr=require("path"),Ma=[{name:"get_graph_overview",description:"Get overview of the knowledge graph",inputSchema:{type:"object",properties:{}}},{name:"get_node_connections",description:"Get all connections for a specific node (note)",inputSchema:{type:"object",properties:{nodeName:{type:"string",description:"Name of the node/note"}},required:["nodeName"]}},{name:"find_path",description:"Find path between two nodes in the graph",inputSchema:{type:"object",properties:{from:{type:"string",description:"Starting node"},to:{type:"string",description:"Target node"}},required:["from","to"]}},{name:"get_orphan_notes",description:"Find notes with no connections (orphans)",inputSchema:{type:"object",properties:{}}},{name:"get_hub_notes",description:"Find most connected notes (hubs)",inputSchema:{type:"object",properties:{limit:{type:"number",description:"Number of top hubs to return"}}}},{name:"get_clusters",description:"Identify clusters of related notes",inputSchema:{type:"object",properties:{}}}];async function Wc(n,e,r,s){switch(n){case"get_graph_overview":return await Jp(r);case"get_node_connections":return await Yp(r,e.nodeName);case"find_path":return await Gp(r,e.from,e.to);case"get_orphan_notes":return await Qp(r);case"get_hub_notes":return await Kp(r,e.limit||10);case"get_clusters":return await Xp(r);default:throw new Error(`Unknown graph tool: ${n}`)}}async function Pr(n){let e={nodes:new Set,edges:[],adjacencyList:{}};async function r(s){let o=await(0,ps.readdir)(s,{withFileTypes:!0});for(let i of o){if(i.name.startsWith("."))continue;let l=(0,nr.join)(s,i.name);if(i.isDirectory())await r(l);else if(i.isFile()&&[".md",".txt"].includes((0,nr.extname)(i.name))){let u=(0,nr.basename)(i.name,(0,nr.extname)(i.name));e.nodes.add(u);try{let y=((await(0,ps.readFile)(l,"utf-8")).match(/\[\[([^\]]+)\]\]/g)||[]).map(S=>S.slice(2,-2));e.adjacencyList[u]=y;for(let S of y)e.edges.push({from:u,to:S})}catch{}}}}return await r(n),e}async function Jp(n){let e=await Pr(n),r={totalNodes:e.nodes.size,totalEdges:e.edges.length,avgConnections:e.edges.length/Math.max(e.nodes.size,1),orphanCount:0,hubCount:0};for(let s of e.nodes){let o=(e.adjacencyList[s]||[]).length,i=e.edges.filter(u=>u.to===s).length,l=o+i;l===0&&r.orphanCount++,l>5&&r.hubCount++}return{content:[{type:"text",text:`**Knowledge Graph Overview**

\u{1F535} Total Notes: ${r.totalNodes}
\u{1F517} Total Connections: ${r.totalEdges}
\u{1F4CA} Avg Connections: ${r.avgConnections.toFixed(2)}
\u{1F3DD}\uFE0F Orphan Notes: ${r.orphanCount}
\u{1F31F} Hub Notes (>5 connections): ${r.hubCount}

The knowledge graph shows how your notes are interconnected through wiki links.`}]}}async function Yp(n,e){let r=await Pr(n),s=r.adjacencyList[e]||[],o=r.edges.filter(l=>l.to===e).map(l=>l.from),i=new Set([...s,...o]);return{content:[{type:"text",text:`**Connections for "${e}"**

**Outgoing Links (${s.length}):**
${s.map(l=>`  \u2192 ${l}`).join(`
`)||"  None"}

**Incoming Links (${o.length}):**
${o.map(l=>`  \u2190 ${l}`).join(`
`)||"  None"}

**All Related Notes (${i.size}):**
${Array.from(i).map(l=>`  \u2022 ${l}`).join(`
`)||"  None"}`}]}}async function Gp(n,e,r){let s=await Pr(n),o=[[e]],i=new Set([e]);for(;o.length>0;){let l=o.shift(),u=l[l.length-1];if(u===r)return{content:[{type:"text",text:`**Path from "${e}" to "${r}":**

${l.map((d,y)=>y===0?`\u{1F7E2} ${d}`:y===l.length-1?`\u{1F534} ${d}`:`\u26AA ${d}`).join(" \u2192 ")}

Path length: ${l.length-1} steps`}]};let p=s.adjacencyList[u]||[];for(let d of p)i.has(d)||(i.add(d),o.push([...l,d]))}return{content:[{type:"text",text:`No path found from "${e}" to "${r}". These notes are not connected in the knowledge graph.`}]}}async function Qp(n){let e=await Pr(n),r=[];for(let s of e.nodes){let o=(e.adjacencyList[s]||[]).length,i=e.edges.filter(l=>l.to===s).length;o===0&&i===0&&r.push(s)}return{content:[{type:"text",text:`**Orphan Notes (${r.length}):**

These notes have no connections to other notes:

${r.map(s=>`  \u2022 ${s}`).join(`
`)||"No orphan notes found!"}

Consider linking these notes to integrate them into your knowledge graph.`}]}}async function Kp(n,e){let r=await Pr(n),s={};for(let i of r.nodes){let l=(r.adjacencyList[i]||[]).length,u=r.edges.filter(p=>p.to===i).length;s[i]=l+u}let o=Object.entries(s).sort((i,l)=>l[1]-i[1]).slice(0,e);return{content:[{type:"text",text:`**Top ${e} Hub Notes:**

These notes are most connected in your knowledge graph:

${o.map(([i,l],u)=>`${u+1}. **${i}** - ${l} connections`).join(`
`)}

Hub notes are central to your knowledge structure and often represent key concepts.`}]}}async function Xp(n){let e=await Pr(n),r=new Set,s=[];function o(i,l){if(r.has(i))return;r.add(i),l.add(i);let u=e.adjacencyList[i]||[];for(let d of u)o(d,l);let p=e.edges.filter(d=>d.to===i).map(d=>d.from);for(let d of p)o(d,l)}for(let i of e.nodes)if(!r.has(i)){let l=new Set;o(i,l),l.size>1&&s.push(Array.from(l))}return s.sort((i,l)=>l.length-i.length),{content:[{type:"text",text:`**Knowledge Clusters (${s.length}):**

${s.slice(0,5).map((i,l)=>`**Cluster ${l+1}** (${i.length} notes):
${i.slice(0,10).map(u=>`  \u2022 ${u}`).join(`
`)}${i.length>10?`
  ... and ${i.length-10} more`:""}`).join(`

`)}${s.length>5?`

... and ${s.length-5} more clusters`:""}

Clusters represent groups of related notes that are interconnected.`}]}}var sr={defaultWorkspace:(0,Ar.join)((0,hs.homedir)(),"Documents","Lokus Workspace"),lokusConfigDir:(0,Ar.join)((0,hs.homedir)(),".lokus"),lastWorkspaceFile:(0,Ar.join)((0,hs.homedir)(),".lokus","last-workspace.json"),apiUrl:"http://127.0.0.1:3333"},re={info:(...n)=>console.error("[MCP]",...n),error:(...n)=>console.error("[MCP ERROR]",...n),warn:(...n)=>console.error("[MCP WARN]",...n)},za=class{constructor(){this.currentWorkspace=null,this.apiAvailable=!1}async getWorkspace(){return this.currentWorkspace?this.currentWorkspace:(this.currentWorkspace=await this.getWorkspaceFromAPI(),this.currentWorkspace?(re.info("Using workspace from Lokus API:",this.currentWorkspace),this.apiAvailable=!0,this.currentWorkspace):(this.currentWorkspace=await this.getLastWorkspace(),this.currentWorkspace?(re.info("Using last workspace from config:",this.currentWorkspace),this.currentWorkspace):(this.currentWorkspace=await this.getDefaultWorkspace(),re.info("Using default workspace:",this.currentWorkspace),this.currentWorkspace)))}async getWorkspaceFromAPI(){try{let e=(await Promise.resolve().then(()=>(rn(),$a))).default,r=await e(`${sr.apiUrl}/api/workspace`,{timeout:2e3});if(r.ok){let s=await r.json();if(s.success&&s.data)return s.data.workspace}}catch{}return null}async getLastWorkspace(){try{let e=await(0,Ce.readFile)(sr.lastWorkspaceFile,"utf-8"),r=JSON.parse(e);if(r.workspace&&await this.validateWorkspace(r.workspace))return r.workspace}catch{}return null}async getDefaultWorkspace(){let e=sr.defaultWorkspace;try{await(0,Ce.access)(e,ms.constants.F_OK)}catch{try{await(0,Ce.mkdir)(e,{recursive:!0}),await(0,Ce.mkdir)((0,Ar.join)(e,".lokus"),{recursive:!0}),await(0,Ce.writeFile)((0,Ar.join)(e,"Welcome.md"),`# Welcome to Lokus!

This is your knowledge workspace. You can:
- Create notes with [[WikiLinks]]
- Organize with Bases (databases)
- Visualize with Canvas
- Manage tasks with Kanban boards
- Explore connections with Graph view

Happy knowledge building! \u{1F680}
`),re.info("Created default workspace at:",e)}catch(r){re.error("Failed to create default workspace:",r)}}return e}async validateWorkspace(e){try{return await(0,Ce.access)(e,ms.constants.R_OK|ms.constants.W_OK),!0}catch{return!1}}async saveLastWorkspace(e){try{await(0,Ce.mkdir)(sr.lokusConfigDir,{recursive:!0}),await(0,Ce.writeFile)(sr.lastWorkspaceFile,JSON.stringify({workspace:e,lastUsed:new Date().toISOString(),apiAvailable:this.apiAvailable}))}catch(r){re.error("Failed to save last workspace:",r)}}async checkAPIStatus(){try{let e=(await Promise.resolve().then(()=>(rn(),$a))).default;return(await e(`${sr.apiUrl}/api/health`,{timeout:1e3})).ok}catch{return!1}}},ys=new za,Ua=new Kn({name:"lokus-mcp-enhanced",version:"2.0.0"},{capabilities:{tools:{},resources:{}}}),Dc=()=>[...Na,...Wa,...Da,...Fa,...qa,...La,...Ma];Ua.setRequestHandler(fa,async()=>{let n=Dc();return re.info(`Providing ${n.length} tools to AI assistant`),{tools:n}});Ua.setRequestHandler(pa,async n=>{let{name:e,arguments:r}=n.params,s=await ys.getWorkspace(),o=ys.apiAvailable?sr.apiUrl:null;re.info(`Executing tool: ${e}`);try{if(Na.some(i=>i.name===e))return await Cc(e,r,o);if(Wa.some(i=>i.name===e))return await $c(e,r,s,o);if(Da.some(i=>i.name===e))return await Oc(e,r,s,o);if(Fa.some(i=>i.name===e))return await Ic(e,r,s,o);if(qa.some(i=>i.name===e))return await Nc(e,r,s,o);if(La.some(i=>i.name===e))return await Bc(e,r,s,o);if(Ma.some(i=>i.name===e))return await Wc(e,r,s,o);throw new Error(`Unknown tool: ${e}`)}catch(i){return re.error(`Tool execution failed for ${e}:`,i.message),{content:[{type:"text",text:`\u274C Error: ${i.message}`}],isError:!0}}});async function eh(){let n=new es;await Ua.connect(n),re.info("==========================================="),re.info("Lokus MCP Server v2.0 started successfully"),re.info(`Offering ${Dc().length} tools`),await ys.checkAPIStatus()?re.info("\u2705 Connected to Lokus app API"):re.info("\u26A0\uFE0F  Lokus app not running (basic features only)");let r=await ys.getWorkspace();re.info("Workspace:",r),re.info("===========================================")}eh().catch(n=>{re.error("Fatal error:",n),process.exit(1)});
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)
*/
